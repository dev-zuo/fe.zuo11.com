
# 装饰器 Decorator
JS里的装饰器(Decorator)目前处于意见征集第二阶段(stage 2)，属于试验性特性，未来的版本中可能发生改变。

Decorator 是一种不错的AOP(面向切面编程)方案，AOP是一种编程思想核心是；**非侵入式增强**，可以在运行时动态的将代码切入到类的指定方法、指定位置上。

**Decorator本质上就是函数的语法糖**，设计模式中有: 装饰者模式

JS是一门弱语言类型，与强语言类型相比，最大的编程陋习就是对类型思维的缺失。学习ts，最重要的就是类型思维的重塑。

## 基本配置
Decorator在TS中还是一项实验性功能，所以在TS的配置文件中需要加一个参数
1. 命令行
```sh
tsc --target ES5 --experimentalDecorators
```
2. tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES5",
    "experimentalDecorators": true
  }
}
```

**在TS中，Decorator可以修饰5中语句：类、属性、方法、访问器、方法参数。**

## 用装饰器装饰类
- 类装饰器不能在声明文件(.d.ts)中
- 类装饰器会在运行时当作函数被调用，类的构造函数作为其唯一的参数
### 没有返回值的类装饰器
```js
// sealed装饰器，如果想密封一个类的构造函数或原型，只要为类加一个该装饰即可
// 当@sealed被执行时，他将密封类的构造函数和原型
@sealed
class Gretter {
  greeting: string;
  constructor(message: string) {
    this.greeting = message;
  }
  greet() {
    return `hello, ${this.greeting}`
  }
}

// @sealed装饰器定义
function sealed(constructor: function) {
  Object.seal(constructor)
  Object.seal(constructor.prototype)
}

```
### 有返回值的类装饰器
如果类装饰器返回一个值，它会使用提供的构造函数来替换类的声明，如果返回一个新的构造函数，必须处理好原来的原型链。
```ts
// 用装饰器重载构造函数
@classDecorator
class Greeter {
  property = 'property';
  hello: string;
  constructor(m: string) {
    this.hello = m
  }
} 
console.log(new Greeter('world')) 
// 未打开装饰器时：
// Greeter { property: 'property', hello: 'world' }

// 打开装饰器后:
// class_1 {
//   property: 'property',
//   hello: 'override',
//   newProperty: 'new Property' }

// @classDecorator实现
function classDecorator<T extends {new(...args:any[]):{}}>(constructor: T) {
  return class extends constructor {
    newProperty = 'new Property';
    hello = 'override'
  }
}
```
<!-- ### 装饰器工厂模式
```ts
function color(value: string) {
  return function() {
    // do something with "target" and "value"
  }
}
``` -->
## 参考
- [如何用 Decorator 装饰你的 Typescript？](https://mp.weixin.qq.com/s/0JTvJJNX4zwE3-Kl6dMvrA)
- [tc39/proposal-decorators](https://github.com/tc39/proposal-decorators)
- [装饰器 - ECMAScript 6入门](http://es6.ruanyifeng.com/#docs/decorator)
- [Decorators · TypeScript](http://www.typescriptlang.org/docs/handbook/decorators.html)
- [Decorators · TypeScript中文](https://zhongsp.gitbooks.io/typescript-handbook/content/doc/handbook/Decorators.html)

