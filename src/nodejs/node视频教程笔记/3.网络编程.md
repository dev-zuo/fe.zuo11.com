# 网络编程
主要介绍 http https http2 websocket

## OSI模型

<table>
  <tr>
    <th>OSI模型</th>
    <th>实际应用</th>
  </tr>
  <tr>
    <td>7 应用层</td>
    <td rowspan="3">应用层: TELNET,SSH,HTTP,SMTP,POP,SSL/TLS,FTP,MIME,HTML,SNMP,MIB,SIP,RTP...</td>
  </tr>
  <tr><td>6 表示层</td></tr>
  <tr><td>5 会话层</td></tr>
  <tr>
    <td>4 传输层</td>
    <td>传输层: TCP,UDP,UDP-Lite,SCTP,DCCP</td>
  </tr>
  <tr>
    <td>3 网络层</td>
    <td>网络层: ARP,IPv4,IPv6,ICMP,IPsec</td>
  </tr>
  <tr>
    <td>2 数据链路层</td>
    <td rowspan="2">以太网，无线LAN，PPP... (双文线电缆、无线、光纤...)</td>
  </tr>
  <tr><td>1 物理层</td></tr>
</talbe>

## http协议
http协议是基于请求响应的无状态协议，可以使用curl发送http请求，看一些信息
```sh
# 向baidu.com发送http请求
curl -v http://www.baidu.com
```
执行结果
```
kevindeMacBook-Air:ts_init kevin$ curl -v http://www.baidu.com
* Rebuilt URL to: http://www.baidu.com/
*   Trying 14.215.177.38...
* TCP_NODELAY set
* Connected to www.baidu.com (14.215.177.38) port 80 (#0)
> GET / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/7.54.0
> Accept: */*
> 
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 2381
< Content-Type: text/html
< Date: Sat, 11 Jan 2020 14:17:27 GMT
< Etag: "588604dd-94d"
< Last-Modified: Mon, 23 Jan 2017 13:27:57 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Set-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/
< 
<!DOCTYPE html>
<!--STATUS OK--><html> <head><meta http-equiv=content-type content=text/html;charset=utf-8><meta http-equiv=X-UA-Compatible content=IE=Edge><meta content=always name=referrer><link rel=stylesheet type=text/css href=http://s1.bdstatic.com/r/www/cache/bdorz/baidu.min.css><title>百度一下，你就知道</title></head> <body link=#0000cc> <div id=wrapper> <div id=head> <div class=head_wrapper> <div class=s_form> <div class=s_form_wrapper> <div id=lg> <img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129> </div> <form id=form name=f action=//www.baidu.com/s class=fm> <input type=hidden name=bdorz_come value=1> <input type=hidden name=ie value=utf-8> <input type=hidden name=f value=8> <input type=hidden name=rsv_bp value=1> <input type=hidden name=rsv_idx value=1> <input type=hidden name=tn value=baidu><span class="bg s_ipt_wr"><input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus></span><span class="bg s_btn_wr"><input type=submit id=su value=百度一下 class="bg s_btn"></span> </form> </div> </div> <div id=u1> <a href=http://news.baidu.com name=tj_trnews class=mnav>新闻</a> <a href=http://www.hao123.com name=tj_trhao123 class=mnav>hao123</a> <a href=http://map.baidu.com name=tj_trmap class=mnav>地图</a> <a href=http://v.baidu.com name=tj_trvideo class=mnav>视频</a> <a href=http://tieba.baidu.com name=tj_trtieba class=mnav>贴吧</a> <noscript> <a href=http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb>登录</a> </noscript> <script>document.write('<a href="http://www.baidu.com/bdorz/login.gif?login&tpl=mn&u='+ encodeURIComponent(window.location.href+ (window.location.search === "" ? "?" : "&")+ "bdorz_come=1")+ '" name="tj_login" class="lb">登录</a>');</script> <a href=//www.baidu.com/more/ name=tj_briicon class=bri style="display: block;">更多产品</a> </div> </div> </div> <div id=ftCon> <div id=ftConw> <p id=lh> <a href=http://home.baidu.com>关于百度</a> <a href=http://ir.baidu.com>About Baidu</a> </p> <p id=cp>&copy;2017&nbsp;Baidu&nbsp;<a href=http://www.baidu.com/duty/>使用百度前必读</a>&nbsp; <a href=http://jianyi.baidu.com/ class=cp-feedback>意见反馈</a>&nbsp;京ICP证030173号&nbsp; <img src=//www.baidu.com/img/gs.gif> </p> </div> </div> </div> </body> </html>
* Connection #0 to host www.baidu.com left intact
kevindeMacBook-Air:ts_init kevin$ 
```
### 特点
无连接、无状态（http协议本身无法保存鉴权、登录状态）、简单快速、灵活
### 请求(request)
上行，curl > 部分内容，向服务器发送请求信息
#### 请求行
- Method  `GET`
  - GET 请求获取url所标识的资源
  - POST 在url所标识的资源里附加新的数据
  - HEAD 请求获取url所标识资源的响应消息报头
  - PUT 请求服务器存储一个资源，并用url作为标识
  - DELETE 请求服务器删除url所标识的资源
  - TRACE 请求服务器回送收到的请求消息，主要用于测试或诊断
  - CONNECT 保留将来使用
- RequestUrl     `www.baidu.com`
- HttpVersion    `/ HTTP/1.1`
#### 消息包头
- Accept 指定客户端接受那些类型的消息/MIME
  - text/html html文本
  - image/gif gif图片
- Accept-Chartset 客户端接受的字符集
  - gb2312 中文字符
  - iso-8859-1 西文字符
  - utf-8 多语言字符
- Accept-Encoding 可接受的内容编码
  - gzip,deflate 压缩类型
  - identify 默认
- Accept-Language 浏览器语言 zh-cn
- Authorization 证明客户端有权查看某个资源（已经很少用了）
- Host 指定被请求资源的internet主机和端口号 www.baidu.com:8080
- User-Agent 用户代理    `curl/7.54.0`
  - 操作系统及版本
  - CPU类型
  - 浏览器版本
  - 浏览器渲染引擎
  - 浏览器语言
  - 浏览器插件
- Content-Type Body（请求正文）的编码方式

#### 请求正文
根据头部的Content-Type确定
- application/x-www-form-urlencoded
  - `title=test&a=2`
  - 默认的数据编码方式
- multipart/form-data 
  - 既有文本数据，又有文件等二进制数据
  - 允许在数据中包含整个文件，常用于文件上传
- application/json 序列化后的JSON字符串，ajax
- text/xml  xml作为编码方式的远程调用规范
- text/plain 纯文本数据

### 响应(response)
下行，curl < 部分内容，从服务器接收数据

## TCP协议与UDP协议的区别
TCP协议需要传统的三次握手，而UDP不需要，所以速度会快点

## TCP协议 - 实现一个即时通讯IM
### socket实现
原理：Net模块能够创建一个基于流的TCP服务器，客户端与服务端建立连接后，服务器可以获得一个全双工Socket对象，服务器可以保存socket对象列表，在接收到某个客户端消息时，再推送给其他客户端。
```js
const net = require('net')
const chatServer = net.createServer()
const clientList = []

chatServer.on('connection', client => {
  client.write('Hi\n')
  clientList.push(client)
  client.on('data', data => {
    console.log('recive:', data.toString())
    clientList.forEach(v => {
      v.write(data)
    })
  })
})

chatServer.listen(9000, () => {
  console.log('服务开启在9000端口')
})
```
使用 `telnet` 连接到服务器，发送消息，其他连接上的客户端就可以收到消息了
```sh
# mac安装telnet：brew install telnet
# telnet是最早的远程控制工具，由于是明文传输，不安全，现在都改为ssh了
# 使用命链接到服务器
telnet localhost 9000
```
