
# Node.js基础
> 官网：https://nodejs.org/en/
> 官方文档：https://nodejs.org/en/docs/guides/

## Node.js 是什么
- Node.js is a JS runtime built on Chrome's V8 JS engine (Node.js是一个基于Chrome V8引擎的JS运行时)
- Node.js是一个异步的事件驱动的JS运行时

什么叫运行时，用类比的方法学习这个概念，一般语言都会提供一个运行时环境，**Node.js其实就是提供js运行时的环境**。
- JRE java运行时环境
- C Runtime
- .NET Common Language Runtime

runtime(运行时)指的是程序运行的时候，即指令加载到内存并由CPU执行的时候。运行时库就是程序运行的时候所依赖的库。

JS是解释型语言，还有一些语言执行之前是要编译的，比如C，Java等

C代码编译成可执行文件的时候，指令没有被CPU执行，这个时候算是编译时，也就是编译的时候。

## Node.js历史 - 为性能而生
Ryan Dahl /'raiən da:l/ 是nodejs的作者，他的工作是用C/C++写高性能web服务，对于高性能，异步IO、事件驱动是基本原则，但用C/C++写就太痛苦了。于是他设想使用另一种高级语言开发Web服务，评估了很多语言，发现很多语言虽然同是提供了异步IO和同步IO，但开发人员一旦使用了同步IO，他们就再也懒得写异步IO了，所以最终Ryan选择了JS。

**因为JS是单线程执行，根本不能进行同步IO操作，所以JS的这一"缺陷"导致了它只能使用异步IO。**

选定开发语言后，还要有运行时引擎。Ryan曾考虑自己写一个，不过明智的放弃了，因为V8就是开源的JS引擎，让Google投资去优化V8，而他只拿来用，还不用付钱。于是2009年，Ryan正式推出了基于JS和V8引擎的开源Web服务项目，命名为Node。Node第一次把JS带入到后端服务器开发，加上JS开发人员众多，Node一下子就火了起来。

## Node.js依赖(Dependencied)
> https://nodejs.org/en/docs/meta/topics/dependencies/

Node.js功能依赖一些库和工具:
### Libraries
- [V8](https://v8docs.nodesource.com/) 由google维护的JS运行时引擎。V8为Node.js提供了JS引擎，Node.js通过V8 C++ API对其进行控制。
- [libuv](https://libuv.org/) 另一个重要的依赖是libuv, 它一个C语言库，用于将非阻塞(异步)IO操作封装为受支持平台之间一致的接口。他提供了处理file system、DNS、netwrok、child process(子进程)，pipes(管道)，信号处理(signal handling)，polling(轮询) and streaming(流传输)的机制. 它还包括了一个线程池(thread pool)，用于分担某些无法在操作系统级别异步完成的工作。
> libuv is a multi-platform support library with a focus on asynchronous I/O. It was primarily developed for use by Node.js
- [llhttp](https://github.com/nodejs/llhttp) Node.js HTTP parsing(解析)是通过llhttp来处理，一个轻量级的TypeScript和C库。他的设计宗旨是不进行任何系统调用(syscalls)或分配(allocations)，因此每个请求的内存占用非常小。
  - 参考：https://github.com/nodejs/http-parser
- [c-ares](https://c-ares.haxx.se/docs.html) 对于某些异步DNS请求，Node.js使用了c-ares来处理。它是一个C库，It is exposed through the DNS module in JavaScript as the resolve() family of functions. 
- [OpenSSL](https://www.openssl.org/docs/) **tls**和**crypto**模块中都广泛使用了OpenSSL，它提供了许多经过考验的加密功能实现，web依赖这些功能来保证安全性
- [zlib](https://www.zlib.net/manual.html) 为了进行快速压缩何解压缩，Node.js依赖于行业标准的zlib库，该库因在gzip何libpng中的使用而闻名。Node.js使用zlib创建同步、异步及流式压缩何解压缩接口。

### Tools 
- npm node package manager, 是Node.js的模块管理器，Node.js is all about modularity，and with that comes the need for a quality package manager; for this purpose, npm was made. With npm comes the largest selection of community-created packages of any programming ecosystem, which makes building Node.js app quick and easy.
- gyp build系统由gyp处理，它是从V8复制的基于python的项目生成器。可以生成用于跨多个平台的构建系统的项目文件。Node.js需要构建系统，因为它的大部分(及其依赖项)使用需要编译的语言写的。
- gtest 可以使用来自Chromium的gtest测试native code，It allows testing C/C++ without needing an existing node executable to bootstrap from.

## Node.js特性(JS特性)
- [非阻塞I/O](https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/)
- [事件驱动](https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/)

## 并发处理
- 多进程 LinuxC、Apache
- 多线程 Java
- 异步I/O JS 事件回调方式
- 协程 - lua openresty、go、deno、TypeScript

ry(Ryan Dahl) 也就是node的作者, 2018年开启了一个新项目[deno](https://deno.land/), A secure JavaScript/TypeScript runtime built with V8, Rust, and Tokio , TypeScript还是非学不可的。

- justjavac对deno的分析介绍，参考 [Deno 并不是下一代 Node.js](https://studygolang.com/articles/13101) 
- [Ryan Dahl：Node 设计失误值得反思，Deno 将汲取经验](https://www.oschina.net/news/96767/design-mistakes-in-node?origin=wxdw)