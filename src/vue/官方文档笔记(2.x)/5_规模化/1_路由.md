# 路由

## 从零开始简单的路由
简单原理：根据url路径改变渲染的模板

- window.location.pathname 为当前url的路径
- 利用render函数、计算属性动态改变渲染的模板
- 注意：前提条件是需要开启http服务，且所有请求都需要指向一个页面。

```html
<!-- 0_从零开始简单的路由.html -->
<body>
  <div id="app">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script>
    const NotFound = { template: '<p>Page not found</p>'}
    const Home = { template: '<p>Home page</p>'}
    const About = { template: '<p>About page</p>'}

    const routes = {
      '/': Home,
      '/about': About
    }

    let app = new Vue({
      el: '#app',
      data: {
        currentRoute: window.location.pathname
      },
      computed: {
        ViewComponent() {
          return routes[this.currentRoute] || NotFound
        }
      },
      render(h) {
        return h(this.ViewComponent)
      }
      // 等价于
      // render: function(h) {
      //   return h(this.ViewComponent)
      // }
    })
  </script>
</body>
```
### 利用node来开启HTTP服务
- 1.在 0_从零开始简单的路由.html 目录下，打开控制台
- 2.npm init 初始化node，安装express
- 3.创建index.js文件，并写入下面的代码，开启http服务，并将所有请求重定向到一个页面
- 4.node index.js后，浏览器访问 127.0.0.1:3000 测试，效果类似于vue-router的history模式
  - 访问 http://127.0.0.1:3000   页面显示 Home page
  - 访问 http://127.0.0.1:3000/about  页面显示 About page
  - 访问未知页面 http://127.0.0.1:3000/test  页面显示 Page not found
```js
// index.js
const express = require('express');
const fs=require("fs");
const app = express();

app.use('*', function(req, res) {
  console.log('接收到请求')
  console.log(req.baseUrl)

  res.sendfile('0_从零开始简单的路由.html')
})

app.listen(3000, function() {  
    console.log("server start at 127.0.0.1:3000");
});
```

## vue-router(官方路由)
对于大多数单页面应用(SPA)，都推荐使用官方支持的 vue-router 库。

- vue-router [开源地址](https://github.com/vuejs/vue-router)
- vue-router [官方文档](https://router.vuejs.org/zh/)

### 安装
#### 直接下载/CDN 
https://unpkg.com/vue-router/dist/vue-router.js

使用示例
```html
<!-- 先加载vue，再加载vue-router -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
```
#### npm安装
npm install vue-router

使用示例
```js
import Vue from 'vue'
import VueRouter from 'vue-router'

Vue.use(VueRouter)
```

### 介绍
> 对于TypeScript用户来说，vue-router@3.0+ 依赖 vue@2.5+，反之亦然。

Vue Router是Vue.js官方的路由管理。和Vue.js核心深度集成。自定义了两个组件RouterView及RouterLink，均使用render函数渲染，包含功能：

- 嵌套的路由/视图表
- 模块化、基于组件的路由配置
- 路由参数、查询、通配符
- 基于Vue.js过渡系统的视图过渡效果
- 细粒度的导航控制
- 带有自动激活的 CSS class的链接
- HTML5历史模式或hash模式，在IE9中自动降级
- 自定义的滚动条行为

vue-router 3.1.3版本源码只有 2900 行左右，有时间可以仔细看看

### 基础
#### 起步(第一个vue-router页面)
```html
<body>
  <div id="app">
    <h1>Hello App!</h1>
    <p>
      <!-- router-link标签会默认渲染为一个a标签，to属性用来指定链接-->
      <router-link to="/foo">Go to Foo</router-link>
      <router-link to="/bar">Go to Bar</router-link>
    </p>

    <!-- 路由出口，路由匹配到组件将在这里渲染-->
    <router-view></router-view>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
  <script>

    // 1. 定义 (路由) 组件。
    const Foo = { template: '<p>foo page</p>'}
    const Bar = { template: '<p>bar page</p>'}

    // 2. 定义路由
    const routes = [
      { path: '/foo', component: Foo },
      { path: '/bar', component: Bar }
    ]

    // 3. 创建 router 实例，然后传 `routes` 配置
    const router = new VueRouter({
      routes // 相当于 routes: routes
    })

    let app = new Vue({
      el: '#app',
      router,
    })
    // 也可以这样写
    // const app = new Vue({
    //   router
    // }).$mount('#app')
  </script>
</body>
```

- 可以在任何组件内通过 this.\$router 访问路由器，也可以通过 this.\$route 访问当前路由
- 使用 this.$router 的原因是我们并不想在每个独立需要封装路由的组件中都导入路由。
- 注意，当 router-link 对应的路由匹配成功，将自动设置 class 属性值 .router-link-active

```js
// Home.vue
export default {
  computed: {
    username() {
      // 我们很快就会看到 `params` 是什么
      return this.$route.params.username
    }
  },
  methods: {
    goBack() {
      window.history.length > 1 ? this.$router.go(-1) : this.$router.push('/')
    }
  }
}
```

#### 动态路由匹配
#### 嵌套路由

### 进阶
#### 导航守卫
#### 路由元信息
#### 过渡效果
#### 数据获取
#### 滚动行为
#### 路由懒加载

## 整合第三方路由
第三方路由这里暂不讨论，参考 [第三方路由](https://cn.vuejs.org/v2/guide/routing.html#%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E8%B7%AF%E7%94%B1)