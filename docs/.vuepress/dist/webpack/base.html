<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 基础 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="左小白的前端笔记，用于记录、完善个人前端知识体系结构">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.acaf374f.css" as="style"><link rel="preload" href="/assets/js/app.203f8a3a.js" as="script"><link rel="preload" href="/assets/js/2.4b3539f1.js" as="script"><link rel="preload" href="/assets/js/147.f447a013.js" as="script"><link rel="preload" href="/assets/js/3.e6a4dd76.js" as="script"><link rel="prefetch" href="/assets/js/10.71696328.js"><link rel="prefetch" href="/assets/js/100.13f02065.js"><link rel="prefetch" href="/assets/js/101.72f8aa86.js"><link rel="prefetch" href="/assets/js/102.26e5e769.js"><link rel="prefetch" href="/assets/js/103.bd1f11da.js"><link rel="prefetch" href="/assets/js/104.92e87bf2.js"><link rel="prefetch" href="/assets/js/105.c5d791fd.js"><link rel="prefetch" href="/assets/js/106.8a17271c.js"><link rel="prefetch" href="/assets/js/107.63297449.js"><link rel="prefetch" href="/assets/js/108.32c52b33.js"><link rel="prefetch" href="/assets/js/109.6cd42a73.js"><link rel="prefetch" href="/assets/js/11.cd2bed73.js"><link rel="prefetch" href="/assets/js/110.4015358f.js"><link rel="prefetch" href="/assets/js/111.24aa7693.js"><link rel="prefetch" href="/assets/js/112.1f0b1706.js"><link rel="prefetch" href="/assets/js/113.d4059e6b.js"><link rel="prefetch" href="/assets/js/114.0d4d4281.js"><link rel="prefetch" href="/assets/js/115.bd6dfbf0.js"><link rel="prefetch" href="/assets/js/116.b4594e01.js"><link rel="prefetch" href="/assets/js/117.904edc7c.js"><link rel="prefetch" href="/assets/js/118.0210c9fa.js"><link rel="prefetch" href="/assets/js/119.12b65423.js"><link rel="prefetch" href="/assets/js/12.f288e29d.js"><link rel="prefetch" href="/assets/js/120.beaef1ad.js"><link rel="prefetch" href="/assets/js/121.3c18bd2f.js"><link rel="prefetch" href="/assets/js/122.59b49736.js"><link rel="prefetch" href="/assets/js/123.40856117.js"><link rel="prefetch" href="/assets/js/124.3e3f634a.js"><link rel="prefetch" href="/assets/js/125.8e6a815e.js"><link rel="prefetch" href="/assets/js/126.d20eda41.js"><link rel="prefetch" href="/assets/js/127.ebd2093b.js"><link rel="prefetch" href="/assets/js/128.902b7354.js"><link rel="prefetch" href="/assets/js/129.864d215e.js"><link rel="prefetch" href="/assets/js/13.82e7edce.js"><link rel="prefetch" href="/assets/js/130.b7fc05ab.js"><link rel="prefetch" href="/assets/js/131.372298bc.js"><link rel="prefetch" href="/assets/js/132.d579f204.js"><link rel="prefetch" href="/assets/js/133.dd74500c.js"><link rel="prefetch" href="/assets/js/134.a32dedb3.js"><link rel="prefetch" href="/assets/js/135.dc558866.js"><link rel="prefetch" href="/assets/js/136.e0e9a2a5.js"><link rel="prefetch" href="/assets/js/137.bd672a56.js"><link rel="prefetch" href="/assets/js/138.07644d14.js"><link rel="prefetch" href="/assets/js/139.61873602.js"><link rel="prefetch" href="/assets/js/14.e81004ee.js"><link rel="prefetch" href="/assets/js/140.f7bd11f3.js"><link rel="prefetch" href="/assets/js/141.94516bbd.js"><link rel="prefetch" href="/assets/js/142.5d1224ae.js"><link rel="prefetch" href="/assets/js/143.e98b3a46.js"><link rel="prefetch" href="/assets/js/144.bc8db6ee.js"><link rel="prefetch" href="/assets/js/145.98bcfe7f.js"><link rel="prefetch" href="/assets/js/146.283fd90f.js"><link rel="prefetch" href="/assets/js/148.c40adbd7.js"><link rel="prefetch" href="/assets/js/15.6d52c5f9.js"><link rel="prefetch" href="/assets/js/16.6a143e09.js"><link rel="prefetch" href="/assets/js/17.92df7b99.js"><link rel="prefetch" href="/assets/js/18.50bc4846.js"><link rel="prefetch" href="/assets/js/19.310fceff.js"><link rel="prefetch" href="/assets/js/20.e5894862.js"><link rel="prefetch" href="/assets/js/21.8dd45d89.js"><link rel="prefetch" href="/assets/js/22.f96f7f7f.js"><link rel="prefetch" href="/assets/js/23.9670a582.js"><link rel="prefetch" href="/assets/js/24.9b6f6c0e.js"><link rel="prefetch" href="/assets/js/25.f7468bea.js"><link rel="prefetch" href="/assets/js/26.2fa477e0.js"><link rel="prefetch" href="/assets/js/27.4dc6c393.js"><link rel="prefetch" href="/assets/js/28.4a449035.js"><link rel="prefetch" href="/assets/js/29.0039a6c5.js"><link rel="prefetch" href="/assets/js/30.8385df39.js"><link rel="prefetch" href="/assets/js/31.6ccde381.js"><link rel="prefetch" href="/assets/js/32.06759061.js"><link rel="prefetch" href="/assets/js/33.446401f5.js"><link rel="prefetch" href="/assets/js/34.8a330d88.js"><link rel="prefetch" href="/assets/js/35.ab009531.js"><link rel="prefetch" href="/assets/js/36.76e1a2c0.js"><link rel="prefetch" href="/assets/js/37.a9c58175.js"><link rel="prefetch" href="/assets/js/38.5b013d96.js"><link rel="prefetch" href="/assets/js/39.cdb89d63.js"><link rel="prefetch" href="/assets/js/4.1546fae2.js"><link rel="prefetch" href="/assets/js/40.8bb1b7f0.js"><link rel="prefetch" href="/assets/js/41.2bb01b3f.js"><link rel="prefetch" href="/assets/js/42.9fcbf6c3.js"><link rel="prefetch" href="/assets/js/43.2566d4e2.js"><link rel="prefetch" href="/assets/js/44.47eef9e4.js"><link rel="prefetch" href="/assets/js/45.b5e3255e.js"><link rel="prefetch" href="/assets/js/46.c5a41894.js"><link rel="prefetch" href="/assets/js/47.5f7bc7e8.js"><link rel="prefetch" href="/assets/js/48.52f1355c.js"><link rel="prefetch" href="/assets/js/49.fb5fa34a.js"><link rel="prefetch" href="/assets/js/5.a74a6229.js"><link rel="prefetch" href="/assets/js/50.9dd30f76.js"><link rel="prefetch" href="/assets/js/51.593ae5ef.js"><link rel="prefetch" href="/assets/js/52.a33c9e05.js"><link rel="prefetch" href="/assets/js/53.1f6ab5f6.js"><link rel="prefetch" href="/assets/js/54.ba46601f.js"><link rel="prefetch" href="/assets/js/55.e4c796c0.js"><link rel="prefetch" href="/assets/js/56.3f66a4f5.js"><link rel="prefetch" href="/assets/js/57.5ffb70f3.js"><link rel="prefetch" href="/assets/js/58.ac90f180.js"><link rel="prefetch" href="/assets/js/59.b6a5fcdf.js"><link rel="prefetch" href="/assets/js/6.68e7d734.js"><link rel="prefetch" href="/assets/js/60.276cc185.js"><link rel="prefetch" href="/assets/js/61.e77e984a.js"><link rel="prefetch" href="/assets/js/62.872daaa3.js"><link rel="prefetch" href="/assets/js/63.a2cd03fc.js"><link rel="prefetch" href="/assets/js/64.1a6d4a06.js"><link rel="prefetch" href="/assets/js/65.3cca1278.js"><link rel="prefetch" href="/assets/js/66.d4482a48.js"><link rel="prefetch" href="/assets/js/67.0e13d8c3.js"><link rel="prefetch" href="/assets/js/68.7d9b4ef6.js"><link rel="prefetch" href="/assets/js/69.577b2fbc.js"><link rel="prefetch" href="/assets/js/7.cb937ed7.js"><link rel="prefetch" href="/assets/js/70.88e4d04d.js"><link rel="prefetch" href="/assets/js/71.7ee4dcbf.js"><link rel="prefetch" href="/assets/js/72.ce4f770e.js"><link rel="prefetch" href="/assets/js/73.e7951b0d.js"><link rel="prefetch" href="/assets/js/74.1a82f36b.js"><link rel="prefetch" href="/assets/js/75.7d20227b.js"><link rel="prefetch" href="/assets/js/76.5dd22cc4.js"><link rel="prefetch" href="/assets/js/77.4416caa6.js"><link rel="prefetch" href="/assets/js/78.84f4de97.js"><link rel="prefetch" href="/assets/js/79.833d6583.js"><link rel="prefetch" href="/assets/js/8.97b32e18.js"><link rel="prefetch" href="/assets/js/80.59e7a444.js"><link rel="prefetch" href="/assets/js/81.bd5879db.js"><link rel="prefetch" href="/assets/js/82.5de38cfa.js"><link rel="prefetch" href="/assets/js/83.a0b3a349.js"><link rel="prefetch" href="/assets/js/84.b6ae8a65.js"><link rel="prefetch" href="/assets/js/85.af9419c6.js"><link rel="prefetch" href="/assets/js/86.b1c300f5.js"><link rel="prefetch" href="/assets/js/87.3732542c.js"><link rel="prefetch" href="/assets/js/88.6d0ce20b.js"><link rel="prefetch" href="/assets/js/89.2c7dbc31.js"><link rel="prefetch" href="/assets/js/9.6344b9c3.js"><link rel="prefetch" href="/assets/js/90.062358cd.js"><link rel="prefetch" href="/assets/js/91.2802e1ed.js"><link rel="prefetch" href="/assets/js/92.83fc011a.js"><link rel="prefetch" href="/assets/js/93.2e4f0637.js"><link rel="prefetch" href="/assets/js/94.57d127a1.js"><link rel="prefetch" href="/assets/js/95.cb445c7d.js"><link rel="prefetch" href="/assets/js/96.6637a2ea.js"><link rel="prefetch" href="/assets/js/97.e2788a04.js"><link rel="prefetch" href="/assets/js/98.0a1f9ea3.js"><link rel="prefetch" href="/assets/js/99.1f4d9522.js">
    <link rel="stylesheet" href="/assets/css/0.styles.acaf374f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zuoxiaobai/fenote" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zuoxiaobai/fenote" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/base.html" aria-current="page" class="active sidebar-link">webpack 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#什么是webpack" class="sidebar-link">什么是webpack</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#使用webpack打包-默认配置" class="sidebar-link">使用webpack打包（默认配置）</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#自定义webpack配置" class="sidebar-link">自定义webpack配置</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#webpack核心配置" class="sidebar-link">webpack核心配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#entry-打包入口" class="sidebar-link">entry - 打包入口</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#output-输出结构" class="sidebar-link">output - 输出结构</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#mode-打包环境" class="sidebar-link">mode - 打包环境</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#module-loader模块处理" class="sidebar-link">module - loader模块处理</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#plugins-插件" class="sidebar-link">plugins - 插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/base.html#webpack其他配置" class="sidebar-link">webpack其他配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#devtool-选择sourcemap方式" class="sidebar-link">devtool - 选择sourceMap方式</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#devserver-开发服务器-代理-hmr" class="sidebar-link">devServer - 开发服务器/代理/HMR</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/base.html#webpack-merge" class="sidebar-link">webpack-merge</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#vue-cli相关" class="sidebar-link">vue-cli相关</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/base.html#处理es6-babel-loader" class="sidebar-link">处理ES6+ babel-loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#babel-polyfill" class="sidebar-link">@babel/polyfill</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#babel-plugin-transform-runtime" class="sidebar-link">@babel/plugin-transform-runtime</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#babelrc文件" class="sidebar-link">.babelrc文件</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#配置react打包环境" class="sidebar-link">配置React打包环境</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/base.html#tree-shaking-摇树" class="sidebar-link">tree shaking ”摇树“</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#tree-shaking副作用" class="sidebar-link">tree shaking副作用</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#tree-shaking概念的理解" class="sidebar-link">tree shaking概念的理解</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/base.html#代码分割-code-splitting" class="sidebar-link">代码分割 code splitting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/base.html#预获取-预加载模块-prefetch-preload-module" class="sidebar-link">预获取/预加载模块(prefetch/preload module)</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/base.html#webpack打包原理分析" class="sidebar-link">webpack打包原理分析</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#自己写一个-loader" class="sidebar-link">自己写一个 loader</a></li><li class="sidebar-sub-header"><a href="/webpack/base.html#自己写一个-plugins" class="sidebar-link">自己写一个 plugins</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-基础"><a href="#webpack-基础" class="header-anchor">#</a> webpack 基础</h1> <blockquote><p>webpack官⽅网站: https://webpack.js.org/</p></blockquote> <h2 id="什么是webpack"><a href="#什么是webpack" class="header-anchor">#</a> 什么是webpack</h2> <p>这里从三个方面来简单介绍什么是webpack：一句话解释、官方解释、结合实际开发来解释</p> <p><strong>一句话解释</strong></p> <p>webpack is a module bundler。webpack 是一个模块打包工具</p> <p><img src="/images/webpack/webpack_1_1.png" alt="webpack_1_1.png"></p> <p><strong>官方解释</strong></p> <blockquote><p>At its core, webpack is a static module bundler for modern JavaScript applications. When webpack processes your application, it internally builds a dependency graph which maps every module your project needs and generates one or more bundles.</p></blockquote> <p>本质上，webpack 是一个用于现代 JavaScript 应用程序的静态模块打包工具(module bundler)。当 webpack 处理应用程序时，它会在内部构建一个包含应用程序所有模块的依赖关系图(dependency graph)，生成一个或多个包(bundles)。</p> <blockquote><p>Since version 4.0.0, webpack does not require a configuration file to bundle your project. Nevertheless, it is incredibly configurable to better fit your needs.</p></blockquote> <p>从webpack 4.0.0 版本开始，可以不用引入配置文件就可以打包。但依旧可以根据你的需要进行高度自定义配置。</p> <p>参考：<a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener noreferrer">Concepts | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>结合实际开发来解释</strong></p> <p>webpack是一个模块打包工具：它会分析当前项目结构，找到JavaScript模块(ES modules)以及其它浏览器不能直接运行的拓展语言，比如.vue、.less, .ts等，将其打包为浏览器可以直接运行的代码。除此之外，它也可以打包.png、.jpg资源文件，对js、html进行混淆压缩等处理</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>安装webpack需要用npm安装两个包：webpack、webpack-cli（安装后，可以在命令行里使用npx，webpack等命令）</p> <p><strong>全局安装(不建议)</strong></p> <p>因为webpack更新很快，不同的项目可能使用不同的webpack版本，为了避免多个项目冲突，建议在项目内局部安装webpack，如果有全局安装了的，建议卸载</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 全局安装</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli -g

<span class="token comment"># 检查是否安装成功，查看 webpack 版本</span>
webpack -v  

<span class="token comment"># 卸载全局的 webpack</span>
<span class="token function">npm</span> uninstall webpack webpack-cli -g
</code></pre></div><p><strong>项目内安装(局部安装)</strong></p> <p>我们可以先创建一个文件夹，再 npm init 创建 package.json，然后通过 --save-dev 参数进行当前项目的局部安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 创建项目demo，并进入该目录</span>
<span class="token function">mkdir</span> webpack_demo<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> webpack_demo<span class="token punctuation">;</span>

<span class="token comment"># 创建package.json</span>
<span class="token function">npm</span> init -y

<span class="token comment"># 开始安装webpack</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli --save-dev

<span class="token comment"># 检查是否安装成功，查看版本</span>
npx webpack -v  <span class="token comment"># </span>
<span class="token comment"># npx会在当前项目中的node_modules里查找webpack </span>
<span class="token comment"># 相当于 ./node_modules/.bin/webpack -v</span>
</code></pre></div><p><strong>安装指定版本</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看webpack的历史版本</span>
<span class="token function">npm</span> info webpack

<span class="token comment"># 安装指定版本</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack@版本号 webpack-cli@版本号 --save-dev

<span class="token comment"># latest 最新版本 latest: 4.44.1</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack@latest webpack-cli@latest --save-dev   

<span class="token comment"># next下一代版本,一般是开发、测试版本 next: 5.0.0-beta.28</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack@next webpack-cli@next --save-dev  
</code></pre></div><p>我项目内安装，默认的版本是 webpack-cli@3.3.12 / webpack@4.44.1</p> <h2 id="使用webpack打包-默认配置"><a href="#使用webpack打包-默认配置" class="header-anchor">#</a> 使用webpack打包（默认配置）</h2> <p>一般执行 npx webpack 会自动对项目进行打包，webpack默认的入口文件为当前目录下src文件的inex.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello webpack'</span><span class="token punctuation">)</span>
</code></pre></div><p>执行 npx webpack，如下图</p> <p><img src="/images/webpack/webpack_1_2.png" alt="webpack_1_2.png"></p> <p>webpack会自动在当前目录创建dist目录、main.js，main.js就是对src/index.js的打包处理，注意输入出的目录dist、main.js都是默认的配置</p> <p><img src="/images/webpack/webpack_1_3.png" alt="webpack_1_3.png"></p> <p>验证打包后的main.js是否可以运行，在 dist 目录创建 index.html，引入 main.js 执行页面，在页面看到 hello webpack 就是执行成功了</p> <h2 id="自定义webpack配置"><a href="#自定义webpack配置" class="header-anchor">#</a> 自定义webpack配置</h2> <p>默认配置会比较弱，如果需要自定义打包，就需要自己写配置了，默认的配置文件是 <code>webpack.config.js</code>，npx webpack执行时，如果当前目录下有webpack.config.js就使用这个配置，如果没有就使用默认配置</p> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'main.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果在webpack.config.js里使用上面的代码，就是使用默认的webpack配置：入口为 src/index, 输出目录为./dist，文件名为 main.js</p> <p><strong>mode属性 - 配置环境</strong></p> <p>使用上面的配置运行npx webpack会提示如下图的warning，说配置项里少了mode这个配置</p> <p><img src="/images/webpack/webpack_1_4.png" alt="webpack_1_4.png"></p> <p>mode用于配置当前环境:</p> <ul><li>production（生产环境）默认值，如果不设置mode属性，默认就是这个值</li> <li>development (开发环境)</li> <li>none 基本不使用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// path.resolve和path.join是node中用来做路径拼接用</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    filename<span class="token operator">:</span> <span class="token string">'main.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span> <span class="token comment">// 配置环境</span>
<span class="token punctuation">}</span>
</code></pre></div><p>加上mode参数，再执行npx webpack就不会有warning了</p> <p><img src="/images/webpack/webpack_1_5.png" alt="webpack_1_5.png"></p> <p>开发环境(development)和生产环境(production)的区别：<strong>生成的main.js一个有注释，可以大致看懂，一个没注释，代码进行了混淆压缩，难以理解</strong> 如下面，生成的main.js对比</p> <p><img src="/images/webpack/webpack_1_6.png" alt="webpack_1_6.png"></p> <p><strong>使用指定的配置文件</strong></p> <p>除了使用webpack.config.js外，我们也可以通过 npx webpack --config 来指定配置文件，比如我们创建一个webpack.dev.js, 将配置拷贝一份到里面，然后执行</p> <div class="language- extra-class"><pre class="language-text"><code>npx webpack --config webpack.dev.js
</code></pre></div><p>这样做有什么好处呢？<strong>不同的运行环境可以写多个配置文件，比如生产环境一个配置，开发环境一个配置</strong></p> <p>我们可以把 webpack.config.js 里的mode配置为 production，webpack.dev.js里面的 mode配置为 development</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 生产环境打包，默认使用 webpack.config.js 配置文件</span>
npx webpack
<span class="token comment"># 开发环境打包，使用 webpack.dev.js 配置文件</span>
npx webpack --config webpack.dev.js
</code></pre></div><p>为了在项目中方便运行，我们可以在 package.json 配置 scripts，以方便以npm run 的方式运行</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 在 package.json 里加 build 和 dev 配置</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.dev.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>这样我们就可以不用 npx 运行了，直接使用 npm run build 和 npm run dev 来执行webpack打包</p> <h2 id="webpack核心配置"><a href="#webpack核心配置" class="header-anchor">#</a> webpack核心配置</h2> <p>webpack主要由以下5个配置项</p> <table><thead><tr><th>webpack配置项</th> <th>说明</th></tr></thead> <tbody><tr><td>entry</td> <td>指定打包⼊口⽂件，执行webpack后从该文件开始执行</td></tr> <tr><td>output</td> <td>指定输出结构，可以设置生成文件的目录、层级结构等</td></tr> <tr><td>mode</td> <td>指定打包环境</td></tr> <tr><td>module - rules</td> <td>loader模块处理，用于解析webpack不能识别的模块</td></tr> <tr><td>plugins</td> <td>插件配置</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定打包⼊口⽂件 </span>
    output<span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定输出结构</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定打包环境</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// loader模块处理，用于解析webpack不能识别的模块</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 指定匹配规则</span>
                use<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span> <span class="token comment">// 指定使用的loader</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// 插件配置</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="entry-打包入口"><a href="#entry-打包入口" class="header-anchor">#</a> entry - 打包入口</h3> <p>指定webpack入口文件，webpack执行构建的第一步就是从entry开始，entry属性的值除了字符串外，还可以是对象，用于指定多个入口</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 单个入口 SPA 单页面应用</span>
entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
<span class="token comment">// 等价于</span>
entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里entry对象里面默认的属性名为main，也可以指定为index，output里面可以根据[name]变量动态取这个属性名。设置打包后的Chunck Names(包名)</p> <p>修改配置webpack.dev.js为下面的代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再执行 npm run dev，就会生成 dist/index.js，Chunk Names就是 index，执行后的对比图如下</p> <p><img src="/images/webpack/webpack_1_7.png" alt="webpack_1_7.png"></p> <p><strong>多个entry，多页面应用MPA</strong></p> <p>在src目录下，我们除了index.js外，再额外创建一个 login.js，使用多个页面，修改配置文件如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    login<span class="token operator">:</span> <span class="token string">'./src/login.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，运行npm run dev后，会在dist目录生成两个文件，一个index.js，一个login.js，执行效果如下图</p> <p><img src="/images/webpack/webpack_1_8.png" alt="webpack_1_8.png"></p> <p><strong>output.filename中hash占位符</strong></p> <p>在上面的例子中，我们使用了 [name]占位符，会读取entry对象的属性名，除了name外，还有[hash]、[chunkhash]占位符，可以在文件名上加hash值。修改配置如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    login<span class="token operator">:</span> <span class="token string">'./src/login.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[hash].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>npm run dev，运行效果如下图，生成的dist目录下不再是 index.js和login.js 而是 index_hash值.js, login_hash值.js 后面加了hash值。</p> <p><img src="/images/webpack/webpack_1_9.png" alt="webpack_1_9.png"></p> <p>默认hash值为20位，有点长，而且每次都不一样，在项目中，我们用的比较多的是[chunkhash]，他会计算文件的指纹。[chunckhash:需要的hash位数]可以指定hash长度，将filename设置为 <code>[name]_[chunkhash:8].js</code>，再运行npm run dev 效果如下</p> <p><img src="/images/webpack/webpack_1_10.png" alt="webpack_1_10.png"></p> <p><strong>使用chunkhash的好处是，版本迭代时，如果有多个入口文件，其中有一个入口文件发生变化，那这个入口生成的文件hash值就会变化，其他入口文件生成的文件hash值不会变。</strong> 浏览器/IE会缓存资源文件，不同版本的hash不一样，客户端会刷新缓存，加载最新的代码，而未改变的文件hash值不会变，就还会使用缓存</p> <p>js模块，一般用的就是chunkhash。chunk 可以理解为块</p> <h3 id="output-输出结构"><a href="#output-输出结构" class="header-anchor">#</a> output - 输出结构</h3> <p>打包生成的目录结构</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 单入口</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 生成文件名称</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 生成的文件路径，必须是绝对路路径</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 多入口 </span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name]_[chunkhash:8].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 使用name/chunkhash等占位符，文件名不能重复</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 生成的文件路径，必须是绝对路路径</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="mode-打包环境"><a href="#mode-打包环境" class="header-anchor">#</a> mode - 打包环境</h3> <p>指定当前的构建环境，设置mode可以自动触发webpack内置的函数，起到优化的效果</p> <table><thead><tr><th>mode属性值</th> <th>说明</th></tr></thead> <tbody><tr><td>production</td> <td>将 DefinePlugin 中 process.env.NODE_ENV 设置为 production <br>启用FlagDependencyUsagePlugin、FlagIncludedChunksPlugin、ModuleConcatenationPlugin、NoEmitOnErrorsPlugin、OccurrenceOrderPlugin、SideEffectsFlagPlugin、TerserPlugin，这些模块主要用于混淆压缩、摇摆树(Tree Sharking，去除没有用到的模块)等</td></tr> <tr><td>development</td> <td>将 DefinePlugin 中 process.env.NODE_ENV设置为development<br>启用NamedChunksPlugin、NamedModulesPlugin，这两个插件用于开发时热更新处理，识别那个模块发生了变化</td></tr> <tr><td>none</td> <td>不使用任何默认优化选项</td></tr></tbody></table> <p>注意：</p> <ol><li>如果不设置mode，默认值为production，运行时webpack打包时，会有warnning</li> <li>设置 NODE_ENV 不会自动设置 mode 值</li></ol> <h3 id="module-loader模块处理"><a href="#module-loader模块处理" class="header-anchor">#</a> module - loader模块处理</h3> <p>模块，webpack会从entry入口文件开始递归找出所有依赖的模块，当遇到webpack不能处理的文件/模块时，就需要要在module里进行配置，指定某个loader来处理某种格式的文件/模块。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// loader模块处理，用于解析webpack不能识别的模块</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 指定匹配规则</span>
            use<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span> <span class="token comment">// 指定使用的loader</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h4> <p>模块解析，webpack本身只能处理 js、json，但需要打包的文件除了js外，还有 css、图片、vue等其他格式文件。像这种其他文件的处理就需要使用loader了</p> <p>常见的loader</p> <div class="language-js extra-class"><pre class="language-js"><code>style<span class="token operator">-</span>loader <span class="token comment">// css相关</span>
css<span class="token operator">-</span>loader
less<span class="token operator">-</span>loader
sass<span class="token operator">-</span>loader
ts<span class="token operator">-</span>loader <span class="token comment">// 处理ts</span>
babel<span class="token operator">-</span>loader <span class="token comment">// ES6+兼容性处理</span>
file<span class="token operator">-</span>loader <span class="token comment">// 处理图片等静态资源文件</span>
eslint<span class="token operator">-</span>loader
vue<span class="token operator">-</span>loader
vue<span class="token operator">-</span>style<span class="token operator">-</span>loader
</code></pre></div><h4 id="静态资源处理-file-loader"><a href="#静态资源处理-file-loader" class="header-anchor">#</a> 静态资源处理 file-loader</h4> <p>file-loader的作用与使用场景</p> <ol><li><strong>它会把entry入口文件里识别出的资源模块，移动到output指定的输出目录(dist)，并返回一个地址</strong></li> <li><strong>用于处理源代码中引入的png、svg、txt、csv、execl等静态文件资源，将文件移动到打包目录</strong></li></ol> <p>来看个例子：之前的src/index.js里只写了document.write，下面我们来试试引入一张图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.png'</span>

<span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> logo
img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'logo'</span><span class="token punctuation">)</span>

<span class="token comment">// 将图片挂载到id为imgWrap的元素上</span>
<span class="token keyword">let</span> imgWrap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#imgWrap'</span><span class="token punctuation">)</span>
imgWrap<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello webpack'</span><span class="token punctuation">)</span>
</code></pre></div><p>npm run dev 执行webpack打包，发现报错</p> <p><img src="/images/webpack/webpack_1_11.png" alt="webpack_1_11.png"></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 错误信息，大致意思是，无法处理 logo.png，可能需要使用loader来处理.png这种文件类型</span>
ERROR <span class="token keyword">in</span> ./src/logo.png <span class="token number">1</span>:0
Module parse failed: Unexpected character <span class="token string">'�'</span> <span class="token punctuation">(</span><span class="token number">1</span>:0<span class="token punctuation">)</span>
You may need an appropriate loader to handle this <span class="token function">file</span> type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts<span class="token comment">#loaders</span>
<span class="token punctuation">(</span>Source code omitted <span class="token keyword">for</span> this binary <span class="token function">file</span>
</code></pre></div><p>如果想要处理.png图片文件，就需要在module.rules里配置对应的loader了，这里使用 file-loader 来处理</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 先安装 file-loader</span>
<span class="token function">npm</span> <span class="token function">install</span> file-loader --save-dev
</code></pre></div><p>再修改webpack.dev.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 当遇到.png文件时，使用file-loader来处理</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.png$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span>  <span class="token string">'file-loader'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改文件后 npm run dev 就没有报错了。默认情况下会在dist目录下生成一个hash命名的png文件， ef3eecd0bf07a2ac32ef435537980fd6.png，如下图</p> <p><img src="/images/webpack/webpack_1_12.png" alt="webpack_1_12.png"></p> <p>我们来测试下构建的js是否可以。修改dist/index.html，引入生成的js，加一个id为imgWrap的div，看图片是否显示正常。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- src/index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgWrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index_f824a855.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>运行html，显示如下图，可以正常运行js的内容，图片加载成功</p> <p><img src="/images/webpack/webpack_1_13.png" alt="webpack_1_13.png"></p> <h4 id="指定loader的use字段可以是对象"><a href="#指定loader的use字段可以是对象" class="header-anchor">#</a> 指定loader的use字段可以是对象</h4> <p>上面的例子中，module.rules里 use 字段是字符串，他的值还可以是对象，用于对某个loader进行配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 当遇到.png文件时，使用file-loader来处理</span>
        <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.png$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span>  <span class="token string">'file-loader'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>开看看file-loader的配置，使用use.loader指定loader名，use.options指定对应loader的配置，下面的代码中，我们设置了png图片打包的目录，打包后png的名称</p> <div class="language-js extra-class"><pre class="language-js"><code> module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.png$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span>  <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 文件名，[name]为资源的名称，[ext]为资源的后缀</span>
            name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span> 
            outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span> 
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>npm run dev 生成的dist目录如下</p> <p><img src="/images/webpack/webpack_1_14.png" alt="webpack_1_14.png"></p> <p>运行dist/index.html，效果如下</p> <p><img src="/images/webpack/webpack_1_15.png" alt="webpack_1_15.png"></p> <h4 id="url-loader"><a href="#url-loader" class="header-anchor">#</a> url-loader</h4> <p>url-loader内置了file-loader，并在其基础上进行了功能增强，把 file-loader 换成url-loader完全可以。</p> <p>注意：使用url-loader时，如果遇到 jpg 格式的图片，会把图片转成base64的形式，打包到js里。对体积较小的图片比较好(减少一次网络请求)，大图片就不合适了，会增大js的体积。我们可以使用 limit 来限制，当 jpg 图片小于多少字节时，才转 base64。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">npm</span> <span class="token function">install</span> url-loader --save-dev
</code></pre></div><p>找一个logo.jpg，替换src/index.js里的logo.png，修改 webpack.dev.js如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'index'</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 当文件后缀为png、jpg、jpeg、gif时</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 文件名，[name]为资源的名称，[ext]为资源的后缀</span>
            name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span> 
            outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
            limit<span class="token operator">:</span> <span class="token number">2048</span> <span class="token comment">// 单位字节，小于2KB的jpg，图片自动转base64，可以减少一次http请求</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行 npm run dev，在dist目录不会生成images/logo.jpg，而是在index_xx.js里加入了对应的base64字符串，运行正常</p> <h4 id="css-loader与style-loader"><a href="#css-loader与style-loader" class="header-anchor">#</a> css-loader与style-loader</h4> <p>webpack处理样式文件，需要借助样式相关loader</p> <ol><li>css-loader 分析css模块之间的关系合并成一个css</li> <li>style-loader 将css-loader生成的内容，通过style元素挂载到页面的header部分</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装 </span>
<span class="token function">npm</span> <span class="token function">install</span> style-loader css-loader --save-dev
</code></pre></div><p>现在来测试下，先新建一个css文件 src/index.css</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* src/index.css */</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> darkorange<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 src/index.js 里直接import src/index.css</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./logo.jpg'</span>
<span class="token comment">// 直接引入css文件即可</span>
<span class="token keyword">import</span> indexCss <span class="token keyword">from</span> <span class="token string">'./index.css'</span>

<span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> logo
img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'logo'</span><span class="token punctuation">)</span>

<span class="token comment">// 将图片挂载到id为imgWrap的元素上</span>
<span class="token keyword">let</span> imgWrap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#imgWrap'</span><span class="token punctuation">)</span>
imgWrap<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello webpack'</span><span class="token punctuation">)</span>
</code></pre></div><p>修改 webpack.dev.js 配置，加入对应的loader</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'index'</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 文件名，[name]为资源的名称，[ext]为资源的后缀</span>
            name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span> 
            outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
            <span class="token comment">// 我这里图片为26k，就调到了限制，一般建议 2048, 2KB</span>
            limit<span class="token operator">:</span> <span class="token number">40960</span> <span class="token comment">// 单位字节，小于40KB的jpg，图片自动转base64，可以减少一次http请求</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 增加对css的处理</span>
      <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token comment">// 注意css loader有执行顺序，从又向左执行</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意生成后的dist里面是没有css文件的，他会将 index.css 弄到js里，由js去执行，打包后的文件如下图</p> <p><img src="/images/webpack/webpack_1_16.png" alt="webpack_1_16.png"></p> <p>运行 dist/index.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgWrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index_3bdb9619.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>可以看到我们在index.css里写的样式已生效，会通过 index_xxx.js 将样式动态写入到header的style元素里</p> <p><img src="/images/webpack/webpack_1_17.png" alt="webpack_1_17.png"></p> <h4 id="less-loader"><a href="#less-loader" class="header-anchor">#</a> less-loader</h4> <p>上面成功加载了css，而一般我们会使用像less、sass这种css预处理器。如果使用less，就需要使用 less-lodaer 了</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">npm</span> <span class="token function">install</span> less-loader <span class="token function">less</span> --save-dev
</code></pre></div><p>新增 src/index.less</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token comment">/* src/index.less */</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> darkorange<span class="token punctuation">;</span>
    <span class="token selector">#imgWrap</span> <span class="token punctuation">{</span>
        <span class="token selector">img</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将 src/index.js 里面的 index.css 改为 index.less，修改 webpack.dev.js</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 增加对less的处理</span>
    <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 注意css loader有执行顺序，从又向左执行，从下到上</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>运行后，less可以正常加载，效果如下图</p> <p><img src="/images/webpack/webpack_1_18.png" alt="webpack_1_18.png"></p> <h4 id="postcss-loader"><a href="#postcss-loader" class="header-anchor">#</a> postcss-loader</h4> <p>对于老版本的浏览器，有些css可能需要加前缀才能支持，postcss-loader 预处理器的 autoprefixer 可以为样式自动添加vender前缀，参考 <a href="https://github.com/postcss/autoprefixer" target="_blank" rel="noopener noreferrer">autoprefixer | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">npm</span> <span class="token function">install</span> postcss-loader autoprefixer --save-dev
</code></pre></div><p>我们在 index.less 里加入一个对于低版本需要加前缀的样式，比如: display: flex，再在 webpack.dev.js 里加入 postcss-loader</p> <div class="language-js extra-class"><pre class="language-js"><code>       <span class="token comment">// 增加对css的处理</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 注意css loader有执行顺序，从又向左执行</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token comment">// 表示兼容 &gt; 1% 的浏览器</span>
                        overrideBrowserslist<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">,</span> <span class="token string">'&gt;1%'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>关于overrideBrowserslist设置兼容浏览器的处理配置，参考 <a href="https://github.com/browserslist/browserslist#queries" target="_blank" rel="noopener noreferrer">browserslist 配置说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/images/webpack/webpack_1_19.png" alt="webpack_1_19.png"></p> <p>修改好配置后，运行 npm run dev，效果如下图，display: flex 有加入前缀</p> <p><img src="/images/webpack/webpack_1_20.png" alt="webpack_1_20.png"></p> <p><strong>关于 postcss.config.js</strong></p> <p>由于 postcss-loader 的配置可能有点多，可以将他的配置单独提成一个文件 postcss.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 和 webpack.dev.js 同层级创建 postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            overrideBrowserslist<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">,</span> <span class="token string">'&gt;1%'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改webpack.dev.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这里 postcss-loader 默认先看当前目录是否有postcss.config.js，有就使用该配置</span>
<span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token comment">// 注意css loader有执行顺序，从又向左执行</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="引入iconfont字体"><a href="#引入iconfont字体" class="header-anchor">#</a> 引入iconfont字体</h4> <p>我们先在 <a href="https://www.iconfont.cn/webfont" target="_blank" rel="noopener noreferrer">iconfont官网 - 在线字体<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载一个字体文件，直接将 webfont.woff 文件拷贝到 src 目录</p> <p><img src="/images/webpack/webpack_1_21.png" alt="webpack_1_21.png"></p> <p>修改 index.less，引入下载好的字体</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token atrule">@font-face</span> <span class="token punctuation">{</span>
    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'webfont'</span><span class="token punctuation">;</span>
    <span class="token property">font-display</span><span class="token punctuation">:</span> swap<span class="token punctuation">;</span>
    <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'webfont.woff'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'woff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* chrome、firefox */</span>
<span class="token punctuation">}</span>

<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">&quot;webfont&quot;</span> <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> darkorange<span class="token punctuation">;</span>

    <span class="token selector">#imgWrap</span> <span class="token punctuation">{</span>
        <span class="token selector">img</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改 webpack.dev.js，加入对字体文件的处理 lodaer，使用 file-loader即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>为了看到字体效果，我们在index.js docuemnt.write里加入文字 &quot;结婚就是&quot;, npm run dev 运行看效果，如下图，字体可以加载成功</p> <p><img src="/images/webpack/webpack_1_22.png" alt="webpack_1_22.png"></p> <h4 id="文件监听"><a href="#文件监听" class="header-anchor">#</a> 文件监听</h4> <p>在上面的例子中，每次修改 src/index.js 后，都需要手动执行 npm run dev，来运行webpack，比较麻烦。怎么能够每次修改后，自动npm run dev呢？可以使用 watch 属性，效果类似于 nodemon</p> <p>webpack里面有一个文件监听机制，他可以轮询判断文件是否发生变化，webpack开启监听模式，有两种方法</p> <ol><li>运行webpack命令时，加上 <code>--watch</code> 参数</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.dev.js --watch&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们 npm run watch 后，每次修改 src/index.js 都会自动执行打包</p> <ol start="2"><li>在配置文件里加 watch: true 属性</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在 webpack.dev.js 中加入如下配置</span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认false, 不开启</span>
  <span class="token comment">// 配合watch使用, 只有watch为true才会生效</span>
  watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置当某些文件变更时，不触发打包，值为⽂件或者⽬录，⽀持正则</span>
    ignored<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> 
    <span class="token comment">// 监听到文件变化后延时多少秒再执行webpack，默认300ms, </span>
    aggregateTimeout<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> 
    <span class="token comment">// 轮询间隔：通过不停的轮询系统，看⽂件是否有变化，默认每秒轮询1次</span>
    poll<span class="token operator">:</span> <span class="token number">1000</span> <span class="token comment">// ms</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>注意开启watch后，terminal就一直处于运行的状态，<code>ctrl + c</code> 可以退出监听</p> <h3 id="plugins-插件"><a href="#plugins-插件" class="header-anchor">#</a> plugins - 插件</h3> <p>在上面的例子中，我们执行打包是从entry入口文件开始，一般都是生成的js，生成的css也是内联样式，而且是没有生成html静态文件的。那如果我们想生成html、单独的css等其他功能，就需要使用插件配置了。</p> <p>plugin用于在webpack运行到某个阶段的时候，做一些处理，类似于生命周期钩子/中间件的概念，作用于整个构建过程</p> <h4 id="htmlwebpackplugin"><a href="#htmlwebpackplugin" class="header-anchor">#</a> HtmlWebpackPlugin</h4> <p>HtmlWebpackPlugin会在打包结束后，自动生成一个html文件，并把打包生成的js引入到该html中</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装</span>
<span class="token function">npm</span> <span class="token function">install</span> html-webpack-plugin --save-dev
</code></pre></div><p>修改 webpack.dev.js</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
  
<span class="token comment">// ...</span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 利用htmlWebpackPlugin，读取src/index.html模板，在输出文件夹下生成app.html</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'测试webpack生成html'</span><span class="token punctuation">,</span> <span class="token comment">// 生成html标题</span>
      filename<span class="token operator">:</span> <span class="token string">'app.html'</span><span class="token punctuation">,</span> <span class="token comment">// 导出html文件名</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span> <span class="token comment">// 模板</span>
      <span class="token comment">// inject: true 默认为true，指定打包js引入到生成的html的位置</span>
      <span class="token comment">// true或'body'是放到body标签的底部script中，'header'会将js放到head标签里</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>src/index.html模板，可以读取插件传的变量</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%= HtmlWebpackPlugin.options.title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgWrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>npm run dev 生成的dist结构、app.html内容如下图</p> <p><img src="/images/webpack/webpack_1_23.png" alt="webpack_1_23.png"></p> <p>注意：</p> <ol><li>不传参的情况下</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 不带参数就默认是 dist/index.html，不指定模块会有默认的空html引入打包后的js</span>
<span class="token comment">// plugins: [new HtmlWebpackPlugin()]</span>
</code></pre></div><ol start="2"><li>由于plugins是数组，你可以同时输出多个html</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Generates default index.html</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// Also generate a test.html</span>
      filename<span class="token operator">:</span> <span class="token string">'test.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'src/assets/test.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre></div><p>更多细节，可以参考github：<a href="https://github.com/jantimon/html-webpack-plugin#options" target="_blank" rel="noopener noreferrer">html-webpack-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>关于html模板语法用法，可以参考这个dmeo <a href="https://github.com/jaketrent/html-webpack-template/blob/86f285d5c790a6c15263f5cc50fd666d51f974fd/index.html" target="_blank" rel="noopener noreferrer"> html-webpack-template project <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="header-anchor">#</a> clean-webpack-plugin</h4> <p>在之前所有的例子中，每次修改entry重新生成时，dist目录里的内容不会删除。那么，多次修改entry入口js文件，多次执行 npm run dev 会生成多个js文件，我们可以使用 clean-webpack-plugin 插件，用于每次清除之前的dist目录</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 安装</span>
<span class="token comment">// npm install clean-webpack-plugin --save-dev</span>

<span class="token comment">// 2.修改 webpack.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">// ... </span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'测试webpack生成htmllll'</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'app.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，每次修改 src/index.js 后，重新打包后都会删除原来的dist，生成新的dist</p> <p>参考文档: <a href="https://github.com/johnagan/clean-webpack-plugin" target="_blank" rel="noopener noreferrer">clean-webpack-plugin | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="mini-css-extract-plugin"><a href="#mini-css-extract-plugin" class="header-anchor">#</a> mini-css-extract-plugin</h4> <p>上面的例子中，我们css文件都是直接用的 'style-loader'，写入到内联样式中，我们可以使用 mini-css-extract-plugin 插件，生成独立的css文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.安装</span>
<span class="token comment">// npm install mini-css-extract-plugin --save-dev</span>

<span class="token comment">// 2.使用</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>

  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// 增加对css的处理</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 注意css loader有执行顺序，从又向左执行</span>
        <span class="token comment">// use: ['style-loader', 'css-loader', 'less-loader', 'postcss-loader']</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>

      <span class="token punctuation">}</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'测试webpack生成htmllll'</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'app.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;[name][contenthash:8].css&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>效果如下图，而且生成的html会自动引入该css</p> <p><img src="/images/webpack/webpack_1_24.png" alt="webpack_1_24.png"></p> <p>这里注意 filename 占位符的hash，一般js使用 chunkhash, css使用contenthash</p> <p>参考文档：<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener noreferrer">mini-css-extract-plugin | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="webpack其他配置"><a href="#webpack其他配置" class="header-anchor">#</a> webpack其他配置</h2> <h3 id="devtool-选择sourcemap方式"><a href="#devtool-选择sourcemap方式" class="header-anchor">#</a> devtool - 选择sourceMap方式</h3> <blockquote><p>官方文档：<a href="https://webpack.docschina.org/configuration/devtool/#devtool" target="_blank" rel="noopener noreferrer">Devtool | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Choose a style of source mapping to enhance the debugging process. These values can affect build and rebuild speed dramatically.（devtool参数用于选择一种 source map 方式来增强调试过程。不同的值会明显影响到构建和重新构建的速度。）</p> <p><strong>什么是source map?</strong></p> <p>一般发布代码时，都会把js、css、html代码进行混淆压缩，这样体积更小，加载速度更快，安全性更好。</p> <p>但这样有个缺点，就是如果有js错误，使用chrome调试时，看不到具体是哪一行源代码出的问题，因为都是混淆压缩的代码。</p> <p>A source map provides a way of mapping code within a compressed file back to it’s original position in a source file.（source map 提供了一种压缩代码映射到源代码具体位置的方式。）</p> <p>参考：<a href="https://blog.teamtreehouse.com/introduction-source-maps" target="_blank" rel="noopener noreferrer">An Introduction to Source Maps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>默认情况，devtool的值为 'none'，是打包后的代码。我们修改下 src/index.js 加入一个错误的js代码，然后看看chrome控制台的效果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在 src/index.js 里加入 console.og('test soruce map') 这行错误代码</span>

<span class="token comment">// 修改 webpack.dev.js 配置</span>
mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生成环境，生成的js会混淆压缩</span>
devtool<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token comment">// 默认值，不使用source map</span>
</code></pre></div><p>npm run dev 打包构建后，运行效果</p> <p><img src="/images/webpack/webpack_1_26.png" alt="webpack_1_26.png"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 我们修改下 devtool 的值，重新打包</span>
mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
</code></pre></div><p>设置 devtool 为 'source-map' 后，打包时，会生成js、css对应的map文件，如下图</p> <p><img src="/images/webpack/webpack_1_27.png" alt="webpack_1_27.png"></p> <p>运行 dist/app.html 效果如下</p> <p><img src="/images/webpack/webpack_1_28.png" alt="webpack_1_28.png"></p> <p><strong>devtool配置值</strong></p> <p><img src="/images/webpack/webpack_1_25.png" alt="webpack_1_25.png"></p> <ul><li>eval: 速度最快, 使用eval包裹模块代码,</li> <li>source-map: 产⽣.map文件</li> <li>cheap: 较快，不用管列的信息,也不包含loader的source map</li> <li>Module: 第三⽅模块，包含loader的source map(⽐如jsx to js ，babel 的source map)</li> <li>inline: 将.map作为DataURI嵌入，不单独生成.map⽂件</li></ul> <p>上面的参数可以自由组合，开发环境推荐如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>devtool<span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span>
</code></pre></div><p>生产环境可以使用&quot;cheap-module-source-map&quot;，但建议不开启</p> <h3 id="devserver-开发服务器-代理-hmr"><a href="#devserver-开发服务器-代理-hmr" class="header-anchor">#</a> devServer - 开发服务器/代理/HMR</h3> <p>主要用于提升开发效率</p> <p>一般我们打包构建到dist目录后，需要直接打开dist/app.html运行(默认使用file://，不推荐)，或者使用 vscode lives server插件开启http服务运行app.html，每次修改代码重新打包后，都要手动刷新网页，确保是最新的。</p> <p>而devServer可以自己在打包的同时，自动开启静态服务，自动在浏览器打开页面</p> <ol><li>先需要安装 webpack-dev-server</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webpack-dev-server --save-dev
</code></pre></div><ol start="2"><li>在 package.json 里加入 server 命令</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 如果不加 --config，默认使用webpack.config.js配置</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config webpack.dev.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ol start="3"><li>修改webpack.dev.js</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
  contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token comment">// 指定服务器的静态资源目录</span>
  open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动再浏览器打开</span>
  port<span class="token operator">:</span> <span class="token number">8081</span> <span class="token comment">// 端口</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置好后，npm run server 后，就会执行打包，并将dist目录内容加载到内存中，打开浏览器访问 <code>http://localhost:8081/</code>，这里默认访问的是contentBase设置目录下的index.html，而我们上面有执行输出html为app.html，改为index.html，就可以直接打开了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'测试webpack生成htmllll'</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'app.html'</span><span class="token punctuation">,</span>
    template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>而且，我们修改 src/index.js 文件、或者src/index.html模板文件、index.js里引入的index.less文件等，可以自动重新rebuild，自动刷新整个页面。</p> <h4 id="proxy-代理服务器"><a href="#proxy-代理服务器" class="header-anchor">#</a> proxy 代理服务器</h4> <p>解决mock接口连后端本地接口跨域的问题</p> <p>先来模拟一个跨域的场景，我们在 webpack_demo 这个目录下面创建一个 mock 目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 进入mock目录</span>
<span class="token builtin class-name">cd</span> mock
<span class="token comment"># 初始化 package.json</span>
<span class="token function">npm</span> init -y
<span class="token comment"># 安装mock接口需要的koa, koa-router</span>
<span class="token function">npm</span> <span class="token function">install</span> koa koa-router --save
</code></pre></div><p>新建index.js文件，写一个get接口</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/info'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> <span class="token string">'success'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'9002'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server listen on 9092 port.'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在mock目录下运行 <code>nodemon index.js</code>，测试接口是否正常 <code>http://127.0.0.1:9002/api/info</code></p> <p><img src="/images/webpack/webpack_1_29.png" alt="webpack_1_29.png"></p> <p>接口测试正常后，关闭服务</p> <p>回到我们的 webpack-demo 目录下，修改 package.json，在 npm run server 的时候同时开启mock接口服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// npm run 同时执行下面的两条命令</span>
<span class="token comment">// webpack-dev-server --config webpack.dev.js</span>
<span class="token comment">// nodemon ./mock/index.js</span>

<span class="token comment">// 先安装 concurrently</span>
<span class="token comment">// npm install concurrently --save</span>
<span class="token comment">// 修改 package.json 如下</span>
<span class="token string">&quot;server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;concurrently \&quot;nodemon ./mock/index.js\&quot; \&quot;webpack-dev-server --config webpack.dev.js\&quot;&quot;</span>
<span class="token comment">// 注意 &amp;&amp; 同时执行两条命令存在兼容性问题，windows不兼容，concurrently跨平台兼容</span>
<span class="token comment">// &amp;&amp; 是按顺序执行 concurrently 是并列执行，跨平台的顺序执行，可以使用 npm-run-all</span>
<span class="token comment">// 参考：npm并行&amp;串行执行多个scripts命令</span>
<span class="token comment">// https://blog.csdn.net/ligang2585116/article/details/105909789/</span>
</code></pre></div><p>然后，我们前端使用axios来请求接口试试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 先安装 axios</span>
<span class="token comment">// npm install axios --save</span>
<span class="token comment">// 在 src/index.js 里加入请求接口的代码</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:9092/api/info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>npm run server 开启服务，然后打开浏览器控制台，会同时执行上面的两个命令</p> <p><img src="/images/webpack/webpack_1_30.png" alt="webpack_1_30.png"></p> <p>运行成功后，可以看到，接口提示跨域问题</p> <p><img src="/images/webpack/webpack_1_31.png" alt="webpack_1_31.png"></p> <p>然后我们来设置 devServer 的接口代理，先把请求改下，直接使用相对路径的接口</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>再修改 webpack.dev.js，把 <code>/api</code> 下面的接口代理到 9002 端口下的mock接口服务</p> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
  contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token comment">// 指定服务器的静态资源目录</span>
  open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动再浏览器打开</span>
  port<span class="token operator">:</span> <span class="token number">8081</span><span class="token punctuation">,</span> <span class="token comment">// 端口</span>
  proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">&quot;http://127.0.0.1:9002&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样页面请求的 <code>http://127.0.0.1:8081/api/info</code>，就会直接代理到 mock服务，就没有跨域的问题了</p> <p><img src="/images/webpack/webpack_1_32.png" alt="webpack_1_32"></p> <h4 id="hot-热模块替换hmr"><a href="#hot-热模块替换hmr" class="header-anchor">#</a> hot 热模块替换HMR</h4> <p>HMR(Hot Module Replacement，热模块替换)</p> <p>在上面的例子中，我们按 F12 打开console，在控制台会看到 <code>[WDS] Live Reloading enabled.</code> 表示 [webpack dev server] 实时重新加载已启用，当检测到我们有修改时，会自动重新打包，<strong>整个页面会重新刷新</strong>。</p> <p><strong>HMR(热模块替换)就是针对这种情况而做的一个优化，它允许在运行时热更新某个模块，而无需完全刷新。</strong></p> <ol><li>保留在完全重新加载页面期间会丢失的应用程序状态</li> <li>只更新变更内容，以节省宝贵的开发时间</li> <li>在源码中 css、js 产生修改时，会立刻在浏览器中进行更新，几乎相当于在浏览器 devtools 直接修改样式</li></ol> <p>webpack-dev-server默认是 LiveReload（实时重新加载）。HMR可以作为 LiveReload 的替代，如果将devServer的 hot 属性设置为 true，那么在试图重新加载整个页面前，hot 模式会尝试使用 HMR 来更新。 参考: <a href="https://webpack.docschina.org/concepts/hot-module-replacement/#how-it-works" target="_blank" rel="noopener noreferrer">HMR - how it works | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>注意：</strong></p> <p><strong>1. HMR不支持chunkhash，contenthash，它不适用于生产环境，只能在开发环境使用，生成环境和开发环境需要两套配置</strong> <strong>2. 社区提供了许多loader，都内置了HMR逻辑，比如 style-loader 支持 css 的 HMR、vue-loader 支持 vue 组件的 HMR、react hot loader支持react组件的HMR，等等</strong></p> <p>下面我们来看看HMR内部的一些细节。这里测试时webpack版本是4.44.1，我们直接在devServer的配置里加 hot 为 true，这样就开启了HMR</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Version: webpack 4.44.1</span>
devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
  hot<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>开启后重新 npm run server 就可以在console里看到，多出了开启 HMR 相关的 log 了</p> <p><img src="/images/webpack/webpack_1_33.png" alt="webpack_1_33.png"></p> <p><strong>处理js模块HMR</strong></p> <p>先来测试看看js的热更新，在 webpack.dev.js 中，将chunkhash、contenthash均去掉，然后再 src/index.js 里加入检测到某个js变更后的操作逻辑</p> <p>在入口文件引入一个新的 js 模块 number.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/number.js</span>

<span class="token keyword">function</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span>  div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> 
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
  
<span class="token keyword">export</span> <span class="token keyword">default</span> number<span class="token punctuation">;</span>
</code></pre></div><p>然后修改 src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> number <span class="token keyword">from</span> <span class="token string">'./number.js'</span>

<span class="token comment">// 挂载dom</span>
<span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 当检测到 模块有热更新时，内部的 module.hot 会为true，并执行下面的逻辑</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 module.hot.accept 监听</span>
  <span class="token comment">// 当 number.js 这个模块改动时，移除number，重新执行number，达到热更新的效果</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./number.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Accepting the updated printMe module!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当我们修改 <code>div.innerHTML = 100;</code>的值时，页面没有重新刷新，这个 number.js 重新执行，且执行对应的 module.hot.accept 逻辑，达到了 js 热模块替换的效果，保存更新后，console信息如下</p> <p><img src="/images/webpack/webpack_1_34.png" alt="webpack_1_34.png"></p> <p>另外，这个过程中，我们在src/index.js请求的接口并没有重新请求，而是内部请求了一个 hot-update.json 的接口</p> <p><img src="/images/webpack/webpack_1_35.png" alt="webpack_1_35.png"></p> <p><strong>处理css模块的HMR</strong></p> <p>由于 style-loader 内置了 HMR 的逻辑，我们直接使用 style-loader，不要使用 MiniCssExtractPlugin 插件单独生成 css 文件即可像上面的js那样，达到HMR的效果</p> <p>style-loader 在幕后使用了 module.hot.accept，在 CSS 依赖模块更新之后，会将其 patch(修补) 到 <code>&lt;style&gt;</code> 标签中。</p> <p>参考webpack官方文档：<a href="https://webpack.docschina.org/guides/hot-module-replacement/" target="_blank" rel="noopener noreferrer">模块热替换 | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="webpack-merge"><a href="#webpack-merge" class="header-anchor">#</a> webpack-merge</h2> <p>上面我们提到过 webpack-dev-server 仅开发环境需要，开发环境和生产环境的配置是两种配置。我们可以写一份开发环境、生产环境都一致的公共配置 webpack.base.js，然后开发环境使用 webpack.dev.js，生产环境使用 webpack.prod.js，使用 webpack-merge 把特有的配置和公共配置合并。</p> <p>下面来看看公用的配置:</p> <ol><li>入口entry</li> <li>静态资源处理loader</li> <li>根据模板生成静态html的插件、每次构建清除dist目录的插件</li></ol> <p>开发环境特有的配置</p> <ol><li>output不能使用chunkhash、contenthash</li> <li>mode: 'development' 开发环境</li> <li>devtool: 'cheap-module-eval-source-map', 开始sourcemap</li> <li>不单独生成css文件，使用 style-loader</li> <li>打开devServer配置，配合 webpack-dev-server 进行开发环境调试</li></ol> <p>生产环境特有的配置</p> <ol><li>使用chunkhash和contenthash</li> <li>mode为 production 生成环境</li> <li>devtool不设置，默认不开始 sourcemap</li> <li>使用css插件，生成单独的css文件</li> <li>不使用devServer</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.base.js</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'index'</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 文件名，[name]为资源的名称，[ext]为资源的后缀</span>
            name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span>
            outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
            <span class="token comment">// 我这里图片为26k，就调到了限制，一般建议 2048, 2KB</span>
            <span class="token comment">// 图片太大会影响主包，还是设置为2048</span>
            limit<span class="token operator">:</span> <span class="token number">2048</span> <span class="token comment">// 单位字节，小于40KB的jpg，图片自动转base64，可以减少一次http请求</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff|woff2|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'测试webpack生成htmllll'</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>开发环境特有配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.js'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 增加对css的处理</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 注意css loader有执行顺序，从又向左执行</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token comment">// 指定服务器的静态资源目录</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动再浏览器打开</span>
    port<span class="token operator">:</span> <span class="token number">8081</span><span class="token punctuation">,</span> <span class="token comment">// 端口</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">//即便便HMR不不⽣生效，浏览器器也不不⾃自动刷新，就开启hotOnly </span>
    <span class="token comment">// hotOnly: true,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">&quot;http://127.0.0.1:9002&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span>
</code></pre></div><p>生产环境特有配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.prod.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.js'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 增加对css的处理</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 注意css loader有执行顺序，从又向左执行</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;[name]_[contenthash:8].css&quot;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span>
</code></pre></div><p>修改 package.json 里面的 scripts，加入对应的命令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 开发环境打包、不使用devServer，主要看打包后的文件</span>
  <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.dev.js&quot;</span><span class="token punctuation">,</span> 
  <span class="token comment">// 生产环境打包</span>
  <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.prod.js&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 开发环境打包、调试，开启devServer 在内存中执行dist下的项目</span>
  <span class="token string">&quot;dev:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config webpack.dev.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="vue-cli相关"><a href="#vue-cli相关" class="header-anchor">#</a> vue-cli相关</h3> <p>vue-cli中的 vue.config.js，其实就是对 webpack 配置的一层封装，我们也可以在 vue.config.js 里使用使用原生的webpack写法。configureWebpack 这个选项，这个对象会被 webpack-merge 合并到最终的 webpack 配置中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">MyAwesomeWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了对象外，他还可以是一个函数，不同的环境使用不同的配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 为生产环境修改配置...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 为开发环境修改配置...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参考: <a href="https://cli.vuejs.org/zh/guide/webpack.html" target="_blank" rel="noopener noreferrer">webpack相关 | vue-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="处理es6-babel-loader"><a href="#处理es6-babel-loader" class="header-anchor">#</a> 处理ES6+ babel-loader</h2> <p>上面的例子中，我们并没有使用babel，假设src/index.js里面使用了 ?? 、?. 、箭头函数等，它在低版本的浏览器将不会运行，这里我们可以使用 babel-loader 对他进行处理</p> <p>我们先把 src/index.js 的内容替换为如下内容，里面用到了 ??, ?. ES2020的内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function-variable function">sayHi</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a: '</span><span class="token punctuation">,</span> a <span class="token operator">??</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b: '</span><span class="token punctuation">,</span> b <span class="token operator">??</span> <span class="token string">'b'</span><span class="token punctuation">)</span>

arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj.sayHello?.()'</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>sayHello<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj.sayHello()'</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>npm run dev:server 会直接报错</p> <p><img src="/images/webpack/webpack_1_36.png" alt="webpack_1_36.png"></p> <h3 id="babel-polyfill"><a href="#babel-polyfill" class="header-anchor">#</a> @babel/polyfill</h3> <p>下面来使用 babel-loader，将 js 处理成 低版本浏览器也支持的代码，先安装必要的依赖</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># webpack 4.x | babel-loader 8.x | babel 7.x</span>
<span class="token function">npm</span> <span class="token function">install</span> -D babel-loader @babel/core @babel/preset-env
<span class="token function">npm</span> <span class="token function">install</span> -D @babel/polyfill core-js@3
</code></pre></div><p>在 src/index.js 顶部，加入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>然后加入 babel-loader 的处理：遇到js文件时，使用babel转换一次，修改 webpack.dev.js</p> <div class="language-js extra-class"><pre class="language-js"><code> module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ....</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">// 忽略 node_modules 目录下的js文件，不转换</span>
      loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> 
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，再运行 npm run dev 就可以正常运行了。这种情况会把 polyfill 全部载入，打包后的文件较大，也可以配置按需注入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// presets: [&quot;@babel/preset-env&quot;] 修改为下面的代码</span>
 presets<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span> 
    <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">{</span>
      useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span> <span class="token comment">// 按需注⼊</span>
      corejs<span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">]</span>    
</code></pre></div><p>下面是默认情况，和使用按需载入后，dist/index.js 包的大小</p> <p><img src="/images/webpack/webpack_1_37.png" alt="webpack_1_37.png"></p> <p>参考: <a href="https://babeljs.io/docs/en/babel-preset-env#usebuiltins" target="_blank" rel="noopener noreferrer">@babel/preset-env | Babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="header-anchor">#</a> @babel/plugin-transform-runtime</h3> <p>由于 polyfill 是注⼊到全局变量window下的，会污染全局环境。一般如果是开发组件库，⼯具库的场景，推荐使用闭包的方式: @babel/plugin-transform-runtime 插件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装依赖</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/plugin-transform-runtime 
<span class="token function">npm</span> <span class="token function">install</span> --save @babel/runtim
</code></pre></div><p>使用plugins</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>去掉 src/index.js 里的 <code>import &quot;@babel/polyfill&quot;;</code>，npm run dev 后，可正常运行，并进行了转换</p> <p>关于 loader的配置还可以用下面的写法，下面是webpack官网对应的示例</p> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// the 'transform-runtime' plugin tells Babel to</span>
  <span class="token comment">// require the runtime instead of inlining it.</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules|bower_components)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/plugin-transform-runtime'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>参考： <a href="https://webpack.js.org/loaders/babel-loader/#install" target="_blank" rel="noopener noreferrer">@babel/plugin-transform-runtime | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="babelrc文件"><a href="#babelrc文件" class="header-anchor">#</a> .babelrc文件</h3> <p>新建.babelrc文件，把options部分移⼊到该⽂件中即可，如果没有在webpack配置中写options，就默认读取 .babelrc 文件里的配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> 
  loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// .babelrc</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置react打包环境"><a href="#配置react打包环境" class="header-anchor">#</a> 配置React打包环境</h3> <p>我们在 src/index.js 里面可以跑 react 代码，使用 babel 可以转换，修改 src/index.js 入口文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 显示 hello world</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>为了可以执行，先安装依赖</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装依赖包</span>
<span class="token function">npm</span> <span class="token function">install</span> react react-dom --save
<span class="token comment"># 安装babel与react转换的插件</span>
<span class="token function">npm</span> <span class="token function">install</span> -D @babel/preset-react
</code></pre></div><p>修改 .babelrc 文件</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token string">'@babel/preset-react'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，npm run dev后，运行 dist/index.html 就可以看到 hello world 了</p> <h2 id="tree-shaking-摇树"><a href="#tree-shaking-摇树" class="header-anchor">#</a> tree shaking ”摇树“</h2> <p>[ˈʃeɪkɪŋ]，webpack 2.x开始支持 tree shaking 概念，可以移除代码中没有用到的部分，只保留实际用到了的。从而减少打包体积。<strong>注意它只支持 ES module，也就是 import， export，像 node 的 CommonJS module.export，require是不支持的。</strong></p> <p>修改 src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./counter'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>新建一个 counter.js，导出两个函数，我们只用其中的一个</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/couner.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">-</span> b
<span class="token punctuation">}</span>
</code></pre></div><p>我们 npm run dev 时，可以看到 counter 里没用到的 sub 函数也被打包了</p> <p><img src="/images/webpack/webpack_1_38.png" alt="webpack_1_38.png"></p> <p>这里，我们可以在 webpack.dev.js 中设置开启tree sharking</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
  usedExports<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><p>再 npm run dev，可以看到打包的文件里面就标记只使用 add，没有使用 sub，如下图</p> <p><img src="/images/webpack/webpack_1_39.png" alt="webpack_1_39.png"></p> <p><strong>注意：这里我们使用开发环境有两个原因：</strong></p> <ol><li>mode: development开发环境代码没有混淆压缩，可以更好的看打包出来代码情况，（注意：开发环境，tree shaking后，还是可以在代码里找到没用到的sub的，生成环境才会自动去掉）</li> <li>mode: production默认开启了tree shaking，不好看效果</li></ol> <h3 id="tree-shaking副作用"><a href="#tree-shaking副作用" class="header-anchor">#</a> tree shaking副作用</h3> <p>tree shaking 会把没用的代码(dead code)，直接删掉。<strong>有些css文件，或者一些表面上看起来没用到的代码，有可能会被shaking掉，这就是tree shaking开启后的副作用</strong></p> <p>怎么消除这个副作用呢？可以在 package.json 里使用 &quot;sideEfects&quot; 字段指定 tree shaking 时，跳过这些文件，防止误删。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your-project&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 设置 tree shaking 需要跳过的文件</span>
  <span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;./src/some-side-effectful-file.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;*.css&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tree-shaking概念的理解"><a href="#tree-shaking概念的理解" class="header-anchor">#</a> tree shaking概念的理解</h3> <blockquote><p>You can imagine your application as a tree. The source code and libraries you actually use represent the green, living leaves of the tree. Dead code represents the brown, dead leaves of the tree that are consumed by autumn. In order to get rid of the dead leaves, you have to shake the tree, causing them to fall.</p></blockquote> <p>你可以把你的应用想象成一颗树。绿色表示实际用到的代码和库，是树上活着的树叶。灰色表示未引用的代码，是秋天树上枯萎的树叶。为了去除死去的树叶，你必须摇动(shaking)这颗树，使它落下。</p> <p>参考：<a href="https://webpack.docschina.org/guides/tree-shaking/#add-a-utility" target="_blank" rel="noopener noreferrer">tree shaking | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="代码分割-code-splitting"><a href="#代码分割-code-splitting" class="header-anchor">#</a> 代码分割 code splitting</h2> <p>在之前react的例子中，我们引入了react, react-dom，打包后的inde.js比较大，有 3M 多</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/images/webpack/webpack_1_40.png" alt="webpack_1_40.png"></p> <p>一般这种单个文件比较大的情况，就可以使用代码分割(code splitting)了。不使用代码分割的缺点</p> <ol><li>业务代码体积小，而第三方库体积大。业务逻辑会变化，而第三方库基本不会变更。如果不分割代码，每次业务代码改动，第三方库也会跟着一起打包，耗时</li> <li>单个文件体积大，加载时间长。尽管分割后会多出一个或多个get请求，但整体比单个大文件体验要好。</li></ol> <p>可以在 webpack.dev.js 里使用如下配置进行代码分割</p> <div class="language-js extra-class"><pre class="language-js"><code>
optimization<span class="token operator">:</span><span class="token punctuation">{</span> 
  <span class="token comment">// 自动代码分割</span>
  splitChunks<span class="token operator">:</span><span class="token punctuation">{</span>
    chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 默认⽀持异步，我们使用all </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样 npm run dev 后，就可以看到多出一个 venders~index.js的文件，为 react 库文件</p> <p><img src="/images/webpack/webpack_1_41.png" alt="webpack_1_41.png"></p> <p>一般使用默认的配置，适合web性能最佳实践，但有些情况，项目的最佳策略可能有所不同。splitChunks 还可以配置很多细节</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 默认仅对异步模块进行分割，initial 仅对同步，all 对所有模块</span>
      minSize<span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token comment">// 生成块的最小大大小（以字节为单位) 20kb</span>
      minRemainingSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// </span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// </span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 打包生成的chunk文件最少有几个chunk引⽤了这个模块</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 最⼤异步并行请求数</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 入口文件的最大并行请求数</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 代码分割文件名分隔符</span>
      enforceSizeThreshold<span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 缓存组</span>
        defaultVendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>参考：<a href="https://webpack.js.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer">SplitChunksPlugin | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="预获取-预加载模块-prefetch-preload-module"><a href="#预获取-预加载模块-prefetch-preload-module" class="header-anchor">#</a> 预获取/预加载模块(prefetch/preload module)</h3> <p>webpack v4.6.0+ 增加了对预获取和预加载的支持。</p> <ul><li>prefetch(预获取)：将来某些导航下可能需要的资源 (推荐)</li> <li>preload(预加载)：当前导航下可能需要资源 <strong>不正确地使用 webpackPreload 会有损性能，请谨慎使用。</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//...</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'LoginModal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这会生成 &lt;link rel=&quot;prefetch&quot; href=&quot;login-modal-chunk.js&quot;&gt; 并追加到页面头部，指示着浏览器在闲置时间预取 login-modal-chunk.js 文件。</span>
</code></pre></div><p><strong>prefetch 在父 chunk 加载结束后，网络空闲时开始加载。</strong></p> <p><strong>preload 和父 chunk 并行请求，可能会有负面的影响</strong></p> <p>参考: <a href="https://webpack.docschina.org/guides/code-splitting/#prefetchingpreloading-modules" target="_blank" rel="noopener noreferrer">预获取/预加载模块(prefetch/preload module) | webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="webpack打包原理分析"><a href="#webpack打包原理分析" class="header-anchor">#</a> webpack打包原理分析</h2> <p>来回顾一下之前的知识点，在一个空的项目中，引入webpack进行打包</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 创建一个空的项目</span>
<span class="token function">mkdir</span> webpack_source
<span class="token comment"># 进入该项目目录</span>
<span class="token builtin class-name">cd</span> webpack_source
<span class="token comment"># 初始化，生成 package.json</span>
<span class="token function">npm</span> init -y
<span class="token comment"># 安装webpack依赖包</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli -D
<span class="token comment"># 创建src/index.js 写入值document.write('123')，并返回到webpack_source目录</span>
<span class="token function">mkdir</span> src<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> src<span class="token punctuation">;</span> <span class="token function">touch</span> index.js<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;document.write('123')&quot;</span> <span class="token operator">&gt;&gt;</span> index.js<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span><span class="token punctuation">;</span>
<span class="token comment"># 创建webpack配置文件</span>
<span class="token function">touch</span> webpack.config.js
</code></pre></div><p>webpack.config.js 内容如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'main.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>npx webpack 执行打包就可以在 dist目录下生成main.js了。webpack在打包时，主要执行了三个步骤</p> <ol><li>找到 entry 入口文件，分析内容</li> <li>找出模块依赖，转换内容(浏览器可以运行的代码)</li> <li>输出源代码，把代码放到 ./dist/main.js</li></ol> <h2 id="自己写一个-loader"><a href="#自己写一个-loader" class="header-anchor">#</a> 自己写一个 loader</h2> <h2 id="自己写一个-plugins"><a href="#自己写一个-plugins" class="header-anchor">#</a> 自己写一个 plugins</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/28/2020, 6:32:03 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.203f8a3a.js" defer></script><script src="/assets/js/2.4b3539f1.js" defer></script><script src="/assets/js/147.f447a013.js" defer></script><script src="/assets/js/3.e6a4dd76.js" defer></script>
  </body>
</html>
