<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>25. 客户端存储 - JS高程4 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="HTTP 是一种基于请求-响应的无状态协议，无法保存数据信息，刷新页面后数据就重置了。在客户端存储用户信息的需求是比较常见的，对该问题的第一个解决方法就是 cookie。cookie 由网景公司发明，由 Persistent Client State - HTTP Cookies 规范定义。除了 cookie 外，客户端存储还可以使用 Web Storage，IndexedDB 等。可以用于同域下不同 TAB 页面之间的通信。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.594b47db.css" as="style"><link rel="preload" href="/assets/js/app.a1bcc4c3.js" as="script"><link rel="preload" href="/assets/js/2.4b3539f1.js" as="script"><link rel="preload" href="/assets/js/84.bf3d114b.js" as="script"><link rel="preload" href="/assets/js/3.e6a4dd76.js" as="script"><link rel="prefetch" href="/assets/js/10.35d8cd15.js"><link rel="prefetch" href="/assets/js/100.62403a37.js"><link rel="prefetch" href="/assets/js/101.9eead1bc.js"><link rel="prefetch" href="/assets/js/102.f70cd704.js"><link rel="prefetch" href="/assets/js/103.c1accf9e.js"><link rel="prefetch" href="/assets/js/104.92e14ed4.js"><link rel="prefetch" href="/assets/js/105.9fdd021d.js"><link rel="prefetch" href="/assets/js/106.a16552d1.js"><link rel="prefetch" href="/assets/js/107.b2e9608f.js"><link rel="prefetch" href="/assets/js/108.8a2e6046.js"><link rel="prefetch" href="/assets/js/109.43e70fa7.js"><link rel="prefetch" href="/assets/js/11.69640d31.js"><link rel="prefetch" href="/assets/js/110.0ae45b0c.js"><link rel="prefetch" href="/assets/js/111.3df4e9b7.js"><link rel="prefetch" href="/assets/js/112.44f1b9ec.js"><link rel="prefetch" href="/assets/js/113.4ffcdc66.js"><link rel="prefetch" href="/assets/js/114.a97c0d4d.js"><link rel="prefetch" href="/assets/js/115.b0ab5fd6.js"><link rel="prefetch" href="/assets/js/116.fce468e7.js"><link rel="prefetch" href="/assets/js/117.8f2f1eca.js"><link rel="prefetch" href="/assets/js/118.1b42acea.js"><link rel="prefetch" href="/assets/js/119.da684fa3.js"><link rel="prefetch" href="/assets/js/12.66186d22.js"><link rel="prefetch" href="/assets/js/120.92adaeae.js"><link rel="prefetch" href="/assets/js/121.46e8c5ff.js"><link rel="prefetch" href="/assets/js/122.c9d414e8.js"><link rel="prefetch" href="/assets/js/123.8888bff9.js"><link rel="prefetch" href="/assets/js/124.e1d66f62.js"><link rel="prefetch" href="/assets/js/125.ea43cf5c.js"><link rel="prefetch" href="/assets/js/126.9a6aaa99.js"><link rel="prefetch" href="/assets/js/127.44b6010e.js"><link rel="prefetch" href="/assets/js/128.184020a9.js"><link rel="prefetch" href="/assets/js/129.69596776.js"><link rel="prefetch" href="/assets/js/13.a8b44eb9.js"><link rel="prefetch" href="/assets/js/130.c3e8e6f1.js"><link rel="prefetch" href="/assets/js/131.50fccd13.js"><link rel="prefetch" href="/assets/js/132.32cbc95e.js"><link rel="prefetch" href="/assets/js/133.d2ebae38.js"><link rel="prefetch" href="/assets/js/134.4de15fb0.js"><link rel="prefetch" href="/assets/js/135.50389e75.js"><link rel="prefetch" href="/assets/js/136.4f1bb8f3.js"><link rel="prefetch" href="/assets/js/137.43f2447c.js"><link rel="prefetch" href="/assets/js/138.719d8b96.js"><link rel="prefetch" href="/assets/js/139.0bb0ef28.js"><link rel="prefetch" href="/assets/js/14.63576ad2.js"><link rel="prefetch" href="/assets/js/140.050dd27b.js"><link rel="prefetch" href="/assets/js/141.0ac977c2.js"><link rel="prefetch" href="/assets/js/142.a83bd583.js"><link rel="prefetch" href="/assets/js/143.ee4fa74c.js"><link rel="prefetch" href="/assets/js/144.f54f4aaf.js"><link rel="prefetch" href="/assets/js/145.14b0aaa2.js"><link rel="prefetch" href="/assets/js/146.28f1cf68.js"><link rel="prefetch" href="/assets/js/147.123f6bab.js"><link rel="prefetch" href="/assets/js/148.c7917ba7.js"><link rel="prefetch" href="/assets/js/149.9ec0f297.js"><link rel="prefetch" href="/assets/js/15.eee264f4.js"><link rel="prefetch" href="/assets/js/150.5b5e29da.js"><link rel="prefetch" href="/assets/js/151.703f73be.js"><link rel="prefetch" href="/assets/js/152.62169f3b.js"><link rel="prefetch" href="/assets/js/153.ca245a09.js"><link rel="prefetch" href="/assets/js/154.532080cf.js"><link rel="prefetch" href="/assets/js/155.84a7be16.js"><link rel="prefetch" href="/assets/js/156.6197ef98.js"><link rel="prefetch" href="/assets/js/157.b3afad81.js"><link rel="prefetch" href="/assets/js/158.b0d082ab.js"><link rel="prefetch" href="/assets/js/159.f0c39600.js"><link rel="prefetch" href="/assets/js/16.eb71a02a.js"><link rel="prefetch" href="/assets/js/17.02588c41.js"><link rel="prefetch" href="/assets/js/18.50bc4846.js"><link rel="prefetch" href="/assets/js/19.11b63d49.js"><link rel="prefetch" href="/assets/js/20.8de62fb6.js"><link rel="prefetch" href="/assets/js/21.6f2ce4c0.js"><link rel="prefetch" href="/assets/js/22.456f3d71.js"><link rel="prefetch" href="/assets/js/23.c06a1b16.js"><link rel="prefetch" href="/assets/js/24.ad5c06ea.js"><link rel="prefetch" href="/assets/js/25.06895800.js"><link rel="prefetch" href="/assets/js/26.5edf933c.js"><link rel="prefetch" href="/assets/js/27.4ecf6215.js"><link rel="prefetch" href="/assets/js/28.3f66d916.js"><link rel="prefetch" href="/assets/js/29.2bef1625.js"><link rel="prefetch" href="/assets/js/30.a79ebe07.js"><link rel="prefetch" href="/assets/js/31.7d16b276.js"><link rel="prefetch" href="/assets/js/32.23ef8e62.js"><link rel="prefetch" href="/assets/js/33.0c396262.js"><link rel="prefetch" href="/assets/js/34.8ee7721f.js"><link rel="prefetch" href="/assets/js/35.1b92b98c.js"><link rel="prefetch" href="/assets/js/36.1db3b6ca.js"><link rel="prefetch" href="/assets/js/37.8d0a586e.js"><link rel="prefetch" href="/assets/js/38.1d25c358.js"><link rel="prefetch" href="/assets/js/39.65fae495.js"><link rel="prefetch" href="/assets/js/4.87971e4f.js"><link rel="prefetch" href="/assets/js/40.71a63ab6.js"><link rel="prefetch" href="/assets/js/41.60788936.js"><link rel="prefetch" href="/assets/js/42.593c73ee.js"><link rel="prefetch" href="/assets/js/43.5c36ba6b.js"><link rel="prefetch" href="/assets/js/44.fae6a1d0.js"><link rel="prefetch" href="/assets/js/45.4b04f0f6.js"><link rel="prefetch" href="/assets/js/46.0d0079da.js"><link rel="prefetch" href="/assets/js/47.4113b162.js"><link rel="prefetch" href="/assets/js/48.2c99d432.js"><link rel="prefetch" href="/assets/js/49.bccf6668.js"><link rel="prefetch" href="/assets/js/5.5b94bff7.js"><link rel="prefetch" href="/assets/js/50.49879839.js"><link rel="prefetch" href="/assets/js/51.513ee75a.js"><link rel="prefetch" href="/assets/js/52.ea1b4b45.js"><link rel="prefetch" href="/assets/js/53.0d869fb2.js"><link rel="prefetch" href="/assets/js/54.bb4b40d8.js"><link rel="prefetch" href="/assets/js/55.f12ee302.js"><link rel="prefetch" href="/assets/js/56.6b8418c0.js"><link rel="prefetch" href="/assets/js/57.80332060.js"><link rel="prefetch" href="/assets/js/58.8a4491fc.js"><link rel="prefetch" href="/assets/js/59.4cde2092.js"><link rel="prefetch" href="/assets/js/6.481b22df.js"><link rel="prefetch" href="/assets/js/60.4db8717d.js"><link rel="prefetch" href="/assets/js/61.b1d1aa7e.js"><link rel="prefetch" href="/assets/js/62.f3d59428.js"><link rel="prefetch" href="/assets/js/63.0a5db164.js"><link rel="prefetch" href="/assets/js/64.7ae71e74.js"><link rel="prefetch" href="/assets/js/65.c041521a.js"><link rel="prefetch" href="/assets/js/66.8e122867.js"><link rel="prefetch" href="/assets/js/67.316e3bba.js"><link rel="prefetch" href="/assets/js/68.2a9ea7c0.js"><link rel="prefetch" href="/assets/js/69.013f3120.js"><link rel="prefetch" href="/assets/js/7.cb937ed7.js"><link rel="prefetch" href="/assets/js/70.14dbb73e.js"><link rel="prefetch" href="/assets/js/71.d364649d.js"><link rel="prefetch" href="/assets/js/72.26b29dfe.js"><link rel="prefetch" href="/assets/js/73.5c649771.js"><link rel="prefetch" href="/assets/js/74.597f8d6d.js"><link rel="prefetch" href="/assets/js/75.bafa2507.js"><link rel="prefetch" href="/assets/js/76.ff32c9f1.js"><link rel="prefetch" href="/assets/js/77.7134a6ec.js"><link rel="prefetch" href="/assets/js/78.78b0a1cc.js"><link rel="prefetch" href="/assets/js/79.c83b72c7.js"><link rel="prefetch" href="/assets/js/8.c04ae090.js"><link rel="prefetch" href="/assets/js/80.7d975c75.js"><link rel="prefetch" href="/assets/js/81.74e8ed40.js"><link rel="prefetch" href="/assets/js/82.3357dd0a.js"><link rel="prefetch" href="/assets/js/83.75bc4803.js"><link rel="prefetch" href="/assets/js/85.4ea0353f.js"><link rel="prefetch" href="/assets/js/86.d3743855.js"><link rel="prefetch" href="/assets/js/87.96f9597f.js"><link rel="prefetch" href="/assets/js/88.6a859aff.js"><link rel="prefetch" href="/assets/js/89.cd4335c4.js"><link rel="prefetch" href="/assets/js/9.6344b9c3.js"><link rel="prefetch" href="/assets/js/90.f5c90069.js"><link rel="prefetch" href="/assets/js/91.546764e0.js"><link rel="prefetch" href="/assets/js/92.e0f1efd9.js"><link rel="prefetch" href="/assets/js/93.56044903.js"><link rel="prefetch" href="/assets/js/94.b6720846.js"><link rel="prefetch" href="/assets/js/95.595b78a5.js"><link rel="prefetch" href="/assets/js/96.59571918.js"><link rel="prefetch" href="/assets/js/97.e69ef9d0.js"><link rel="prefetch" href="/assets/js/98.d3ad2eac.js"><link rel="prefetch" href="/assets/js/99.70ea2b6d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.594b47db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/mocha-test.html" class="nav-link">
  Mocha - JavaScript测试框架
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/mocha-test.html" class="nav-link">
  Mocha - JavaScript测试框架
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS/ES6</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ES6标准入门(第三版)笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JavaScript高级程序设计(第四版)笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/ad3/js-ad4-diff.html" class="sidebar-link">第四版相比第三版有哪些更新 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-1.html" class="sidebar-link">1. 什么是JavaScript - JS高程4</a></li><li><a href="/js/ad3/js-ad3-2.html" class="sidebar-link">2. 在HTML中使用JavaScript - JS高程4</a></li><li><a href="/js/ad3/js-ad3-3.html" class="sidebar-link">3. ES基本概念(语言基础) - JS高程4</a></li><li><a href="/js/ad3/js-ad3-4.html" class="sidebar-link">4. 变量、作用域与内存 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-5.html" class="sidebar-link">5. 基本引用类型 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-6.html" class="sidebar-link">6. 集合引用类型 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-7.html" class="sidebar-link">7. 迭代器与生成器(Iterator 与 Generator) - JS高程4</a></li><li><a href="/js/ad3/js-ad3-8.html" class="sidebar-link">8. 对象、类与面向对象编程 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-9.html" class="sidebar-link">9. 代理与反射(Proxy与Reflect) - JS高程4</a></li><li><a href="/js/ad3/js-ad3-10.html" class="sidebar-link">10. 函数 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-11.html" class="sidebar-link">11. 期约与异步函数(Promise与async/await) - JS高程4</a></li><li><a href="/js/ad3/js-ad3-12.html" class="sidebar-link">12. BOM - JS高程4</a></li><li><a href="/js/ad3/js-ad3-13.html" class="sidebar-link">13. 客户端检测 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-14.html" class="sidebar-link">14. DOM - JS高程4</a></li><li><a href="/js/ad3/js-ad3-15.html" class="sidebar-link">15. DOM扩展 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-16.html" class="sidebar-link">16. DOM2 和 DOM3 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-17.html" class="sidebar-link">17. 事件 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-18.html" class="sidebar-link">18. 动画与 Canvas 图形 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-19.html" class="sidebar-link">19. 表单脚本 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-20.html" class="sidebar-link">20. JavaScript API - JS高程4</a></li><li><a href="/js/ad3/js-ad3-21.html" class="sidebar-link">21. 错误处理与调试 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-22.html" class="sidebar-link">22. 处理 XML - JS高程4</a></li><li><a href="/js/ad3/js-ad3-23.html" class="sidebar-link">23. JSON - JS高程4</a></li><li><a href="/js/ad3/js-ad3-24.html" class="sidebar-link">24. 网络请求与远程资源 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-25.html" aria-current="page" class="active sidebar-link">25. 客户端存储 - JS高程4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#http-cookie-cookie" class="sidebar-link">Http Cookie(cookie)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#cookie-限制" class="sidebar-link">cookie 限制</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#cookie-构成" class="sidebar-link">cookie 构成</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#js-中的-cookie" class="sidebar-link">JS 中的 cookie</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#子cookie" class="sidebar-link">子cookie</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#使用-cookie-注意事项" class="sidebar-link">使用 cookie 注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#web-storage" class="sidebar-link">Web Storage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#storage-类型" class="sidebar-link">Storage 类型</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#sessionstorage" class="sidebar-link">sessionStorage</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#localstorage" class="sidebar-link">localStorage</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#storage-事件" class="sidebar-link">storage 事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#indexeddb" class="sidebar-link">IndexedDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#创建数据库" class="sidebar-link">创建数据库</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#创建对象存储" class="sidebar-link">创建对象存储</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#创建事务-插入对象" class="sidebar-link">创建事务/插入对象</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#通过游标查询多条数据" class="sidebar-link">通过游标查询多条数据</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#键范围-ibdkeyrange" class="sidebar-link">键范围 IBDKeyRange</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#设置游标方向" class="sidebar-link">设置游标方向</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#并发问题" class="sidebar-link">并发问题</a></li><li class="sidebar-sub-header"><a href="/js/ad3/js-ad3-25.html#限制" class="sidebar-link">限制</a></li></ul></li></ul></li><li><a href="/js/ad3/js-ad3-26.html" class="sidebar-link">26. 模块(Modules) - JS高程4</a></li><li><a href="/js/ad3/js-ad3-27.html" class="sidebar-link">27. 工作者线程(Web Workers) - JS高程4</a></li><li><a href="/js/ad3/js-ad3-28.html" class="sidebar-link">28. 最佳实践 - JS高程4</a></li><li><a href="/js/ad3/js-ad3-old.html" class="sidebar-link">第三版其他内容(高级技巧) - JS高程4</a></li></ul></section></li><li><a href="/js/js-dom-art.html" class="sidebar-link">JavaScript DOM 编程艺术(第二版)笔记</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_25-客户端存储"><a href="#_25-客户端存储" class="header-anchor">#</a> 25. 客户端存储</h1> <p>HTTP 是一种基于请求-响应的无状态协议，无法保存数据信息，刷新页面后数据就重置了。在客户端存储用户信息的需求是比较常见的，对该问题的第一个解决方法就是 cookie。cookie 由网景公司发明，由 <code>Persistent Client State: HTTP Cookies</code> 规范定义。除了 cookie 外，客户端存储还可以使用 Web Storage，IndexedDB 等。可以用于同域下不同 TAB 页面之间的通信。</p> <h2 id="http-cookie-cookie"><a href="#http-cookie-cookie" class="header-anchor">#</a> Http Cookie(cookie)</h2> <p>HTTP Cookie，通常直接叫做 cookie，最初用于在客户端存储会话信息。该规范要求 <strong>服务器在响应 HTTP 请求时，在 Set-Cookie 响应头中包含会话信息</strong>，服务器响应头可能如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 服务器响应头</span>
<span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> <span class="token constant">OK</span>
Content<span class="token operator">-</span>type<span class="token operator">:</span> text<span class="token operator">/</span>html
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> name<span class="token operator">=</span>value
Other<span class="token operator">-</span>header<span class="token operator">:</span> other<span class="token operator">-</span>header<span class="token operator">-</span>value
</code></pre></div><p>上面的服务器响应头中设置了一个以 name 为名称、value 为值的一个 cookie，<strong>浏览器会存储这样的会话信息，并在之后，通过为每个请求添加 Cookie 请求头将信息发送回服务器。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 之后的请求信息</span>
<span class="token constant">GET</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
Cookie<span class="token operator">:</span> name<span class="token operator">=</span>value
Other<span class="token operator">-</span>header<span class="token operator">:</span> other<span class="token operator">-</span>header<span class="token operator">-</span>value
</code></pre></div><p>这些发送回服务器的额外信息，可以用于唯一标识发送请求的客户端</p> <h3 id="cookie-限制"><a href="#cookie-限制" class="header-anchor">#</a> cookie 限制</h3> <ul><li>cookie 绑定在特定的域名下，其他域是无法访问，<strong>设置 cookie 后，它会与请求一起发送到服务器</strong>。</li> <li>cookie 存储在客户端机器上，为了防止被滥用，浏览器会限制 cookie 不能占用太多磁盘空间，另外由于 cookie 也会作为请求头发送到服务端，cookie 越大，请求完成时间越长，所以一般 size 尽量小点。不同的浏览器对 cookie 的限制不一样，为保证兼容性，一般有如下建议
<ul><li>每个域不要超过 20 个 cookie，尽管一般限制在 50+，或没限制</li> <li>每个 cookie 不超过 4kb，如果超过限制，cookie 会被静默删除</li> <li>每个域不超过 80 kb（20 * 4kb）</li></ul></li></ul> <h3 id="cookie-构成"><a href="#cookie-构成" class="header-anchor">#</a> cookie 构成</h3> <p>cookie 在浏览器中由以下参数构成</p> <ul><li><code>名称 name</code> 唯一标识 cookie 的名称，<strong>不区分大小写</strong>，myCookie 和 MyCookie 被认同是同一个cookie。名称尽量特殊点，防止其他子域设置了相同的 cookie，导致异常，<strong>名称必须被 URL 编码</strong></li> <li><code>值 value</code> cookie 名称对应的值，<strong>值必须被 URL 编码</strong></li> <li><code>域 domain</code> cookie 在哪个域是有效的，发送到这个域的所有请求都会包含对应的 cookie。默认为设置 cookie 的域，<code>.a.com</code> 表示对所有子域域都有效。</li> <li><code>路径 path</code> 请求 URL 中包含这个路径才会把 cookie 发送到服务器，可以指定 cookie 只能由 <code>xx.com/books/</code> 访问，那么 <code>xx.com</code> 的页面就不会发送 cookie 信息，即使请求都是来自同一个域</li> <li><code>过期时间</code> expires(HTTP/1.0)、max-age(Http/1.1) 如果不设置，浏览器会话结束即删除所有 cookie，也可以自己设置删除事件。expires 值为 GMT 格式的日期，如果设置为以前的时间。会立即删除，max-age 为有效期，单位秒。expires 和 max-age 参考:<a href="https://blog.csdn.net/yingzizizizizizzz/article/details/81347719" target="_blank" rel="noopener noreferrer">cookie 过期时间: expires 与 max-age<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>安全标志</code> secure 指定后只有使用 SSL 连接的时候才会发送到服务器</li> <li><code>HttpOnly</code> 为了帮助缓解跨站点脚本（XSS）攻击，<strong>JavaScript 的 document.cookie API 无法访问 HttpOnly cookie</strong>; 它们只被发送到服务器。 例如，持久化服务器端会话的 cookie 不需要可用于 JavaScript，并且应设置 HttpOnly 标志。</li></ul> <p>每一段信息都作为 Set-Cookie 头的一部分，使用分号加空格分隔每一段, 响应头示例:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对所有 wrox.com 域名及子域名下(/)，所有页面都有效的 cookie，且只能通过 SSL 连接才能传输</span>
<span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> <span class="token constant">OK</span>
Content<span class="token operator">-</span>type<span class="token operator">:</span> text<span class="token operator">/</span>html
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> name<span class="token operator">=</span>value<span class="token punctuation">;</span> domain<span class="token operator">=</span><span class="token punctuation">.</span>wrox<span class="token punctuation">.</span>com<span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> secure
Other<span class="token operator">-</span>header<span class="token operator">:</span> other<span class="token operator">-</span>header<span class="token operator">-</span>value

<span class="token comment">// 指定了名为 name 的 cookie，他会在2019/08/21 09:46:24失效，同时对于wwwx.wrox.com和wrox.com的任何子域都有效</span>
<span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> <span class="token constant">OK</span>
Content<span class="token operator">-</span>type<span class="token operator">:</span> text<span class="token operator">/</span>html
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> name<span class="token operator">=</span>value<span class="token punctuation">;</span> expires<span class="token operator">=</span>Wed<span class="token punctuation">,</span> <span class="token number">21</span> Aug <span class="token number">2019</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">24</span> <span class="token constant">GMT</span><span class="token punctuation">;</span> domain<span class="token operator">=</span><span class="token punctuation">.</span>wrox<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
Other<span class="token operator">-</span>header<span class="token operator">:</span> other<span class="token operator">-</span>header<span class="token operator">-</span>value

<span class="token comment">// 关于 GMT 时间 没有加时区，一般 new Date() 默认加了时区</span>
<span class="token comment">// 参考: http://fe.zuo11.com/js/ad3/js-ad3-5.html#date-%E7%B1%BB%E5%9E%8B</span>
<span class="token comment">// (new Date()).toGMTString()</span>
<span class="token comment">// &quot;Wed, 21 Aug 2019 09:46:24 GMT&quot;</span>
</code></pre></div><p><strong>域、路径、失效时间和 secure 标志都是服务器给浏览器的指示，以指定前端发送请求时何时发送 cookie。这些参数并不会作为发送到服务器的 cookie 信息的一部分，只有 name 和 value 才能被发送</strong></p> <h3 id="js-中的-cookie"><a href="#js-中的-cookie" class="header-anchor">#</a> JS 中的 cookie</h3> <p>在 JS 中处理 cookie 比较麻烦，因为接口过于简单，只有 BOM 的 document.cookie 属性。它会包含页面中所有有效的 cookie 字符串（根据域、路径、过期时间、安全设置过滤后），以分号分隔。名字和值都是通过 URL 编码的，必须使用 decodeURIComponent() 来解码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// document.cookie</span>
name1<span class="token operator">=</span>value1<span class="token punctuation">;</span>name2<span class="token operator">=</span>value2<span class="token punctuation">;</span>name3<span class="token operator">=</span>value3
</code></pre></div><p>设置cookie格式如下，并不会覆盖原有的 cookie，除非设置的 cookie 名称已存在</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;name=value; expires=expiration_time; path=domain_path; domain=domain_name; secure&quot;</span>
</code></pre></div><p>除了name、value其他值为可选，且都需要用URL编码</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token function">encodeURLComponent</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&quot;guoqzuo&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>cookie操作函数封装</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">CookieUtil</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取cookie值</span>
  <span class="token keyword">static</span> <span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cookieName <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> startIndex <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>cookieName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> cookieVal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果存在该cookie</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> endIndex <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">,</span> startIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>endIndex <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果找不到，就是字符串末尾</span>
        endIndex <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      cookieVal <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>startIndex <span class="token operator">+</span> cookieName<span class="token punctuation">.</span>length<span class="token punctuation">,</span> endIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> cookieVal<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 设置cookie</span>
  <span class="token comment">// options: { expires, maxAge, path, domain, secure, httpOnly}</span>
  <span class="token keyword">static</span> <span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tempVal <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>expires <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tempVal <span class="token operator">+=</span> <span class="token string">&quot;; expires=&quot;</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>expires<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>maxAge <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>maxAge <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tempVal <span class="token operator">+=</span> <span class="token string">'; max-age='</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>maxAge<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tempVal <span class="token operator">+=</span> <span class="token string">'; path='</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>path
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>domain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tempVal <span class="token operator">+=</span> <span class="token string">'; domain='</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>domain
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>secure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tempVal <span class="token operator">+=</span> <span class="token string">'; secure'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>HttpOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tempVal <span class="token operator">+=</span> <span class="token string">'; HttpOnly'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> tempVal
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 删除cookie</span>
  <span class="token comment">// options { path, domain, secure, ... }</span>
  <span class="token comment">// 将 expries 设置为过期时间即可删除</span>
  <span class="token keyword">static</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>expires <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      options <span class="token operator">=</span> <span class="token punctuation">{</span> expires<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    CookieUtil<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="子cookie"><a href="#子cookie" class="header-anchor">#</a> 子cookie</h3> <p>为了绕开浏览器单域名下的 cookie 数限制，有些开发者提出了 <strong>子 cookie</strong> 的概念。使用一个 cookie 值，来存储键值对。更多示例代码参见 p755</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// document.cookie</span>
name<span class="token operator">=</span>subname1<span class="token operator">=</span>valu1<span class="token operator">&amp;</span>subname2<span class="token operator">=</span>value2
</code></pre></div><h3 id="使用-cookie-注意事项"><a href="#使用-cookie-注意事项" class="header-anchor">#</a> 使用 cookie 注意事项</h3> <ul><li>httpOnly 在浏览器和服务端都可以设置，仅能在服务端读取，设置后 document.cookie 无法修改和读取</li> <li>cookie 尽量只保存必要信息，不要太大，由于会发送到服务端，cookie 越大，请求完成时间越长</li> <li>不要在 cookie 中存储敏感信息，虽然 httpOnly 的 cookie 无法通过 document.cookie 获取，但在浏览器开发工具中还是可以看到的。</li></ul> <h2 id="web-storage"><a href="#web-storage" class="header-anchor">#</a> Web Storage</h2> <p>Web Storage 最早是超文本应用技术工作组（WHATWG，Web Hypetext Application Technical Working Group）在 Web Applications 1.0 规范中提出的，这个规范的草案最终成了 HTML5 的一部分。由于设置 cookie 后发会送到服务端，cookie 越大，请求时间越长，因此 cookie 不适合存储大量数据。Web Storage 的目的解决 cookie 客户端存储需要频繁发送数据到服务器的问题，IE8+ 支持, Web Storage 最新的版本是第 2 版，该版本的两个主要目标是:</p> <ul><li>提供了一种 cookie 之外存储会话数据的途径</li> <li>提供了一种存储大量可以跨会话存在的数据机制</li></ul> <p>Web Storage 第二版定义了两个对象 localStorage 和 sessionStorage，可以做到刷新页面而不影响存储数据。</p> <ul><li>localStorage 是永久存储机制</li> <li>sessionStorage 是跨会话存储机制</li></ul> <p>sessionStorage 在新开一个 tab 页时就会失效，localStorage 则没有限制。</p> <h3 id="storage-类型"><a href="#storage-类型" class="header-anchor">#</a> Storage 类型</h3> <p>Storage 类型（localStorage、sessionStorage）提供最大的存储空间来存储键值对数据。Storage 类型只能存储字符串，非字符串存储前需要转换为字符串。Storage 实例与其对象有如下方法:</p> <ul><li><code>clear()</code> 删除所有值</li> <li><code>getItem(name)</code> 根据指定的名字 name 获取对应的值，如果没值返回 null</li> <li><code>key(index)</code>  获取 index 位置处的 key 的名称, 可以用来遍历值</li> <li><code>removeItem(name)</code> 删除指定 name 的值。</li> <li><code>setItem(name, value)</code> 设置键值对</li> <li><code>length</code> name 字段个数</li> <li><code>.[name]</code> 点语法支持，设置或获取值。使用 delete xx.name 可以删除值</li></ul> <h3 id="sessionstorage"><a href="#sessionstorage" class="header-anchor">#</a> sessionStorage</h3> <p>sessionStorage 数据浏览器关闭后，会消失。新开一个 tab 也会消失，用于存储只在会话期间有效的小段数据。2.5M - 5M。如果需要跨花卉持久存储数据，可以使用 localstorage</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// MDN</span>
sessionStorage maintains a separate storage area <span class="token keyword">for</span> each given origin that's available <span class="token keyword">for</span> the duration <span class="token keyword">of</span> the page <span class="token function">session</span> <span class="token punctuation">(</span><span class="token keyword">as</span> long <span class="token keyword">as</span> the browser is open<span class="token punctuation">,</span> including page reloads and restores<span class="token punctuation">)</span>
<span class="token operator">-</span> Stores data only <span class="token keyword">for</span> a session<span class="token punctuation">,</span> meaning that the data is stored until the <span class="token function">browser</span> <span class="token punctuation">(</span>or tab<span class="token punctuation">)</span> is closed<span class="token punctuation">.</span>
<span class="token operator">-</span> Data is never transferred to the server<span class="token punctuation">.</span>
<span class="token operator">-</span> Storage limit is larger than a <span class="token function">cookie</span> <span class="token punctuation">(</span>at most <span class="token number">5</span>MB<span class="token punctuation">)</span><span class="token punctuation">.</span>
</code></pre></div><p>相关链接: <a href="http://www.zuo11.com/blog/2020/8/sessionStorage_loss.html" target="_blank" rel="noopener noreferrer">怎么解决sessionStorage新打开一个tab页就失效的问题 - 左小白的技术日常<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> localStorage</h3> <p>修订过的 HTML5 规范中，localStorage 取代 globalStorage，作为持久保存客户端的数据的方案。<strong>要访问同一个 localStorage 对象，页面必须来自同一个域名(子域名无效)。使用同一种协议，同一个端口</strong>， 2.5M - 5M</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// MDN</span>
localStorage does the same thing<span class="token punctuation">,</span> but persists even when the browser is closed and reopened<span class="token punctuation">.</span>
<span class="token operator">-</span> Stores data <span class="token keyword">with</span> no expiration date<span class="token punctuation">,</span> and gets cleared only through JavaScript<span class="token punctuation">,</span> or clearing the Browser cache <span class="token operator">/</span> Locally Stored Data<span class="token punctuation">.</span>
<span class="token operator">-</span> Storage limit is the maximum amongst the three<span class="token punctuation">.</span>
</code></pre></div><h3 id="storage-事件"><a href="#storage-事件" class="header-anchor">#</a> storage 事件</h3> <p>当 Storage 对象发生变化时，都会在文档上触发 storage 事件。使用点语法或setItem() 设置值、使用 delete 或 removeItem() 删除值，以及每次调用 clear() 都会触发 Storage 事件</p> <p>单个页面里面 storage 事件不会触发，需要由其他 tab 页面触发, 触发的条件：</p> <ul><li>同一浏览器打开了两个同源页面</li> <li>其中一个页面修改了 localStorage 或 sessionStorage</li> <li>另一个网页注册了这个事件</li></ul> <p>参考: <a href="https://blog.csdn.net/jlin991/article/details/55855524" target="_blank" rel="noopener noreferrer">Storage事件无法触发解决<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'storage chage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// event.domain 存储变化对应的域</span>
  <span class="token comment">// event.key 被设置或删除的键</span>
  <span class="token comment">// event.newValue 键被设置的新值，若键被删除则为 null</span>
  <span class="token comment">// event.oldValue 键变化之前的值</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="indexeddb"><a href="#indexeddb" class="header-anchor">#</a> IndexedDB</h2> <p>Indexed Database API 简称 IndexedDB，是浏览器中存储结构化数据的一个方案，用以替代已废弃的 Web SQL Database API。IndexDB 背后的思想是创造一套 API，方便 JS 对象的存储和获取，同时也支持查询和搜索。书中讲的不是很好理解，可以参考 <a href="http://www.ruanyifeng.com/blog/2018/07/indexeddb.html" target="_blank" rel="noopener noreferrer">浏览器数据库 IndexedDB 入门教程 - 阮一峰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>IndexedDB 的设计几乎都是异步的。大多数操作以请求的形式执行，需要监听其返回结果的 success 或 error 事件才能拿到成功或错误信息。IE10+ 支持。</p> <h3 id="创建数据库"><a href="#创建数据库" class="header-anchor">#</a> 创建数据库</h3> <p>IndexDB 类似于 MySQL 的数据库，区别在于使用的是对象存储而不是表格存储数据，他是一个公共命名空间下的一组对象存储，类似于 NoSQL 风格的实现。它的核心对象是 window.indexedDB，类型为 IDBFactory {}，包含如下方法</p> <ul><li><code>indexDB.open(dbName, version)</code> 打开或创建一个数据库，dbName 是需要打开的数据库名称，version 为数据库版本。如果数据库已存在则打开，如果不存在则创建，然后打开。返回一个 IDBRequest 实例，可以在该实例上添加 onsuccess 和 onerror 事件处理程序</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> db<span class="token punctuation">,</span> request<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to open admin'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result <span class="token comment">// 类型为 IDBDatabase</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="创建对象存储"><a href="#创建对象存储" class="header-anchor">#</a> 创建对象存储</h3> <p>主要用于新创建数据库或数据库版本与期待的不一致时，创建新的对象存储。类似于 MySQL 存储数据前需要先创建表。创建对象存储需要指定对象存储名称、对象存储键(key)。这个 key 必须全局唯一，创建对象存储时必须指定一个键。</p> <ul><li><code>db对象.createObjectStore(存储对象名称, { keyPath: 存储对象key })</code> 创建一个存储对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">&quot;zuo&quot;</span><span class="token punctuation">,</span>
  firstName<span class="token operator">:</span> <span class="token string">&quot;fugui&quot;</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token string">'wang'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">'24'</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>假设要创建一个存储上述信息的对象存储，我们创建对象存储的时机需要在 upgrageneeded 事件中。这个事件在调用 open 创建一个新的数据库，或者数据库存在指定了一个升级的版本号时触发。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> db<span class="token punctuation">,</span> request<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to open admin'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result <span class="token comment">// 类型为 IDBDatabase</span>
<span class="token punctuation">}</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  <span class="token comment">// 这样做会删除原有数据，谨慎使用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'username'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="创建事务-插入对象"><a href="#创建事务-插入对象" class="header-anchor">#</a> 创建事务/插入对象</h3> <p>创建存储对象后，剩下的所有操作都是通过 <strong>事务</strong> 来完成的，在读取或修改数据时，需要通过事务把操作组织起来</p> <ul><li><code>db对象.transaction(对象存储名称, 访问模式)</code> 创建一个事务并返回 IDBTransaction 对象，存储对象名称可以是字符串，也可以是字符串数组。访问模式有三种：默认为 &quot;readonly&quot;，还有 &quot;readwrire&quot;、&quot;versionchange&quot;</li> <li><code>transaction对象.objectStore(对象存储名称)</code> 通过事务获取特定的对象存储。返回 IDBObjectStore 对象，一般命名为 store，它支持如下方法
<ul><li><code>store对象.add(object数据)</code> 添加对象，如果已经有了同名的 key，会报异常</li> <li><code>store对象.put(object数据)</code> 更新对象，可以添加对象，如果已经有了同名的 key，会使用新对象更新该值</li> <li><code>store对象.get()</code> 获取对象</li> <li><code>store对象.delete()</code> 删除对象</li> <li><code>store对象.clear()</code> 删除所有对象</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> db<span class="token punctuation">,</span> request<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to open admin'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result <span class="token comment">// 类型为 IDBDatabase</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span> <span class="token comment">// IDBTransaction</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token comment">// IDBObjectStore</span>
  <span class="token comment">// 添加值</span>
  <span class="token keyword">let</span> req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    username<span class="token operator">:</span> <span class="token string">&quot;zuo&quot;</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">&quot;fugui&quot;</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">'wang'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token string">'24'</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span>log
  req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token comment">// zuo</span>
  <span class="token comment">// 获取值</span>
  req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;zuo&quot;</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span>log
  req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span> 
  <span class="token comment">// {username: &quot;zuo&quot;, firstName: &quot;fugui&quot;, lastName: &quot;wang&quot;, age: &quot;24&quot;}</span>
<span class="token punctuation">}</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onupgradeneeded'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  <span class="token comment">// 这样做会删除原有数据，谨慎使用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'username'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="通过游标查询多条数据"><a href="#通过游标查询多条数据" class="header-anchor">#</a> 通过游标查询多条数据</h3> <p>使用事务可以通过一个已知的键值获取一条记录。如果需要获取多条记录就需要使用游标了。通过 IDBObjectStore 对象的 openCursor() 方法可以创建一个游标，类型为 IDBCursorWithValue，包含如下属性方法</p> <ul><li><code>direction</code> 字符串常量，表示游标的前进方向以及是否应该遍历所有重复的值，默认为 &quot;next&quot;，还包括 &quot;nextunique&quot;, &quot;prev&quot;, &quot;prevunique&quot;</li> <li><code>key</code> 对象的键</li> <li><code>value</code> 实际的对象</li> <li><code>primaryKey</code> 游标使用的键，有可能是对象键或索引键</li> <li><code>continue(可选的key)</code> 默认游标继续向下遍历，如果指定了 key，则游标移动到指定的 key</li> <li><code>update(obj)</code> 用于更新当前游标位置对应的值</li> <li><code>delete()</code> 删除游标位置的记录</li> <li><code>advance(count)</code> 游标向前移动指定的 count 条记录</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> db<span class="token punctuation">,</span> request<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result <span class="token comment">// 类型为 IDBDatabase</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token comment">// 添加值</span>
  <span class="token keyword">let</span> datas <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;zuo&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'16'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'33'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;zhang&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'24'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">let</span> reqs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> <span class="token function-variable function">successCb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'put success all'</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建一个游标</span>
    req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token comment">// IDBCursorWithValue</span>
      <span class="token comment">// direction: &quot;next&quot;</span>
      <span class="token comment">// key: &quot;you&quot;</span>
      <span class="token comment">// primaryKey: &quot;you&quot;</span>
      <span class="token comment">// value: {username: &quot;you&quot;, age: &quot;33&quot;}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key<span class="token punctuation">,</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 继续遍历</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;没有更多数据了&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  datas<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">let</span> req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'put success'</span><span class="token punctuation">)</span>
      reqs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>reqs<span class="token punctuation">.</span>length <span class="token operator">===</span> datas<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">successCb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'put error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onupgradeneeded'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  <span class="token comment">// 这样做会删除原有数据，谨慎使用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'username'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="键范围-ibdkeyrange"><a href="#键范围-ibdkeyrange" class="header-anchor">#</a> 键范围 IBDKeyRange</h3> <p>使用游标获取数据不太方便，使用 &quot;键范围&quot;（key range） 可以让游标更容易管理，IDBKeyRange 创建键范围的方法有如下几种，都是静态方法</p> <ul><li><code>IDBKeyRange.only(key)</code> 仅获取对应 key 的值</li> <li><code>IDBKeyRange.lowerBound(key[, lowerOpen])</code> 默认从 key 开始遍历，直到最后, lowerOpen 是否从他的下一个条记录开始</li> <li><code>IDBKeyRange.upperBound(key[, upperOpen])</code> 默认从头开始，达到 key 后停止遍历，upperOpen 是否从 key 的前一条记录截止</li> <li><code>IDBKeyRange.upperBound(lowerKey, upperKey[[, lowerOpen], upperOpen])</code> 默认从 lowerKey 开始遍历，到 upperKey 截止</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>cont boundRange <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token comment">// IDBKeyRange {lower: &quot;a&quot;, upper: &quot;b&quot;, lowerOpen: true, upperOpen: false}</span>
</code></pre></div><p>使用键范围控制游标遍历 demo</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> db<span class="token punctuation">,</span> request<span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result <span class="token comment">// 类型为 IDBDatabase</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token comment">// 添加值</span>
  <span class="token keyword">let</span> datas <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;zuo&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'16'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 2</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'33'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 1</span>
    <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;zhang&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">'24'</span> <span class="token punctuation">}</span> <span class="token comment">// 2</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">let</span> reqs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> <span class="token function-variable function">successCb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'put success all'</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建一个游标，从 you 记录开始，到 zhang 结束</span>
    <span class="token keyword">let</span> range <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhang&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token comment">// IDBCursorWithValue</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key<span class="token punctuation">,</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 继续遍历</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;没有更多数据了&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  datas<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">let</span> req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'put success'</span><span class="token punctuation">)</span>
      reqs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>reqs<span class="token punctuation">.</span>length <span class="token operator">===</span> datas<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">successCb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'put error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onupgradeneeded'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  <span class="token comment">// 这样做会删除原有数据，谨慎使用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'username'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="设置游标方向"><a href="#设置游标方向" class="header-anchor">#</a> 设置游标方向</h3> <p>openCursor() 支持两个参数，第一个为 IDBKeyRange，第二个参数为表示方向的字符串，默认为 &quot;next&quot;，另外支持 &quot;prev&quot;，&quot;nextunique&quot;, &quot;prevunique&quot;</p> <div class="language-js extra-class"><pre class="language-js"><code>req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;nextunique&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 如果有重复的数据跳过</span>
</code></pre></div><h3 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h3> <p>对于某些数据集，可能需要为对象存储指定多个键。例如同时记录用户的 ID 和用户名。可以把 ID 作为主键，然后在用户名上创建索引。下面的例子中建立名为 username 的索引，属性为 username，unique 表示键是否必须在所有记录中唯一。返回 IDBIndex 实例，它类似于 IDBObjectStore，可以直接使用该对象执行相关操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> transation <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transation</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> transation<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建索引</span>
index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'useranme'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>使用索引</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'users'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用一个已存在的索引</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更多细节参考：p771</p> <h3 id="并发问题"><a href="#并发问题" class="header-anchor">#</a> 并发问题</h3> <p>在浏览器中，如果两个不同的 tab 页打开了同一个页面。而版本变化只能在浏览器只有一个标签页使用数据库时才能完成。需要在 onversionchange 时关闭数据库</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> re<span class="token punctuation">,</span> db<span class="token punctuation">;</span>
req <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  db<span class="token punctuation">.</span><span class="token function-variable function">onversionchange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="限制"><a href="#限制" class="header-anchor">#</a> 限制</h3> <p>indexedDB 的限制和 Web Storage 大致一样</p> <ul><li>数据库和当前域（协议、host、端口）绑定</li> <li>Chrome 限制为 5M，如果超出限制会请求用户许可</li> <li>本地调试建议使用 Chrome</li></ul> <p>参考：<a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="noopener noreferrer">IndexedDB API - MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/21/2020, 10:39:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/ad3/js-ad3-24.html" class="prev">
        24. 网络请求与远程资源 - JS高程4
      </a></span> <span class="next"><a href="/js/ad3/js-ad3-26.html">
        26. 模块(Modules) - JS高程4
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.a1bcc4c3.js" defer></script><script src="/assets/js/2.4b3539f1.js" defer></script><script src="/assets/js/84.bf3d114b.js" defer></script><script src="/assets/js/3.e6a4dd76.js" defer></script>
  </body>
</html>
