<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js 内置模块笔记 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="左小白的前端笔记，归纳整理自己在前端工作、学习中的一些心得笔记，有利于前端知识系统化。包括 Vue.js、前端工程化（TypeScript、Node.js、webpack）、Docker、JS/ES6、CSS/CSS3、HTML/HTML5、数据可视化、计算机基础、英语等笔记。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.c896736b.css" as="style"><link rel="preload" href="/assets/js/app.222184eb.js" as="script"><link rel="preload" href="/assets/js/2.3f8a6b0b.js" as="script"><link rel="preload" href="/assets/js/128.aa7f5018.js" as="script"><link rel="preload" href="/assets/js/3.018b29e2.js" as="script"><link rel="prefetch" href="/assets/js/10.9d91f1b8.js"><link rel="prefetch" href="/assets/js/100.c819952b.js"><link rel="prefetch" href="/assets/js/101.62c77c5f.js"><link rel="prefetch" href="/assets/js/102.b62e6f04.js"><link rel="prefetch" href="/assets/js/103.e64c7ead.js"><link rel="prefetch" href="/assets/js/104.35d4c324.js"><link rel="prefetch" href="/assets/js/105.4147930a.js"><link rel="prefetch" href="/assets/js/106.b01c2d24.js"><link rel="prefetch" href="/assets/js/107.8453fecf.js"><link rel="prefetch" href="/assets/js/108.492914d7.js"><link rel="prefetch" href="/assets/js/109.9e08fa69.js"><link rel="prefetch" href="/assets/js/11.b7e99381.js"><link rel="prefetch" href="/assets/js/110.68bfb110.js"><link rel="prefetch" href="/assets/js/111.8d790a52.js"><link rel="prefetch" href="/assets/js/112.8c759909.js"><link rel="prefetch" href="/assets/js/113.2cb44b65.js"><link rel="prefetch" href="/assets/js/114.af866c28.js"><link rel="prefetch" href="/assets/js/115.81a99552.js"><link rel="prefetch" href="/assets/js/116.bdb1301b.js"><link rel="prefetch" href="/assets/js/117.bf5ecfeb.js"><link rel="prefetch" href="/assets/js/118.9244e9be.js"><link rel="prefetch" href="/assets/js/119.06ec3c12.js"><link rel="prefetch" href="/assets/js/12.42673558.js"><link rel="prefetch" href="/assets/js/120.af976ac8.js"><link rel="prefetch" href="/assets/js/121.b2fda307.js"><link rel="prefetch" href="/assets/js/122.d2e73d20.js"><link rel="prefetch" href="/assets/js/123.99e72a69.js"><link rel="prefetch" href="/assets/js/124.486ecec9.js"><link rel="prefetch" href="/assets/js/125.f251cf73.js"><link rel="prefetch" href="/assets/js/126.0f844bcf.js"><link rel="prefetch" href="/assets/js/127.ac094c12.js"><link rel="prefetch" href="/assets/js/129.61ef7f75.js"><link rel="prefetch" href="/assets/js/13.986f7498.js"><link rel="prefetch" href="/assets/js/130.10c3b575.js"><link rel="prefetch" href="/assets/js/131.373c3a15.js"><link rel="prefetch" href="/assets/js/132.a78117c0.js"><link rel="prefetch" href="/assets/js/133.ba2c2f72.js"><link rel="prefetch" href="/assets/js/134.898729aa.js"><link rel="prefetch" href="/assets/js/135.1da68a32.js"><link rel="prefetch" href="/assets/js/136.c4a37002.js"><link rel="prefetch" href="/assets/js/137.bc509ee2.js"><link rel="prefetch" href="/assets/js/138.06d4dada.js"><link rel="prefetch" href="/assets/js/139.09d2fe2e.js"><link rel="prefetch" href="/assets/js/14.5ce6db09.js"><link rel="prefetch" href="/assets/js/140.43257c97.js"><link rel="prefetch" href="/assets/js/141.619ef672.js"><link rel="prefetch" href="/assets/js/142.2f4291a3.js"><link rel="prefetch" href="/assets/js/143.4cb35e2e.js"><link rel="prefetch" href="/assets/js/144.1852b0e0.js"><link rel="prefetch" href="/assets/js/145.333a9d23.js"><link rel="prefetch" href="/assets/js/146.27b09871.js"><link rel="prefetch" href="/assets/js/147.48f652f9.js"><link rel="prefetch" href="/assets/js/148.8d03109b.js"><link rel="prefetch" href="/assets/js/149.d4672362.js"><link rel="prefetch" href="/assets/js/15.9cd93588.js"><link rel="prefetch" href="/assets/js/150.93b40e8f.js"><link rel="prefetch" href="/assets/js/151.c35e85e6.js"><link rel="prefetch" href="/assets/js/152.b5eead7e.js"><link rel="prefetch" href="/assets/js/153.6c42745a.js"><link rel="prefetch" href="/assets/js/154.3d4a9d38.js"><link rel="prefetch" href="/assets/js/155.2719d7e4.js"><link rel="prefetch" href="/assets/js/156.9a05d99f.js"><link rel="prefetch" href="/assets/js/157.2ee4c6ad.js"><link rel="prefetch" href="/assets/js/158.9a466cb2.js"><link rel="prefetch" href="/assets/js/159.2e2a8e03.js"><link rel="prefetch" href="/assets/js/16.ea0f861e.js"><link rel="prefetch" href="/assets/js/160.87f7a1f5.js"><link rel="prefetch" href="/assets/js/161.3b990d2c.js"><link rel="prefetch" href="/assets/js/162.03fbe89f.js"><link rel="prefetch" href="/assets/js/163.91c13e9e.js"><link rel="prefetch" href="/assets/js/164.14aeccf0.js"><link rel="prefetch" href="/assets/js/165.ac44f873.js"><link rel="prefetch" href="/assets/js/166.d949dcf8.js"><link rel="prefetch" href="/assets/js/167.f866505f.js"><link rel="prefetch" href="/assets/js/17.b02447ea.js"><link rel="prefetch" href="/assets/js/18.dadf715c.js"><link rel="prefetch" href="/assets/js/19.711ca118.js"><link rel="prefetch" href="/assets/js/20.67b2e7ac.js"><link rel="prefetch" href="/assets/js/21.1062ab94.js"><link rel="prefetch" href="/assets/js/22.58137531.js"><link rel="prefetch" href="/assets/js/23.4c1fc498.js"><link rel="prefetch" href="/assets/js/24.f04d7b70.js"><link rel="prefetch" href="/assets/js/25.b513497e.js"><link rel="prefetch" href="/assets/js/26.98142d7d.js"><link rel="prefetch" href="/assets/js/27.3463feb1.js"><link rel="prefetch" href="/assets/js/28.668030a9.js"><link rel="prefetch" href="/assets/js/29.6e2056fb.js"><link rel="prefetch" href="/assets/js/30.7346364e.js"><link rel="prefetch" href="/assets/js/31.8e563168.js"><link rel="prefetch" href="/assets/js/32.ff88cb29.js"><link rel="prefetch" href="/assets/js/33.3872e844.js"><link rel="prefetch" href="/assets/js/34.8528d11c.js"><link rel="prefetch" href="/assets/js/35.8bc50305.js"><link rel="prefetch" href="/assets/js/36.c228b885.js"><link rel="prefetch" href="/assets/js/37.3247d5e3.js"><link rel="prefetch" href="/assets/js/38.091ab5f2.js"><link rel="prefetch" href="/assets/js/39.a0aae745.js"><link rel="prefetch" href="/assets/js/4.727b3cb3.js"><link rel="prefetch" href="/assets/js/40.a4511166.js"><link rel="prefetch" href="/assets/js/41.aa3d1bb9.js"><link rel="prefetch" href="/assets/js/42.a48c9270.js"><link rel="prefetch" href="/assets/js/43.05418d59.js"><link rel="prefetch" href="/assets/js/44.a6fd5424.js"><link rel="prefetch" href="/assets/js/45.2d28ee99.js"><link rel="prefetch" href="/assets/js/46.73bb240c.js"><link rel="prefetch" href="/assets/js/47.533c85cc.js"><link rel="prefetch" href="/assets/js/48.675c7b9f.js"><link rel="prefetch" href="/assets/js/49.a90588e1.js"><link rel="prefetch" href="/assets/js/5.5f97339e.js"><link rel="prefetch" href="/assets/js/50.16999182.js"><link rel="prefetch" href="/assets/js/51.3f652437.js"><link rel="prefetch" href="/assets/js/52.19a0186f.js"><link rel="prefetch" href="/assets/js/53.3816f661.js"><link rel="prefetch" href="/assets/js/54.9966941e.js"><link rel="prefetch" href="/assets/js/55.11cf3564.js"><link rel="prefetch" href="/assets/js/56.1904522d.js"><link rel="prefetch" href="/assets/js/57.ccab6ccc.js"><link rel="prefetch" href="/assets/js/58.65f407b4.js"><link rel="prefetch" href="/assets/js/59.f799e6e1.js"><link rel="prefetch" href="/assets/js/6.8b6802aa.js"><link rel="prefetch" href="/assets/js/60.a70ee3de.js"><link rel="prefetch" href="/assets/js/61.aa96422c.js"><link rel="prefetch" href="/assets/js/62.461d77f6.js"><link rel="prefetch" href="/assets/js/63.ffd14805.js"><link rel="prefetch" href="/assets/js/64.862ba338.js"><link rel="prefetch" href="/assets/js/65.e9864945.js"><link rel="prefetch" href="/assets/js/66.3f5ed71a.js"><link rel="prefetch" href="/assets/js/67.175ff21f.js"><link rel="prefetch" href="/assets/js/68.582d2924.js"><link rel="prefetch" href="/assets/js/69.7217f814.js"><link rel="prefetch" href="/assets/js/7.55c6af5e.js"><link rel="prefetch" href="/assets/js/70.8d7c375e.js"><link rel="prefetch" href="/assets/js/71.4732a004.js"><link rel="prefetch" href="/assets/js/72.32704e34.js"><link rel="prefetch" href="/assets/js/73.c1bc5a66.js"><link rel="prefetch" href="/assets/js/74.a5f3f7b7.js"><link rel="prefetch" href="/assets/js/75.0003d6fa.js"><link rel="prefetch" href="/assets/js/76.7e5be669.js"><link rel="prefetch" href="/assets/js/77.ce6fc909.js"><link rel="prefetch" href="/assets/js/78.3d505a90.js"><link rel="prefetch" href="/assets/js/79.3abcd1d6.js"><link rel="prefetch" href="/assets/js/8.b5a4a0a4.js"><link rel="prefetch" href="/assets/js/80.a574f302.js"><link rel="prefetch" href="/assets/js/81.b0b699ad.js"><link rel="prefetch" href="/assets/js/82.94d7a1c2.js"><link rel="prefetch" href="/assets/js/83.33648457.js"><link rel="prefetch" href="/assets/js/84.1779fff1.js"><link rel="prefetch" href="/assets/js/85.8b7f817c.js"><link rel="prefetch" href="/assets/js/86.cb4e2238.js"><link rel="prefetch" href="/assets/js/87.97a84c9d.js"><link rel="prefetch" href="/assets/js/88.bfbd70a7.js"><link rel="prefetch" href="/assets/js/89.15644171.js"><link rel="prefetch" href="/assets/js/9.c5b9353e.js"><link rel="prefetch" href="/assets/js/90.689c48d2.js"><link rel="prefetch" href="/assets/js/91.3b922a75.js"><link rel="prefetch" href="/assets/js/92.3cf18cbf.js"><link rel="prefetch" href="/assets/js/93.ed12d953.js"><link rel="prefetch" href="/assets/js/94.37d44c56.js"><link rel="prefetch" href="/assets/js/95.655e0323.js"><link rel="prefetch" href="/assets/js/96.7323a21e.js"><link rel="prefetch" href="/assets/js/97.fff0d8fd.js"><link rel="prefetch" href="/assets/js/98.51a30d4d.js"><link rel="prefetch" href="/assets/js/99.37dd8e53.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c896736b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/you-donot-know-js-1/scope-closures.html" class="nav-link">
  你不知道的 JavaScript - 上卷
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/mocha-test.html" class="nav-link">
  Mocha - JavaScript测试框架
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zuoxiaobai/service-monitor" target="_blank" rel="noopener noreferrer" class="nav-link external">
  service-monitor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/you-donot-know-js-1/scope-closures.html" class="nav-link">
  你不知道的 JavaScript - 上卷
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/mocha-test.html" class="nav-link">
  Mocha - JavaScript测试框架
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zuoxiaobai/service-monitor" target="_blank" rel="noopener noreferrer" class="nav-link external">
  service-monitor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node.js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/node-doc.html" aria-current="page" class="active sidebar-link">Node.js 内置模块笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/node-doc.html#child-process" class="sidebar-link">child_process</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#http" class="sidebar-link">http</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/node-doc.html#http-clientrequest-类-http-get-、http-request" class="sidebar-link">http.ClientRequest 类 http.get()、http.request()</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#http-server-类-http-createserver" class="sidebar-link">http.Server 类 http.createServer()</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#http-serverresponse-类" class="sidebar-link">http.ServerResponse 类</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#http-incomingmessage-类" class="sidebar-link">http.IncomingMessage 类</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#http-methods、http-status-codes" class="sidebar-link">http.METHODS、http.STATUS_CODES</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#https" class="sidebar-link">https</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#http2" class="sidebar-link">http2</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#querystring" class="sidebar-link">querystring</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#dns" class="sidebar-link">dns</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/node-doc.html#dns-lookup" class="sidebar-link">dns.lookup()</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#dns-resolveany" class="sidebar-link">dns.resolveAny()</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#dns-reverse" class="sidebar-link">dns.reverse()</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#dns-getservers" class="sidebar-link">dns.getServers()</a></li><li class="sidebar-sub-header"><a href="/node/node-doc.html#dns-promise-形式接口" class="sidebar-link">dns Promise 形式接口</a></li></ul></li></ul></li><li><a href="/node/node-third-party.html" class="sidebar-link">Node.js 第三方模块笔记</a></li><li><a href="/node/base/1.html" class="sidebar-link">Node.js基础</a></li><li><a href="/node/base/2.html" class="sidebar-link">Koa</a></li><li><a href="/node/base/3.html" class="sidebar-link">网络编程</a></li><li><a href="/node/base/4.html" class="sidebar-link">数据持久化mysql</a></li><li><a href="/node/base/5.html" class="sidebar-link">数据持久化mongodb</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js-内置模块笔记"><a href="#node-js-内置模块笔记" class="header-anchor">#</a> Node.js 内置模块笔记</h1> <p>参考</p> <ul><li><a href="http://nodejs.cn/api/" target="_blank" rel="noopener noreferrer">Node.js 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nodejs.org/dist/latest-v14.x/docs/api/index.html" target="_blank" rel="noopener noreferrer">Node.js 英文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="child-process"><a href="#child-process" class="header-anchor">#</a> child_process</h2> <p>child_process 模块允许打开一个子进程去执行其他任务，该功能使 node 程序可以执行指定的 shell 脚本，可以用于自动化部署、定时任务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ls <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'-lh'</span><span class="token punctuation">,</span> <span class="token string">'/usr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行 ls -lh /usr 命令</span>

ls<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ls 产生的 terminal log 在这里 console</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果发生错误，错误从这里输出</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行完成后正常退出就是 0 </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行写好的 shell 脚本</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># deploy.sh</span>
<span class="token comment"># chmod +x deploy.sh 注意要加可执行权限</span>
<span class="token comment"># 执行 ./deploy.sh  或者 sh ./deploy.sh</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;开始部署&quot;</span>

<span class="token comment"># 显示当前执行路径，用于排查路径错误</span>
<span class="token builtin class-name">pwd</span> 

<span class="token comment"># 拉取最新代码</span>
<span class="token function">git</span> pull

<span class="token comment"># pm2 重启服务 node 服务，也可以是其他逻辑</span>
pm2 stop xxx
pm2 start src/index.js -n <span class="token string">'xxx'</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;完成部署&quot;</span>
</code></pre></div><p>用于执行 shell 脚本的 node 程序</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// deploy.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'./deploy.sh'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sh ./deploy.sh 运行脚本</span>

child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 运行命令产生的 terminal log 在这里 console</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果发生错误，错误从这里输出</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行完成后正常退出就是 0 </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">child process exited with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="http"><a href="#http" class="header-anchor">#</a> http</h2> <h3 id="http-clientrequest-类-http-get-、http-request"><a href="#http-clientrequest-类-http-get-、http-request" class="header-anchor">#</a> http.ClientRequest 类 http.get()、http.request()</h3> <p>可以使用 http.get()、http.request() 发送 http 请求。这两个函数返回 http.ClientRequest 对象</p> <ul><li><code>http.request(url[, options][, callback])</code> 发送 http 请求</li> <li><code>http.get(url[, options][, callback])</code> 发送 get 请求方式的 http 请求，自动调用 req.end()</li></ul> <p>http.ClientRequest 对象(假设命名为 request，一般简写为 req) 支持以下方法、事件</p> <ul><li><code>request.write(chunk[, encoding][, callback])</code> Sends a chunk of the body 发送一个请求主体(body)的数据块。POST 传送数据时使用</li> <li><code>request.end([data[, encoding]][, callback])</code> 完成发送请求。 req.end(data, encoding, cb) 相当于调用 req.write(data, encoding) 后再调用 req.end(cb)</li> <li><code>request.destroy([error])</code> 销毁请求，用于替代之前的 request.abort()</li> <li><code>error 事件</code> req.on('error', cb) 如果请求出错，需要监听该事件接收错误，使用 try/catch 是无法捕获错误的。</li></ul> <p><strong>发送 GET 请求</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> req <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'http://fe.zuo11.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// hostname: 'localhost',</span>
  <span class="token comment">// port: 80,</span>
  <span class="token comment">// agent: false, // 是否使用代理</span>
  path<span class="token operator">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> statusCode <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token keyword">const</span> contentType <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span> <span class="token comment">// 200 text/html; charset=utf-8</span>
  res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> rawData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> rawData <span class="token operator">+=</span> chunk<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// res 文本数据，如果是 JSON 字符串数据，需使用 JSON.parse(rawData);</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rawData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求返回的 http.ClientRequest 类，可以监听上面的一些方法</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求出现错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 必须</span>
</code></pre></div><p>由于大多请求是不带请求体(body data)的 GET 请求，于是 Node.js 提供了更便捷的 http.get() 方法，和 http.request 的区别是无法设置 method 为 POST 等，而且内部会自动调用 req.end() 完成发送请求。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://fe.zuo11.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// hostname: 'localhost',</span>
  <span class="token comment">// port: 80,</span>
  <span class="token comment">// agent: false, // 是否使用代理</span>
  path<span class="token operator">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> statusCode <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token keyword">const</span> contentType <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span> <span class="token comment">// 200 text/html; charset=utf-8</span>
  res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> rawData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> rawData <span class="token operator">+=</span> chunk<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// res 文本数据，如果是 JSON 字符串数据，需使用 JSON.parse(rawData);</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rawData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求返回的 http.ClientRequest 类，可以监听上面的一些方法</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求出现错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>发送 POST 请求</strong>，如果需要在请求体携带数据，注意设置 <code>Content-Type</code> 请求头</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> req <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">8000</span><span class="token punctuation">,</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 'Content-Type': 'application/json',</span>
    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
    <span class="token comment">// 'Content-Length': Buffer.byteLength(postData)</span>
    <span class="token string">'Referer'</span><span class="token operator">:</span> <span class="token string">'www.zuo11.com'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// res IncomingMessage</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> statusCode <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token keyword">const</span> contentType <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span> <span class="token comment">// 200 application/json; charset=utf-8</span>
  res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> rawData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> rawData <span class="token operator">+=</span> chunk<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// res 文本数据，如果是 JSON 字符串数据，需使用 JSON.parse(rawData);</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rawData<span class="token punctuation">)</span> <span class="token comment">// {&quot;code&quot;:200,&quot;msg&quot;:&quot;Success&quot;,&quot;data&quot;:{&quot;b&quot;:1}}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求返回的 http.ClientRequest 类，可以监听上面的一些方法</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求出现错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// req.write(JSON.stringify({ a: 1, b: 2 }))</span>
req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'a=1&amp;b=2'</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 必须</span>
</code></pre></div><p>对应的 koa 接口服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
   code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
   msg<span class="token operator">:</span> <span class="token string">'Success'</span><span class="token punctuation">,</span>
   data<span class="token operator">:</span> <span class="token punctuation">{</span>
     b<span class="token operator">:</span> <span class="token number">1</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server listen on 8000 port'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：使用 http 模块发送请求时，可以伪造 Referer。上面的测试中，在 Koa 里可以接收到 headers 参数</p> <p><img src="/images/node/referer%E4%BC%AA%E9%80%A0.png" alt="referer伪造.png"></p> <h3 id="http-server-类-http-createserver"><a href="#http-server-类-http-createserver" class="header-anchor">#</a> http.Server 类 http.createServer()</h3> <p>http 模块除了可以发送 http 请求外，还可以使用创建 http 服务，监听处理 http 请求。使用 http.createServer() 创建 http 服务，返回 http.Server 实例，该实例调用 listen 方法开始监听服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('req', req) // req IncomingMessage</span>
  <span class="token comment">// console.log('res', res) // res ServerResponse </span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收到请求后，返回 &quot;123&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'clientError'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'HTTP/1.1 400 Bad Request\r\n\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="http-serverresponse-类"><a href="#http-serverresponse-类" class="header-anchor">#</a> http.ServerResponse 类</h3> <p>http.createServer 用于 http 模块在接收到 http 请求后，响应数据。是  http.createServer() 回调函数的第二个参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// http.ServerResponse 类实例 response</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token punctuation">,</span> encoding<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="http-incomingmessage-类"><a href="#http-incomingmessage-类" class="header-anchor">#</a> http.IncomingMessage 类</h3> <p>http.IncomingMessage 类有两个常见的用处</p> <ol><li>在接收到 http 请求时，用于接收请求信息，是 http.createServer() 回调函数的第一个参数。</li> <li>在发送 http 请求后，用于接收响应数据，是http.request() 和 http.get() 回调函数的参数</li></ol> <p>用法大致如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> req <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// IncomingMessage</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> statusCode <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token keyword">const</span> contentType <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> rawData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> rawData <span class="token operator">+=</span> chunk<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rawData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求返回的 http.ClientRequest 类，可以监听上面的一些方法</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求出现错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 必须</span>
</code></pre></div><h3 id="http-methods、http-status-codes"><a href="#http-methods、http-status-codes" class="header-anchor">#</a> http.METHODS、http.STATUS_CODES</h3> <p>http 模块包含两个常量属性，分别表示支持 http 请求方法，http 响应状态码集合。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">METHODS</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">'ACL'</span><span class="token punctuation">,</span>         <span class="token string">'BIND'</span><span class="token punctuation">,</span>       <span class="token string">'CHECKOUT'</span><span class="token punctuation">,</span>
  <span class="token string">'CONNECT'</span><span class="token punctuation">,</span>     <span class="token string">'COPY'</span><span class="token punctuation">,</span>       <span class="token string">'DELETE'</span><span class="token punctuation">,</span>
  <span class="token string">'GET'</span><span class="token punctuation">,</span>         <span class="token string">'HEAD'</span><span class="token punctuation">,</span>       <span class="token string">'LINK'</span><span class="token punctuation">,</span>
  <span class="token string">'LOCK'</span><span class="token punctuation">,</span>        <span class="token string">'M-SEARCH'</span><span class="token punctuation">,</span>   <span class="token string">'MERGE'</span><span class="token punctuation">,</span>
  <span class="token string">'MKACTIVITY'</span><span class="token punctuation">,</span>  <span class="token string">'MKCALENDAR'</span><span class="token punctuation">,</span> <span class="token string">'MKCOL'</span><span class="token punctuation">,</span>
  <span class="token string">'MOVE'</span><span class="token punctuation">,</span>        <span class="token string">'NOTIFY'</span><span class="token punctuation">,</span>     <span class="token string">'OPTIONS'</span><span class="token punctuation">,</span>
  <span class="token string">'PATCH'</span><span class="token punctuation">,</span>       <span class="token string">'POST'</span><span class="token punctuation">,</span>       <span class="token string">'PROPFIND'</span><span class="token punctuation">,</span>
  <span class="token string">'PROPPATCH'</span><span class="token punctuation">,</span>   <span class="token string">'PURGE'</span><span class="token punctuation">,</span>      <span class="token string">'PUT'</span><span class="token punctuation">,</span>
  <span class="token string">'REBIND'</span><span class="token punctuation">,</span>      <span class="token string">'REPORT'</span><span class="token punctuation">,</span>     <span class="token string">'SEARCH'</span><span class="token punctuation">,</span>
  <span class="token string">'SOURCE'</span><span class="token punctuation">,</span>      <span class="token string">'SUBSCRIBE'</span><span class="token punctuation">,</span>  <span class="token string">'TRACE'</span><span class="token punctuation">,</span>
  <span class="token string">'UNBIND'</span><span class="token punctuation">,</span>      <span class="token string">'UNLINK'</span><span class="token punctuation">,</span>     <span class="token string">'UNLOCK'</span><span class="token punctuation">,</span>
  <span class="token string">'UNSUBSCRIBE'</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token constant">STATUS_CODES</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">'100'</span><span class="token operator">:</span> <span class="token string">'Continue'</span><span class="token punctuation">,</span>
  <span class="token string">'101'</span><span class="token operator">:</span> <span class="token string">'Switching Protocols'</span><span class="token punctuation">,</span>
  <span class="token string">'102'</span><span class="token operator">:</span> <span class="token string">'Processing'</span><span class="token punctuation">,</span>
  <span class="token string">'103'</span><span class="token operator">:</span> <span class="token string">'Early Hints'</span><span class="token punctuation">,</span>
  <span class="token string">'200'</span><span class="token operator">:</span> <span class="token string">'OK'</span><span class="token punctuation">,</span>
  <span class="token string">'201'</span><span class="token operator">:</span> <span class="token string">'Created'</span><span class="token punctuation">,</span>
  <span class="token string">'202'</span><span class="token operator">:</span> <span class="token string">'Accepted'</span><span class="token punctuation">,</span>
  <span class="token string">'203'</span><span class="token operator">:</span> <span class="token string">'Non-Authoritative Information'</span><span class="token punctuation">,</span>
  <span class="token string">'204'</span><span class="token operator">:</span> <span class="token string">'No Content'</span><span class="token punctuation">,</span>
  <span class="token string">'205'</span><span class="token operator">:</span> <span class="token string">'Reset Content'</span><span class="token punctuation">,</span>
  <span class="token string">'206'</span><span class="token operator">:</span> <span class="token string">'Partial Content'</span><span class="token punctuation">,</span>
  <span class="token string">'207'</span><span class="token operator">:</span> <span class="token string">'Multi-Status'</span><span class="token punctuation">,</span>
  <span class="token string">'208'</span><span class="token operator">:</span> <span class="token string">'Already Reported'</span><span class="token punctuation">,</span>
  <span class="token string">'226'</span><span class="token operator">:</span> <span class="token string">'IM Used'</span><span class="token punctuation">,</span>
  <span class="token string">'300'</span><span class="token operator">:</span> <span class="token string">'Multiple Choices'</span><span class="token punctuation">,</span>
  <span class="token string">'301'</span><span class="token operator">:</span> <span class="token string">'Moved Permanently'</span><span class="token punctuation">,</span>
  <span class="token string">'302'</span><span class="token operator">:</span> <span class="token string">'Found'</span><span class="token punctuation">,</span>
  <span class="token string">'303'</span><span class="token operator">:</span> <span class="token string">'See Other'</span><span class="token punctuation">,</span>
  <span class="token string">'304'</span><span class="token operator">:</span> <span class="token string">'Not Modified'</span><span class="token punctuation">,</span>
  <span class="token string">'305'</span><span class="token operator">:</span> <span class="token string">'Use Proxy'</span><span class="token punctuation">,</span>
  <span class="token string">'307'</span><span class="token operator">:</span> <span class="token string">'Temporary Redirect'</span><span class="token punctuation">,</span>
  <span class="token string">'308'</span><span class="token operator">:</span> <span class="token string">'Permanent Redirect'</span><span class="token punctuation">,</span>
  <span class="token string">'400'</span><span class="token operator">:</span> <span class="token string">'Bad Request'</span><span class="token punctuation">,</span>
  <span class="token string">'401'</span><span class="token operator">:</span> <span class="token string">'Unauthorized'</span><span class="token punctuation">,</span>
  <span class="token string">'402'</span><span class="token operator">:</span> <span class="token string">'Payment Required'</span><span class="token punctuation">,</span>
  <span class="token string">'403'</span><span class="token operator">:</span> <span class="token string">'Forbidden'</span><span class="token punctuation">,</span>
  <span class="token string">'404'</span><span class="token operator">:</span> <span class="token string">'Not Found'</span><span class="token punctuation">,</span>
  <span class="token string">'405'</span><span class="token operator">:</span> <span class="token string">'Method Not Allowed'</span><span class="token punctuation">,</span>
  <span class="token string">'406'</span><span class="token operator">:</span> <span class="token string">'Not Acceptable'</span><span class="token punctuation">,</span>
  <span class="token string">'407'</span><span class="token operator">:</span> <span class="token string">'Proxy Authentication Required'</span><span class="token punctuation">,</span>
  <span class="token string">'408'</span><span class="token operator">:</span> <span class="token string">'Request Timeout'</span><span class="token punctuation">,</span>
  <span class="token string">'409'</span><span class="token operator">:</span> <span class="token string">'Conflict'</span><span class="token punctuation">,</span>
  <span class="token string">'410'</span><span class="token operator">:</span> <span class="token string">'Gone'</span><span class="token punctuation">,</span>
  <span class="token string">'411'</span><span class="token operator">:</span> <span class="token string">'Length Required'</span><span class="token punctuation">,</span>
  <span class="token string">'412'</span><span class="token operator">:</span> <span class="token string">'Precondition Failed'</span><span class="token punctuation">,</span>
  <span class="token string">'413'</span><span class="token operator">:</span> <span class="token string">'Payload Too Large'</span><span class="token punctuation">,</span>
  <span class="token string">'414'</span><span class="token operator">:</span> <span class="token string">'URI Too Long'</span><span class="token punctuation">,</span>
  <span class="token string">'415'</span><span class="token operator">:</span> <span class="token string">'Unsupported Media Type'</span><span class="token punctuation">,</span>
  <span class="token string">'416'</span><span class="token operator">:</span> <span class="token string">'Range Not Satisfiable'</span><span class="token punctuation">,</span>
  <span class="token string">'417'</span><span class="token operator">:</span> <span class="token string">'Expectation Failed'</span><span class="token punctuation">,</span>
  <span class="token string">'418'</span><span class="token operator">:</span> <span class="token string">&quot;I'm a Teapot&quot;</span><span class="token punctuation">,</span>
  <span class="token string">'421'</span><span class="token operator">:</span> <span class="token string">'Misdirected Request'</span><span class="token punctuation">,</span>
  <span class="token string">'422'</span><span class="token operator">:</span> <span class="token string">'Unprocessable Entity'</span><span class="token punctuation">,</span>
  <span class="token string">'423'</span><span class="token operator">:</span> <span class="token string">'Locked'</span><span class="token punctuation">,</span>
  <span class="token string">'424'</span><span class="token operator">:</span> <span class="token string">'Failed Dependency'</span><span class="token punctuation">,</span>
  <span class="token string">'425'</span><span class="token operator">:</span> <span class="token string">'Unordered Collection'</span><span class="token punctuation">,</span>
  <span class="token string">'426'</span><span class="token operator">:</span> <span class="token string">'Upgrade Required'</span><span class="token punctuation">,</span>
  <span class="token string">'428'</span><span class="token operator">:</span> <span class="token string">'Precondition Required'</span><span class="token punctuation">,</span>
  <span class="token string">'429'</span><span class="token operator">:</span> <span class="token string">'Too Many Requests'</span><span class="token punctuation">,</span>
  <span class="token string">'431'</span><span class="token operator">:</span> <span class="token string">'Request Header Fields Too Large'</span><span class="token punctuation">,</span>
  <span class="token string">'451'</span><span class="token operator">:</span> <span class="token string">'Unavailable For Legal Reasons'</span><span class="token punctuation">,</span>
  <span class="token string">'500'</span><span class="token operator">:</span> <span class="token string">'Internal Server Error'</span><span class="token punctuation">,</span>
  <span class="token string">'501'</span><span class="token operator">:</span> <span class="token string">'Not Implemented'</span><span class="token punctuation">,</span>
  <span class="token string">'502'</span><span class="token operator">:</span> <span class="token string">'Bad Gateway'</span><span class="token punctuation">,</span>
  <span class="token string">'503'</span><span class="token operator">:</span> <span class="token string">'Service Unavailable'</span><span class="token punctuation">,</span>
  <span class="token string">'504'</span><span class="token operator">:</span> <span class="token string">'Gateway Timeout'</span><span class="token punctuation">,</span>
  <span class="token string">'505'</span><span class="token operator">:</span> <span class="token string">'HTTP Version Not Supported'</span><span class="token punctuation">,</span>
  <span class="token string">'506'</span><span class="token operator">:</span> <span class="token string">'Variant Also Negotiates'</span><span class="token punctuation">,</span>
  <span class="token string">'507'</span><span class="token operator">:</span> <span class="token string">'Insufficient Storage'</span><span class="token punctuation">,</span>
  <span class="token string">'508'</span><span class="token operator">:</span> <span class="token string">'Loop Detected'</span><span class="token punctuation">,</span>
  <span class="token string">'509'</span><span class="token operator">:</span> <span class="token string">'Bandwidth Limit Exceeded'</span><span class="token punctuation">,</span>
  <span class="token string">'510'</span><span class="token operator">:</span> <span class="token string">'Not Extended'</span><span class="token punctuation">,</span>
  <span class="token string">'511'</span><span class="token operator">:</span> <span class="token string">'Network Authentication Required'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="https"><a href="#https" class="header-anchor">#</a> https</h2> <p>http 模块不支持发送 https 请求，不支持监听 https 服务。这就需要使用 https 模块了。</p> <p>发送 https 请求，和 http 模块基本一致，将 https 换成 http 即可，注意 options 里面的 port 默认为 443</p> <p>在创建 https 服务时，需要增加 SSL 证书相关文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'test/fixtures/keys/agent2-key.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  cert<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'test/fixtures/keys/agent2-cert.pem'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 或者</span>
<span class="token comment">// const options = {</span>
<span class="token comment">//   pfx: fs.readFileSync('test/fixtures/test_cert.pfx'),</span>
<span class="token comment">//   passphrase: '密码'</span>
<span class="token comment">// };</span>

https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'你好，世界\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="http2"><a href="#http2" class="header-anchor">#</a> http2</h2> <p>由于 HTTP/2 相比 HTTP 1.x 增加了很多特殊处理，需要使用专门的 http2 模块来处理。HTTP/2 必须是 https，不支持 http</p> <p>客户端发送 http 请求</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> http2<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'https://localhost:8443'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  ca<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'证书.pem'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> req <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">':path'</span><span class="token operator">:</span> <span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'response'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">headers<span class="token punctuation">,</span> flags</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">in</span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>headers<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

req<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建监听 http 服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http2<span class="token punctuation">.</span><span class="token function">createSecureServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  key<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'密钥.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  cert<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'证书.pem'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stream<span class="token punctuation">,</span> headers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 流是一个双工流。</span>
  stream<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">,</span>
    <span class="token string">':status'</span><span class="token operator">:</span> <span class="token number">200</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;你好世界&lt;/h1&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="querystring"><a href="#querystring" class="header-anchor">#</a> querystring</h2> <p>可以用于发送 <code>Content-Type</code> 为 <code>application/x-www-form-urlencoded</code> 时的数据处理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> baz<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'qux'</span><span class="token punctuation">,</span> <span class="token string">'quux'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corge<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回 'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge='</span>

querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> baz<span class="token operator">:</span> <span class="token string">'qux'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回 'foo:bar;baz:qux'</span>

querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'foo=bar&amp;abc=xyz&amp;abc=123'</span><span class="token punctuation">)</span> 
<span class="token comment">// {</span>
<span class="token comment">//   foo: 'bar',</span>
<span class="token comment">//   abc: ['xyz', '123']</span>
<span class="token comment">// }</span>
</code></pre></div><h2 id="dns"><a href="#dns" class="header-anchor">#</a> dns</h2> <h3 id="dns-lookup"><a href="#dns-lookup" class="header-anchor">#</a> dns.lookup()</h3> <p>DNS 查询，根据 hostname（主机名） 获取 IP 地址以及对应的版本。内部使用 getaddrinfo 系统调用，会读取 <code>/etc/hosts</code> 的配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dns.js</span>
<span class="token keyword">const</span> dns <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dns'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注意不能使用 http 等协议</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'www.zuo11.com'</span><span class="token punctuation">,</span>
  <span class="token string">'fe.zuo11.com'</span>
<span class="token punctuation">]</span>

arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">host</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// dns 查询，</span>
  dns<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> address<span class="token punctuation">,</span> family</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'host: %j \naddress: %j family: IPv%s'</span><span class="token punctuation">,</span> host<span class="token punctuation">,</span> address<span class="token punctuation">,</span> family<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// node dns.js</span>
<span class="token comment">// host: &quot;fe.zuo11.com&quot; </span>
<span class="token comment">// address: &quot;120.77.166.5&quot; family: IPv4</span>
<span class="token comment">// host: &quot;zuo11.com&quot; </span>
<span class="token comment">// address: &quot;47.107.190.93&quot; family: IPv4</span>
</code></pre></div><h3 id="dns-resolveany"><a href="#dns-resolveany" class="header-anchor">#</a> dns.resolveAny()</h3> <p>DNS 解析记录查询，比 dns.lookup() 查询的信息更详细，准确。忽略 <code>/etc/hosts</code> 的配置，始终通过网络执行 DNS 查询。可以根据 hostname 获取对应的解析类型、解析值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dns <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dns'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注意不能使用 http 等协议</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'www.zuo11.com'</span><span class="token punctuation">,</span>
  <span class="token string">'fe.zuo11.com'</span>
<span class="token punctuation">]</span>

arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">host</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dns<span class="token punctuation">.</span><span class="token function">resolveAny</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> ret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> ret<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// null [</span>
<span class="token comment">//   { value: 'fe-zuo11-com.oss-cn-shenzhen.aliyuncs.com', type: 'CNAME' }</span>
<span class="token comment">// ]</span>
<span class="token comment">// null [ { address: '47.107.190.93', ttl: 600, type: 'A' } ]</span>
</code></pre></div><p>除了 dns.resolveAny() 外，还有粒度更细的相关 API，参考 <a href="https://nodejs.org/dist/latest-v14.x/docs/api/dns.html#dns_dns_resolve_hostname_rrtype_callback" target="_blank" rel="noopener noreferrer">ns_dns_resolve_hostname<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><code>dns.resolveAny()</code> Uses the DNS protocol to resolve all records (also known as ANY or * query).</li> <li><code>dns.resolve4()</code> Uses the DNS protocol to resolve a IPv4 addresses (A records) for the hostname.</li> <li><code>dns.resolve6()</code> Uses the DNS protocol to resolve a IPv6 addresses (AAAA records) for the hostname.</li> <li><code>dns.resolveCname()</code> Uses the DNS protocol to resolve CNAME records for the hostname.</li> <li><code>dns.resolveNs()</code> Uses the DNS protocol to resolve name server records (NS records) for the hostname.</li> <li>...</li></ul> <h3 id="dns-reverse"><a href="#dns-reverse" class="header-anchor">#</a> dns.reverse()</h3> <p>反向 DNS 查询</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ipArr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'47.107.190.93'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

ipArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">ip</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 getHostByAddr 系统调用</span>
  <span class="token comment">// 执行一个反向 DNS 查询，将 IPv4 或 IPv6 地址解析为主机名数组。</span>
  dns<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> hostnames</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dns.reverse'</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> hostnames<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>一般服务供应商不允许反向 DNS 查询，会报错 <strong>Error: getHostByAddr ENOTFOUND 47.107.190.93</strong>，参考: <a href="https://stackoverflow.com/questions/48548085/firebase-reverse-dns-lookup-enotfound-error-node-js-dns" target="_blank" rel="noopener noreferrer">Firebase reverse dns lookup ENOTFOUND error node.js dns<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dns.reverse Error: getHostByAddr ENOTFOUND 47.107.190.93</span>
<span class="token comment">//     at QueryReqWrap.onresolve [as oncomplete] (dns.js:203:19) {</span>
<span class="token comment">//   errno: 'ENOTFOUND',</span>
<span class="token comment">//   code: 'ENOTFOUND',</span>
<span class="token comment">//   syscall: 'getHostByAddr',</span>
<span class="token comment">//   hostname: '47.107.190.93'</span>
<span class="token comment">// } undefined</span>

<span class="token comment">// don't allow reverse DNS lookups</span>
</code></pre></div><p>参考: <a href="https://nodejs.org/dist/latest-v14.x/docs/api/dns.html#dns_dns_lookup_hostname_options_callback" target="_blank" rel="noopener noreferrer">DNS | Node.js v14.15.4 Documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="dns-getservers"><a href="#dns-getservers" class="header-anchor">#</a> dns.getServers()</h3> <p>返回 IP 地址字符串的数组，该字符串根据 RFC 5952 进行了格式化，作为当前 DNS 解析。如果使用自定义端口，则字符串将包含端口部分。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dns.getServers()</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> dns<span class="token punctuation">.</span><span class="token function">getServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// dns.getServers() [ '192.168.31.1' ] 本地路由地址</span>
</code></pre></div><h3 id="dns-promise-形式接口"><a href="#dns-promise-形式接口" class="header-anchor">#</a> dns Promise 形式接口</h3> <p>使用 require('dns').promises 相当于之前的 dns，相关 API 都是 Promise 形式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dnsPromises <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dns'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises

dnsPromises<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">'fe.zuo11.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'address: %j family: IPv%s'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>address<span class="token punctuation">,</span> result<span class="token punctuation">.</span>family<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// address: &quot;120.77.166.5&quot; family: IPv4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dnsPromises<span class="token punctuation">.</span><span class="token function">resolveAny</span><span class="token punctuation">(</span><span class="token string">'fe.zuo11.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [</span>
<span class="token comment">//   { value: 'fe-zuo11-com.oss-cn-shenzhen.aliyuncs.com', type: 'CNAME' }</span>
<span class="token comment">// ]</span>

dnsPromises<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'120.77.166.5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// 错误</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Error: getHostByAddr ENOTFOUND 120.77.166.5</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/2/19 下午12:16:05</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/node/node-third-party.html">
        Node.js 第三方模块笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.222184eb.js" defer></script><script src="/assets/js/2.3f8a6b0b.js" defer></script><script src="/assets/js/128.aa7f5018.js" defer></script><script src="/assets/js/3.018b29e2.js" defer></script>
  </body>
</html>
