<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js基础 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="左小白的前端笔记，归纳整理自己在前端工作、学习中的一些心得笔记，有利于前端知识系统化。包括 Vue.js、前端工程化（TypeScript、Node.js、webpack）、Docker、JS/ES6、CSS/CSS3、HTML/HTML5、数据可视化、计算机基础、英语等笔记。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.594b47db.css" as="style"><link rel="preload" href="/assets/js/app.7f6157e7.js" as="script"><link rel="preload" href="/assets/js/2.4b3539f1.js" as="script"><link rel="preload" href="/assets/js/115.0eebc982.js" as="script"><link rel="preload" href="/assets/js/3.e6a4dd76.js" as="script"><link rel="prefetch" href="/assets/js/10.71696328.js"><link rel="prefetch" href="/assets/js/100.32c2f5a9.js"><link rel="prefetch" href="/assets/js/101.9cb07210.js"><link rel="prefetch" href="/assets/js/102.d290a906.js"><link rel="prefetch" href="/assets/js/103.1fb3a5bb.js"><link rel="prefetch" href="/assets/js/104.86beaffd.js"><link rel="prefetch" href="/assets/js/105.ccd09a6b.js"><link rel="prefetch" href="/assets/js/106.2ae5fe8b.js"><link rel="prefetch" href="/assets/js/107.f128dc01.js"><link rel="prefetch" href="/assets/js/108.3d265327.js"><link rel="prefetch" href="/assets/js/109.4942d39a.js"><link rel="prefetch" href="/assets/js/11.f94d3695.js"><link rel="prefetch" href="/assets/js/110.f445eb24.js"><link rel="prefetch" href="/assets/js/111.f71ddab4.js"><link rel="prefetch" href="/assets/js/112.7bd66bc0.js"><link rel="prefetch" href="/assets/js/113.7be6e797.js"><link rel="prefetch" href="/assets/js/114.75860268.js"><link rel="prefetch" href="/assets/js/116.a3180979.js"><link rel="prefetch" href="/assets/js/117.2064f6b2.js"><link rel="prefetch" href="/assets/js/118.09f18166.js"><link rel="prefetch" href="/assets/js/119.54e746dc.js"><link rel="prefetch" href="/assets/js/12.5065a0a0.js"><link rel="prefetch" href="/assets/js/120.3ebb524b.js"><link rel="prefetch" href="/assets/js/121.11cc2ebd.js"><link rel="prefetch" href="/assets/js/122.8c74b42f.js"><link rel="prefetch" href="/assets/js/123.7d264876.js"><link rel="prefetch" href="/assets/js/124.c5c6682f.js"><link rel="prefetch" href="/assets/js/125.dde73f7d.js"><link rel="prefetch" href="/assets/js/126.d641344d.js"><link rel="prefetch" href="/assets/js/127.315f3c34.js"><link rel="prefetch" href="/assets/js/128.68fe35f6.js"><link rel="prefetch" href="/assets/js/129.e3eeb791.js"><link rel="prefetch" href="/assets/js/13.a8b44eb9.js"><link rel="prefetch" href="/assets/js/130.80c9c616.js"><link rel="prefetch" href="/assets/js/131.e98fec29.js"><link rel="prefetch" href="/assets/js/132.2af68f32.js"><link rel="prefetch" href="/assets/js/133.9df301da.js"><link rel="prefetch" href="/assets/js/134.d9462e9c.js"><link rel="prefetch" href="/assets/js/135.0ec1048b.js"><link rel="prefetch" href="/assets/js/136.40404308.js"><link rel="prefetch" href="/assets/js/137.c76a57fc.js"><link rel="prefetch" href="/assets/js/138.e2b6fabb.js"><link rel="prefetch" href="/assets/js/139.a8ca01a4.js"><link rel="prefetch" href="/assets/js/14.8e644d14.js"><link rel="prefetch" href="/assets/js/140.a9dd6461.js"><link rel="prefetch" href="/assets/js/141.f172ed71.js"><link rel="prefetch" href="/assets/js/142.13510333.js"><link rel="prefetch" href="/assets/js/143.e4e19839.js"><link rel="prefetch" href="/assets/js/144.68a7699d.js"><link rel="prefetch" href="/assets/js/145.1f1f3717.js"><link rel="prefetch" href="/assets/js/146.e8b1eca4.js"><link rel="prefetch" href="/assets/js/147.26e26a50.js"><link rel="prefetch" href="/assets/js/148.b97c8e6e.js"><link rel="prefetch" href="/assets/js/149.09d4a2d6.js"><link rel="prefetch" href="/assets/js/15.1326e39c.js"><link rel="prefetch" href="/assets/js/150.658a8f48.js"><link rel="prefetch" href="/assets/js/151.1f6ef0d4.js"><link rel="prefetch" href="/assets/js/152.c7f6b031.js"><link rel="prefetch" href="/assets/js/153.8fc0a77c.js"><link rel="prefetch" href="/assets/js/154.66d523bd.js"><link rel="prefetch" href="/assets/js/155.d4d9d7ac.js"><link rel="prefetch" href="/assets/js/156.b3989277.js"><link rel="prefetch" href="/assets/js/16.510b9986.js"><link rel="prefetch" href="/assets/js/17.92df7b99.js"><link rel="prefetch" href="/assets/js/18.50bc4846.js"><link rel="prefetch" href="/assets/js/19.d1ecd44d.js"><link rel="prefetch" href="/assets/js/20.afec8f53.js"><link rel="prefetch" href="/assets/js/21.0f20cb10.js"><link rel="prefetch" href="/assets/js/22.f22473d2.js"><link rel="prefetch" href="/assets/js/23.e43cef6a.js"><link rel="prefetch" href="/assets/js/24.80be1122.js"><link rel="prefetch" href="/assets/js/25.aaa33b7b.js"><link rel="prefetch" href="/assets/js/26.457ebcaa.js"><link rel="prefetch" href="/assets/js/27.1963bdd9.js"><link rel="prefetch" href="/assets/js/28.fd255c8f.js"><link rel="prefetch" href="/assets/js/29.9be7c06f.js"><link rel="prefetch" href="/assets/js/30.ec48e840.js"><link rel="prefetch" href="/assets/js/31.6dcc588d.js"><link rel="prefetch" href="/assets/js/32.04333fd7.js"><link rel="prefetch" href="/assets/js/33.0ae0efe9.js"><link rel="prefetch" href="/assets/js/34.b4be6b86.js"><link rel="prefetch" href="/assets/js/35.64cf8684.js"><link rel="prefetch" href="/assets/js/36.6db6ff86.js"><link rel="prefetch" href="/assets/js/37.148032a4.js"><link rel="prefetch" href="/assets/js/38.58df30af.js"><link rel="prefetch" href="/assets/js/39.a470e9de.js"><link rel="prefetch" href="/assets/js/4.cc6d99c2.js"><link rel="prefetch" href="/assets/js/40.d4b18e0c.js"><link rel="prefetch" href="/assets/js/41.fece705d.js"><link rel="prefetch" href="/assets/js/42.980e0c55.js"><link rel="prefetch" href="/assets/js/43.50c464bf.js"><link rel="prefetch" href="/assets/js/44.f8fdf57f.js"><link rel="prefetch" href="/assets/js/45.e4246fe5.js"><link rel="prefetch" href="/assets/js/46.1bdaaffd.js"><link rel="prefetch" href="/assets/js/47.1ee76e81.js"><link rel="prefetch" href="/assets/js/48.fa598109.js"><link rel="prefetch" href="/assets/js/49.6f378f1c.js"><link rel="prefetch" href="/assets/js/5.5b94bff7.js"><link rel="prefetch" href="/assets/js/50.858b6cba.js"><link rel="prefetch" href="/assets/js/51.fa997ae9.js"><link rel="prefetch" href="/assets/js/52.d75d437b.js"><link rel="prefetch" href="/assets/js/53.50e1d46d.js"><link rel="prefetch" href="/assets/js/54.9d20b6a7.js"><link rel="prefetch" href="/assets/js/55.dd4a74cf.js"><link rel="prefetch" href="/assets/js/56.0c442daa.js"><link rel="prefetch" href="/assets/js/57.0af80735.js"><link rel="prefetch" href="/assets/js/58.0257c4ad.js"><link rel="prefetch" href="/assets/js/59.22e80b2d.js"><link rel="prefetch" href="/assets/js/6.481b22df.js"><link rel="prefetch" href="/assets/js/60.e88ec729.js"><link rel="prefetch" href="/assets/js/61.9a499194.js"><link rel="prefetch" href="/assets/js/62.7acf3ad8.js"><link rel="prefetch" href="/assets/js/63.98f2d0e9.js"><link rel="prefetch" href="/assets/js/64.cfbf411f.js"><link rel="prefetch" href="/assets/js/65.75353cfc.js"><link rel="prefetch" href="/assets/js/66.f6583bc6.js"><link rel="prefetch" href="/assets/js/67.3aed5f18.js"><link rel="prefetch" href="/assets/js/68.583d7440.js"><link rel="prefetch" href="/assets/js/69.0c09bba0.js"><link rel="prefetch" href="/assets/js/7.cb937ed7.js"><link rel="prefetch" href="/assets/js/70.4b79405e.js"><link rel="prefetch" href="/assets/js/71.e376b330.js"><link rel="prefetch" href="/assets/js/72.dcb8ba9a.js"><link rel="prefetch" href="/assets/js/73.84e08324.js"><link rel="prefetch" href="/assets/js/74.b7bb7206.js"><link rel="prefetch" href="/assets/js/75.5d2d6c3a.js"><link rel="prefetch" href="/assets/js/76.f6fcd0bb.js"><link rel="prefetch" href="/assets/js/77.dd0cb5e9.js"><link rel="prefetch" href="/assets/js/78.4a2e798e.js"><link rel="prefetch" href="/assets/js/79.f600e5e5.js"><link rel="prefetch" href="/assets/js/8.9b412011.js"><link rel="prefetch" href="/assets/js/80.41023da8.js"><link rel="prefetch" href="/assets/js/81.f10e2b89.js"><link rel="prefetch" href="/assets/js/82.b47a3c0e.js"><link rel="prefetch" href="/assets/js/83.20db14ac.js"><link rel="prefetch" href="/assets/js/84.c501b672.js"><link rel="prefetch" href="/assets/js/85.b82824b9.js"><link rel="prefetch" href="/assets/js/86.fe5d6f98.js"><link rel="prefetch" href="/assets/js/87.49ac0aa5.js"><link rel="prefetch" href="/assets/js/88.2a890ce0.js"><link rel="prefetch" href="/assets/js/89.2fa83aed.js"><link rel="prefetch" href="/assets/js/9.b551853b.js"><link rel="prefetch" href="/assets/js/90.bc412f4d.js"><link rel="prefetch" href="/assets/js/91.6f67a16c.js"><link rel="prefetch" href="/assets/js/92.65d10705.js"><link rel="prefetch" href="/assets/js/93.7dc85bff.js"><link rel="prefetch" href="/assets/js/94.b89692e0.js"><link rel="prefetch" href="/assets/js/95.bedc733f.js"><link rel="prefetch" href="/assets/js/96.f074aeef.js"><link rel="prefetch" href="/assets/js/97.4e3cf611.js"><link rel="prefetch" href="/assets/js/98.3c645f95.js"><link rel="prefetch" href="/assets/js/99.264e633c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.594b47db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node.js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Node.js 笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/base/1.html" aria-current="page" class="active sidebar-link">Node.js基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/base/1.html#node-js-是什么" class="sidebar-link">Node.js 是什么</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#node-js历史-为性能而生" class="sidebar-link">Node.js历史 - 为性能而生</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#node-js依赖-dependencied" class="sidebar-link">Node.js依赖(Dependencied)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/base/1.html#libraries" class="sidebar-link">Libraries</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#tools" class="sidebar-link">Tools</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/base/1.html#node-js特性-js特性" class="sidebar-link">Node.js特性(JS特性)</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#并发处理" class="sidebar-link">并发处理</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#与前端的不同" class="sidebar-link">与前端的不同</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#node-api" class="sidebar-link">Node API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/base/1.html#第一个node程序" class="sidebar-link">第一个node程序</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#常用模块" class="sidebar-link">常用模块</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#异步流程控制" class="sidebar-link">异步流程控制</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#使用内置模块util的promisify" class="sidebar-link">使用内置模块util的promisify</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#fs模块" class="sidebar-link">fs模块</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#buffer对象" class="sidebar-link">Buffer对象</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#http模块" class="sidebar-link">http模块</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#stream-流" class="sidebar-link">stream 流</a></li><li class="sidebar-sub-header"><a href="/node/base/1.html#工具链" class="sidebar-link">工具链</a></li></ul></li></ul></li><li><a href="/node/base/2.html" class="sidebar-link">Koa</a></li><li><a href="/node/base/3.html" class="sidebar-link">网络编程</a></li><li><a href="/node/base/4.html" class="sidebar-link">数据持久化mysql</a></li><li><a href="/node/base/5.html" class="sidebar-link">数据持久化mongodb</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js基础"><a href="#node-js基础" class="header-anchor">#</a> Node.js基础</h1> <blockquote><p>官网：https://nodejs.org/en/</p></blockquote> <blockquote><p>官方文档：https://nodejs.org/en/docs/guides/</p></blockquote> <h2 id="node-js-是什么"><a href="#node-js-是什么" class="header-anchor">#</a> Node.js 是什么</h2> <ul><li>Node.js is a JS runtime built on Chrome's V8 JS engine (Node.js是一个基于Chrome V8引擎的JS运行时)</li> <li>Node.js是一个异步的事件驱动的JS运行时</li></ul> <p>什么叫运行时，用类比的方法学习这个概念，一般语言都会提供一个运行时环境，<strong>Node.js其实就是提供js运行时的环境</strong>。</p> <ul><li>JRE java运行时环境</li> <li>C Runtime</li> <li>.NET Common Language Runtime</li></ul> <p>runtime(运行时)指的是程序运行的时候，即指令加载到内存并由CPU执行的时候。运行时库就是程序运行的时候所依赖的库。</p> <p>JS是解释型语言，还有一些语言执行之前是要编译的，比如C，Java等</p> <p>C代码编译成可执行文件的时候，指令没有被CPU执行，这个时候算是编译时，也就是编译的时候。</p> <h2 id="node-js历史-为性能而生"><a href="#node-js历史-为性能而生" class="header-anchor">#</a> Node.js历史 - 为性能而生</h2> <p>Ryan Dahl /'raiən da:l/ 是nodejs的作者，他的工作是用C/C++写高性能web服务，对于高性能，异步IO、事件驱动是基本原则，但用C/C++写就太痛苦了。于是他设想使用另一种高级语言开发Web服务，评估了很多语言，发现很多语言虽然同是提供了异步IO和同步IO，但开发人员一旦使用了同步IO，他们就再也懒得写异步IO了，所以最终Ryan选择了JS。</p> <p><strong>因为JS是单线程执行，根本不能进行同步IO操作，所以JS的这一&quot;缺陷&quot;导致了它只能使用异步IO。</strong></p> <p>选定开发语言后，还要有运行时引擎。Ryan曾考虑自己写一个，不过明智的放弃了，因为V8就是开源的JS引擎，让Google投资去优化V8，而他只拿来用，还不用付钱。于是2009年，Ryan正式推出了基于JS和V8引擎的开源Web服务项目，命名为Node。Node第一次把JS带入到后端服务器开发，加上JS开发人员众多，Node一下子就火了起来。</p> <h2 id="node-js依赖-dependencied"><a href="#node-js依赖-dependencied" class="header-anchor">#</a> Node.js依赖(Dependencied)</h2> <blockquote><p>https://nodejs.org/en/docs/meta/topics/dependencies/</p></blockquote> <p>Node.js功能依赖一些库和工具:</p> <h3 id="libraries"><a href="#libraries" class="header-anchor">#</a> Libraries</h3> <ul><li><a href="https://v8docs.nodesource.com/" target="_blank" rel="noopener noreferrer">V8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 由google维护的JS运行时引擎。V8为Node.js提供了JS引擎，Node.js通过V8 C++ API对其进行控制。</li> <li><a href="https://libuv.org/" target="_blank" rel="noopener noreferrer">libuv<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 另一个重要的依赖是libuv, 它一个C语言库，用于将非阻塞(异步)IO操作封装为受支持平台之间一致的接口。他提供了处理file system、DNS、netwrok、child process(子进程)，pipes(管道)，信号处理(signal handling)，polling(轮询) and streaming(流传输)的机制. 它还包括了一个线程池(thread pool)，用于分担某些无法在操作系统级别异步完成的工作。</li></ul> <blockquote><p>libuv is a multi-platform support library with a focus on asynchronous I/O. It was primarily developed for use by Node.js</p></blockquote> <ul><li><a href="https://github.com/nodejs/llhttp" target="_blank" rel="noopener noreferrer">llhttp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Node.js HTTP parsing(解析)是通过llhttp来处理，一个轻量级的TypeScript和C库。他的设计宗旨是不进行任何系统调用(syscalls)或分配(allocations)，因此每个请求的内存占用非常小。
<ul><li>Node.js v12中内核的HTTP Parser默认使用了llhttp，取代了老旧的http-parser，性能提升了156%，参考: <a href="https://zhuanlan.zhihu.com/p/100660049" target="_blank" rel="noopener noreferrer">llhttp是如何使Node.js性能翻倍的？ - 知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>http-parser参考：https://github.com/nodejs/http-parser</li></ul></li> <li><a href="https://c-ares.haxx.se/docs.html" target="_blank" rel="noopener noreferrer">c-ares<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对于某些异步DNS请求，Node.js使用了c-ares来处理。它是一个C库，It is exposed through the DNS module in JavaScript as the resolve() family of functions.</li> <li><a href="https://www.openssl.org/docs/" target="_blank" rel="noopener noreferrer">OpenSSL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <strong>tls</strong>和<strong>crypto</strong>模块中都广泛使用了OpenSSL，它提供了许多经过考验的加密功能实现，web依赖这些功能来保证安全性</li> <li><a href="https://www.zlib.net/manual.html" target="_blank" rel="noopener noreferrer">zlib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 为了进行快速压缩何解压缩，Node.js依赖于行业标准的zlib库，该库因在gzip何libpng中的使用而闻名。Node.js使用zlib创建同步、异步及流式压缩何解压缩接口。</li></ul> <h3 id="tools"><a href="#tools" class="header-anchor">#</a> Tools</h3> <ul><li>npm node package manager, 是Node.js的模块管理器，Node.js is all about modularity，and with that comes the need for a quality package manager; for this purpose, npm was made. With npm comes the largest selection of community-created packages of any programming ecosystem, which makes building Node.js app quick and easy.</li> <li>gyp build系统由gyp处理，它是从V8复制的基于python的项目生成器。可以生成用于跨多个平台的构建系统的项目文件。Node.js需要构建系统，因为它的大部分(及其依赖项)使用需要编译的语言写的。</li> <li>gtest 可以使用来自Chromium的gtest测试native code，It allows testing C/C++ without needing an existing node executable to bootstrap from.</li></ul> <h2 id="node-js特性-js特性"><a href="#node-js特性-js特性" class="header-anchor">#</a> Node.js特性(JS特性)</h2> <ul><li><a href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/" target="_blank" rel="noopener noreferrer">非阻塞I/O<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/" target="_blank" rel="noopener noreferrer">事件驱动<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="并发处理"><a href="#并发处理" class="header-anchor">#</a> 并发处理</h2> <ul><li>多进程 LinuxC、Apache</li> <li>多线程 Java</li> <li>异步I/O JS 事件回调方式</li> <li>协程 - lua openresty、go、deno、TypeScript</li></ul> <p>ry(Ryan Dahl) 也就是node的作者, 2018年开启了一个新项目<a href="https://deno.land/" target="_blank" rel="noopener noreferrer">deno<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, A secure JavaScript/TypeScript runtime built with V8, Rust, and Tokio , TypeScript还是非学不可的。</p> <ul><li>justjavac对deno的分析介绍，参考 <a href="https://studygolang.com/articles/13101" target="_blank" rel="noopener noreferrer">Deno 并不是下一代 Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.oschina.net/news/96767/design-mistakes-in-node?origin=wxdw" target="_blank" rel="noopener noreferrer">Ryan Dahl：Node 设计失误值得反思，Deno 将汲取经验<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="与前端的不同"><a href="#与前端的不同" class="header-anchor">#</a> 与前端的不同</h2> <ul><li>JS核心语法不变</li> <li>前端：BOM DOM</li> <li>后端：fs、http、buffer(缓冲区，二进制内容)、event、os</li></ul> <h2 id="node-api"><a href="#node-api" class="header-anchor">#</a> Node API</h2> <h3 id="第一个node程序"><a href="#第一个node程序" class="header-anchor">#</a> 第一个node程序</h3> <p>新建一个0_run.js文件，打印hello world，然后在终端(Terminal)用node命令执行：node 0_run.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 0_run.js, node 0_run.js终端会打印hello world</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="nodemon"><a href="#nodemon" class="header-anchor">#</a> nodemon</h4> <p>上面的例子中，每次修改0_run.js后，想再次运行都需要再次执行node 0_run.js，调试时非常麻烦，这就需要用到nodemon了。</p> <blockquote><p><a href="https://github.com/remy/nodemon" target="_blank" rel="noopener noreferrer">nodemon<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 监听node.js应用的所有改动，当改动发生时，自动重启服务（Monitor for any changes in your node.js application and automatically restart the server - perfect for development）</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 全局安装 nodemon 命令</span>
<span class="token function">npm</span> <span class="token function">install</span> -g nodemon 

<span class="token comment"># 执行，当0_run.js里的文件有更改时，会自动重启执行新的文件</span>
nodemon 0_run.js
</code></pre></div><p><img src="/images/node/1_0_nodemon.png" alt="1_0_nodemon.png"></p> <h3 id="常用模块"><a href="#常用模块" class="header-anchor">#</a> 常用模块</h3> <h4 id="核心模块-require都不需要就能直接使用"><a href="#核心模块-require都不需要就能直接使用" class="header-anchor">#</a> 核心模块(require都不需要就能直接使用)</h4> <ul><li>global</li> <li><a href="http://nodejs.cn/api/buffer.html" target="_blank" rel="noopener noreferrer">buffer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 用于处理二进制数据流
<ul><li>alloc</li> <li>from</li> <li>write</li> <li>concat</li> <li>toString</li></ul></li> <li>process</li> <li>module 模块操作CommonJS规范，require与module.exports</li></ul> <h4 id="内置模块-不需要npm-install安装-直接require就能使用"><a href="#内置模块-不需要npm-install安装-直接require就能使用" class="header-anchor">#</a> 内置模块(不需要npm install安装,直接require就能使用)</h4> <ul><li>os</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// http://nodejs.cn/api/os.html#os_os_freemem</span>
<span class="token comment">// os.freemem() 方法以整数的形式回空闲系统内存的字节数(B)。</span>
<span class="token comment">// os.totalmem() 方法以整数的形式返回所有系统内存的字节数(B)。</span>
<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'闲置内存:'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'M'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'总内存:'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'M'</span> <span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Darwin </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 18.7.0  操作系统发行版本</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">hostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// kevindeMacBook-Air.local</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">homedir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// /Users/kevin</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 打印cpu内核信息，包括cpu具体型号</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 当前用户信息</span>
</code></pre></div><ul><li>fs</li> <li>path</li> <li>http</li> <li>event</li> <li>util</li></ul> <h4 id="第三方模块-需要npm-install安装-需要require"><a href="#第三方模块-需要npm-install安装-需要require" class="header-anchor">#</a> 第三方模块(需要npm install安装，需要require)</h4> <ul><li><a href="https://www.npmjs.com/package/download-git-repo" target="_blank" rel="noopener noreferrer">download-git-repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，Download and extract a git repository (GitHub, GitLab, Bitbucket) from node.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 先安装 npm install download-git-repo --save</span>
<span class="token comment">// 如果没有package.json 需要先npm init</span>

<span class="token comment">/**
 * @description Download a git repository to a destination folder with options, and callback.
 * @params { String } repository 
 * - Github: github:owner/name  或者简写 owner/name
 * - GitLab: gitlab:owner/name
 * - Bitbucket : bitbucket:owner/name
 * - 默认为主分支(master)，指定分支 owner/name#my-branch
 * @params { String } distination 下载repository后，存放的路径
 * @options { Object } 可选的选项对象，download时的选项
 * - { clone: false } 如果clone为true，将用git clone 代替http download
 * = proxy, headers, filter 等
 * @params { Function } callback 执行完成后的回调函数 function(err)
 */</span>
<span class="token function">download</span><span class="token punctuation">(</span>repository<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token comment">// 实例：将github用户zuoxiaobai的todo项目，下载到test目录(可以是不存在的，会自动创建)下, 如果成功，打印OK，否则打印错误</span>
<span class="token comment">// 使用第三方模块 download-git-repo</span>
<span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span>
<span class="token function">download</span><span class="token punctuation">(</span><span class="token string">'github:zuoxiaobai/todo'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err <span class="token operator">?</span> err <span class="token operator">:</span> <span class="token string">'OK'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><ul><li><a href="https://www.npmjs.com/package/ora" target="_blank" rel="noopener noreferrer">ora<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Elegant terminal spinner 优雅的终端提示工具</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 上面的例子中，下载过程没有提示，可以使用ora这个模块，来加入提示信息</span>
<span class="token comment">// 先来看看ora的demo 03—_ora.js</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'Loading unicorns'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    spinner<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
    spinner<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'Loading rainbows'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  spinner<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'这是一个警告....'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  spinner<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'这是一个错误....'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  spinner<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'加载成功!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/images/node/1_1_ora%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95.gif" alt="1_1_ora基础用法.gif"></p> <p>优化后的下载代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 优化，加入下载过程中的提示</span>
<span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> repo <span class="token operator">=</span> <span class="token string">'github:zuoxiaobai/todo'</span>
<span class="token keyword">const</span> dest <span class="token operator">=</span> <span class="token string">'test'</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span> 

<span class="token keyword">const</span> process <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">正在下载 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>repo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 目录...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">download</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err <span class="token operator">?</span> err <span class="token operator">:</span> <span class="token string">'OK'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'下载成功'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/images/node/1_2_%E4%B8%8B%E8%BD%BD%E8%BF%87%E7%A8%8B%E5%8A%A0%E5%85%A5ora%E6%8F%90%E7%A4%BA.gif" alt="1_2_下载过程加入ora提示"></p> <h3 id="异步流程控制"><a href="#异步流程控制" class="header-anchor">#</a> 异步流程控制</h3> <ul><li>callback</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">taskone</span><span class="token punctuation">(</span><span class="token string">'任务1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 任务1的回调</span>
  <span class="token function">tasktwo</span><span class="token punctuation">(</span><span class="token string">'任务2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 任务2的回调</span>
    <span class="token function">taskThree</span><span class="token punctuation">(</span><span class="token string">'任务3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 任务3的回调</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'task 3 callback'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如何让异步任务串行化</p> <ul><li>promise then 承诺执行</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promise</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异步任务'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'异步任务1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'异步任务2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'异步任务3'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>ES6 generator</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Generator 和 yield 、 iterator</span>
<span class="token keyword">const</span> <span class="token function-variable function">generator</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">promise</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">promise</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> gen <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token string">'Generator'</span><span class="token punctuation">)</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 用next() 手动执行</span>
</code></pre></div><ul><li>自己实现一个co库</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用co模块，自动执行generator</span>
<span class="token keyword">let</span> <span class="token function-variable function">co</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">gen<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ret <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ret<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">co</span><span class="token punctuation">(</span>generator<span class="token punctuation">,</span> <span class="token string">'CO'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>ES7 async/await</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'异步任务1'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">'异步任务2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用内置模块util的promisify"><a href="#使用内置模块util的promisify" class="header-anchor">#</a> 使用内置模块util的promisify</h3> <p>util.promisify是在node.js 8.x版本中新增的一个工具，用于将老式的Error first callback转换为Promise对象，让老项目改造变得更为轻松。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// promisify 将函数转换为promise</span>
<span class="token comment">// const { promisify } = require('util');</span>

<span class="token comment">// 再次优化 内置util模块promisify</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadRepo</span><span class="token punctuation">(</span><span class="token parameter">repo<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> process <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">正在下载 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>repo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 目录...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">download</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> dest<span class="token punctuation">)</span> <span class="token comment">// 下载</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  process<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'下载成功!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> repo <span class="token operator">=</span> <span class="token string">'github:zuoxiaobai/todo'</span>
<span class="token keyword">const</span> dest <span class="token operator">=</span> <span class="token string">'test'</span>
<span class="token function">downloadRepo</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> dest<span class="token punctuation">)</span>
</code></pre></div><p>将download的代码封装为模块，再使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 04_download.js</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">downloadRepo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">repo<span class="token punctuation">,</span> dest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> process <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">正在下载 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>repo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 到 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 目录...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">download</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> dest<span class="token punctuation">)</span> <span class="token comment">// 下载</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  process<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'下载成功!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 02_useModule.js</span>
<span class="token comment">// 封装为模块后，再次调用</span>
<span class="token keyword">const</span> repo <span class="token operator">=</span> <span class="token string">'github:zuoxiaobai/todo'</span>
<span class="token keyword">const</span> dest <span class="token operator">=</span> <span class="token string">'test'</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> downloadRepo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./04_download'</span><span class="token punctuation">)</span>

<span class="token function">downloadRepo</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> dest<span class="token punctuation">)</span>
</code></pre></div><h3 id="fs模块"><a href="#fs模块" class="header-anchor">#</a> fs模块</h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 同步调用</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./04_download.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token comment">// data内容打印如下，为Buffer对象，读取的是二进制数据</span>
<span class="token comment">// &lt;Buffer 0a 6d 6f 64 75 6c 65 2e 65 78 70 6f 72 74 73 2e 64 6f 77 6e 6c 6f </span>
<span class="token comment">// 61 64 52 65 70 6f 20 3d 20 61 73 79 6e 63 20 66 75 </span>
<span class="token comment">// 6e 63 74 69 6f 6e 20 28 72 65 70 ... &gt;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 将Buffer转换为字符串</span>
<span class="token comment">// 打印内容如下:</span>
<span class="token comment">// </span>
<span class="token comment">// module.exports.downloadRepo = async function (repo, dest) {</span>
<span class="token comment">//   const { promisify } = require('util')</span>
<span class="token comment">//   const download = promisify(require('download-git-repo'))</span>
<span class="token comment">//   const ora = require('ora')</span>
<span class="token comment">//   const process = ora(`正在下载 ${repo} 到 ${dest} 目录...`).start()</span>

<span class="token comment">//   try {</span>
<span class="token comment">//     await download(repo, dest) // 下载</span>
<span class="token comment">//   } catch(e) {</span>
<span class="token comment">//     process.fail('失败')</span>
<span class="token comment">//   }</span>

<span class="token comment">//   process.succeed('下载成功!')</span>
<span class="token comment">// }</span>


<span class="token comment">// 2. 异步调用</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./04_download.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 3. promisify处理异步调用</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">consoleFileData</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> readFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">consoleFileData</span><span class="token punctuation">(</span><span class="token string">'./04_download.js'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="buffer对象"><a href="#buffer对象" class="header-anchor">#</a> Buffer对象</h3> <p>操作二进制值，需要使用Buffer</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 分配一个10字节空间</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">)</span>
<span class="token comment">// 10个字节</span>
<span class="token comment">// &lt;Buffer 00 00 00 00 00 00 00 00 00 00&gt;   // 用16进制，表示二进制数</span>
<span class="token comment">// 00   16进制数，代表一个字节</span>

<span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment">// 将字母a，转换为二进制数据</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf2<span class="token punctuation">,</span> buf2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &lt;Buffer 61&gt; 'a'</span>

<span class="token keyword">const</span> buf3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf3<span class="token punctuation">)</span> <span class="token comment">// &lt;Buffer e4 b8 ad e6 96 87&gt;</span>

<span class="token comment">// 拼接两个buffer</span>
<span class="token keyword">const</span> buf4 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>buf2<span class="token punctuation">,</span> buf3<span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf4<span class="token punctuation">,</span> buf4<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &lt;Buffer 61 e4 b8 ad e6 96 87&gt; 'a中文'</span>
</code></pre></div><h3 id="http模块"><a href="#http模块" class="header-anchor">#</a> http模块</h3> <h4 id="开启一个http服务"><a href="#开启一个http服务" class="header-anchor">#</a> 开启一个http服务</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 07_http.js</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello....'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3003</span><span class="token punctuation">)</span>
<span class="token comment">// node 07_http.js 然后打开浏览器，访问127.0.0.1:3003 即可看到hello...</span>
</code></pre></div><p><img src="/images/node/1_3_http.png" alt="1_3_http.png"></p> <h4 id="渲染静态页面或json数据"><a href="#渲染静态页面或json数据" class="header-anchor">#</a> 渲染静态页面或json数据</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 利用fs，渲染静态html、JSON字符串返回</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> req
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'url, method: '</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> method<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/users'</span> <span class="token operator">&amp;&amp;</span> method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'guoqzuo'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3003</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="stream-流"><a href="#stream-流" class="header-anchor">#</a> stream 流</h3> <p>现有图片img.png，复制一份该图片，使用流</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 复制一个图片，就需要使用stream 流了。</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./img.png'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./img2.png'</span><span class="token punctuation">)</span>
rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
</code></pre></div><p><img src="/images/node/1_4_stream.png" alt="1_4_stream.png"></p> <p>使用流</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 07_http.js代码片段</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> method<span class="token punctuation">,</span>headers <span class="token punctuation">}</span> <span class="token operator">=</span> req
<span class="token comment">// ...</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'GET'</span> <span class="token operator">&amp;&amp;</span> headers<span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'image/*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用流</span>
  <span class="token comment">// 如果index.html有img，或是请求 /favicon.ico 时，可以正常加载图片</span>
  fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><h3 id="工具链"><a href="#工具链" class="header-anchor">#</a> 工具链</h3> <p>写一个npm包zuo-util</p> <h4 id="创建一个目录"><a href="#创建一个目录" class="header-anchor">#</a> 创建一个目录</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> zuo-util
<span class="token builtin class-name">cd</span> zuo-util
<span class="token function">npm</span> init <span class="token comment"># 生成package.json</span>
</code></pre></div><h4 id="创建可执行的命令"><a href="#创建可执行的命令" class="header-anchor">#</a> 创建可执行的命令</h4> <h5 id="什么是可执行的命令"><a href="#什么是可执行的命令" class="header-anchor">#</a> 什么是可执行的命令?</h5> <p>以vue这个命令为例，对于新手来说会很困惑。vue命令并不是vue的命令。而是vue-cli这个node包全局安装时注入的。当运行 <strong>npm install -g vue-cli</strong> 时，会全局安装vue-cli，然后在terminal终端就可以直接运行vue命令。而是vue -V 显示vue-cli版本是3.5.5，而不是vue的版本，毕竟现在vue还没有3.0的版本</p> <h5 id="为zuo-util-创建一个可执行命令zuo"><a href="#为zuo-util-创建一个可执行命令zuo" class="header-anchor">#</a> 为zuo-util 创建一个可执行命令zuo</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> bin<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> bin<span class="token punctuation">;</span> 
<span class="token function">touch</span> zuo   // 在bin目录下创建文件zuo，注意不要加后缀
</code></pre></div><p>在zuo这个文件里，写入下面的内容, 最开始的一行是文件头，表示这是一个node程序，用node写的shell。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env node</span>
console.log<span class="token punctuation">(</span><span class="token string">'this is zuo util'</span><span class="token punctuation">)</span>
</code></pre></div><p>然后在package.json里加入下面的代码，指定命令的目录</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;zuo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/zuo&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h5 id="运行命令-zuo"><a href="#运行命令-zuo" class="header-anchor">#</a> 运行命令 zuo</h5> <p>如果想要命令全局运行，需要在zuo-util目录下执行npm link命令，这样就可以在终端运行zuo这个命令了</p> <p><img src="/images/node/1_5_npm_link%E8%AE%A9%E5%91%BD%E4%BB%A4%E5%8F%AF%E4%BB%A5%E5%85%A8%E5%B1%80%E8%BF%90%E8%A1%8C.png" alt="1_5_npm_link让命令可以全局运行.png"></p> <h4 id="使用commander模块显示帮助文档"><a href="#使用commander模块显示帮助文档" class="header-anchor">#</a> 使用commander模块显示帮助文档</h4> <p>commander模块是一个命令行工具，一般用于terminal提示，命令解析</p> <p>修改 /bin/zuo内容如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>

program<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init &lt;name&gt;'</span><span class="token punctuation">,</span> <span class="token string">'init project'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">,</span><span class="token string">'show os cpu info'</span><span class="token punctuation">)</span>
    
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面使用commander模块，初始化了一个提示，当直接执行zuo命令，会显示帮助信息，version指定zuo -V后打印额值，command显示具体的命令及说明。zuo init 会执行/bin/zuo-init，zuo cpu 会执行 /bin/zuo-cpu</p> <p><img src="/images/node/1_6_commander%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8.png" alt="1_6_commander模块使用.png"></p> <p>如果直接执行zuo cpu 会提示文件没有可执行权限</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kevindeMacBook-Air:zuo-util kevin$ zuo cpu
error: /Users/kevin/Desktop/zuo-util/bin/zuo-cpu<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> not executable. try <span class="token function">chmod</span> or run with root

<span class="token comment"># 需要在terminal 里处理下权限，方法文档 man chmod</span>
<span class="token function">chmod</span> +x bin/*   <span class="token comment"># 将bin文件下的所有文件添加可执行权限</span>
</code></pre></div><p>上面说了zuo init会执行/bin/zuo-init方法，为什么？我们来看看progress.argv，下面是/bin/zuo-init的代码，跑起来看看process.argv到底是什么</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'zuo init'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
</code></pre></div><p><img src="/images/node/1_7_process_argv.png" alt="1_7_process_argv.png"></p> <p>所有可以理解为zuo init test，实际执行的是</p> <div class="language-shell extra-class"><pre class="language-shell"><code>/usr/local/bin/node  /Users/kevin/Desktop/zuo-util/bin/zuo-init  <span class="token builtin class-name">test</span>
<span class="token comment"># 相当于 node  zuo-init test</span>
</code></pre></div><h4 id="初步实现两个命令"><a href="#初步实现两个命令" class="header-anchor">#</a> 初步实现两个命令</h4> <p>这里实现zuo init 和 zuo cpu两个命令</p> <p>/bin/zuo-cpu</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> cpuInfoArr <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CPU INFO: '</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' - Count: '</span> <span class="token operator">+</span> cpuInfoArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' - Model: '</span> <span class="token operator">+</span> cpuInfoArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' - Speed: '</span> <span class="token operator">+</span> cpuInfoArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>speed<span class="token punctuation">)</span>

</code></pre></div><p>/bin/zuo-init</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'zuo init'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Arguments error, Please use like: zuo init &lt;name&gt;'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'TODO Init project '</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="上传npm"><a href="#上传npm" class="header-anchor">#</a> 上传npm</h4> <p>在 zuo-util目录创建publish.sh脚本文件，为该文件添加可执行权限 chmod +x publish.sh;  执行 ./publish.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token function">npm</span> config get registry <span class="token comment"># 检查仓库镜像库</span>
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span>http://registry.npmjs.org
<span class="token builtin class-name">echo</span> <span class="token string">'请进行登录相关操作：'</span>
<span class="token function">npm</span> login <span class="token comment"># 登陆</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------publishing-------&quot;</span>
<span class="token function">npm</span> publish <span class="token comment"># 发布</span>
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> <span class="token assign-left variable">registry</span><span class="token operator">=</span>https://registry.npm.taobao.org <span class="token comment"># 设置为淘宝镜像</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;发布完成&quot;</span>
<span class="token builtin class-name">exit</span>
</code></pre></div><p><img src="/images/node/1_8_publish_npm%E5%8C%85.png" alt="1_8_publish_npm包.png"></p> <p>由于是第一次提交，需要先运行 npm adduser 否则会出现错误</p> <p><img src="/images/node/1_9_%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%8F%91%E5%B8%83%E9%9C%80%E8%A6%81%E5%85%88%E8%BF%90%E8%A1%8Cnpm_adduser%E5%91%BD%E4%BB%A4.png" alt="1_9_第一次发布需要先运行npm_adduser命令.png"></p> <h4 id="版本更新"><a href="#版本更新" class="header-anchor">#</a> 版本更新</h4> <p>比如添加了README.md文档，需要从 0.1.0 升级到 0.1.1</p> <ul><li>修改package.json里的version为 0.1.1</li> <li>运行 ./publish.sh，提交新版本</li></ul> <h4 id="其他问题"><a href="#其他问题" class="header-anchor">#</a> 其他问题</h4> <ul><li><a href="https://docs.npmjs.com/packages-and-modules/" target="_blank" rel="noopener noreferrer">Packages and modules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 官方文档精读</li> <li>关于版本更新记录，可以学axios放到CHANGELOG.md里</li> <li>研究入口index.js，可以导出一些模块</li> <li>index.d.ts TypeScript支持</li> <li>LICENSE 添加</li> <li>想设置发布文件的黑名单，通过.gitignore或.npmignore这两个文件来设置忽略的文件或文件夹。参见 <a href="https://www.jianshu.com/p/dc8e9af61a0f" target="_blank" rel="noopener noreferrer">NPM发包建议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>commander 模块后续深入了解</li> <li><a href="https://www.npmjs.com/package/handlebars" target="_blank" rel="noopener noreferrer">handlebars<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文件渲染模板模块研究
<ul><li><a href="https://handlebars-draft.knappi.org/guide/#what-is-handlebars" target="_blank" rel="noopener noreferrer">handlebars文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://tryhandlebarsjs.com/" target="_blank" rel="noopener noreferrer">在线handlebars调试<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>npm version 研究，参考 <a href="https://www.codercto.com/a/56844.html" target="_blank" rel="noopener noreferrer">NPM包（模块）发布、更新、撤销发布<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>在node_modules 里仔细研究 axios，commander等模块源码</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/29/2020, 10:59:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/node/base/2.html">
        Koa
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.7f6157e7.js" defer></script><script src="/assets/js/2.4b3539f1.js" defer></script><script src="/assets/js/115.0eebc982.js" defer></script><script src="/assets/js/3.e6a4dd76.js" defer></script>
  </body>
</html>
