<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2020年10月技术日常 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="左小白的前端笔记，归纳整理自己在前端工作、学习中的一些心得笔记，有利于前端知识系统化。包括 Vue.js、前端工程化（TypeScript、Node.js、webpack）、Docker、JS/ES6、CSS/CSS3、HTML/HTML5、数据可视化、计算机基础、英语等笔记。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.594b47db.css" as="style"><link rel="preload" href="/assets/js/app.05304cd4.js" as="script"><link rel="preload" href="/assets/js/2.4b3539f1.js" as="script"><link rel="preload" href="/assets/js/45.ed0f9610.js" as="script"><link rel="preload" href="/assets/js/3.e6a4dd76.js" as="script"><link rel="prefetch" href="/assets/js/10.71696328.js"><link rel="prefetch" href="/assets/js/100.af4eb0dd.js"><link rel="prefetch" href="/assets/js/101.799fd293.js"><link rel="prefetch" href="/assets/js/102.ef90d320.js"><link rel="prefetch" href="/assets/js/103.c238a6be.js"><link rel="prefetch" href="/assets/js/104.a99af0df.js"><link rel="prefetch" href="/assets/js/105.3efb51e9.js"><link rel="prefetch" href="/assets/js/106.3d1881fb.js"><link rel="prefetch" href="/assets/js/107.0ed11eb1.js"><link rel="prefetch" href="/assets/js/108.3d265327.js"><link rel="prefetch" href="/assets/js/109.c3abb2af.js"><link rel="prefetch" href="/assets/js/11.f94d3695.js"><link rel="prefetch" href="/assets/js/110.49981c69.js"><link rel="prefetch" href="/assets/js/111.d1d61cbb.js"><link rel="prefetch" href="/assets/js/112.8d76b681.js"><link rel="prefetch" href="/assets/js/113.e345b7e8.js"><link rel="prefetch" href="/assets/js/114.6d851ece.js"><link rel="prefetch" href="/assets/js/115.0eebc982.js"><link rel="prefetch" href="/assets/js/116.2aadb56a.js"><link rel="prefetch" href="/assets/js/117.37e37c52.js"><link rel="prefetch" href="/assets/js/118.1e8f5afa.js"><link rel="prefetch" href="/assets/js/119.2ff36c4f.js"><link rel="prefetch" href="/assets/js/12.5065a0a0.js"><link rel="prefetch" href="/assets/js/120.71db3662.js"><link rel="prefetch" href="/assets/js/121.d57525fa.js"><link rel="prefetch" href="/assets/js/122.a83b24b5.js"><link rel="prefetch" href="/assets/js/123.9f86fe8b.js"><link rel="prefetch" href="/assets/js/124.084523c1.js"><link rel="prefetch" href="/assets/js/125.e9bac513.js"><link rel="prefetch" href="/assets/js/126.c16d4f67.js"><link rel="prefetch" href="/assets/js/127.18fceb32.js"><link rel="prefetch" href="/assets/js/128.9e0458bf.js"><link rel="prefetch" href="/assets/js/129.f759a036.js"><link rel="prefetch" href="/assets/js/13.82e7edce.js"><link rel="prefetch" href="/assets/js/130.49e5429d.js"><link rel="prefetch" href="/assets/js/131.e98fec29.js"><link rel="prefetch" href="/assets/js/132.2af68f32.js"><link rel="prefetch" href="/assets/js/133.2b5d9790.js"><link rel="prefetch" href="/assets/js/134.c3904d3e.js"><link rel="prefetch" href="/assets/js/135.0f89a7a5.js"><link rel="prefetch" href="/assets/js/136.b730b767.js"><link rel="prefetch" href="/assets/js/137.3a58c871.js"><link rel="prefetch" href="/assets/js/138.e2b6fabb.js"><link rel="prefetch" href="/assets/js/139.19b9b802.js"><link rel="prefetch" href="/assets/js/14.47fdb070.js"><link rel="prefetch" href="/assets/js/140.bacebfef.js"><link rel="prefetch" href="/assets/js/141.dcb25d46.js"><link rel="prefetch" href="/assets/js/142.13510333.js"><link rel="prefetch" href="/assets/js/143.c4f8cfbb.js"><link rel="prefetch" href="/assets/js/144.f14b64cf.js"><link rel="prefetch" href="/assets/js/145.3ee999ca.js"><link rel="prefetch" href="/assets/js/146.e8b1eca4.js"><link rel="prefetch" href="/assets/js/147.bb492c99.js"><link rel="prefetch" href="/assets/js/148.b97c8e6e.js"><link rel="prefetch" href="/assets/js/149.09d4a2d6.js"><link rel="prefetch" href="/assets/js/15.96e033fa.js"><link rel="prefetch" href="/assets/js/150.09459140.js"><link rel="prefetch" href="/assets/js/151.e58d50d6.js"><link rel="prefetch" href="/assets/js/152.144e4b5a.js"><link rel="prefetch" href="/assets/js/153.8fc0a77c.js"><link rel="prefetch" href="/assets/js/154.66d523bd.js"><link rel="prefetch" href="/assets/js/155.753cc2ca.js"><link rel="prefetch" href="/assets/js/156.b3989277.js"><link rel="prefetch" href="/assets/js/16.eb71a02a.js"><link rel="prefetch" href="/assets/js/17.92df7b99.js"><link rel="prefetch" href="/assets/js/18.50bc4846.js"><link rel="prefetch" href="/assets/js/19.b1ef1e4b.js"><link rel="prefetch" href="/assets/js/20.0bd8c323.js"><link rel="prefetch" href="/assets/js/21.61706504.js"><link rel="prefetch" href="/assets/js/22.8dd4c425.js"><link rel="prefetch" href="/assets/js/23.586aa03f.js"><link rel="prefetch" href="/assets/js/24.587da8d7.js"><link rel="prefetch" href="/assets/js/25.48dbd4aa.js"><link rel="prefetch" href="/assets/js/26.457ebcaa.js"><link rel="prefetch" href="/assets/js/27.1963bdd9.js"><link rel="prefetch" href="/assets/js/28.fd255c8f.js"><link rel="prefetch" href="/assets/js/29.9be7c06f.js"><link rel="prefetch" href="/assets/js/30.ec48e840.js"><link rel="prefetch" href="/assets/js/31.6dcc588d.js"><link rel="prefetch" href="/assets/js/32.04333fd7.js"><link rel="prefetch" href="/assets/js/33.0ae0efe9.js"><link rel="prefetch" href="/assets/js/34.b4be6b86.js"><link rel="prefetch" href="/assets/js/35.64cf8684.js"><link rel="prefetch" href="/assets/js/36.6db6ff86.js"><link rel="prefetch" href="/assets/js/37.148032a4.js"><link rel="prefetch" href="/assets/js/38.58df30af.js"><link rel="prefetch" href="/assets/js/39.a470e9de.js"><link rel="prefetch" href="/assets/js/4.cc6d99c2.js"><link rel="prefetch" href="/assets/js/40.d4b18e0c.js"><link rel="prefetch" href="/assets/js/41.e20068b4.js"><link rel="prefetch" href="/assets/js/42.3a75683d.js"><link rel="prefetch" href="/assets/js/43.ba2cdbb2.js"><link rel="prefetch" href="/assets/js/44.98e76581.js"><link rel="prefetch" href="/assets/js/46.2825326b.js"><link rel="prefetch" href="/assets/js/47.ce00ed53.js"><link rel="prefetch" href="/assets/js/48.99180398.js"><link rel="prefetch" href="/assets/js/49.63a36b62.js"><link rel="prefetch" href="/assets/js/5.5b94bff7.js"><link rel="prefetch" href="/assets/js/50.1eb2e756.js"><link rel="prefetch" href="/assets/js/51.6c4ff19b.js"><link rel="prefetch" href="/assets/js/52.b3544353.js"><link rel="prefetch" href="/assets/js/53.1c5bada0.js"><link rel="prefetch" href="/assets/js/54.3f612a54.js"><link rel="prefetch" href="/assets/js/55.e371eb4b.js"><link rel="prefetch" href="/assets/js/56.0c442daa.js"><link rel="prefetch" href="/assets/js/57.96bb7db7.js"><link rel="prefetch" href="/assets/js/58.3e297889.js"><link rel="prefetch" href="/assets/js/59.c05a9392.js"><link rel="prefetch" href="/assets/js/6.481b22df.js"><link rel="prefetch" href="/assets/js/60.e88ec729.js"><link rel="prefetch" href="/assets/js/61.9a499194.js"><link rel="prefetch" href="/assets/js/62.17aa3868.js"><link rel="prefetch" href="/assets/js/63.98f2d0e9.js"><link rel="prefetch" href="/assets/js/64.5a7e0382.js"><link rel="prefetch" href="/assets/js/65.75353cfc.js"><link rel="prefetch" href="/assets/js/66.2f77d310.js"><link rel="prefetch" href="/assets/js/67.9fd528d0.js"><link rel="prefetch" href="/assets/js/68.3e65a767.js"><link rel="prefetch" href="/assets/js/69.4483a196.js"><link rel="prefetch" href="/assets/js/7.cb937ed7.js"><link rel="prefetch" href="/assets/js/70.f4e7a648.js"><link rel="prefetch" href="/assets/js/71.e376b330.js"><link rel="prefetch" href="/assets/js/72.dcb8ba9a.js"><link rel="prefetch" href="/assets/js/73.037831aa.js"><link rel="prefetch" href="/assets/js/74.654ba410.js"><link rel="prefetch" href="/assets/js/75.5d2d6c3a.js"><link rel="prefetch" href="/assets/js/76.643f6d9b.js"><link rel="prefetch" href="/assets/js/77.0ce16396.js"><link rel="prefetch" href="/assets/js/78.5f05ca92.js"><link rel="prefetch" href="/assets/js/79.662034ba.js"><link rel="prefetch" href="/assets/js/8.9b412011.js"><link rel="prefetch" href="/assets/js/80.c731131b.js"><link rel="prefetch" href="/assets/js/81.76951019.js"><link rel="prefetch" href="/assets/js/82.9cd618c9.js"><link rel="prefetch" href="/assets/js/83.beb1efe0.js"><link rel="prefetch" href="/assets/js/84.8dc3ae7c.js"><link rel="prefetch" href="/assets/js/85.8ea0a641.js"><link rel="prefetch" href="/assets/js/86.0e1f35a3.js"><link rel="prefetch" href="/assets/js/87.6f89ccf2.js"><link rel="prefetch" href="/assets/js/88.77626763.js"><link rel="prefetch" href="/assets/js/89.2fa83aed.js"><link rel="prefetch" href="/assets/js/9.b551853b.js"><link rel="prefetch" href="/assets/js/90.bc412f4d.js"><link rel="prefetch" href="/assets/js/91.69f41fec.js"><link rel="prefetch" href="/assets/js/92.ab147dde.js"><link rel="prefetch" href="/assets/js/93.078b5817.js"><link rel="prefetch" href="/assets/js/94.f602d07f.js"><link rel="prefetch" href="/assets/js/95.f348d112.js"><link rel="prefetch" href="/assets/js/96.e0a54a9b.js"><link rel="prefetch" href="/assets/js/97.390f851a.js"><link rel="prefetch" href="/assets/js/98.742e7f81.js"><link rel="prefetch" href="/assets/js/99.b8d65f8d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.594b47db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link router-link-active">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link router-link-active">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daily/" aria-current="page" class="sidebar-link">技术日常记录</a></li><li><a href="/daily/2020-12.html" class="sidebar-link">2020年12月技术日常</a></li><li><a href="/daily/2020-11.html" class="sidebar-link">2020年11月技术日常</a></li><li><a href="/daily/2020-10.html" aria-current="page" class="active sidebar-link">2020年10月技术日常</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-31-周六" class="sidebar-link">2020/10/31 周六</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#防盗链时需要注意搜索引擎-referer-百度和-google-搜索内容跳转链接之间的区别" class="sidebar-link">防盗链时需要注意搜索引擎 Referer：百度和 Google 搜索内容跳转链接之间的区别</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#外部链接-a-标签为什么要加-noreferer-与-noopener" class="sidebar-link">外部链接 a 标签为什么要加 noreferer 与 noopener ？</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-29-周四" class="sidebar-link">2020/10/29 周四</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vuepress-复选框、任务列表不生效怎么处理" class="sidebar-link">VuePress 复选框、任务列表不生效怎么处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-27-周二" class="sidebar-link">2020/10/27 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#使用vuepress生成静态网站并部署到github-pages" class="sidebar-link">使用VuePress生成静态网站并部署到Github Pages</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-22-周四" class="sidebar-link">2020/10/22 周四</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#js使用localecompare函数对中文进行首字母排序" class="sidebar-link">js使用localeCompare函数对中文进行首字母排序</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#js判断两个日期是否是同一周-带单元测试" class="sidebar-link">js判断两个日期是否是同一周，带单元测试</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#console-log-打印带样式的文字-图片" class="sidebar-link">console.log 打印带样式的文字，图片</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-21-周三" class="sidebar-link">2020/10/21 周三</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#两种方法解决error-cannot-find-module-webpack-cli-bin-config-yargs" class="sidebar-link">两种方法解决Error: Cannot find module 'webpack-cli/bin/config-yargs'</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-20-周二" class="sidebar-link">2020/10/20 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vscode配置了自动fix突然失效了-或者一直生效不了-怎么看对应的log" class="sidebar-link">vscode配置了自动fix突然失效了，或者一直生效不了，怎么看对应的log</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#docsify嵌入vue-echarts组件无法显示图表的问题" class="sidebar-link">docsify嵌入vue echarts组件无法显示图表的问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#github-pages使用自定义域名开启https-配置cname解析" class="sidebar-link">GitHub Pages使用自定义域名开启HTTPS，配置CNAME解析</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#xx-github-io仓库配置github-pages后对其他仓库的影响" class="sidebar-link">xx.github.io仓库配置Github pages后对其他仓库的影响</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#lodash-js打包后默认是整包-怎么按需打包-减少包体积" class="sidebar-link">lodash.js打包后默认是整包，怎么按需打包，减少包体积</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vue-cli-build-target-lib时如何避免打包成多个umd-js文件" class="sidebar-link">vue-cli build --target lib时如何避免打包成多个umd.js文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-17-周六" class="sidebar-link">2020/10/17 周六</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#google广告一个页面怎么显示多个广告-多个广告只显示的一个是什么原因" class="sidebar-link">Google广告一个页面怎么显示多个广告，多个广告只显示的一个是什么原因？</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-11-周日" class="sidebar-link">2020/10/11 周日</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#domcontentloaded与load时间具体指的是什么时间" class="sidebar-link">DOMContentLoaded与Load时间具体指的是什么时间？</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vue项目页面打开时间优化-从16秒到2秒内" class="sidebar-link">vue项目页面打开时间优化：从16秒到2秒内</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vue-cannot-read-property-prototype-of-undefined" class="sidebar-link">vue Cannot read property 'prototype' of undefined</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vue-config-js-plugins-is-not-allowed" class="sidebar-link">vue.config.js: &quot;plugins&quot; is not allowed</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#vue中文本-功能实现" class="sidebar-link">vue中文本@功能实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-06-周二" class="sidebar-link">2020/10/06 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#docker持续集成与自动化部署" class="sidebar-link">Docker持续集成与自动化部署</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-04-周日" class="sidebar-link">2020/10/04 周日</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#pm2-process-yml-you-cannot-define-a-mapping-item-when-in-a-sequence" class="sidebar-link">pm2 process.yml You cannot define a mapping item when in a sequence</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#_2020-10-01-周四" class="sidebar-link">2020/10/01 周四</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-10.html#let-s-encrypt-免费https证书" class="sidebar-link">Let’s Encrypt 免费HTTPS证书</a></li><li class="sidebar-sub-header"><a href="/daily/2020-10.html#http-2-怎么确定网站是否开启了http-2-http-3" class="sidebar-link">HTTP/2，怎么确定网站是否开启了HTTP/2，HTTP/3？</a></li></ul></li></ul></li><li><a href="/daily/2020-09.html" class="sidebar-link">2020年09月技术日常</a></li><li><a href="/daily/2020-08.html" class="sidebar-link">2020年08月技术日常</a></li><li><a href="/daily/2020-07.html" class="sidebar-link">2020年07月技术日常</a></li><li><a href="/daily/2020-06.html" class="sidebar-link">2020年06月技术日常</a></li><li><a href="/daily/2020-05.html" class="sidebar-link">2020年05月技术日常</a></li><li><a href="/daily/2020-04.html" class="sidebar-link">2020年04月技术日常</a></li><li><a href="/daily/2020-03.html" class="sidebar-link">2020年03月技术日常</a></li><li><a href="/daily/2020-02.html" class="sidebar-link">2020年02月技术日常</a></li><li><a href="/daily/2020-01.html" class="sidebar-link">2020年01月技术日常</a></li><li><a href="/daily/2019-12.html" class="sidebar-link">2019年12月技术日常</a></li><li><a href="/daily/2019-11.html" class="sidebar-link">2019年11月技术日常</a></li><li><a href="/daily/2019-10.html" class="sidebar-link">2019年10月技术日常</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2020年10月技术日常"><a href="#_2020年10月技术日常" class="header-anchor">#</a> 2020年10月技术日常</h1> <h2 id="_2020-10-31-周六"><a href="#_2020-10-31-周六" class="header-anchor">#</a> 2020/10/31 周六</h2> <h3 id="防盗链时需要注意搜索引擎-referer-百度和-google-搜索内容跳转链接之间的区别"><a href="#防盗链时需要注意搜索引擎-referer-百度和-google-搜索内容跳转链接之间的区别" class="header-anchor">#</a> 防盗链时需要注意搜索引擎 Referer：百度和 Google 搜索内容跳转链接之间的区别</h3> <p>一般搜索引擎为了方便网页做来源分析，不会使用 noreferer，因此从搜索引擎进入页面时，会携带对应的 Referer。当首页 index.html 也放在 CDN 的情况时，做防盗链 Referer 白名单时，要记得放开搜索引擎的相关 Referer。下面分两个部分介绍搜索引擎跳转链接的处理</p> <ol><li>百度搜索结果链接的跳转方式</li> <li>Google搜索结构链接的跳转方式</li></ol> <p><img src="/images/daily/search_1.png" alt="search_1.png"></p> <p><strong>百度搜索结果链接的跳转方式</strong></p> <p>如上图所示，百度搜索结果列表里的链接，指向的任然是 baidu.com 的域名，访问这个链接它会做一个重定向。我们可以使用 <code>curl -v</code> 的方式来查看具体逻辑</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -v <span class="token string">'https://www.baidu.com/link?url=MKActaa6Ed8aGU2yOX2y9v3ne5xinD6tt_v-PHOZ9STfd8cgtAY0yi-c5FEqiIt-CW9_8db1PBwqnTE7jEdb3K&amp;wd=&amp;eqid=a4d184060000714d000000065f9d3673'</span>
</code></pre></div><p>下面是得到的网页内容</p> <p><img src="/images/daily/search_2.png" alt="search_2.png"></p> <p>可以看到如果支持 <code>script</code>，一般默认使用 window.location.replace 重定向到目标链接。如果不支持 <code>script</code>，使用 meta 的方式进行跳转。</p> <p>具体排版后，内容如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opener <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span>bds <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span>bds<span class="token punctuation">.</span>pdc <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span>bds<span class="token punctuation">.</span>pdc<span class="token punctuation">.</span>sendLinkLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span>bds<span class="token punctuation">.</span>pdc<span class="token punctuation">.</span><span class="token function">sendLinkLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bdlksmp</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bdlksmp=([^=&amp;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> matches <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timeout <span class="token operator">=</span> matches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> matches<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;https://blog.csdn.net/aexwx/article/details/86775768&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>opener <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>noscript<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token constant">META</span> http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;refresh&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;0;URL='https://blog.csdn.net/aexwx/article/details/86775768'&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>noscript<span class="token operator">&gt;</span>
</code></pre></div><p>在进入下面后，我们查看 Network 里面的 Referer 会看到来源的百度链接，如下图</p> <p><img src="/images/daily/search_3.png" alt="search_3.png"></p> <p><strong>Google搜索结构链接的跳转方式</strong></p> <p>如下图所示 Google 搜索列表是直接链接到目标地址，和百度先跳自己的链接再重定向是不同的。</p> <p><img src="/images/daily/search_4.png" alt="search_4.png"></p> <p>这种情况来看进入页面后，其 Referer，可以看到只有 google 的链接没有参数，可能这就是为什么百度统计里面只能看到百度搜索的来源关键字，而看不到 Google 搜索的来源关键字的原因。</p> <p><img src="/images/daily/search_5.png" alt="search_5.png"></p> <h3 id="外部链接-a-标签为什么要加-noreferer-与-noopener"><a href="#外部链接-a-标签为什么要加-noreferer-与-noopener" class="header-anchor">#</a> 外部链接 a 标签为什么要加 noreferer 与 noopener ？</h3> <p>一般页面的外部连接都会加上 <code>ref=&quot;noreferer noopener&quot;</code>，这样可以避免一些安全问题，下面通过几个问题来具体看看</p> <ol><li>a 标签加上 noreferer 和 noopener 后会有什么效果？</li> <li>Referer 是什么？</li> <li>Referer 的应用场景</li> <li>window.opener 可以做什么？</li></ol> <p><img src="/images/daily/noreferer_1.png" alt="noreferer_1.png"></p> <p><strong>a 标签加上 noreferer 和 noopener 后会有什么效果？</strong></p> <p>以 Github 上 less.js 仓库设置的网站链接为例，如上图。加了这两个参数后点击链接，该页面打开后</p> <ul><li>请求头（Request Headers）部分的 Referer 和直接访问的 Referer 一致，都为空，不会携带来源信息。</li> <li>window.opener 和直接访问该网站一致，无法获取来源网站信息，无法操作来源网站的跳转等</li></ul> <p><strong>请求头 Referer 是什么？</strong></p> <p>一般网页在加载html、js、css、图片等静态资源发送请求时，<strong>请求头部分会有一个 Referer 字段，用于标记请求来源</strong>。referer 单词存在拼写错误，本意是打算使用 referrer，写错了。后来为了兼容，将错就错，还是保留了错误的拼写方式。</p> <p><strong>Referer 的应用场景</strong></p> <p>Referer可以标记请求来源，有以下几个应用场景</p> <ul><li>用于统计分析，可以知道用户是从哪种方式进入网站的。搜索引擎一般不会开启 noreferer，比如百度统计可以知道你是通过哪个关键字进入的页面。</li></ul> <p><img src="/images/daily/noreferer_2.png" alt="noreferer_2.png"></p> <ul><li><p>用于防盗链，防止网页静态资源被其他站点直接引用，如淘宝店铺图片、CDN图片链接、文件、视频链接等。一般会设置 referer 白名单，仅允许白名单内的 Referer 访问，否则禁止访问。减少服务器负载或不必要的 CDN 流量花费。</p></li> <li><p>用于鉴权，比如页面在集成评论系统、Google AdSense等第三方功能时，会校验站点与ID是否匹配，如果不匹配会提示 403。防止其他网站引入对应的代码后，导致数据错乱。我们在处理接口请求时，也可以对 Referer 值进行判断，禁止某些来源访问接口。</p></li></ul> <p><strong>window.opener 可以做什么？</strong></p> <p>window.opener 可以拿到来源网站的 window 对象，虽然一般访问 dom 等有跨域限制，但 window.opener.location 可以直接重定向网站，使来源站点发生变化，referer 保持源网站链接。使用 noopener 可以避免一些安全风险。</p> <p>参考：</p> <ul><li><a href="https://cloud.tencent.com/developer/article/1555507" target="_blank" rel="noopener noreferrer">你了解Referer吗 - 云+社区 - 腾讯云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://help.aliyun.com/document_detail/31869.html?spm=5176.8466010.referer.1.1e611450esasVK" target="_blank" rel="noopener noreferrer">防盗链_访问控制_数据安全_开发指南_对象存储 OSS-阿里云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_2020-10-29-周四"><a href="#_2020-10-29-周四" class="header-anchor">#</a> 2020/10/29 周四</h2> <h3 id="vuepress-复选框、任务列表不生效怎么处理"><a href="#vuepress-复选框、任务列表不生效怎么处理" class="header-anchor">#</a> VuePress 复选框、任务列表不生效怎么处理</h3> <p>在写 markdown 笔记时，复选框、任务列表（task list）功能在本地 Typora 是生效的，但在 VuePress 中无法正常显示。于是在 Github 对应的 issue 里面搜索 Task lists，找到了解决方法：需要安装一个 markdown 插件 <code>markdown-it-task-lists</code></p> <div class="language- extra-class"><pre class="language-text"><code>- [x] 已完成的计划
- [ ] 待完成 1
- [ ] 待完成 2
- [x] 已完成的计划
- [ ] 待完成 1
- [ ] 待完成 2
</code></pre></div><p>插件安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> markdown-it-task-lists -D
</code></pre></div><p>修改配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  markdown<span class="token operator">:</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'task-lists'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>完全退出 dev，再重新开启服务后，就正常了，对比图如下：</p> <p><img src="/images/daily/vuepress_tasklist.png" alt="vuepress_tasklist.png"></p> <p>参考: <a href="https://github.com/vuejs/vuepress/issues/2364" target="_blank" rel="noopener noreferrer">怎么实现复选框功能 · Issue #2364 · vuejs/vuepress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-10-27-周二"><a href="#_2020-10-27-周二" class="header-anchor">#</a> 2020/10/27 周二</h2> <h3 id="使用vuepress生成静态网站并部署到github-pages"><a href="#使用vuepress生成静态网站并部署到github-pages" class="header-anchor">#</a> 使用VuePress生成静态网站并部署到Github Pages</h3> <p><a href="https://www.vuepress.cn/guide/#%E5%AE%83%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84" target="_blank" rel="noopener noreferrer">VuePress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个静态网站生成器，诞生初衷是为了支持 Vue 及其子项目的文档需求。目前 Vue 相关文档都是有 vuepress 搭建。</p> <p>Docsify 是运行时驱动，通过 JS 加载内容，对 SEO 不够友好。它类似于 Hexo，只是 VuePress 是由 Vue 驱动。</p> <p>VuePress 的比较好的地方：</p> <ol><li>丰富的 Markdown 扩展、主题风格优雅</li> <li>可以使用插件支持 PWA</li> <li>SEO友好</li></ol> <p>现在以 <a href="https://github.com/zuoxiaobai/fenote" target="_blank" rel="noopener noreferrer">zuoxiaobai/fenote<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Github 仓库为例，为该仓库搭建一个官网</p> <p>核心目录结构如下，完整目录结构参考 <a href="https://www.vuepress.cn/guide/directory-structure.html#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" target="_blank" rel="noopener noreferrer">VuePress 目录结构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>├── docs  <span class="token comment"># docs 是文档项目名称，也可以自己命名 </span>
│   ├── .vuepress <span class="token comment"># .vuepress 配置、构件生成目录</span>
│   ├── README.md <span class="token comment"># 默认的首页</span>
│   ├── 其他markdown目录及文档
└── package.json
</code></pre></div><p>它的本质就是，先按照指定的目录格式，写好 Markdown 及配置。然后使用 vuepress dev docs 命令生成静态站点，生成目录默认为 docs/.vuepress/dist。另外它还提供了开发server，运行 vuepress dev docs 可以实时看页面效果。</p> <p>由于需要使用 vuepress 命令，我们为了方便后期维护迭代，一般不推荐全局安装 vuepress。在项目内安装即可。如果项目根目录没有 package.json，那就需要自己创建一个了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 初始化一个 package.json，如果这个文件存在，可跳过</span>
<span class="token function">npm</span> init   
<span class="token comment"># 安装 vuepress 开发依赖</span>
<span class="token function">npm</span> <span class="token function">install</span> vuepress -D <span class="token comment"># --save-dev</span>
</code></pre></div><p>在 package.json 里面添加下面两条命令的快捷方式，这样就可以使用 npm run docs:dev，以及 npm run docs:build 来运行或构件静态站点了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;docs:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vuepress dev docs&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;docs:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vuepress build docs&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>下面按照上面的目录结构，把 docs、.vuepress文件夹，以及 README.md 创建好，REAMEME.md 写一个 hello vuepress。运行 npm run docs:dev 它默认会在本地开启 8080 端口服务，访问效果如下图</p> <p><img src="/images/daily/vuepress_1.png" alt="vuepress_1.png"></p> <p>可以看到标题、右上角导航栏、左侧菜单都没有出来。这就需要在 .vuepress/confing.js 写对应的配置了。你需要关系 4 点：</p> <ol><li>title 用于配置左上角标题</li> <li>themeConfig.sidebar 用于配置右上角的导航栏</li> <li>themeConfig.nav 用于配置左侧菜单</li> <li>首页默认是 docs/README.md，<code>/</code> 表示 docs 目录，比如：<code>/a.md</code> 表示 <code>dosc/a.md</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .vuepress/config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// base: '/fenote/',</span>
  title<span class="token operator">:</span> <span class="token string">'左小白的前端笔记'</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'左小白的前端笔记，用于记录、完善个人前端知识体系结构'</span><span class="token punctuation">,</span>
  themeConfig<span class="token operator">:</span> <span class="token punctuation">{</span>
    sidebar<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'指南'</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'/'</span><span class="token punctuation">,</span>
          <span class="token string">'/a.md'</span><span class="token punctuation">,</span>
          <span class="token string">'/b.md'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    nav<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'指南'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'配置'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'/config.md'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'Github'</span><span class="token punctuation">,</span> link<span class="token operator">:</span> <span class="token string">'https://www.github.com/zuoxiaobai/fenote'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们按照上面的配置文件写好后，在 docs 目录下创建 a.md，b.md，a.md 如下</p> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> a文件</span>

a.md
</code></pre></div><p>由于 npm run build:dev 后，它支持类似 HMR 热模块加载的功能，修改后，会自动重新构建。根据上面的配置好后，效果如下</p> <p><img src="/images/daily/vuepress_2.png" alt="vuepress_2.png"></p> <p>这样我们就可以根据自己的需要，规划顶部导航以及左侧菜单了。更多配置、markdown扩展语法参见：<a href="https://www.vuepress.cn/guide/basic-config.html#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" target="_blank" rel="noopener noreferrer">基本配置 | VuePress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这样写好后，只能本地运行，怎么部署到 Github Pages 呢？VuePress官网提供一个部署脚本，可以放到项目根目录 deploy.sh</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env sh</span>

<span class="token comment"># 确保脚本抛出遇到的错误</span>
<span class="token builtin class-name">set</span> -e

<span class="token comment"># 生成静态文件</span>
<span class="token function">npm</span> run docs:build

<span class="token comment"># 进入生成的文件夹</span>
<span class="token builtin class-name">cd</span> docs/.vuepress/dist

<span class="token comment"># 如果是发布到自定义域名</span>
<span class="token comment"># echo 'www.example.com' &gt; CNAME</span>

<span class="token comment"># 在新生成的目录下初始化 .git，并 add 所有文件，提交到该目录下项目的本地master分支(默认)</span>
<span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> -A
<span class="token function">git</span> commit -m <span class="token string">'deploy'</span>

<span class="token comment"># 如果发布到 https://&lt;USERNAME&gt;.github.io</span>
<span class="token comment"># git push -f git@github.com:&lt;USERNAME&gt;/&lt;USERNAME&gt;.github.io.git master</span>

<span class="token comment"># 如果发布到 https://&lt;USERNAME&gt;.github.io/&lt;REPO&gt;</span>
<span class="token comment"># git push -f git@github.com:&lt;USERNAME&gt;/&lt;REPO&gt;.git master:gh-pages</span>
<span class="token comment"># zuoxiaobai/fenote 对应的配置如下，将doscs/.vuepress/dist 目录下的 master 分支 push 到 fenote 远程远程仓库的 gh-pages 分支</span>
<span class="token function">git</span> push -f git@github.com:zuoxiaobai/fenote.git master:gh-pages

<span class="token builtin class-name">cd</span> -
</code></pre></div><p>在 mac 下，新建的 deploy.sh 默认没有可执行权限，需要 <code>chmod +x deploy.sh</code>，这样就可以 ./deploy.sh 直接部署了。</p> <p>注意：如果发布到 <code>https://&lt;USERNAME&gt;.github.io/&lt;REPO&gt;</code>，且没有使用自定义域名。则需要修改 config.js 的 base 配置为对应的仓库名</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  base<span class="token operator">:</span> <span class="token string">'/fenote/'</span><span class="token punctuation">,</span> 
  title<span class="token operator">:</span> <span class="token string">'左小白的前端笔记'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行 ./deploy.sh，部署成功后，可以通过 <code>https://zuoxiaobai.github.io/fenote/</code> 来访问了，如下图</p> <p><img src="/images/daily/vuepress_3.png" alt="vuepress_3.png"></p> <h2 id="_2020-10-22-周四"><a href="#_2020-10-22-周四" class="header-anchor">#</a> 2020/10/22 周四</h2> <h3 id="js使用localecompare函数对中文进行首字母排序"><a href="#js使用localecompare函数对中文进行首字母排序" class="header-anchor">#</a> js使用localeCompare函数对中文进行首字母排序</h3> <blockquote><p>tag: js中文按首字母排序, 前端中文按首字母排序,前端中文排序</p></blockquote> <p>String.prototype.localeCompare(compareString[, locales[, options]])</p> <p>该方法用于对字符串进行排序。第二个参数 locales 可以指定语言，中文排序传 'ch' 即可。它的返回值为 -1, 1, 0 和 sort 自定义排序的返回值基本一致。来看一个例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token string">'中文zw'</span><span class="token punctuation">,</span> <span class="token string">'啊啊啊aaa'</span><span class="token punctuation">,</span> <span class="token string">'猜猜猜ccc'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">'ch'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//  [&quot;啊啊啊aaa&quot;, &quot;猜猜猜ccc&quot;, &quot;中文zw&quot;]</span>
</code></pre></div><p><img src="/images/daily/sort_ch.png" alt="sort_ch.png"></p> <p>参考：</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare" target="_blank" rel="noopener noreferrer">String.prototype.localeCompare() | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/stone10086/article/details/83752227" target="_blank" rel="noopener noreferrer">js中文按首字母排序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="js判断两个日期是否是同一周-带单元测试"><a href="#js判断两个日期是否是同一周-带单元测试" class="header-anchor">#</a> js判断两个日期是否是同一周，带单元测试</h3> <p>给定两个日期，怎么判断他们是同一周呢？核心是 <strong>所有时间都是从 1970年1月1日(周4) 开始，(天数 + 4)/7 就是周数，如果相同则是同一周</strong>，这里会有一个特殊情况，就是周日的时候。只需要日期，不要输入时间，默认都是以 '08:00:00' 为准。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @description 判断两个时间是否是同一周
 * 所有时间都是从 1970年1月1日(周4) 开始，(天数 + 4)/7 就是周数，如果相同则是同一周
 * 特殊情况：周日会是整数，如果直接取整，周日会和下周一是同一天
 * (+new Date('1970-01-01') / oneDay) + 4 // 4 周四 /7 = 0.57
 * (+new Date('1970-01-04') / oneDay) + 4 // 4 周日 /7 = 1
 * (+new Date('1970-01-05') / oneDay) + 4 // 4 周一 /7 = 1.14
 * @params { Stirng } timeA '1970-01-03'
 * @params { Stirng } timeB '1970-01-22'
 */</span>
<span class="token keyword">function</span> <span class="token function">isSameWeek</span><span class="token punctuation">(</span><span class="token parameter">timeA<span class="token punctuation">,</span> timeB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> weekIndexA <span class="token operator">=</span> <span class="token function">getWeekIndex</span><span class="token punctuation">(</span>timeA<span class="token punctuation">)</span>
  <span class="token keyword">let</span> weekIndexB <span class="token operator">=</span> <span class="token function">getWeekIndex</span><span class="token punctuation">(</span>timeB<span class="token punctuation">)</span>
  <span class="token keyword">let</span> tempArr <span class="token operator">=</span> <span class="token punctuation">[</span>weekIndexA<span class="token punctuation">,</span> weekIndexB<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 如果有周日，间隔 &lt; 1，则是 [1.9, 2] 或 [1, 1.14]，较大的数为整数则是同一周。间隔 &gt;=1 则不是同一周</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tempArr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> tempArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> tempArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span>tempArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>weekIndexA<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>weekIndexB<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 获取周数</span>
  <span class="token keyword">function</span> <span class="token function">getWeekIndex</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> oneDayTime <span class="token operator">=</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token keyword">let</span> dayCount <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> oneDayTime
    <span class="token keyword">let</span> weekCount <span class="token operator">=</span> <span class="token punctuation">(</span>dayCount <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">7</span>
    <span class="token keyword">return</span> weekCount
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>单元测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// isSameWeek 单元测试</span>
<span class="token keyword">function</span> <span class="token function">isSameWeekTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'1970-01-01'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'1970-01-04'</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'1970-01-04'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'1970-01-05'</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'1970-01-12'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'1970-01-11'</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'1970-01-22'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'1970-01-23'</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">isSameWeek</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> item<span class="token punctuation">.</span>result
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res <span class="token operator">?</span> <span class="token string">'PASS'</span> <span class="token operator">:</span> <span class="token string">'FAIL'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">','</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">',</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res <span class="token operator">?</span> <span class="token string">'green'</span> <span class="token operator">:</span> <span class="token string">'red'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Run</span>
<span class="token function">isSameWeekTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>运行效果:</p> <p><img src="/images/daily/is_same_week.png" alt="is_same_week.png"></p> <h3 id="console-log-打印带样式的文字-图片"><a href="#console-log-打印带样式的文字-图片" class="header-anchor">#</a> console.log 打印带样式的文字，图片</h3> <p>console.log 的第一个参数中，如果有 '%c'，表示设置样式，会将第二个参数的 css 样式应用到第一个参数的内容中</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c文字'</span><span class="token punctuation">,</span> <span class="token string">'css样式'</span><span class="token punctuation">)</span>
</code></pre></div><p>这样可以打印绿色或红色的文字</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%cSuccess!'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/images/daily/console_color.png" alt="console_color.png"></p> <p>不仅可以设置文字颜色，还可以通过设置 background-color 在控制台显示图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>console<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;%c &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;padding:112px 150px;background:url('https://images.cnblogs.com/cnblogs_com/enumx/1647344/o_200214113324console.gif') no-repeat;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%cWelcome'</span><span class="token punctuation">,</span> <span class="token string">'color: #0000ff;font-size: 20px;font-weight: bold;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>效果如下</p> <p><img src="/images/daily/console_img.gif" alt="console_img.gif"></p> <p>参考：<a href="https://www.cnblogs.com/enumx/p/12308528.html" target="_blank" rel="noopener noreferrer">console.log输出字体颜色 - enumx - 博客园<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-10-21-周三"><a href="#_2020-10-21-周三" class="header-anchor">#</a> 2020/10/21 周三</h2> <h3 id="两种方法解决error-cannot-find-module-webpack-cli-bin-config-yargs"><a href="#两种方法解决error-cannot-find-module-webpack-cli-bin-config-yargs" class="header-anchor">#</a> 两种方法解决Error: Cannot find module 'webpack-cli/bin/config-yargs'</h3> <p>在运行 webpack-dev-server 这个命令时，如果出现了 Error: Cannot find module 'webpack-cli/bin/config-yargs' 这个错误，是因为默认情况下 webpack-dev-server 执行依赖 webpack-cli 包目录下的 bin/config-yargs，但 webpack-cli 4.1.0 的版本。有较大调整，删除了这个文件，导致了这个错误。</p> <p><img src="/images/daily/config-yargs_error.png" alt="config-yargs_error.png"></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.1.3&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;webpack-dev-server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.11.0&quot;</span>
</code></pre></div><p>有两种解决方法</p> <ol><li>将 webpack-cli 降级到 3.x版本, &quot;webpack-cli&quot;: &quot;^ 3.3.12&quot;</li> <li>使用 webpack 5.x 用于替代 webpack-dev-server 命令的 webpack serve 命令。其实它内部还是使用的 webpack-dev-server 这个包</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json scripts</span>
<span class="token string">&quot;dev:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve --config webpack.dev.js&quot;</span>
</code></pre></div><p>参考：<a href="https://github.com/webpack/webpack-cli/issues/1948" target="_blank" rel="noopener noreferrer">Error: Cannot find module 'webpack-cli/bin/config-yargs' · Issue #1948 · webpack/webpack-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-10-20-周二"><a href="#_2020-10-20-周二" class="header-anchor">#</a> 2020/10/20 周二</h2> <h3 id="vscode配置了自动fix突然失效了-或者一直生效不了-怎么看对应的log"><a href="#vscode配置了自动fix突然失效了-或者一直生效不了-怎么看对应的log" class="header-anchor">#</a> vscode配置了自动fix突然失效了，或者一直生效不了，怎么看对应的log</h3> <p>你是否会遇到下面的问题：在 vscode 里面安装了 eslint 插件后，正确设置了保存后自动 fix 参数，但没有生效。或者之前是生效的，忽然就不生效了。</p> <p>只要你的配置是没有问题的，那就是插件依赖的包加载异常了，一般都重启几次就Ok了。那怎么看 eslint 对应的log呢？可以分下面两步</p> <ol><li>点击 vscode 右下角的错误信息、警告信息图标，看是信息里是否有 eslint 相关报错</li> <li>点击 输出 - 选择 ESLint 就可以看 ESLint 相关 log 了。</li></ol> <p>下图是 ESLint 正常加载的 log</p> <p><img src="/images/daily/vscode_eslint_log.png" alt="vscode_eslint_log.png"></p> <p>下图是 eslint 失效后，查看 输出 - ESLint log 报的错误。提示 eslint-plugin-vue 找不到，一般就是 vscode 内部加载失败了。将 vscode 完全退出，再打开。或者将项目单独用一个新窗口打开就又正常了。</p> <p><img src="/images/daily/vscode_eslint_log_2.png" alt="vscode_eslint_log_2.png"></p> <h3 id="docsify嵌入vue-echarts组件无法显示图表的问题"><a href="#docsify嵌入vue-echarts组件无法显示图表的问题" class="header-anchor">#</a> docsify嵌入vue echarts组件无法显示图表的问题</h3> <p>注意，只要是 echarts vue 组件，使用 docsify 自带的 vue 后，echarts图出不来。后来打印 log 发现，<strong>最终渲染到页面的 echarts div并不是 vue 初始化之后，进行绘制的echarts div。而是一个拷贝后的副本，所以图片显示不出来。</strong> 需要使用 vuep 插件才行。实例参考 https://vuechart.zuo11.com，效果如下图:</p> <p><img src="/images/daily/z_chart_doc.png" alt="z_chart_doc.png"></p> <p>对应的 markdown 文件内容如下</p> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">###</span> z-chart</span>
z-chart组件是基于echarts的组件，只需要设置父容器的宽高，再设置 options 值即可。
<span class="token comment">&lt;!-- markdown文档里插入vuep代码 --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vuep</span> <span class="token attr-name">template</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#basicBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vuep</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">v-pre</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/x-template<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>basicBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">&quot;width:100%; height:100%;&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>z<span class="token operator">-</span>chart <span class="token operator">:</span>options<span class="token operator">=</span><span class="token string">&quot;chartData&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
 module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>chartData <span class="token operator">=</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token punctuation">{</span>
            text<span class="token operator">:</span> <span class="token string">&quot;ECharts 入门示例&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          tooltip<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          xAxis<span class="token operator">:</span> <span class="token punctuation">{</span>
            data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;衬衫&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;羊毛衫&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;雪纺衫&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;裤子&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;高跟鞋&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;袜子&quot;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          yAxis<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          series<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">&quot;销量&quot;</span><span class="token punctuation">,</span>
              type<span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
              data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意在 index.html 里面需要引入 vuep，以及其他你需要的组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>//cdn.jsdelivr.net/npm/vue/dist/vue.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>//unpkg.com/vuep/dist/vuep.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/echarts/4.8.0/echarts-en.common.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/@guoqzuo/vue-chart@latest/lib/vue-chart.umd.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="github-pages使用自定义域名开启https-配置cname解析"><a href="#github-pages使用自定义域名开启https-配置cname解析" class="header-anchor">#</a> GitHub Pages使用自定义域名开启HTTPS，配置CNAME解析</h3> <p>一般在仓库的Setting中，开启 Github Pages 会生成一个 <code>xxx.github.io/xx/</code> 的地址，地址有点长，我们可以使用自定义域名，这里我将 vue-chart 这个仓库设置成了自定义域名 vuechart.zuo11.com。然后，我们需要把自定义的域名解析到 github.com 地址。可以使用 ping github.com 来获取它的服务器 IP。</p> <p><img src="/images/daily/github_custom_domain.png" alt="github_custom_domain.png"></p> <p>获取 IP 后，我们到域名管理的位置，设置解析。</p> <ul><li>记录类型，就是域名的解析类型，最常见的是 <code>A</code> 类型，就是将域名解析到服务器 IP。<code>CNAME</code> 是将域名指向另一个域名</li> <li>主机记录，就是域名前缀，<code>@</code> 表示 xx.com，<code>www</code> 表示 <code>www.xx.com</code>，一般设置这两种。<code>mail</code> 表示 mail.xx.com，代表二级域名。</li></ul> <p><img src="/images/daily/github_custom_domain_2.png" alt="github_custom_domain_2.png"></p> <p>解析到 github IP 后，可以正常用域名访问到。但开启 https 后，证书有问题。这时提示需要配置 CNAME 解析。于是就配置成 CNAME 解析了。将 zuo11.com 的二级域名 vuechart 解析到 zuoxiaobia.github.io，这样就可以使用 https 访问了。而且证书正常。</p> <p><img src="/images/daily/github_custom_domain_3.png" alt="github_custom_domain_3.png"></p> <h3 id="xx-github-io仓库配置github-pages后对其他仓库的影响"><a href="#xx-github-io仓库配置github-pages后对其他仓库的影响" class="header-anchor">#</a> xx.github.io仓库配置Github pages后对其他仓库的影响</h3> <p>在 github 中，假设我们创建了 <code>github用户名.github.io</code> 仓库，开启 Github Pages 后，访问该域名，就指向了这个仓库的文件。这时如果你的其他仓库也开启了 Github Pages，那么对于的目录解析可能会有问题。</p> <p><img src="/images/daily/github_pages.png" alt="github_pages.png"></p> <p>以我的 github 账号 zuoxiaobai 为例，zuoxiaobai.github.io 这个仓库
开启pages后，如果 zuo-blog 仓库也开启 pages，那么访问 <code>https://zuoxiaobai.github.io/zuo-blog/</code> 并不能访问 /docs/index.html，而是提示404。需要访问 <code>xx/zuo-blog/index.html</code> 才行。这里我直接把 zuoxiaobai.github.io 的仓库关掉了Github Pages。这样 <code>/xx/zuo-blog/</code> 才能自动解析目录下的 index.html。</p> <h3 id="lodash-js打包后默认是整包-怎么按需打包-减少包体积"><a href="#lodash-js打包后默认是整包-怎么按需打包-减少包体积" class="header-anchor">#</a> lodash.js打包后默认是整包，怎么按需打包，减少包体积</h3> <p>在 vue-cli 打包 lib 项目时，发现包体积较大有 600多KB，于是使用 <code>-- report</code> 参数看具体是哪个包较大，发现尽管只用到了 lodash 的一个函数，但打包体积却有几百k，如下图，应该是整包打的，没有按需打包。</p> <p><img src="/images/daily/lodash_need_1.png" alt="lodash_need_1.png"></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 以 src/index.js 为入口，以库的形式打包到lib目录下，并生成 report.html</span>
vue-cli-service build --mode lib --target lib --dest lib --report src/index.js
</code></pre></div><p>以下是 打开 lib/项目名.umd-report.html 后，显示的各模块大小示意图</p> <p><img src="/images/daily/lodash_need_2.png" alt="lodash_need_2.png"></p> <p>这里借助 babel 的 loadsh 插件来进行按需打包。如果没有babel的配置文件，新建 .babelrc 文件，加入如下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .babelrc  使用 lodash 的babel插件</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>lodash 的 babel 插件就是 babel-plugin-lodash，需要先 npm 安装下</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> babel-plugin-lodash -D
</code></pre></div><p>ok后，重新打包，就是按需打包了。如下图，体积只有 100 多 KB 了。</p> <p><img src="/images/daily/lodash_need_3.png" alt="lodash_need_3.png"></p> <p>在来看看 report 信息，可以看到，只打包了使用到的函数</p> <p><img src="/images/daily/lodash_need_4.png" alt="lodash_need_4.png"></p> <h3 id="vue-cli-build-target-lib时如何避免打包成多个umd-js文件"><a href="#vue-cli-build-target-lib时如何避免打包成多个umd-js文件" class="header-anchor">#</a> vue-cli build --target lib时如何避免打包成多个umd.js文件</h3> <p>vue-cli项目中，一般我们使用的是 npm run build 来构建项目，并发布到线上。当我们写组件/工具库的时候，就需要使用 <code>--target lib</code> 参数了。</p> <p>打包成库与普通的构建应用不一样，它会在 dist目录下生成对应的 umd.js 文件，也就是通用模块定义的 js 文件。一般用于组件/工具库的入口文件，我们可以在静态 html 以及 vue-cli 等项目中直接引入并使用。<strong>如果不进行构建，只能在 vue-cli 项目中使用，无法引入一个 js 直接使用。</strong></p> <p>在项目中，运行打包命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 打包成库 Library，指定入口为 src/index.js，构建后生成目录为 lib 目录</span>
<span class="token comment"># --mode lib 不单独生成css，样式内联</span>
<span class="token comment"># --target lib 打包形式为 lib</span>
vue-cli-service build --mode lib --target lib --dest lib src/index.js
</code></pre></div><p>执行效果如下</p> <p><img src="/images/daily/multi_umd_1.png" alt="multi_umd_1.png"></p> <p>一般我们把 *.umd.js 引入到项目中就可以使用。但这里分包了。将 *.umd.js 文件，分了好几个小包。在普通 html 文件里面引入是可以正常运行的。他会根据 umd.js 找到需要加载的其他分包并加载。但在vue项目中只引入 *.umd.js，其他分包不会打包到项目中，导致无法运行。</p> <p>其实看上面的图，js 文件超过 77KB 左右就分块了。Gzipped 压缩后不到 12KB，我们完全可以将这些打包成一个 umd.js 文件，而不需要分多个文件。</p> <p>这里借助 webpack 的一个插件来配置 Chunk 数量，maxChunks  设置为 1，只打一个包，不分多个 js 文件。在 vue.config.js 里修改webpack 的配置。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 限制只打一个包，不分Chunk</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>LimitChunkCountPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxChunks<span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 当库里面引入了比较大的文件时，为了不影响主包大小，需要设置下该包使用外部引入</span>
    externals<span class="token operator">:</span> <span class="token punctuation">{</span>
      echarts<span class="token operator">:</span> <span class="token string">&quot;echarts&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这样设置后，再重新打包就正常了，只有一个包，各平台就都没问题了。而且 gzip 压缩后也才 14KB 不到。如下图</p> <p><img src="/images/daily/multi_umd_2.png" alt="multi_umd_2.png"></p> <p>扩展：</p> <p>如果想要了解对于 vue-cli 打包 <code>vue-cli-service --target lib</code> 的具体执行，可以看 Vue CLI 源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @vue/cli-service/lib/commands/build/index.js</span>
<span class="token comment">// Vue CLI源码，bulid 入口文件，lib时，配置处理</span>
<span class="token comment">// resolve raw webpack config</span>
<span class="token keyword">let</span> webpackConfig
<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">'lib'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./resolveLibConfig'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> args<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
<span class="token comment">// .....</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./resolveAppConfig'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> args<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// @vue/cli-service/lib/commands/build/resolveLibConfig.js</span>
<span class="token comment">// Vue CLI源码，lib 时 输入、输出文件配置</span>
rawConfig<span class="token punctuation">.</span>output <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  library<span class="token operator">:</span> libName<span class="token punctuation">,</span>
  libraryExport<span class="token operator">:</span> isVueEntry <span class="token operator">?</span> <span class="token string">'default'</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  libraryTarget<span class="token operator">:</span> format<span class="token punctuation">,</span>
  <span class="token comment">// preserve UDM header from webpack 3 until webpack provides either</span>
  <span class="token comment">// libraryTarget: 'esm' or target: 'universal'</span>
  <span class="token comment">// https://github.com/webpack/webpack/issues/6522</span>
  <span class="token comment">// https://github.com/webpack/webpack/issues/6525</span>
  globalObject<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(typeof self !== 'undefined' ? self : this)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> rawConfig<span class="token punctuation">.</span>output<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  filename<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entryName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  chunkFilename<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entryName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.[name].js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token comment">// use dynamic publicPath so this can be deployed anywhere</span>
  <span class="token comment">// the actual path will be determined at runtime by checking</span>
  <span class="token comment">// document.currentScript.src.</span>
  publicPath<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2020-10-17-周六"><a href="#_2020-10-17-周六" class="header-anchor">#</a> 2020/10/17 周六</h2> <h3 id="google广告一个页面怎么显示多个广告-多个广告只显示的一个是什么原因"><a href="#google广告一个页面怎么显示多个广告-多个广告只显示的一个是什么原因" class="header-anchor">#</a> Google广告一个页面怎么显示多个广告，多个广告只显示的一个是什么原因？</h3> <p>在 Google Adsense 中，理论上配置好广告形式后，获取代码，把对应的代码放到页面中就可以显示广告了。但发现，如果放多个广告，只有一个可以显示出来，下面来看看是为什么？</p> <p>官方提供的代码如下:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ins</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>adsbygoogle<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name">
     <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>block</span><span class="token punctuation">'</span></span>
     <span class="token attr-name">data-ad-client</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>ca-pub-9527676606416000<span class="token punctuation">'</span></span>
     <span class="token attr-name">data-ad-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>3653238000<span class="token punctuation">'</span></span>
     <span class="token attr-name">data-ad-format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>auto<span class="token punctuation">'</span></span>
     <span class="token attr-name">data-full-width-responsive</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
     <span class="token punctuation">(</span>adsbygoogle <span class="token operator">=</span> window<span class="token punctuation">.</span>adsbygoogle <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一般在验证开通 Google Adsense 时，就会引入第一行 script 代码。那么只需要把下面的 ins 元素 和 script 里的代码拷贝进页面里就行。</p> <p>当有多个广告时，我只拷贝了 多个 ins 到指定位置。 script 里面 <code>(adsbygoogle = window.adsbygoogle || []).push({});</code> 只放到了 body最后面的 script 里，这时只能显示一个广告。于是我看了下其他可以显示多个 google 广告的页面，打开源码后，发现最下面的 script 里的内容也要多次拷贝。也就是 <strong>如果页面上要放多个 google 广告，每次都需要引入 ins +  script 两部分的代码</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 广告 1 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ins</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>adsbygoogle<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value">ins内容简写</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">(</span>adsbygoogle <span class="token operator">=</span> window<span class="token punctuation">.</span>adsbygoogle <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 广告 2 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ins</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>adsbygoogle<span class="token punctuation">'</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value">ins内容简写</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">(</span>adsbygoogle <span class="token operator">=</span> window<span class="token punctuation">.</span>adsbygoogle <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_2020-10-11-周日"><a href="#_2020-10-11-周日" class="header-anchor">#</a> 2020/10/11 周日</h2> <h3 id="domcontentloaded与load时间具体指的是什么时间"><a href="#domcontentloaded与load时间具体指的是什么时间" class="header-anchor">#</a> DOMContentLoaded与Load时间具体指的是什么时间？</h3> <p>在 <a href="https://developers.google.com/web/tools/chrome-devtools/network/reference#load" target="_blank" rel="noopener noreferrer">Chrome DevTools 官网 Network Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 里是这样介绍的：</p> <p><img src="/images/daily/chrome_load_event.png" alt="chrome_load_events.png"></p> <p>View load events</p> <blockquote><p>DevTools displays the timing of the DOMContentLoaded and load events in multiple places on the Network panel. The DOMContentLoaded event is colored blue, and the load event is red.</p></blockquote> <p>来看看 <code>DOMContentLoaded</code> 和 <code>load</code> 事件在 MDN 的解释</p> <p><strong>DOMContentLoaded事件：window 和 document 上都可以监听，意思一致</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DOM fully loaded and parsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DOM fully loaded and parsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>The DOMContentLoaded event fires when the initial HTML document has been completely loaded and parsed, without waiting for stylesheets, images, and subframes to finish loading.</p></blockquote> <p><code>DOMContentLoaded</code> 事件：<strong>当 DOM (HTML document) 完成加载并解析，而不用等 css样式、图片和子 frame 完全加载完成时触发</strong></p> <p>同步 JS 会使 DOM 的解析暂停，如果希望用户在请求页面后尽快解析DOM，你可以把 JS 使用异步加载，并优化 css 样式加载方式。如果按照惯例加载，样式表和 JS 是并行加载的，会减慢 DOM 解析，窃取主html文档解析速度。下面是 head 中 script 默认加载以及加上 async, defer 参数的对比，一般把 script 放到 body 末尾，基本等价于 header 中 defer 的效果</p> <p><img src="/images/daily/script_load.png" alt="script_load.png"></p> <p><strong>load事件：window</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'page is fully loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'page is fully loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>The load event is fired when the whole page has loaded, including all dependent resources such as stylesheets and images. This is in contrast to DOMContentLoaded, which is fired as soon as the page DOM has been loaded, without waiting for resources to finish loading.</p></blockquote> <p><strong>当整个页面加载完成时（包括所有相关资源，例如css样式表和图片），这与 <code>DOMContentLoaded</code> 相反，它在页面DOM被加载后立即触发，而无需等待资源完成加载。</strong></p> <p>参考:</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/DOMContentLoaded_event" target="_blank" rel="noopener noreferrer">Window: DOMContentLoaded event | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/DOMContentLoaded_event" target="_blank" rel="noopener noreferrer">Document: DOMContentLoaded event<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/speed/docs/insights/OptimizeCSSDelivery" target="_blank" rel="noopener noreferrer">优化 css 加载方式 | Google developers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event" target="_blank" rel="noopener noreferrer">Window: load event | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="vue项目页面打开时间优化-从16秒到2秒内"><a href="#vue项目页面打开时间优化-从16秒到2秒内" class="header-anchor">#</a> vue项目页面打开时间优化：从16秒到2秒内</h3> <blockquote><p>Tag: vue-cli项目页面加载时间太长、npm run build 打包很大、vue vendor.js文件太大</p></blockquote> <p>在日常开发中，经常要写一些 demo 来测试一些功能，我专门弄了个 github 仓库来管理，方便沉淀积累。这次想着把 vue demo 部署到服务器，方便PC/手机实时看效果。于是把 vue-cli 项目 npm run build 后，将 dist 部署到服务器 nginx 下，但发现打开很慢，下面来看看</p> <p>如下图，DOM加载完 15秒，完全加载 16秒</p> <p><img src="/images/daily/vue_vendor_optimize_1.png" alt="vue_vendor_optimize_1.png"></p> <p>主要是 chunk-vendors.js 接近 1.7M，下载时间较长。npm run build 打包后 log 如下图(这是后面补的图，中间把路由懒加载改了下，size 会比上图里的小一点)，超出建议的 244kB</p> <p><img src="/images/daily/vue_vendor_optimize_2.png" alt="vue_vendor_optimize_2.png"></p> <p><strong>理论上，nginx 开启 gzip 成功后，文件大小应该是 600多kb，看最上面的 Chrome Network 图里面，vendors 是 1.7M，且 Content-Encoding 那一栏没有 gzip，说明 js,css文件没有开启 gzip</strong> 咱们配置下 nginx 服务，开启 gzip</p> <div class="language-bash extra-class"><pre class="language-bash"><code>server
<span class="token punctuation">{</span>
  server_name www.zuoguoqing.com<span class="token punctuation">;</span>

  <span class="token comment"># 开启gzip</span>
  <span class="token function">gzip</span> on<span class="token punctuation">;</span>
  gzip_vary on<span class="token punctuation">;</span>
  gzip_min_length <span class="token number">1000</span><span class="token punctuation">;</span>
  gzip_comp_level <span class="token number">2</span><span class="token punctuation">;</span>
  gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml image/jpeg image/gif image/png application/javascript<span class="token punctuation">;</span> 
  
  location / <span class="token punctuation">{</span>
    <span class="token comment"># root   html;</span>
    <span class="token comment"># index  index.html index.htm;</span>
    proxy_pass http://127.0.0.1:3000<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>咱们再来看看效果，如下图。vendors.js 文件从 1.7M 变为 600多k，且 Content-Type 那一栏也有了 gzip 标识。</p> <p><strong>下图可以看出 nginx 开启 gzip 压缩后，加载时间快了 5s。注意网上说的 compresion-webpack-plugin 插件在前端进行 gzip 在我看来基本是多此一举。nginx本身可以配置 gzip 功能，前端不用做 gzip 处理</strong></p> <p><img src="/images/daily/vue_vendor_optimize_3.png" alt="vue_vendor_optimize_3.png"></p> <p>11秒还是有点长，咱们想办法来减少 vendor.js 的体积看看，上面的图里面，gzip压缩后的 venders.js 有 613KB，加载也要 7秒多。</p> <p><strong>这里我们要使用 vue-cli(@vue/cli) 自带的 webpack 包体积优化工具，它可以查看各个模块的 size 大小，方便优化。只需要在 build 后面加上 --report 参数即可。我们把命令配置到 package.json 里，方便 npm run report 打包并生成 report</strong>，注意：网上很多说要先安装 webpack-bundle-analyzer 包，但不装也可以。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 加入下面一行</span>
  <span class="token string">&quot;report&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build --report&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>根据上面的配置后，运行 npm run report 后，会在 build 的同时，在 dist 目录会生成一个 report.html，打开后如下图，我们可以看到 ElementUI 和 Echarts 占用较大，直接打包了 node_modules 里面框架的内容。</p> <p><img src="/images/daily/vue_vendor_optimize_4.png" alt="vue_vendor_optimize_4.png"></p> <p><strong>这里我们可以把 Echarts 改为外部引用 cdn，不打包到主包 vendors.js 里，另外再把 Element改为懒加载，只加载使用到的部分模块</strong></p> <p>如果只把 Echarts 改为外部引入，ElementUI 整体引入，大概还有 1.4M 左右。Element 按需加载后就锐减了，提示大小就变为 596KB 了，如下图</p> <p><img src="/images/daily/vue_vendor_optimize_5.png" alt="vue_vendor_optimize_5.png"></p> <p>对应的 report.html 图如下，可以看到</p> <p><img src="/images/daily/vue_vendor_optimize_6.png" alt="vue_vendor_optimize_6.png"></p> <p>看完效果后，下面来看方法，怎么把 Echarts 外部引用，以及 Element 怎么按需加载。外部引入需要配置两个地方：</p> <ol><li>在 vue.config.js的configureWebpack.externals加入需要外部使用的包</li> <li>在 public/index.html 里引入对应的包</li></ol> <p>下面是 Echarts 外部引用需要配置的地方</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js </span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    externals<span class="token operator">:</span> <span class="token punctuation">{</span>
      echarts<span class="token operator">:</span> <span class="token string">&quot;echarts&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- public/index.html --&gt;</span>
<span class="token comment">&lt;!-- 写在 head 最下面或 body 最下面 --&gt;</span>
<span class="token comment">&lt;!-- echarts cdn --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/echarts/4.8.0/echarts-en.common.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>再来看看 Element 按需引入。注意 Element 按需引入，也需要两步</p> <ol><li>修改 main.js 里的 Element 引入方式，单个模块逐一引入</li> <li>按需引入，依赖的是 babel-plugin-component，vue-cli 项目已经带了对应的功能，在 babel.config.js 加入配置即可(官网提示是在 .babelrc ，如果vue-cli 项目,有了 babel.config.js 就在该文件配置)。 参考: <a href="https://element.eleme.cn/#/zh-CN/component/quickstart#an-xu-yin-ru" target="_blank" rel="noopener noreferrer">按需引入 | ElementUI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js </span>
<span class="token comment">// Element 完整引入</span>
<span class="token comment">// import ElementUI from &quot;element-ui&quot;;</span>
<span class="token comment">// Vue.use(ElementUI);</span>
<span class="token comment">// Element 按需引入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Input<span class="token punctuation">,</span>
  Button<span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;element-ui/lib/theme-chalk/index.css&quot;</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Input<span class="token punctuation">)</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// babel.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@vue/cli-plugin-babel/preset&quot;</span><span class="token punctuation">]</span>
  <span class="token comment">// element 按需引入</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;component&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        libraryName<span class="token operator">:</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">,</span>
        styleLibraryName<span class="token operator">:</span> <span class="token string">&quot;theme-chalk&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>这样设置后，从原来的 1.8M 优化到了 596KB，再来看看加载时间，如下图。只需要 3.6s 了，整整快了 7~8s</p> <p><img src="/images/daily/vue_vendor_optimize_7.png" alt="vue_vendor_optimize_7.png"></p> <p>如上图所示，<strong>echarts 外部引入的js使用了 cdn，且开启了 gzip，只有 168KB，加载时间仅 65ms，而我的 vendors.js gzip压缩后只有 122KB，下载时间较长，加载用了 2.23s，我部署的服务器是入门级的较慢，还是 cdn 快</strong>。另外 vendors.css 里面有 Element 的 css 文件，咱们也换成外部引入 cdn 试试</p> <p>修改 main.js，不按需引入 Element。把 Element 的 css 也放到外部引入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// import &quot;element-ui/lib/theme-chalk/index.css&quot;;</span>
</code></pre></div><p>修改 vue.config.js，设置 vue、ElementUI 外部引用</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    externals<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 需要使用外部引入的包名：包名</span>
      echarts<span class="token operator">:</span> <span class="token string">&quot;echarts&quot;</span><span class="token punctuation">,</span> 
      vue<span class="token operator">:</span> <span class="token string">&quot;Vue&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 注意 vue需要外部引入。放到 echarts前面，防止 console 报错</span>
      <span class="token comment">// element: &quot;ElementUI&quot; 可以打包成功，但chunk-vendors.js里面会打包element</span>
      <span class="token string">&quot;element-ui&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ELEMENT&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>去掉 babel.config.js 里面 Element 按需引入代码，修改 public/index.html，直接head里面引入</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- pbulic/index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 引入Element css --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui/lib/theme-chalk/index.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- echarts --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/echarts/4.8.0/echarts-en.common.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 引入vue --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 引入Element js --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>把 Element 和 vue 都改为外部引入后，再来看看，如下图，完全没警告了，低于 244KB，vendors.js 只有 68 KB</p> <p><img src="/images/daily/vue_vendor_optimize_8.png" alt="vue_vendor_optimize_8.png"></p> <p>对应的 report.html 图如下，其实吧 vue-router、vuex 也使用 cdn 可能 vendor 会更小，但感觉不是很必要了。vendors.js 已经很小了</p> <p><img src="/images/daily/vue_vendor_optimize_9.png" alt="vue_vendor_optimize_9.png"></p> <p>再来看看加载时间，还是要 3s 多 ？？？ 可以明显的看到 index.css 是 ElementUI 的 css，这个官方推荐的 unpkg cdn 有点慢，不是 gzip的压缩，是 br 的压缩方式。 32.7k 要 1.33s。（下图里面是 2.5s，其实整体是 3s 多，ElementUI的 JS 我已经换为了 bootcdn。之前的图压缩时不小心被覆盖了。）</p> <p><img src="/images/daily/vue_vendor_optimize_10.png" alt="vue_vendor_optimize_10.png"></p> <p>这里我们再把 Element css 也替换为 bootcdn 连接，连接如下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/element-ui/2.9.2/theme-chalk/index.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/element-ui/2.9.2/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>替换后再来看看效果，整体 loaded 只要 1.89s 了。</p> <p><img src="/images/daily/vue_vendor_optimize_11.png" alt="vue_vendor_optimize_11.png"></p> <p>上面的图，是取的均值。再次刷新可能会低于 1s，也可能会高于。我这里在测试时都勾选了 Disable cache。就是不使用缓存，有时候可能 dns 解析，https 验证时间、服务器响应时间会有差别。</p> <p><img src="/images/daily/vue_vendor_optimize_12.png" alt="vue_vendor_optimize_12.png"></p> <h3 id="vue-cannot-read-property-prototype-of-undefined"><a href="#vue-cannot-read-property-prototype-of-undefined" class="header-anchor">#</a> vue Cannot read property 'prototype' of undefined</h3> <p>由于 vue 项目 npm run build 打包时 ElementUI 体积较大，因此把他单独抽离出去。放到 public/index.html 里直接引入。但抽离出去后发现启动后控制台会报这样一个错误：Cannot read property 'prototype' of undefined。</p> <p><img src="/images/daily/vue_prototype_undefined.png" alt="vue_prototype_undefined.png"></p> <p>网上查了下，是在 public/index.html 里引入 Element JS script 的前面，没有加入 Vue.js 的引入照成的。这里我们加入 Vue.js 的引入即可。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- public/index.html --&gt;</span>
<span class="token comment">&lt;!-- 引入element组件js前加入vue的引入 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/element-ui/2.9.2/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 vue.config.js 里设置 ElementUI以及JS使用外部引入</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    externals<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 需要使用外部引入的包名：包名</span>
      vue<span class="token operator">:</span> <span class="token string">&quot;Vue&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;element-ui&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ELEMENT&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vue-config-js-plugins-is-not-allowed"><a href="#vue-config-js-plugins-is-not-allowed" class="header-anchor">#</a> vue.config.js: &quot;plugins&quot; is not allowed</h3> <p>在vue.config.js中，webpack 相关的配置需要写到 configureWebpack 里，不能直接写到外面</p> <p><img src="/images/daily/vue_config_js_plugins.png" alt="vue_config_js_plugins.png"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// error，&quot;plugins&quot; is not allowed</span>
  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    externals<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vue中文本-功能实现"><a href="#vue中文本-功能实现" class="header-anchor">#</a> vue中文本@功能实现</h3> <p>如果自己写一个@功能会比较麻烦，在 github 上找了一个现成的开源库：<a href="https://github.com/zurb/tribute" target="_blank" rel="noopener noreferrer">Tribute<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ES6 Native @mentions，它是ES 原生的实现，社区有各种框架的实现。这里我们使用它的 vue 实现 <a href="https://github.com/syropian/vue-tribute" target="_blank" rel="noopener noreferrer">vue-tribute<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。下图是实现效果</p> <p><img src="/images/daily/vue_at_mention.gif" alt="vue_at_mention.gif"></p> <p>在线示例：https://www.zuoguoqing.com/at 对应的 vue 代码如下，需要注意的地方</p> <ol><li>我们引入 vue-tribute 组件，传入 options 即可</li> <li>样式方面，需要写弹出选择框的样式，不然就没有样式</li> <li>options 的配置完全是 Tribute 的配置，到对应的 github 上查找即可，options的可选值支持动态渲染，支持从接口取</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>contenteditable @mentions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vue-tribute</span> <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>options<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content-editable<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">contenteditable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>valueChange<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@...<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vue-tribute</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>纯文本textContent：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ textContent }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>富文本innerHTML：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ innerHTML }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> VueTribute <span class="token keyword">from</span> <span class="token string">&quot;vue-tribute&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    VueTribute
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      textContent<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      innerHTML<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        trigger<span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// specify whether a space is required before the trigger string</span>
        requireLeadingSpace<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        noMatchTemplate<span class="token operator">:</span> <span class="token string">&quot;&lt;li&gt;暂无数据&lt;/li&gt;&quot;</span><span class="token punctuation">,</span>
        values<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&quot;张三 zhangsan&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&quot;李四 lisi&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;李四&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&quot;王五 wangwu&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;王五&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&quot;周杰伦 zhoujielun&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;周杰伦&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        positionMenu<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function-variable function">selectTemplate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token string">'&lt;span contenteditable=&quot;false&quot;&gt;&lt;a&gt;'</span> <span class="token operator">+</span>
            <span class="token string">&quot;@&quot;</span> <span class="token operator">+</span>
            item<span class="token punctuation">.</span>original<span class="token punctuation">.</span>value <span class="token operator">+</span>
            <span class="token string">&quot;&lt;/a&gt;&lt;/span&gt;&quot;</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">noMatchFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;暂无数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">valueChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
// Tribute-specific styles 略
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>完整代码参见：<a href="https://github.com/zuoxiaobai/fedemo/blob/master/src/vuecli-demo/src/views/at/index.vue" target="_blank" rel="noopener noreferrer">vue @功能实现demo | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-10-06-周二"><a href="#_2020-10-06-周二" class="header-anchor">#</a> 2020/10/06 周二</h2> <h3 id="docker持续集成与自动化部署"><a href="#docker持续集成与自动化部署" class="header-anchor">#</a> Docker持续集成与自动化部署</h3> <p>最近看了下 Docker，整理了相关笔记，参考 <a href="https://www.yuque.com/guoqzuo/rdrqd5/wwxcki" target="_blank" rel="noopener noreferrer">Docker持续集成自动化部署<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-10-04-周日"><a href="#_2020-10-04-周日" class="header-anchor">#</a> 2020/10/04 周日</h2> <h3 id="pm2-process-yml-you-cannot-define-a-mapping-item-when-in-a-sequence"><a href="#pm2-process-yml-you-cannot-define-a-mapping-item-when-in-a-sequence" class="header-anchor">#</a> pm2 process.yml You cannot define a mapping item when in a sequence</h3> <p>使用 pm2 运行 node 项目，<code>pm2 start process.yml</code> 后提示 You cannot define a mapping item when in a sequence，是 process.yml 配置文件的问题，修改下配置文件即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// cat process.yml</span>
apps<span class="token operator">:</span>
  <span class="token operator">-</span> script<span class="token operator">:</span> app<span class="token punctuation">.</span>js 
  instances<span class="token operator">:</span> <span class="token number">2</span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span>
  env<span class="token operator">:</span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> production
</code></pre></div><p>将 <code>- script: app.js</code> 改为 <code>script: app.js</code> 重新运行就可以了</p> <p>参考: <a href="https://stackoverflow.com/questions/16482875/you-cannot-define-a-mapping-item-when-in-a-sequence-when-running-phpunit-in-sy" target="_blank" rel="noopener noreferrer">“You cannot define a mapping item when in a sequence” when running phpunit in symfony
| Stack overflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-10-01-周四"><a href="#_2020-10-01-周四" class="header-anchor">#</a> 2020/10/01 周四</h2> <h3 id="let-s-encrypt-免费https证书"><a href="#let-s-encrypt-免费https证书" class="header-anchor">#</a> Let’s Encrypt 免费HTTPS证书</h3> <p><a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let’s Encrypt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个非盈利TLS（Transport Layer Security) 证书颁发机构（CA），免费提供 https 证书。</p> <p>由于 Let’s Encrypt 证书的有效期为 3 个月，所以一般使用程序来自动续期更换证书。官方推荐使用 Certbot 来管理，它可以一站式申请、续期证书。</p> <p>在 <a href="https://certbot.eff.org/" target="_blank" rel="noopener noreferrer">Certbot 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 选择部署服务器使用的软件及系统，会自动列出需要操作的步骤，如下图</p> <p><img src="/images/daily/https_cert_1.png" alt="https_cert_1.png"></p> <p>注意文档里面分了两种：</p> <ol><li>单个域名，仅单个 https 比如 <code>https://xx.com</code> 或 <code>https://www.xx.com</code></li> <li>通配符(Wildcard)证书，支持多个二级域名 <code>https://*.xx.com</code>，但不支持 <code>https://xx.com</code></li></ol> <p>一般我们写好 nginx.conf 的配置，certbot 会根据 server_name 自动识别域名，并申请安装证书</p> <p>这里把两个域名进行 https 处理，分别是 <code>https:/www.zuoguoqing.com</code> 和 <code>https://api.zuoguoqing.com</code></p> <p>需要写两个 nginx 配置文件，分别对应下面两个文件，如果还有其他二级域名可以再增加配置文件</p> <ul><li>/etc/nginx/conf.d/docker.conf  这里是 www 二级域名</li> <li>/etc/nginx/conf.d/api.conf 这里是 api 二级域名的nginx配置</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/nginx/conf.d/docker.conf </span>
server
<span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name www.zuoguoqing.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># /etc/nginx/conf.d/api.conf </span>
server
<span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name api.zuoguoqing.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>开始安装 certbot，并执行</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 登录到 ubuntu linux 服务器</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> snapd
<span class="token function">sudo</span> snap <span class="token function">install</span> core<span class="token punctuation">;</span> <span class="token function">sudo</span> snap refresh core
<span class="token function">sudo</span> <span class="token function">apt-get</span> remove certbot
<span class="token function">sudo</span> dnf remove certbot
<span class="token function">sudo</span> snap <span class="token function">install</span> --classic certbot
<span class="token function">sudo</span> <span class="token function">ln</span> -s /snap/bin/certbot /usr/bin/certbot
<span class="token comment"># 获取并安装证书</span>
<span class="token function">sudo</span> certbot --nginx
</code></pre></div><p><img src="/images/daily/https_cert_2.png" alt="https_cert_2.png"></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 测试续订</span>
<span class="token function">sudo</span> certbot renew --dry-run
</code></pre></div><p>3个月有效期自动续订测试，提示了个 <code>Python 3.8 OSError: [Errno 101] Network is unreachable</code>，但提示又是续订测试成功。只有后面再看是否有问题</p> <p>来看看 certbot 自动修改的 nginx 配置，会有 managed by Certbot 注释，后面我又加了一些基本的重定向配置</p> <p>/etc/nginx/conf.d/docker.conf</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/nginx/conf.d/docker.conf </span>
server
<span class="token punctuation">{</span>
    server_name www.zuoguoqing.com<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
      <span class="token comment"># root   html;</span>
      <span class="token comment"># index  index.html index.htm;</span>
      proxy_pass http://127.0.0.1:3000<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listen <span class="token number">443</span> ssl http2<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/www.zuoguoqing.com/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/www.zuoguoqing.com/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    include /etc/letsencrypt/options-ssl-nginx.conf<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>


<span class="token punctuation">}</span>

server
<span class="token punctuation">{</span>
    server_name zuoguoqing.com<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> zuoguoqing.com<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> <span class="token number">301</span> https://www.<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
<span class="token punctuation">}</span>

server
<span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> zuoguoqing.com<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> <span class="token number">301</span> https://www.<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name zuoguoqing.com<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> www.zuoguoqing.com<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment"># managed by Certbot</span>


    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name www.zuoguoqing.com<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>


<span class="token punctuation">}</span>
</code></pre></div><p>/etc/nginx/conf.d/api.conf</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#  /etc/nginx/conf.d/api.conf </span>
server
<span class="token punctuation">{</span>
    server_name api.zuoguoqing.com<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
      <span class="token comment"># root   html;</span>
      <span class="token comment"># index  index.html index.htm;</span>
      proxy_pass http://127.0.0.1:8700<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/www.zuoguoqing.com/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/www.zuoguoqing.com/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    include /etc/letsencrypt/options-ssl-nginx.conf<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>

<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    server_name api.zuoguoqing.com<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> <span class="token string">'api.zuoguoqing.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参考:</p> <ul><li><a href="https://blog.fundebug.com/2018/07/06/apply-lets-encrypt-certificate/" target="_blank" rel="noopener noreferrer">教你快速撸一个免费HTTPS证书 | FunDebug<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="http-2-怎么确定网站是否开启了http-2-http-3"><a href="#http-2-怎么确定网站是否开启了http-2-http-3" class="header-anchor">#</a> HTTP/2，怎么确定网站是否开启了HTTP/2，HTTP/3？</h3> <p>HTTP/2是新一代的HTTP协议，于2015正式发布。相对 HTTP/1来说，大幅提升了网页性能，绝大多数浏览器都支持了HTTP/2。</p> <p>http怎么开启http2呢？HTTP/2 现阶段必须使用https，80端口就不要想了。参考: <a href="https://ziyuan.baidu.com/wiki/786" target="_blank" rel="noopener noreferrer">拥抱HTTP2.0时代，让网站飞起来 | 百度站长<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>HTTP/1.1 的缺陷</p> <ul><li>连接无法复用，每次请求都经历三次握手和慢启动
<ul><li>HTTP/1.0 传输数据时，每次都需要重新建立连接，增加延迟。</li> <li>HTTP/1.1 虽然加入 keep-alive 可以复用一部分连接，但域名分片等情况下仍然需要建立多个 connection，耗费资源，给服务器带来性能压力。</li></ul></li> <li>队头阻塞(Head-Of-Line Blocking,HOLB)，并发请求数量限制
<ul><li>当页面中需要请求很多资源的时候，HOLB（队头阻塞）会导致在达到最大请求数量时，剩余的资源需要等待其他资源请求完成后才能发起请求。</li> <li>HTTP 1.0：下个请求必须在前一个请求返回后才能发出，request-response对按序发生。显然，如果某个请求长时间没有返回，那么接下来的请求就全部阻塞了。</li> <li>HTTP 1.1：尝试使用 pipeling 来解决，即浏览器可以一次性发出多个请求（同个域名，同一条 TCP 链接）。但 pipeling 要求返回是按序的，那么前一个请求如果很耗时（比如处理大图片），那么后面的请求即使服务器已经处理完，仍会等待前面的请求处理完才开始按序返回。所以，pipeling 只部分解决了 HOLB。</li></ul></li> <li>协议开销大，header 里携带的内容过大，在一定程度上增加了传输的成本，并且每次请求 header 基本不怎么变化，尤其在移动端增加用户流量。</li> <li>安全因素，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份，这在一定程度上无法保证数据的安全性</li></ul> <p>HTTP/2 就是为了解决 HTTP/1 存在的问题而产生的</p> <ul><li>二进制传输，HTTP/1.1传输的是文本数据，而HTTP/2传输的是二进制数据，提高了数据传输效率。</li> <li>多路复用，多个HTTP请求可以复用同一个TCP连接。解决了浏览器限制同一个域名下的请求数量的问题，减少额外的3次握手开销。</li> <li>压缩请求头(Header)，减少重复发送相同的请求头</li> <li>支持服务器推送(Server push)，允许在请求之前先响应数据到客户端（之前请求过的数据），可以加快css/js等资源加载速度</li></ul> <p>开启 HTTP/2 只需要在 listen 443 ssl 后面加上 http2 即可，可以使用 curl -I 进行测试看HTTP/2是否生效</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/nginx/conf.d/docker.conf </span>
server
<span class="token punctuation">{</span>
    server_name www.zuoguoqing.com<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
      proxy_pass http://127.0.0.1:3000<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listen <span class="token number">443</span> ssl http2<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/www.zuoguoqing.com/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/www.zuoguoqing.com/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    include /etc/letsencrypt/options-ssl-nginx.conf<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
<span class="token punctuation">}</span>
</code></pre></div><p>来看看 HTTP/1.1 和 HTTP/2 的测试对比</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -I www.zuo11.com
<span class="token comment"># HTTP/1.1 200 OK</span>
<span class="token comment"># Server: nginx/1.16.1</span>
<span class="token comment"># Date: Thu, 08 Oct 2020 09:08:55 GMT</span>
<span class="token comment"># Content-Type: text/html; charset=utf-8</span>
<span class="token comment"># Content-Length: 3666</span>
<span class="token comment"># Last-Modified: Thu, 01 Oct 2020 15:02:42 GMT</span>
<span class="token comment"># Connection: keep-alive</span>
<span class="token comment"># Vary: Accept-Encoding</span>
<span class="token comment"># ETag: &quot;5f75ef92-e52&quot;</span>
<span class="token comment"># Accept-Ranges: bytes</span>

<span class="token function">curl</span> -I https://www.zuoguoqing.com
<span class="token comment"># HTTP/2 200 </span>
<span class="token comment"># server: nginx/1.14.0 (Ubuntu)</span>
<span class="token comment"># date: Thu, 08 Oct 2020 09:09:07 GMT</span>
<span class="token comment"># content-type: text/html</span>
<span class="token comment"># content-length: 213</span>
<span class="token comment"># last-modified: Wed, 07 Oct 2020 09:03:03 GMT</span>
<span class="token comment"># etag: &quot;5f7d8447-d5&quot;</span>
<span class="token comment"># accept-ranges: bytes</span>
</code></pre></div><p><strong>HTTP/2够好了，为什么还会有 HTTP/3？</strong></p> <p>HTTP/2 的问题在于，其底层支撑协议为 TCP，在丢包的情况下，多个请求复用一个 TCP 连接时，整个 TCP 都要开始等待重传，也就导致了后面的所有数据都被阻塞了。这时 HTTP/2 效果可能还不如 HTTP/1</p> <p>因此，Google 又弄了一个基于 UDP 协议的 QUIC 协议，是 HTTP/3中的底层支撑协议，又取了 TCP 中的精华，实现了即快又可靠的协议。</p> <ul><li>通过提高链接利用效率减少 RTT（Round Trip Time，通俗地说，就是通信一来一回的时间），提高数据交互速度。</li> <li>在第一条的基础上，囊括安全需求。</li> <li>解决当前实际网络环境中的适配问题</li></ul> <p>参考</p> <ul><li><a href="https://blog.fundebug.com/2019/03/07/understand-http2-and-http3/" target="_blank" rel="noopener noreferrer">一文读懂 HTTP/2 及 HTTP/3 特性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://kiwenlau.com/2019/10/28/speedup-fundebug-by-using-http2/" target="_blank" rel="noopener noreferrer">Fundebug网站升级HTTP/2，真的变快了！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/40595473" target="_blank" rel="noopener noreferrer">HTTP/2之服务器推送(Server Push)最佳实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/302412059" target="_blank" rel="noopener noreferrer">如何看待 HTTP/3 ？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/9/2020, 5:16:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daily/2020-11.html" class="prev">
        2020年11月技术日常
      </a></span> <span class="next"><a href="/daily/2020-09.html">
        2020年09月技术日常
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.05304cd4.js" defer></script><script src="/assets/js/2.4b3539f1.js" defer></script><script src="/assets/js/45.ed0f9610.js" defer></script><script src="/assets/js/3.e6a4dd76.js" defer></script>
  </body>
</html>
