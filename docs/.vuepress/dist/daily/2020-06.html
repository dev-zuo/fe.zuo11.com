<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2020年06月技术日常 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="左小白的前端笔记，归纳整理自己在前端工作、学习中的一些心得笔记，有利于前端知识系统化。包括 Vue.js、前端工程化（TypeScript、Node.js、webpack）、Docker、JS/ES6、CSS/CSS3、HTML/HTML5、数据可视化、计算机基础、英语等笔记。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.c896736b.css" as="style"><link rel="preload" href="/assets/js/app.aea08731.js" as="script"><link rel="preload" href="/assets/js/2.3f8a6b0b.js" as="script"><link rel="preload" href="/assets/js/42.154c7e55.js" as="script"><link rel="preload" href="/assets/js/3.018b29e2.js" as="script"><link rel="prefetch" href="/assets/js/10.57230952.js"><link rel="prefetch" href="/assets/js/100.0f8b8510.js"><link rel="prefetch" href="/assets/js/101.01cd1b80.js"><link rel="prefetch" href="/assets/js/102.46cc25e7.js"><link rel="prefetch" href="/assets/js/103.5b9d1b0c.js"><link rel="prefetch" href="/assets/js/104.25e9bd43.js"><link rel="prefetch" href="/assets/js/105.96ae6579.js"><link rel="prefetch" href="/assets/js/106.6607dd73.js"><link rel="prefetch" href="/assets/js/107.94e14f3f.js"><link rel="prefetch" href="/assets/js/108.5633630c.js"><link rel="prefetch" href="/assets/js/109.dbc7f4ca.js"><link rel="prefetch" href="/assets/js/11.9dc4d318.js"><link rel="prefetch" href="/assets/js/110.52b6cb6d.js"><link rel="prefetch" href="/assets/js/111.53b0c9b7.js"><link rel="prefetch" href="/assets/js/112.a7a510a2.js"><link rel="prefetch" href="/assets/js/113.8f779566.js"><link rel="prefetch" href="/assets/js/114.09e9fb91.js"><link rel="prefetch" href="/assets/js/115.d3d367a9.js"><link rel="prefetch" href="/assets/js/116.dfe7231d.js"><link rel="prefetch" href="/assets/js/117.480ab03a.js"><link rel="prefetch" href="/assets/js/118.20193bbe.js"><link rel="prefetch" href="/assets/js/119.475d5b5a.js"><link rel="prefetch" href="/assets/js/12.f053a222.js"><link rel="prefetch" href="/assets/js/120.9ddf00b0.js"><link rel="prefetch" href="/assets/js/121.07aecd62.js"><link rel="prefetch" href="/assets/js/122.939a73d8.js"><link rel="prefetch" href="/assets/js/123.ffc0973f.js"><link rel="prefetch" href="/assets/js/124.0d9f5d5c.js"><link rel="prefetch" href="/assets/js/125.92fc58c1.js"><link rel="prefetch" href="/assets/js/126.32b088e4.js"><link rel="prefetch" href="/assets/js/127.6bf4a0fd.js"><link rel="prefetch" href="/assets/js/128.b565cc40.js"><link rel="prefetch" href="/assets/js/129.a2103f6e.js"><link rel="prefetch" href="/assets/js/13.986f7498.js"><link rel="prefetch" href="/assets/js/130.a57f2f1c.js"><link rel="prefetch" href="/assets/js/131.dc7cd795.js"><link rel="prefetch" href="/assets/js/132.2fe1fc61.js"><link rel="prefetch" href="/assets/js/133.5ffb92a3.js"><link rel="prefetch" href="/assets/js/134.bc019c4d.js"><link rel="prefetch" href="/assets/js/135.2154128f.js"><link rel="prefetch" href="/assets/js/136.aab6fa01.js"><link rel="prefetch" href="/assets/js/137.df57a438.js"><link rel="prefetch" href="/assets/js/138.98f86f10.js"><link rel="prefetch" href="/assets/js/139.adc8ae06.js"><link rel="prefetch" href="/assets/js/14.1898890b.js"><link rel="prefetch" href="/assets/js/140.8b1eb51d.js"><link rel="prefetch" href="/assets/js/141.aa5fe296.js"><link rel="prefetch" href="/assets/js/142.3b80d208.js"><link rel="prefetch" href="/assets/js/143.a241ab25.js"><link rel="prefetch" href="/assets/js/144.da557ab1.js"><link rel="prefetch" href="/assets/js/145.29e965d6.js"><link rel="prefetch" href="/assets/js/146.e3b514f9.js"><link rel="prefetch" href="/assets/js/147.883ee835.js"><link rel="prefetch" href="/assets/js/148.254226ea.js"><link rel="prefetch" href="/assets/js/149.432fe3a3.js"><link rel="prefetch" href="/assets/js/15.5469b4a1.js"><link rel="prefetch" href="/assets/js/150.32707229.js"><link rel="prefetch" href="/assets/js/151.55ed235a.js"><link rel="prefetch" href="/assets/js/152.a0961a89.js"><link rel="prefetch" href="/assets/js/153.01a17e73.js"><link rel="prefetch" href="/assets/js/154.3cab5dca.js"><link rel="prefetch" href="/assets/js/155.b38f80af.js"><link rel="prefetch" href="/assets/js/156.2a98ddc9.js"><link rel="prefetch" href="/assets/js/157.6532cea6.js"><link rel="prefetch" href="/assets/js/158.17a38cf8.js"><link rel="prefetch" href="/assets/js/159.0db8580d.js"><link rel="prefetch" href="/assets/js/16.b46ab2d4.js"><link rel="prefetch" href="/assets/js/160.39ce3a9d.js"><link rel="prefetch" href="/assets/js/161.ebc27f72.js"><link rel="prefetch" href="/assets/js/162.3530d9ce.js"><link rel="prefetch" href="/assets/js/163.2876628d.js"><link rel="prefetch" href="/assets/js/164.2d10c49f.js"><link rel="prefetch" href="/assets/js/17.20b93dac.js"><link rel="prefetch" href="/assets/js/18.1773280f.js"><link rel="prefetch" href="/assets/js/19.043092b9.js"><link rel="prefetch" href="/assets/js/20.67b2e7ac.js"><link rel="prefetch" href="/assets/js/21.d8349b66.js"><link rel="prefetch" href="/assets/js/22.bae760a2.js"><link rel="prefetch" href="/assets/js/23.31599c16.js"><link rel="prefetch" href="/assets/js/24.5bbdd298.js"><link rel="prefetch" href="/assets/js/25.059eebcd.js"><link rel="prefetch" href="/assets/js/26.98142d7d.js"><link rel="prefetch" href="/assets/js/27.242fb841.js"><link rel="prefetch" href="/assets/js/28.ada66cb3.js"><link rel="prefetch" href="/assets/js/29.ee6d44fc.js"><link rel="prefetch" href="/assets/js/30.1404a72f.js"><link rel="prefetch" href="/assets/js/31.7db04ede.js"><link rel="prefetch" href="/assets/js/32.ff88cb29.js"><link rel="prefetch" href="/assets/js/33.3872e844.js"><link rel="prefetch" href="/assets/js/34.8528d11c.js"><link rel="prefetch" href="/assets/js/35.8bc50305.js"><link rel="prefetch" href="/assets/js/36.9bf7c6ff.js"><link rel="prefetch" href="/assets/js/37.bfa76084.js"><link rel="prefetch" href="/assets/js/38.2e4e4f00.js"><link rel="prefetch" href="/assets/js/39.72298233.js"><link rel="prefetch" href="/assets/js/4.fc8623a4.js"><link rel="prefetch" href="/assets/js/40.9b113905.js"><link rel="prefetch" href="/assets/js/41.966fbd83.js"><link rel="prefetch" href="/assets/js/43.82c0efdd.js"><link rel="prefetch" href="/assets/js/44.b09d1cf3.js"><link rel="prefetch" href="/assets/js/45.5783826e.js"><link rel="prefetch" href="/assets/js/46.3e3f4738.js"><link rel="prefetch" href="/assets/js/47.5b1c7435.js"><link rel="prefetch" href="/assets/js/48.3989e8b0.js"><link rel="prefetch" href="/assets/js/49.a66a16bf.js"><link rel="prefetch" href="/assets/js/5.5f97339e.js"><link rel="prefetch" href="/assets/js/50.1b48b123.js"><link rel="prefetch" href="/assets/js/51.ecaa83a0.js"><link rel="prefetch" href="/assets/js/52.987463fe.js"><link rel="prefetch" href="/assets/js/53.fbf93c52.js"><link rel="prefetch" href="/assets/js/54.4b05e141.js"><link rel="prefetch" href="/assets/js/55.49b4ea5b.js"><link rel="prefetch" href="/assets/js/56.6a21abce.js"><link rel="prefetch" href="/assets/js/57.bc7b034b.js"><link rel="prefetch" href="/assets/js/58.a2c22899.js"><link rel="prefetch" href="/assets/js/59.3bdb17f6.js"><link rel="prefetch" href="/assets/js/6.8b6802aa.js"><link rel="prefetch" href="/assets/js/60.e31b8e43.js"><link rel="prefetch" href="/assets/js/61.1a450398.js"><link rel="prefetch" href="/assets/js/62.8d214e4b.js"><link rel="prefetch" href="/assets/js/63.dd8a3381.js"><link rel="prefetch" href="/assets/js/64.3261510d.js"><link rel="prefetch" href="/assets/js/65.2f610ffa.js"><link rel="prefetch" href="/assets/js/66.227ada19.js"><link rel="prefetch" href="/assets/js/67.40ac9dcd.js"><link rel="prefetch" href="/assets/js/68.53912b8a.js"><link rel="prefetch" href="/assets/js/69.7fa926e5.js"><link rel="prefetch" href="/assets/js/7.55c6af5e.js"><link rel="prefetch" href="/assets/js/70.38fc9578.js"><link rel="prefetch" href="/assets/js/71.90f7da46.js"><link rel="prefetch" href="/assets/js/72.d76610ae.js"><link rel="prefetch" href="/assets/js/73.7971d882.js"><link rel="prefetch" href="/assets/js/74.aa48ee7b.js"><link rel="prefetch" href="/assets/js/75.88e9f802.js"><link rel="prefetch" href="/assets/js/76.49e518d0.js"><link rel="prefetch" href="/assets/js/77.cb055f39.js"><link rel="prefetch" href="/assets/js/78.e7e9107d.js"><link rel="prefetch" href="/assets/js/79.8ff34b88.js"><link rel="prefetch" href="/assets/js/8.143ffc63.js"><link rel="prefetch" href="/assets/js/80.af5bfd6d.js"><link rel="prefetch" href="/assets/js/81.b1bc6095.js"><link rel="prefetch" href="/assets/js/82.458d942f.js"><link rel="prefetch" href="/assets/js/83.90fc3d40.js"><link rel="prefetch" href="/assets/js/84.d115314a.js"><link rel="prefetch" href="/assets/js/85.457c338a.js"><link rel="prefetch" href="/assets/js/86.614ce1bc.js"><link rel="prefetch" href="/assets/js/87.b225f160.js"><link rel="prefetch" href="/assets/js/88.54ced39c.js"><link rel="prefetch" href="/assets/js/89.4547f598.js"><link rel="prefetch" href="/assets/js/9.4e36b672.js"><link rel="prefetch" href="/assets/js/90.9e592a2d.js"><link rel="prefetch" href="/assets/js/91.53f5f4fa.js"><link rel="prefetch" href="/assets/js/92.4a311c3f.js"><link rel="prefetch" href="/assets/js/93.d6bbbc9b.js"><link rel="prefetch" href="/assets/js/94.2a069bf7.js"><link rel="prefetch" href="/assets/js/95.4510e613.js"><link rel="prefetch" href="/assets/js/96.13a8e5fe.js"><link rel="prefetch" href="/assets/js/97.50808ce9.js"><link rel="prefetch" href="/assets/js/98.62145787.js"><link rel="prefetch" href="/assets/js/99.1e547bc8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c896736b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link router-link-active">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/mocha-test.html" class="nav-link">
  Mocha - JavaScript测试框架
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zuoxiaobai/service-monitor" target="_blank" rel="noopener noreferrer" class="nav-link external">
  service-monitor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link router-link-active">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/js-data-struct.html" class="nav-link">
  学习JavaScript数据结构与算法(第三版)笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/mocha-test.html" class="nav-link">
  Mocha - JavaScript测试框架
</a></li><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zuoxiaobai/service-monitor" target="_blank" rel="noopener noreferrer" class="nav-link external">
  service-monitor
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daily/" aria-current="page" class="sidebar-link">技术日常记录</a></li><li><a href="/daily/2021-05.html" class="sidebar-link">2021年05月技术日常</a></li><li><a href="/daily/2021-04.html" class="sidebar-link">2021年04月技术日常</a></li><li><a href="/daily/2021-03.html" class="sidebar-link">2021年03月技术日常</a></li><li><a href="/daily/2021-02.html" class="sidebar-link">2021年02月技术日常</a></li><li><a href="/daily/2020-12.html" class="sidebar-link">2020年12月技术日常</a></li><li><a href="/daily/2020-11.html" class="sidebar-link">2020年11月技术日常</a></li><li><a href="/daily/2020-10.html" class="sidebar-link">2020年10月技术日常</a></li><li><a href="/daily/2020-09.html" class="sidebar-link">2020年09月技术日常</a></li><li><a href="/daily/2020-08.html" class="sidebar-link">2020年08月技术日常</a></li><li><a href="/daily/2020-07.html" class="sidebar-link">2020年07月技术日常</a></li><li><a href="/daily/2020-06.html" aria-current="page" class="active sidebar-link">2020年06月技术日常</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-30-周二" class="sidebar-link">2020/06/30 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#为什么有效的uri不能包含空格等其他字符-uri编码方法详解" class="sidebar-link">为什么有效的URI不能包含空格等其他字符，URI编码方法详解</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#为什么有效的uri不能包含空格等其他字符" class="sidebar-link">为什么有效的URI不能包含空格等其他字符？</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-28-周天" class="sidebar-link">2020/06/28 周天</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#输入法组合文字事件compositionstart等不能用on监听" class="sidebar-link">输入法组合文字事件compositionstart等不能用on监听</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-26-周五" class="sidebar-link">2020/06/26 周五</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#为什么vconsole直接new一下就能引入-而且可以显示网络请求-console信息" class="sidebar-link">为什么vconsole直接new一下就能引入，而且可以显示网络请求，console信息</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#obs录制视频不是全屏的问题" class="sidebar-link">obs录制视频不是全屏的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-21-周日" class="sidebar-link">2020/06/21 周日</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#视频拖动到imovie时间轴后-屏幕上方和下方被截断了" class="sidebar-link">视频拖动到imovie时间轴后,屏幕上方和下方被截断了</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-19-周五" class="sidebar-link">2020/06/19 周五</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#数组去重-去掉id重复的元素" class="sidebar-link">数组去重，去掉id重复的元素</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-17-周三" class="sidebar-link">2020/06/17 周三</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#axios取消请求-以及具体使用场景" class="sidebar-link">axios取消请求，以及具体使用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-16-周二" class="sidebar-link">2020/06/16 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#vue写一个js可以调用的toast组件" class="sidebar-link">vue写一个js可以调用的toast组件</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#前端性能优化-缓存" class="sidebar-link">前端性能优化 - 缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-15-周一" class="sidebar-link">2020/06/15 周一</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#macos大小写不敏感-修改文件名大小写后git会异常" class="sidebar-link">macos大小写不敏感，修改文件名大小写后git会异常</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#echarts画高自定义仪表盘-echart本质是图的堆叠" class="sidebar-link">echarts画高自定义仪表盘，echart本质是图的堆叠</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#输入过程中-怎么实时高亮部分文字-xxx高亮实现" class="sidebar-link">输入过程中，怎么实时高亮部分文字(@xxx高亮实现)</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#v-loading指令的实现-怎么通过一个指令自动加骨架屏" class="sidebar-link">v-loading指令的实现，怎么通过一个指令自动加骨架屏</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#element-v-loading在ie下可能会溢出到全屏的问题" class="sidebar-link">element v-loading在IE下可能会溢出到全屏的问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#element-v-loading在ie下可能会关不掉的问题" class="sidebar-link">element v-loading在IE下可能会关不掉的问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#macos下怎么将mp4和m4a文件合并" class="sidebar-link">macOS下怎么将mp4和m4a文件合并</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#判断一个字符串出现次数最多的字符-并输出其次数" class="sidebar-link">判断一个字符串出现次数最多的字符，并输出其次数</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-13-周六" class="sidebar-link">2020/06/13 周六</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#symbol和array-prototype-includes不兼容ie-有babel就可以-他的原理是什么" class="sidebar-link">Symbol和Array.prototype.includes不兼容IE，有babel就可以，他的原理是什么</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#用koa-mock接口时router-allowedmethods-这个中间件是用来做什么的" class="sidebar-link">用koa mock接口时router.allowedMethods()这个中间件是用来做什么的？</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-12-周五" class="sidebar-link">2020/06/12 周五</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#component用is进行组件切换时会触发哪些钩子函数-加了keep-alive后呢" class="sidebar-link">component用is进行组件切换时会触发哪些钩子函数，加了keep-alive后呢？</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#component动态组件与使用v-if控制组件显示有什么区别" class="sidebar-link">component动态组件与使用v-if控制组件显示有什么区别</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#element-tabs组件切换页面时-显示或隐藏的组件会触发哪些钩子函数" class="sidebar-link">element tabs组件切换页面时，显示或隐藏的组件会触发哪些钩子函数</a></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#keep-alive组件切换显示时-avtivated和created同时触发的问题" class="sidebar-link">keep-alive组件切换显示时，avtivated和created同时触发的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-06.html#_2020-06-11-周四" class="sidebar-link">2020/06/11 周四</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-06.html#手动触发window-resize事件-fix改变窗口大小后其他tab页echart图表显示异常的问题" class="sidebar-link">手动触发window resize事件，fix改变窗口大小后其他tab页echart图表显示异常的问题</a></li></ul></li></ul></li><li><a href="/daily/2020-05.html" class="sidebar-link">2020年05月技术日常</a></li><li><a href="/daily/2020-04.html" class="sidebar-link">2020年04月技术日常</a></li><li><a href="/daily/2020-03.html" class="sidebar-link">2020年03月技术日常</a></li><li><a href="/daily/2020-02.html" class="sidebar-link">2020年02月技术日常</a></li><li><a href="/daily/2020-01.html" class="sidebar-link">2020年01月技术日常</a></li><li><a href="/daily/2019-12.html" class="sidebar-link">2019年12月技术日常</a></li><li><a href="/daily/2019-11.html" class="sidebar-link">2019年11月技术日常</a></li><li><a href="/daily/2019-10.html" class="sidebar-link">2019年10月技术日常</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2020年06月技术日常"><a href="#_2020年06月技术日常" class="header-anchor">#</a> 2020年06月技术日常</h1> <h2 id="_2020-06-30-周二"><a href="#_2020-06-30-周二" class="header-anchor">#</a> 2020/06/30 周二</h2> <h3 id="为什么有效的uri不能包含空格等其他字符-uri编码方法详解"><a href="#为什么有效的uri不能包含空格等其他字符-uri编码方法详解" class="header-anchor">#</a> 为什么有效的URI不能包含空格等其他字符，URI编码方法详解</h3> <p>在JS高程3里介绍URI编码方法时，有这样一个描述：<strong>有效的URI中不能包含某些字符，比如空格。使用URI编码方法可以把所有无效的字符替换为特殊的utf-8编码，从而让浏览器能够接受和理解</strong></p> <h3 id="为什么有效的uri不能包含空格等其他字符"><a href="#为什么有效的uri不能包含空格等其他字符" class="header-anchor">#</a> 为什么有效的URI不能包含空格等其他字符？</h3> <p>在《HTTP权威指南》第2章URL与资源 - 各种令人头疼的字符(p38)里有介绍原因：</p> <p>URL是可移植的(portable)，它要统一的命名网上所有的资源，意味着要通过各种不同的协议来传送这些资源，这些协议在传输数据时都会使用不同的机制，在设计URL时，需要满足以下特性：</p> <ol><li>可以通过任意协议进行<strong>安全的传输</strong>：完整/不丢失信息，以SMTP电子邮件的简单邮件传输协议为例，它使用的传输方法会剥去一些特定字符，为了避开这些问题，URL只能使用一些相对较小的、通用的安全字母表中的字符。</li> <li><strong>URL具有可读性</strong>：即使是看不见，不可打印的字符也能在URL中使用，比如空格</li> <li><strong>完整性</strong>：人们可能会希望URL中可以包含除通用安全字母表之外的二进制数据或字符，因此需要一种转义机制，能够将不安全的字符编码转为安全字符再进行传输</li></ol> <h4 id="js中两种uri编码方法的区别"><a href="#js中两种uri编码方法的区别" class="header-anchor">#</a> js中两种URI编码方法的区别</h4> <p>之前有简单说明encodeURIComponent与encodeURI的区别：<s>encodeURI只转义空格，encodeURIComponent会转义所有的非字母数字字符</s></p> <p>其实上面的说法是错误的，在mdn的一个示例中，有更加详细说明两者的区别</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// encodeURI vs encodeURIComponent</span>
<span class="token comment">// encodeURI() differs from encodeURIComponent() as follows:</span>
<span class="token keyword">var</span> set1 <span class="token operator">=</span> <span class="token string">&quot;;,/?:@&amp;=+$#&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Reserved Characters</span>
<span class="token keyword">var</span> set2 <span class="token operator">=</span> <span class="token string">&quot;-_.!~*'()&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// Unreserved Marks</span>
<span class="token keyword">var</span> set3 <span class="token operator">=</span> <span class="token string">&quot;ABC abc 123&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Alphanumeric Characters + Space  [ˌælfənjuːˈmerɪk] 字母数字 + 空格</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>set1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ;,/?:@&amp;=+$#</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>set2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -_.!~*'()</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>set3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ABC%20abc%20123 (the space gets encoded as %20)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>set1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// %3B%2C%2F%3F%3A%40%26%3D%2B%24%23</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>set2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -_.!~*'()</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>set3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ABC%20abc%20123 (the space gets encoded as %20)</span>
</code></pre></div><p>上面的例子中可以看到，URI编码方法一般有3种类型的字符</p> <table><thead><tr><th>字符类型(中)</th> <th>字符类型(英)</th> <th>包含</th> <th>encodeURI</th> <th>encodeURIComponent</th></tr></thead> <tbody><tr><td>URI保留字符</td> <td>Reserved Characters</td> <td>&quot;;,/?😡&amp;=+$#&quot;</td> <td>不转义</td> <td>转义(escaped)</td></tr> <tr><td>非转义字符</td> <td>Unreserved Marks or Alphanumeric Characters</td> <td>&quot;-_.!~*'()&quot;以及数字(0-9)、字母(a-zA-Z)</td> <td>不转义</td> <td>不转义</td></tr> <tr><td>空格等其他字符/中文等</td> <td>space or other character etc</td> <td>&quot; 中文？&quot;等其他字符</td> <td>转义</td> <td>转义</td></tr></tbody></table> <p>通过上面的表格我们可以看到</p> <ul><li><strong>encodeURI不会编码URI保留字符/非转义字符，只会对空格等其他字符(如中文字符，中文等)进行编码</strong></li> <li><strong>encodeURIComponent不会编码非转义字符，URI保留字符和其他字符都会编码</strong></li></ul> <p>综上，encodeURI与encodeURIComponent的区别是：<strong>encodeURIComponent会对URI保留字符进行编码，而encodeURI则不会，其他逻辑基本一致</strong>。</p> <h4 id="标准"><a href="#标准" class="header-anchor">#</a> 标准</h4> <p>下面来看看ECMA262标准/规范(specification)对encodeURI()的定义(definition)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">18.2</span><span class="token number">.6</span><span class="token number">.4</span> <span class="token function">encodeURI</span> <span class="token punctuation">(</span> uri <span class="token punctuation">)</span>
The encodeURI <span class="token keyword">function</span> computes a <span class="token keyword">new</span> <span class="token class-name">version</span> <span class="token keyword">of</span> a <span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">16</span> <span class="token function">encoded</span> <span class="token punctuation">(</span><span class="token number">6.1</span><span class="token number">.4</span><span class="token punctuation">)</span> <span class="token constant">URI</span> <span class="token keyword">in</span> which each instance <span class="token keyword">of</span> certain code points is replaced by one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three<span class="token punctuation">,</span> or four escape sequences representing the <span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span> encoding <span class="token keyword">of</span> the code points<span class="token punctuation">.</span>

The encodeURI <span class="token keyword">function</span> is the <span class="token operator">%</span>encodeURI<span class="token operator">%</span> intrinsic object<span class="token punctuation">.</span> When the encodeURI <span class="token keyword">function</span> is called <span class="token keyword">with</span> one argument uri<span class="token punctuation">,</span> the following steps are taken<span class="token operator">:</span>

  <span class="token number">1.</span> Let uriString be <span class="token operator">?</span> <span class="token function">ToString</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token number">2.</span> Let unescapedURISet be a String containing one instance <span class="token keyword">of</span> each code unit valid <span class="token keyword">in</span> uriReserved and uriUnescaped  
     plus <span class="token string">&quot;#&quot;</span><span class="token punctuation">.</span>
  <span class="token number">3.</span> Return <span class="token operator">?</span> <span class="token function">Encode</span><span class="token punctuation">(</span>uriString<span class="token punctuation">,</span> unescapedURISet<span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token constant">NOTE</span>
The code point # is not encoded to an escape sequence even though it is not a reserved or unescaped <span class="token constant">URI</span> code point<span class="token punctuation">.</span>
</code></pre></div><p>Runtime Semantics: Encode(string, unescapedSet)</p> <div class="language-js extra-class"><pre class="language-js"><code>The abstract operation Encode takes arguments <span class="token function">string</span> <span class="token punctuation">(</span>a String<span class="token punctuation">)</span> and <span class="token function">unescapedSet</span> <span class="token punctuation">(</span>a String<span class="token punctuation">)</span><span class="token punctuation">.</span> It performs <span class="token constant">URI</span> encoding and escaping<span class="token punctuation">.</span> It performs the following steps when called<span class="token operator">:</span>

<span class="token number">1.</span> Let strLen be the number <span class="token keyword">of</span> code units <span class="token keyword">in</span> string<span class="token punctuation">.</span>
<span class="token number">2.</span> Let <span class="token constant">R</span> be the empty String<span class="token punctuation">.</span>
<span class="token number">3.</span> Let k be <span class="token number">0.</span>
<span class="token number">4.</span> Repeat<span class="token punctuation">,</span>
     a<span class="token punctuation">.</span> If k equals strLen<span class="token punctuation">,</span> <span class="token keyword">return</span> <span class="token constant">R</span><span class="token punctuation">.</span>
     b<span class="token punctuation">.</span> Let <span class="token constant">C</span> be the code unit at index k within string<span class="token punctuation">.</span>
     c<span class="token punctuation">.</span> If <span class="token constant">C</span> is <span class="token keyword">in</span> unescapedSet<span class="token punctuation">,</span> then
          i<span class="token punctuation">.</span> Set k to k <span class="token operator">+</span> <span class="token number">1.</span>
          ii<span class="token punctuation">.</span> Set <span class="token constant">R</span> to the string<span class="token operator">-</span>concatenation <span class="token keyword">of</span> the previous value <span class="token keyword">of</span> <span class="token constant">R</span> and <span class="token constant">C</span><span class="token punctuation">.</span>
     d<span class="token punctuation">.</span> Else<span class="token punctuation">,</span>
          i<span class="token punctuation">.</span> Let cp be <span class="token operator">!</span> <span class="token function">CodePointAt</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">.</span>
          ii<span class="token punctuation">.</span> If cp<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>IsUnpairedSurrogate<span class="token punctuation">]</span><span class="token punctuation">]</span> is <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">throw</span> a URIError exception<span class="token punctuation">.</span>
          iii<span class="token punctuation">.</span> Set k to k <span class="token operator">+</span> cp<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>CodeUnitCount<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>
          iv<span class="token punctuation">.</span> Let Octets be the List <span class="token keyword">of</span> octets resulting by applying the <span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span> transformation to cp<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>CodePoint<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>
          v<span class="token punctuation">.</span> For each element octet <span class="token keyword">of</span> Octets <span class="token keyword">in</span> List order<span class="token punctuation">,</span> <span class="token keyword">do</span>
               <span class="token number">1.</span> Set <span class="token constant">R</span> to the string<span class="token operator">-</span>concatenation <span class="token keyword">of</span><span class="token operator">:</span>
                   <span class="token operator">-</span> the previous value <span class="token keyword">of</span> <span class="token constant">R</span>
                   <span class="token operator">-</span> <span class="token string">&quot;%&quot;</span>
                   <span class="token operator">-</span> the String representation <span class="token keyword">of</span> octet<span class="token punctuation">,</span> formatted <span class="token keyword">as</span> a two<span class="token operator">-</span>digit uppercase hexadecimal number<span class="token punctuation">,</span> padded to the left <span class="token keyword">with</span> a zero <span class="token keyword">if</span> necessary
</code></pre></div><p>以上，在总结某个知识点的过程中，我们可以发现介绍js相关知识点的平台很多，我们可以大致的判断出文档的详细程度如下：</p> <p>菜鸟教程/w3school等 &lt;= JS高程3等技术类书籍 &lt;= MDN &lt;= tc39 ECMA标准文档</p> <p>js相关知识基本都是对API、tc39 ECMA标准文档的总结、梳理。区别在于：</p> <ol><li>整理的意图：是仅仅展示API调用，还是介绍原理（简单说明/详细介绍）</li> <li>示例demo是否丰富？demo是否可以让人很好的理解知识点？</li></ol> <p>参考</p> <ul><li><a href="https://tc39.es/ecma262/#sec-uri-handling-functions" target="_blank" rel="noopener noreferrer">URI Handling Functions | ECMA-262 Specifications<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI" target="_blank" rel="noopener noreferrer">encodeURI() | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.zuo11.com/blog/2020/6/content-dispositon.html" target="_blank" rel="noopener noreferrer">encodeURIComponent与encodeURI的区别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.yuque.com/guoqzuo/js_es6/ep07nf#841dc4e5" target="_blank" rel="noopener noreferrer">js高程3的引用类型 - 单体内置对象 - global对象 - URI编码方法笔记<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.ruanyifeng.com/blog/2010/02/url_encoding.html" target="_blank" rel="noopener noreferrer">关于URL编码 | 阮一峰的网络日志<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_2020-06-28-周天"><a href="#_2020-06-28-周天" class="header-anchor">#</a> 2020/06/28 周天</h2> <h3 id="输入法组合文字事件compositionstart等不能用on监听"><a href="#输入法组合文字事件compositionstart等不能用on监听" class="header-anchor">#</a> 输入法组合文字事件compositionstart等不能用on监听</h3> <p>今天用原生的js来写demo时发现使用oncompositoinstart无法监听到输入法组合文件的过程，后面替换为addEventListener就可以了。因此对于输入法组合文字过程事件必须要使用DOM2级事件监听</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#input'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
    <span class="token keyword">let</span> composition <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token comment">// input.addEventListener('compositionstart', (e) =&gt; {</span>
    <span class="token comment">//   console.log('oncompositionstart')</span>
    <span class="token comment">//   composition = true</span>
    <span class="token comment">// });</span>
    <span class="token comment">// input.addEventListener('compositionend', (e) =&gt; {</span>
    <span class="token comment">//   console.log('oncompositionend')</span>
    <span class="token comment">//   composition = false</span>
    <span class="token comment">// });</span>

    input<span class="token punctuation">.</span><span class="token function-variable function">oncompositionstart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oncompositionstart'</span><span class="token punctuation">,</span> composition<span class="token punctuation">)</span>
      composition <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    input<span class="token punctuation">.</span><span class="token function-variable function">oncompositionend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oncompositionend'</span><span class="token punctuation">,</span> composition<span class="token punctuation">)</span>
      composition <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_2020-06-26-周五"><a href="#_2020-06-26-周五" class="header-anchor">#</a> 2020/06/26 周五</h2> <h3 id="为什么vconsole直接new一下就能引入-而且可以显示网络请求-console信息"><a href="#为什么vconsole直接new一下就能引入-而且可以显示网络请求-console信息" class="header-anchor">#</a> 为什么vconsole直接new一下就能引入，而且可以显示网络请求，console信息</h3> <p>在移动端真机调试时，一般会用到vconsole，那你会发现在vue中vconsole的引入非常简单，只需要在main.js里面引入，并new一下。相比其他组件需要Vue.use引入来说，会很迷惑，这个是怎么引入到项目的？页面底部时怎么显示vconsole的dom的？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> VConsole <span class="token keyword">from</span> <span class="token string">&quot;vconsole&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">VConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面我们看看vconsole的源码，看看到底是怎么实现的：</p> <p>入口在 src/core/core.js，有一个VConsole的class，可以看到这里用了单例模式，只允许有一个vconsole</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/core.js</span>
<span class="token comment">// ...</span>
<span class="token keyword">class</span> <span class="token class-name">VConsole</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>$<span class="token punctuation">.</span><span class="token function">one</span><span class="token punctuation">(</span><span class="token constant">VCONSOLE_ID</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'vConsole is already exists.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ....</span>
<span class="token comment">// ...</span>
</code></pre></div><p>Log、System、Network、Element、Storage都是单独的模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/core.js</span>
<span class="token comment">// ...</span>
<span class="token comment">// built-in plugins</span>
<span class="token keyword">import</span> VConsolePlugin <span class="token keyword">from</span> <span class="token string">'../lib/plugin.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VConsoleLogPlugin <span class="token keyword">from</span> <span class="token string">'../log/log.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VConsoleDefaultPlugin <span class="token keyword">from</span> <span class="token string">'../log/default.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VConsoleSystemPlugin <span class="token keyword">from</span> <span class="token string">'../log/system.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VConsoleNetworkPlugin <span class="token keyword">from</span> <span class="token string">'../network/network.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VConsoleElementPlugin <span class="token keyword">from</span> <span class="token string">'../element/element.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VConsoleStoragePlugin <span class="token keyword">from</span> <span class="token string">'../storage/storage.js'</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><p>constructor 里面挂载dom的方法如下，直接监听window的事件，当确定页面加载ok后，再将vconsole相关dom挂载上去</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/core.js</span>
<span class="token comment">// ...</span>
<span class="token comment">// try to init</span>
<span class="token keyword">let</span> <span class="token function-variable function">_onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>isInited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  that<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span><span class="token function">_mockTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span><span class="token function">_bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span><span class="token function">_autoRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>document <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">'loading'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> _onload<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">_onload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// if document does not exist, wait for it</span>
  <span class="token keyword">let</span> _timer<span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">_pollingDocument</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>document <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token string">'complete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_onload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>_pollingDocument<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  _timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>_pollingDocument<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面看看console是怎么拦截的，通过下面的代码我们可以看到重写了window.console.log/info/warn等方法，改为执行自己的printLog方法，用于记录log，并渲染到vconsole面板里</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/log/log.js</span>
<span class="token comment">// ...</span>
<span class="token comment">/**
 * replace window.console with vConsole method
 * @private
 */</span>
<span class="token function">mockConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> methodList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>console<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>console <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    methodList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>console<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>console<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>console<span class="token punctuation">.</span>time <span class="token operator">=</span> window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>time<span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>console<span class="token punctuation">.</span>timeEnd <span class="token operator">=</span> window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>timeEnd<span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>console<span class="token punctuation">.</span>clear <span class="token operator">=</span> window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>clear<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  methodList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>console<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">printLog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        logType<span class="token operator">:</span> method<span class="token punctuation">,</span>
        logs<span class="token operator">:</span> args<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当vconsole remove后，还原现场</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/log/log.js</span>
<span class="token comment">// ...</span>
<span class="token comment">/**
 * before remove
 * @public
 */</span>
<span class="token function">onRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>info<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>warn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>warn<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>debug<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>error<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>time<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>timeEnd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>timeEnd<span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>clear <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>console<span class="token punctuation">.</span>clear<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>console <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> idx <span class="token operator">=</span> <span class="token constant">ADDED_LOG_TAB_ID</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">ADDED_LOG_TAB_ID</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们再来看看Network相关，也是重写了原生的window.XMLHttpRequest.prototype.open/send等方法，在里面加入了拦截逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/network/network.js</span>
<span class="token comment">/**
 * mock ajax request
 * @private
 */</span>
<span class="token function">mockAjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _XMLHttpRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_XMLHttpRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> _open <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>open<span class="token punctuation">,</span>
      _send <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>send<span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>_open <span class="token operator">=</span> _open<span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>_send <span class="token operator">=</span> _send<span class="token punctuation">;</span>

  <span class="token comment">// mock open()</span>
  window<span class="token punctuation">.</span><span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">open</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> XMLReq <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// mock send()</span>
  window<span class="token punctuation">.</span><span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> XMLReq <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
        data <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>综上，我们大致知道vconsole的套路了</p> <ol><li>通过window监听页面加载，加载ok后向页面追加vconsle相关的dom</li> <li>像log、network等相关的渲染显示，都是通过重写window下对应的系统方法来加入一些自定义操作</li></ol> <p>完整源码可以先npm install vconsole后再在node_modules里面查看，或者在github上看 <a href="https://github.com/Tencent/vConsole" target="_blank" rel="noopener noreferrer">vconsole - github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="obs录制视频不是全屏的问题"><a href="#obs录制视频不是全屏的问题" class="header-anchor">#</a> obs录制视频不是全屏的问题</h3> <p>解决方法：打开OBS =&gt; 点击顶部 &quot;编辑&quot; 按钮 =&gt; 选择 &quot;变换&quot; =&gt; 点击比例适配屏幕</p> <h2 id="_2020-06-21-周日"><a href="#_2020-06-21-周日" class="header-anchor">#</a> 2020/06/21 周日</h2> <h3 id="视频拖动到imovie时间轴后-屏幕上方和下方被截断了"><a href="#视频拖动到imovie时间轴后-屏幕上方和下方被截断了" class="header-anchor">#</a> 视频拖动到imovie时间轴后,屏幕上方和下方被截断了</h3> <p>注意这种情况，需要在时间轴，选中视频，然后在预览器，点击 &quot;全部还原&quot;，就可以了。</p> <h2 id="_2020-06-19-周五"><a href="#_2020-06-19-周五" class="header-anchor">#</a> 2020/06/19 周五</h2> <h3 id="数组去重-去掉id重复的元素"><a href="#数组去重-去掉id重复的元素" class="header-anchor">#</a> 数组去重，去掉id重复的元素</h3> <p>有一个需求，客户信息列表，需要去除重复的客户。于是想着怎么写去重的逻辑，可以思考下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> customerList <span class="token operator">=</span> <span class="token punctuation">[</span> 
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> info<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span> info<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> info<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span> info<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span> info<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">// 去重</span>
<span class="token keyword">let</span> tempSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> newList <span class="token operator">=</span> customerList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tempSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  tempSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newList<span class="token punctuation">)</span>
<span class="token comment">// [</span>
<span class="token comment">//   { id: '1', info: 'xxx' },</span>
<span class="token comment">//   { id: '3', info: 'xxx' },</span>
<span class="token comment">//   { id: '2', info: 'xxx' },</span>
<span class="token comment">// ]</span>
</code></pre></div><h2 id="_2020-06-17-周三"><a href="#_2020-06-17-周三" class="header-anchor">#</a> 2020/06/17 周三</h2> <h3 id="axios取消请求-以及具体使用场景"><a href="#axios取消请求-以及具体使用场景" class="header-anchor">#</a> axios取消请求，以及具体使用场景</h3> <p>以下是两个会用到取消当前请求的场景</p> <ol><li>tab切换刷新某个列表数据数据导致数据错乱的问题</li> <li>导出文件或下载文件时，中途取消</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// get 方法 假设这个接口需要50s才返回</span>
axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thrown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request canceled'</span><span class="token punctuation">,</span> thrown<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// handle error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// post 方法时 假设这个接口需要50s才返回</span>
<span class="token comment">// axios.post('/user/12345', {</span>
<span class="token comment">//   name: 'new name'</span>
<span class="token comment">// }, {</span>
<span class="token comment">//   cancelToken: source.token</span>
<span class="token comment">// })</span>

<span class="token comment">// 3庙后取消请求</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// cancel the request (the message parameter is optional)</span>
  source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'Operation canceled by the user.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><p>参考：<a href="https://github.com/axios/axios#cancellation" target="_blank" rel="noopener noreferrer">axios cancellation | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-06-16-周二"><a href="#_2020-06-16-周二" class="header-anchor">#</a> 2020/06/16 周二</h2> <h3 id="vue写一个js可以调用的toast组件"><a href="#vue写一个js可以调用的toast组件" class="header-anchor">#</a> vue写一个js可以调用的toast组件</h3> <p>一般我们使用component属性来引入vue单文件组件，下面来介绍一种用js来挂载单文件组件的方法。这里以一个简单的toast组件来试试效果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将vue单文件组件挂载到dom的核心方法 create.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">Component<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先创建实例</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// h就是createElement，它返回VNode</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span> props <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 手动挂载</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 销毁方法</span>
  <span class="token keyword">const</span> comp <span class="token operator">=</span> vm<span class="token punctuation">.</span>$children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  comp<span class="token punctuation">.</span><span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vm<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> comp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>调用示例</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showToast<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>打开toast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> Toast <span class="token keyword">from</span> <span class="token string">&quot;./Toast.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> create <span class="token keyword">from</span> <span class="token string">&quot;./create&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;show toast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> toast <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>Toast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        message<span class="token operator">:</span> <span class="token string">&quot;我是错误信息&quot;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;error&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>toast<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        toast<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>简单的Toast.vue</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-toast<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.my-toast</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token selector">;
  .error</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.success</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="前端性能优化-缓存"><a href="#前端性能优化-缓存" class="header-anchor">#</a> 前端性能优化 - 缓存</h3> <p>在前端性能优化中，有一个方法是使用缓存。前端缓存可以减少网络请求次数，减少流量消耗，提升用户体验，降低服务器负载。</p> <p>前端缓存分为两种：http缓存、浏览器缓存</p> <h4 id="http缓存"><a href="#http缓存" class="header-anchor">#</a> http缓存</h4> <blockquote><p>相关文档可以搜索对应请求头的MDN文档、另外可以参考《http权威指南》第7章 缓存</p></blockquote> <p>http缓存策略的核心在于<strong>新鲜度检测</strong>，一般有两种策略来保持已缓存数据与服务器数据之间的充分一致</p> <ol><li>强缓存 - 设置文档过期时间(document expiration)：给当前请求设置一个过期时间，这段时间内可以直接使用缓存数据，不必再去请求服务器拿数据</li> <li>弱缓存/协商缓存 - 服务器再验证(server revalidation)：服务器响应某个请求时，在响应头加一个版本信息或最后一次修改时间的标记，当下次该请求发生时，请求头会携带这个标记信息，服务器会通过标记值来判断是否使用缓存内容</li></ol> <h5 id="强缓存-document-expiration"><a href="#强缓存-document-expiration" class="header-anchor">#</a> 强缓存 document expiration</h5> <p>当第一次发送某个http请求后，会把内容缓存一段时间。在这段时间里，都认为内容是 &quot;新鲜的&quot;，可以在不联系服务器的情况下，直接响应该文档。</p> <p><strong>Expires(相对时间)</strong></p> <p>Expires [ɪk'spaɪəz] 响应头包含日期/时间， 即在此时候之后，响应过期。无效的日期，比如 0, 代表着过去的日期，即该资源已经过期。如果在Cache-Control响应头设置了 &quot;max-age&quot; 或者 &quot;s-max-age&quot; 指令，那么 Expires 头会被忽略。</p> <p>我们来写个demo试试，我们用koa来写个listData接口，将接口的Expires时间设置为当前时间+1小时，也就是一个小时后失效，koa代码如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/listData'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 打印log，用来看服务端是否收到了请求</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'recive req'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token comment">// 实际效果：Expires: Sat Jul 04 2020 19:28:42 GMT+0800 (GMT+08:00)</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Expires'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// UTC时间</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'hello world'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server start on 9000 port'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>前端测试demo：public/index.html如下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>
    btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span>  axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/listData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当我们点击两次发送请求，测试结果如下：第一次请求时正常接收请求，由于我们设置了Expires响应头，前端再次请求时，服务端没有接收到请求，浏览器直接从硬盘读的缓存(from disk cache)，响应头对比图如下</p> <p><img src="/images/daily/expires_header.png" alt="expires_header.png"></p> <p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires" target="_blank" rel="noopener noreferrer">Expires - HTTP | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Cache-Control</strong></p> <p>Expries是http1.0的标准，在HTTP/1.1版本里，Expire已经被Cache-Control替代，除了可以设置时间外，还加了更多控制，Cache-Control可以设置很多值</p> <p>可缓存性相关值</p> <ul><li>public：所有内容都将被缓存（客户端和代理服务器都可缓存）</li> <li>private：所有内容只有客户端可以缓存，（即代理服务器不能缓存它）Cache-Control的默认取值</li> <li>no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定（除非资源进行了再验证(协商缓存验证)，否则客户端不会使用已换成的资源）</li> <li>no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存（缓存应当尽快从服务器中删除文档的所有痕迹，因为其中可能包含敏感信息）</li></ul> <p>到期相关值</p> <ul><li>max-age=seconds 设置缓存存储的最大周期，超过这个时间缓存被认为过期(单位秒)。与Expires相反，时间是相对于请求的时间。</li> <li>s-maxage=seconds 覆盖max-age或者Expires头，但是仅适用于共享缓存(比如各个代理)，私有缓存会忽略它。</li></ul> <p>我们将上个例子中设置Expires替换为Cache-Control的写法</p> <div class="language-js extra-class"><pre class="language-js"><code>ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Cache-control&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;max-age=3600&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 设置缓存有效时间为3600s，1个小时</span>
</code></pre></div><p>执行结果和之前的基本一致，只是响应头有点变化，如下图</p> <p><img src="/images/daily/cachecontrol_max-age.png" alt="cachecontrol_max-age.png"></p> <p>这里要特别注意，Catch-Control不止响应头可以设置，前端在请求头也是可以设置的</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Cache-Control: max-age<span class="token operator">=</span><span class="token operator">&lt;</span>seconds<span class="token operator">&gt;</span> <span class="token comment"># 如果后端不设置改值，前端无效</span>
Cache-Control: max-stale<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>seconds<span class="token operator">&gt;</span><span class="token punctuation">]</span>
Cache-Control: min-fresh<span class="token operator">=</span><span class="token operator">&lt;</span>seconds<span class="token operator">&gt;</span>
Cache-control: no-cache  <span class="token comment"># 可以使用，等价于 Pragma: no-cache</span>
Cache-control: no-store
Cache-control: no-transform
Cache-control: only-if-cached
</code></pre></div><p>我们可以在axios请求时加请求头参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span>  axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/listData'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 如果前端使用这个请求头，那么后端设置的max-age或Expires就会被忽略</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">Cache-Control - HTTP | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="弱缓存-协商缓存-server-revalidation"><a href="#弱缓存-协商缓存-server-revalidation" class="header-anchor">#</a> 弱缓存/协商缓存 server revalidation</h5> <p>直接给某个请求设置缓存有效期是简单粗暴的方法，因为一般我们无法准确的知道需要缓存的资源具体可能会变动的时间。于是就有了服务器再验证的这种策略，注意下面讨论的是get请求，涉及到304状态码，对于412相关的post参见具体的mdn文档</p> <p><img src="/images/daily/week_cache.png" alt="week_cache.png"></p> <p><strong>Last-Modified/If-Modified-Since</strong>
在响应某个请求时，响应头加一个Last-Modified，值设置为某个资源的最后一次修改时间。注意：这里会有一个问题，加了Last-Modified后，下次请求浏览器直接使用了强缓存，直接读disk cache，没有请求服务器，那我们服务器再验证就验证不了，所以需要设置一个no-cache的请求头，不使用强缓存，代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> fileInfo <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token string">'./public/index.html'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> mtime <span class="token operator">=</span> fileInfo<span class="token punctuation">.</span>mtime
ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Cache-control&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Last-Modified&quot;</span><span class="token punctuation">,</span> mtime<span class="token punctuation">)</span>
</code></pre></div><p>这样设置后，下次请求时，请求头会自动携带If-Modified-Since，值为之前响应头设置的Last-Modified的值，然后我们根据If-Modified-Since请求头的时间，与某个文件修改的时间进行比对，如果相等，直接返回304状态码，浏览器会使用该接口上一次接口的缓存的数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 完整接口如下</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/listData'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'recive req'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token keyword">let</span> fileInfo <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token string">'./public/index.html'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> mtime <span class="token operator">=</span> fileInfo<span class="token punctuation">.</span>mtime
  <span class="token comment">// console.log(fileInfo, fileInfo.mtime)</span>
  <span class="token comment">// 响应头设置后，下次这个请求会在请求头自动加上 If-Modified-Since: Sat Jul 04 2020 21:19:30 GMT+0800 (GMT+08:00) 字段</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Cache-control&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Last-Modified&quot;</span><span class="token punctuation">,</span> mtime<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-modified-since'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-modified-since'</span><span class="token punctuation">]</span> <span class="token operator">==</span> mtime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;304&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">304</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">'hello world'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：<strong>当与 If-None-Match 一同出现时，它（If-Modified-Since）会被忽略掉，除非服务器不支持 If-None-Match。</strong></p> <p>参考：</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified" target="_blank" rel="noopener noreferrer">Last-Modified - HTTP | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Modified-Since" target="_blank" rel="noopener noreferrer">If-Modified-Since - HTTP | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><strong>ETag/if-None-Macth</strong></p> <p>有些请求验证最后修改时间是不够的，比如：</p> <ul><li>某些文件会被周期性的重写，但文件内容是一样的，可最后一次修改时间变了</li> <li>有些文档被改了，但改动并不重要，比如拼写或注释的修改，不需要让所有缓存都更新</li> <li>有些文档会在亚秒间发生变化，对设置服务器来说，1s的粒度会不够用</li></ul> <p>因此，Last-Modified由于精确度比ETag(实体标签)要低，所以Last-Modified只是一个备用机制。一般Last-Modified设置的是修改时间，而ETag设置的一般是某个资源的标识符(版本号或者md5，表示一个文件的指纹fingerprints)，来看代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> calcMd5 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./md5'</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/listData'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'recive req'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token keyword">let</span> md5 <span class="token operator">=</span>  <span class="token function">calcMd5</span><span class="token punctuation">(</span><span class="token string">'./public/index.html'</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Cache-control&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'ETag'</span><span class="token punctuation">,</span> md5<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span> <span class="token operator">===</span> md5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;304&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">304</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">'hello world'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>md5.js 计算文件md5</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">//读取一个Buffer</span>
	<span class="token keyword">let</span> buffer <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> fsHash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'md5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	fsHash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> fsHash<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参考:</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag" target="_blank" rel="noopener noreferrer">ETag - HTTP | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match" target="_blank" rel="noopener noreferrer">If-None-Match - HTTP| MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="chrome下注意事项"><a href="#chrome下注意事项" class="header-anchor">#</a> Chrome下注意事项</h5> <p>在进行缓存测试时，你会发现浏览器的真实情况和书上或文档里的会有一点不一样的地方，我们需要注意：</p> <ol><li><strong>如果ETag和If-None-Match的值一致，且koa返回了304，但前端一直是200时，可能是浏览器的问题，关掉浏览器当前页面，再打开可能就好了</strong>。这一块调的我差点怀疑人生</li> <li><strong>书上或文档里说，no-cache只是不使用强缓存，需要服务器二次验证、而no-store是既不使用强缓存也不使用协商缓存，但是在chrome浏览器里，如果你的请求头里有Cache-Control': 'no-cache'，不管是强缓存还是协商缓存都不会生效；</strong></li> <li><strong>在F12 chrome调试面板，勾选disable cache，请求头会自动携带Pragma: no-cache，等价于请求头里设置cache-control： no-cache</strong></li> <li><strong>在chrome浏览器下，请求头里使用Cache-Control': 'no-store'，没有任何用处</strong></li></ol> <p>关于以上完整的HTTP缓存测试demo，参见 <a href="https://github.com/zuoxiaobai/fedemo/tree/master/src/DebugDemo/%E5%89%8D%E7%AB%AF%E7%BC%93%E5%AD%98" target="_blank" rel="noopener noreferrer">http缓存测试 | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>参考:</p> <ul><li><a href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Headers/Pragma" target="_blank" rel="noopener noreferrer">Pragma - HTTP | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="浏览器缓存"><a href="#浏览器缓存" class="header-anchor">#</a> 浏览器缓存</h4> <p>cookie或storage</p> <h2 id="_2020-06-15-周一"><a href="#_2020-06-15-周一" class="header-anchor">#</a> 2020/06/15 周一</h2> <h3 id="macos大小写不敏感-修改文件名大小写后git会异常"><a href="#macos大小写不敏感-修改文件名大小写后git会异常" class="header-anchor">#</a> macos大小写不敏感，修改文件名大小写后git会异常</h3> <p>macos是文件大小写不敏感的系统，而widonws/linux是大小写敏感的，假设把git上之前提交过的文件，修改大小写，再次提交后，git上会出现两个大小写不一样的文件？为什么呢</p> <p>macos是大小写不敏感的文件系统，也就是在macos上你无法在同一个目录下同时创建test.vue和Test.vue，如果出现这种情况，本地感知不到文件的改动，但git服务器却有记录这两个文件。</p> <p>最好的解决方法是将整个文件名都变更。而不是仅改变大小写</p> <h3 id="echarts画高自定义仪表盘-echart本质是图的堆叠"><a href="#echarts画高自定义仪表盘-echart本质是图的堆叠" class="header-anchor">#</a> echarts画高自定义仪表盘，echart本质是图的堆叠</h3> <p>最近有个UI需求，画一个自定义的仪表盘，看起来很不好实现，后面在看了echarts社区的一些例子，经过写demo测试后，找到了规律，<strong>核心是化繁为简，对于复杂的UI，可以拆分为多个小的模块，一个个实现</strong></p> <p><img src="/images/daily/echarts_round.png" alt="echarts_round.png"></p> <p>下面是一个很粗糙的测试demo，option如下，完整demo参见: <a href="https://github.com/zuoxiaobai/fedemo/tree/master/src/vuecli-demo/src/views/echarts" target="_blank" rel="noopener noreferrer">自定义仪表盘 | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> placeHolderStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
  normal<span class="token operator">:</span> <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    labelLine<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,0)&quot;</span><span class="token punctuation">,</span>
    borderWidth<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  emphasis<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,0)&quot;</span><span class="token punctuation">,</span>
    borderWidth<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bg <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;pie&quot;</span><span class="token punctuation">,</span>
    radius<span class="token operator">:</span> <span class="token string">&quot;53%&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 半径</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 圆心</span>
      <span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;50%&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    z<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">&quot;linear&quot;</span><span class="token punctuation">,</span>
          x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          y<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          x2<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          y2<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          colorStops<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              offset<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              color<span class="token operator">:</span> <span class="token string">&quot;#ffffff&quot;</span> <span class="token comment">// 0% 处的颜色</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              offset<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
              color<span class="token operator">:</span> <span class="token string">&quot;#f3f4f9&quot;</span> <span class="token comment">// 100% 处的颜色</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          global<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 缺省为 false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        label<span class="token operator">:</span> <span class="token punctuation">{</span>
          show<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        labelLine<span class="token operator">:</span> <span class="token punctuation">{</span>
          show<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    hoverAnimation<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    tooltip<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">70</span> <span class="token comment">// 背景部分</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 空缺部分</span>
        itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
          color<span class="token operator">:</span> <span class="token string">&quot;transparent&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    startAngle<span class="token operator">:</span> <span class="token number">216</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 仪表盘外层</span>
<span class="token keyword">var</span> roundList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;pie&quot;</span><span class="token punctuation">,</span>
    hoverAnimation<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//鼠标经过的特效</span>
    radius<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;55%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    startAngle<span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span>
    labelLine<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        show<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        position<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// 显示长度</span>
        itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
          normal<span class="token operator">:</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token string">&quot;rgba(236,172,112, 1.0)&quot;</span> <span class="token comment">// 橙色 1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// 总长度</span>
        itemStyle<span class="token operator">:</span> placeHolderStyle
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;pie&quot;</span><span class="token punctuation">,</span>
    hoverAnimation<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//鼠标经过的特效</span>
    radius<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;55%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 内半径、外半径</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 圆心坐标, 距离左侧、顶部</span>
    startAngle<span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token comment">// 0 为圆心左侧开始，起始角度，支持范围[0, 360]。</span>
    labelLine<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        show<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        position<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
          normal<span class="token operator">:</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token string">&quot;white&quot;</span> <span class="token comment">// 3 紫色</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// label: dataStyle, 显示标签</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        itemStyle<span class="token operator">:</span> placeHolderStyle
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">//上层环形配置</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;pie&quot;</span><span class="token punctuation">,</span>
    hoverAnimation<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//鼠标经过的特效</span>
    radius<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;55%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 内半径、外半径</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 圆心坐标, 距离左侧、顶部</span>
    startAngle<span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token comment">// 0 为圆心左侧开始，起始角度，支持范围[0, 360]。</span>
    labelLine<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        show<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        position<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
          normal<span class="token operator">:</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token string">&quot;rgba(170,185,227,1.0)&quot;</span> <span class="token comment">// 3 紫色</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// label: dataStyle,  // label: dataStyle, 显示标签</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        itemStyle<span class="token operator">:</span> placeHolderStyle
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> pointer <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;指针&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;gauge&quot;</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    detail<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">29</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    radius<span class="token operator">:</span> <span class="token string">&quot;55%&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 内半径、外半径</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;50%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 圆心坐标, 距离左侧、顶部</span>
    itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;#000&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    axisLine<span class="token operator">:</span> <span class="token punctuation">{</span>
      lineStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
        show<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        width<span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    axisLabel<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    axisTick<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    splitLine<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pointer<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      length<span class="token operator">:</span> <span class="token string">&quot;80%&quot;</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">40</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> circles <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;pie&quot;</span><span class="token punctuation">,</span>
    radius<span class="token operator">:</span> <span class="token string">&quot;80&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 半径</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 圆心</span>
      <span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;50%&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    z<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
      normal<span class="token operator">:</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
        label<span class="token operator">:</span> <span class="token punctuation">{</span>
          show<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        labelLine<span class="token operator">:</span> <span class="token punctuation">{</span>
          show<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        shadowColor<span class="token operator">:</span> <span class="token string">&quot;rgba(122, 122, 122, 0.21)&quot;</span><span class="token punctuation">,</span>
        shadowBlur<span class="token operator">:</span> <span class="token number">30</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    animation<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    tooltip<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token comment">// 背景部分</span>
        label<span class="token operator">:</span> <span class="token punctuation">{</span>
          normal<span class="token operator">:</span> <span class="token punctuation">{</span>
            formatter<span class="token operator">:</span> <span class="token string">&quot;{c}%&quot;</span><span class="token punctuation">,</span>
            position<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
            show<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            textStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
              fontSize<span class="token operator">:</span> <span class="token string">&quot;40&quot;</span><span class="token punctuation">,</span>
              fontFamily<span class="token operator">:</span> <span class="token string">&quot;Impact&quot;</span><span class="token punctuation">,</span>
              fontWeight<span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span>
              color<span class="token operator">:</span> <span class="token string">&quot;#4a4a4a&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    startAngle<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token string">&quot;36%&quot;</span><span class="token punctuation">,</span>
    textStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;Line&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;pie&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 圆圈</span>
    clockWise<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    radius<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;28%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;28.5%&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 圆心</span>
      <span class="token string">&quot;40%&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;50%&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    z<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
    tooltip<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      show<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    animation<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        itemStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
          color<span class="token operator">:</span> <span class="token string">&quot;#ececec&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> option <span class="token operator">=</span> <span class="token punctuation">{</span>
  backgroundColor<span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token string">&quot;13%&quot;</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token string">&quot;51%&quot;</span><span class="token punctuation">,</span>
      textAlign<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
      textStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
        fontWeight<span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span>
        fontFamily<span class="token operator">:</span> <span class="token string">&quot;PingFangSC-Semibold&quot;</span><span class="token punctuation">,</span>
        fontSize<span class="token operator">:</span> <span class="token string">&quot;16&quot;</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token string">&quot;#4a4a4a&quot;</span><span class="token punctuation">,</span>
        textAlign<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token string">&quot;48万&quot;</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token string">&quot;65%&quot;</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token string">&quot;51%&quot;</span><span class="token punctuation">,</span>
      textAlign<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
      textStyle<span class="token operator">:</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token string">&quot;#4a4a4a&quot;</span><span class="token punctuation">,</span>
        fontFamily<span class="token operator">:</span> <span class="token string">&quot;PingFangSC-Semibold&quot;</span><span class="token punctuation">,</span>
        fontWeight<span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span>
        fontSize<span class="token operator">:</span> <span class="token string">&quot;16&quot;</span><span class="token punctuation">,</span>
        textAlign<span class="token operator">:</span> <span class="token string">&quot;center&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  series<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>bg<span class="token punctuation">,</span> <span class="token comment">// 背景</span>
    <span class="token operator">...</span>roundList<span class="token punctuation">,</span> <span class="token comment">// 最外面顶部样式</span>
    <span class="token operator">...</span>pointer<span class="token punctuation">,</span> <span class="token comment">// 指针</span>
    <span class="token operator">...</span>circles<span class="token punctuation">,</span> <span class="token comment">// 中间圆圈部分</span>
    <span class="token operator">...</span>texts <span class="token comment">// 左右侧文字</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="输入过程中-怎么实时高亮部分文字-xxx高亮实现"><a href="#输入过程中-怎么实时高亮部分文字-xxx高亮实现" class="header-anchor">#</a> 输入过程中，怎么实时高亮部分文字(@xxx高亮实现)</h3> <p><img src="/images/daily/input_highlight_key.gif" alt="input_highlight_key.gif"></p> <p>实现思路是，使用富文本编辑器，当监听到输入的文件包含关键字时，使用replace对当前的输入内容进行替换，给关键字加上span给个highlight的class，代码如下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>editdiv<span class="token punctuation">&quot;</span></span> <span class="token attr-name">contenteditable</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> editdiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#editdiv'</span><span class="token punctuation">)</span>
  <span class="token comment">// 输入内容改变</span>
  editdiv<span class="token punctuation">.</span><span class="token function-variable function">oninput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> curValue <span class="token operator">=</span> editdiv<span class="token punctuation">.</span>innerHTML
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前富文本输入内容'</span><span class="token punctuation">,</span> curValue<span class="token punctuation">)</span>
    <span class="token keyword">let</span> needHighlightArr <span class="token operator">=</span> keyArr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> curValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 开始高亮</span>
    needHighlightArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> curValue<span class="token punctuation">)</span>
      <span class="token comment">// 如果之前已经设置了highlight，就不设置了</span>
      <span class="token keyword">let</span> nextText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span class=&quot;highlight&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>nextText<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        curValue <span class="token operator">=</span> curValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> nextText<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    editdiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> curValue
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol><li>replace后，光标移动到了输入框最前面</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 解决方法：replace后，把输入光标移动到最后面</span>
<span class="token comment">// set 光标到末尾</span>
<span class="token comment">// https://www.cnblogs.com/jonie-wong/p/5519822.html</span>
<span class="token comment">// div输入@光标定位</span>
<span class="token comment">// 知乎div编辑器，@功能的光标定位问题</span>
<span class="token comment">// https://segmentfault.com/q/1010000005617160</span>
<span class="token keyword">function</span> <span class="token function">focusToElementEnd</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> range<span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">moveToElementText</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//取消选中</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">selectNodeContents</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> sel <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sel<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sel<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>替换后虽然高亮了，但再次输入的文字，也会一直是高亮的，注意，后面输入的字母没有放到replace span后面</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// [Log] 当前富文本输入内容  &quot;123zuo&quot; </span>
<span class="token comment">// [Log] zuo &quot;123zuo&quot;</span>
<span class="token comment">// [Log] 替换后，再次获取富文本输入内容 &quot;123&lt;span class=&quot;highlight&quot;&gt;zuo&lt;/span&gt;&quot;</span>

<span class="token comment">// [Log] 当前富文本输入内容 – &quot;123&lt;span class=\&quot;highlight\&quot;&gt;zuok&lt;/span&gt;&quot;</span>
<span class="token comment">// [Log] zuo – &quot;123&lt;span class=\&quot;highlight\&quot;&gt;zuok&lt;/span&gt;&quot;</span>
</code></pre></div><p>网上找了下，最相似的答案是 <a href="https://www.jianshu.com/p/b419a695d11b" target="_blank" rel="noopener noreferrer">实现动态输入关键字时关键字高亮<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，从这里捕捉到一个很重要的信息，就是里面提到的是替换text而不是html，而我替换的是innerHTML，所以我换了下思路</p> <p>在onkeyup键盘抬起时对textContent进行replace，解决了这个问题</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> keyArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'明天'</span><span class="token punctuation">,</span> <span class="token string">'上午'</span><span class="token punctuation">,</span> <span class="token string">'下午'</span><span class="token punctuation">,</span> <span class="token string">'11点'</span><span class="token punctuation">,</span> <span class="token string">'12点'</span><span class="token punctuation">,</span> <span class="token string">'zuo'</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> editdiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#editdiv'</span><span class="token punctuation">)</span>
editdiv<span class="token punctuation">.</span><span class="token function-variable function">onkeyup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onkeyup'</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> editdiv<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span>
  <span class="token comment">// document.execCommand('forecolor', false, 'black')</span>
  <span class="token keyword">let</span> curValue <span class="token operator">=</span> editdiv<span class="token punctuation">.</span>textContent
  <span class="token keyword">let</span> needHighlightArr <span class="token operator">=</span> keyArr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> curValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// 开始高亮</span>
  needHighlightArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> curValue<span class="token punctuation">)</span>
    <span class="token comment">// 如果之前已经设置了highlight，就不设置了 class=&quot;highlight&quot;</span>
    <span class="token keyword">let</span> nextText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span class=&quot;highlight&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>nextText<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      curValue <span class="token operator">=</span> curValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> nextText<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  editdiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> curValue
  <span class="token function">focusToElementEnd</span><span class="token punctuation">(</span>editdiv<span class="token punctuation">)</span> <span class="token comment">// 将光标移动到末尾</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>上面的demo还存在一个问题，就是在输入法组合文件的过程中也会进行replace，导致中文无法输入，这里我们结合之前研究<a href="http://www.zuo11.com/blog/2019/12/v_model_text.html" target="_blank" rel="noopener noreferrer">v-model无法实时监听输入法组合文字过程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的经验。当组合文字时，不进行替换</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>editdiv<span class="token punctuation">&quot;</span></span> <span class="token attr-name">contenteditable</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alert(document.querySelector(<span class="token punctuation">'</span>#editdiv<span class="token punctuation">'</span>).textContent)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取textContent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alert(document.querySelector(<span class="token punctuation">'</span>#editdiv<span class="token punctuation">'</span>).innerHTML)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取innerHTML<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> keyArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'今天'</span><span class="token punctuation">,</span> <span class="token string">'明天'</span><span class="token punctuation">,</span> <span class="token string">'上午'</span><span class="token punctuation">,</span> <span class="token string">'下午'</span><span class="token punctuation">,</span> <span class="token string">'11点'</span><span class="token punctuation">,</span> <span class="token string">'12点'</span><span class="token punctuation">,</span> <span class="token string">'zuo'</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> composition <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 是否是在输入法组合文字的过程中</span>
  <span class="token keyword">let</span> editdiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#editdiv'</span><span class="token punctuation">)</span>

  editdiv<span class="token punctuation">.</span><span class="token function-variable function">onkeyup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'输入法组合文字过程,composition: '</span><span class="token punctuation">,</span> composition<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>composition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> 
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onkeyup'</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> editdiv<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span>
    
    <span class="token keyword">let</span> curValue <span class="token operator">=</span> editdiv<span class="token punctuation">.</span>textContent
    <span class="token keyword">let</span> needHighlightArr <span class="token operator">=</span> keyArr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> curValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 开始高亮</span>
    needHighlightArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> curValue<span class="token punctuation">)</span>
      <span class="token comment">// 如果之前已经设置了highlight，就不设置了 class=&quot;highlight&quot;</span>
      <span class="token keyword">let</span> nextText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span class=&quot;highlight&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>nextText<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        curValue <span class="token operator">=</span> curValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> nextText<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    editdiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> curValue
    <span class="token function">focusToElementEnd</span><span class="token punctuation">(</span>editdiv<span class="token punctuation">)</span> <span class="token comment">// 将光标移动到末尾</span>
  <span class="token punctuation">}</span>

  editdiv<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'compositionstart'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oncompositionstart'</span><span class="token punctuation">)</span>
    composition <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  editdiv<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'compositionend'</span><span class="token punctuation">,</span>  <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'oncompositionend'</span><span class="token punctuation">)</span>
    composition <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以上，我们基本实现了输入过程中实时高亮关键字的功能，替换的细节还需要优化，这里只是一个实现思路。完整demo参见: <a href="https://github.com/zuoxiaobai/fedemo/blob/master/src/DebugDemo/%E8%BE%93%E5%85%A5%E5%86%85%E5%AE%B9%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%AB%98%E4%BA%AE%E5%85%B3%E9%94%AE%E5%AD%97/index.html" target="_blank" rel="noopener noreferrer">输入内容过程中高亮关键字 | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="v-loading指令的实现-怎么通过一个指令自动加骨架屏"><a href="#v-loading指令的实现-怎么通过一个指令自动加骨架屏" class="header-anchor">#</a> v-loading指令的实现，怎么通过一个指令自动加骨架屏</h3> <p>这里需要用到vue自定义指令，我们先写个v-zloading来实现loading，在loading过程中加骨架屏</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-zloading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  测试
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/images/daily/v_loading.gif" alt="v_loading.gif"></p> <p>由于是全局自定义指令，所以在main.js里写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 挂载dom</span>
<span class="token keyword">function</span> <span class="token function">mountDom</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&quot;relative&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&quot;absolute&quot;</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;zloading&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> htmlStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div style=&quot;positon:absolute;top:0;left:0;z-index:999;width: 100%;margin: 10 auto;&quot;&gt;
      &lt;div class=&quot;fast-loading&quot;&gt;&lt;/div&gt;
      &lt;div class=&quot;fast-loading w40&quot;&gt;&lt;/div&gt;
      &lt;div class=&quot;fast-loading w80&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> htmlStr<span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">&quot;zloading&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">bind</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(&quot;v-zloading bind&quot;);</span>
    <span class="token comment">// console.log(binding, vnode);</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">mountDom</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(&quot;v-zloading update&quot;);</span>
    <span class="token comment">// console.log(el, binding, vnode);</span>
    <span class="token keyword">let</span> zloadingDom <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.zloading&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(&quot;zloading dom&quot;, zloadingDom);</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>zloadingDom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      zloadingDom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> binding<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token string">&quot;block&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      binding<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> <span class="token function">mountDom</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>骨架屏的样式common.css，然后在App.vue里引入</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.fast-loading</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>245<span class="token punctuation">,</span> 245<span class="token punctuation">,</span> 245<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>90deg<span class="token punctuation">,</span> #eee<span class="token punctuation">,</span> #f5f5f5 100%<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token property">animation-name</span><span class="token punctuation">:</span> fastLoading<span class="token punctuation">;</span>
    <span class="token property">animation-timing-function</span><span class="token punctuation">:</span> linear<span class="token punctuation">;</span>
    <span class="token property">animation-duration</span><span class="token punctuation">:</span> 1s<span class="token punctuation">;</span>
    <span class="token property">animation-iteration-count</span><span class="token punctuation">:</span> infinite<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@keyframes</span> fastLoading</span> <span class="token punctuation">{</span>
    <span class="token selector">from</span> <span class="token punctuation">{</span>
    <span class="token property">background-position</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">to</span> <span class="token punctuation">{</span>
    <span class="token property">background-position</span><span class="token punctuation">:</span> 100px 0<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token selector">.w100</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 100% <span class="token punctuation">}</span>
<span class="token selector">.w80</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 80% <span class="token punctuation">}</span>
<span class="token selector">.w60</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 60% <span class="token punctuation">}</span>
<span class="token selector">.w40</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 50% <span class="token punctuation">}</span>
<span class="token selector">.w30</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 30% <span class="token punctuation">}</span>
</code></pre></div><p>这样就模拟实现了一个v-loading, 完整demo参见<a href="https://github.com/zuoxiaobai/fedemo/blob/master/src/vuecli-demo/src/views/vloading/index.vue" target="_blank" rel="noopener noreferrer">v-zloading 实现 | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  注意，指令的实现是放在main.js里面的</p> <p>我们自己简单实现v-loaidng的功能后，再来看看v-loading的源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 截取至element v-loading部分源码 </span>
<span class="token comment">// https://github.com/ElemeFE/element/blob/dev/packages/loading/src/directive.js</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">bind</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//....</span>
      <span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        el<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          text<span class="token operator">:</span> vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">[</span>textExr<span class="token punctuation">]</span> <span class="token operator">||</span> textExr<span class="token punctuation">,</span>
          spinner<span class="token operator">:</span> vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">[</span>spinnerExr<span class="token punctuation">]</span> <span class="token operator">||</span> spinnerExr<span class="token punctuation">,</span>
          background<span class="token operator">:</span> vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">[</span>backgroundExr<span class="token punctuation">]</span> <span class="token operator">||</span> backgroundExr<span class="token punctuation">,</span>
          customClass<span class="token operator">:</span> vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">[</span>customClassExr<span class="token punctuation">]</span> <span class="token operator">||</span> customClassExr<span class="token punctuation">,</span>
          fullscreen<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>binding<span class="token punctuation">.</span>modifiers<span class="token punctuation">.</span>fullscreen
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>instance <span class="token operator">=</span> mask<span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">.</span>$el<span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>maskStyle <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// 如果v-loading设置的值为true，挂载maskdom(toggleLoading方法)</span>
      binding<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> <span class="token function">toggleLoading</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'element-loading-text'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>oldValue <span class="token operator">!==</span> binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">toggleLoading</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">unbind</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>domInserted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>mask <span class="token operator">&amp;&amp;</span>
        el<span class="token punctuation">.</span>mask<span class="token punctuation">.</span>parentNode <span class="token operator">&amp;&amp;</span>
        el<span class="token punctuation">.</span>mask<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">toggleLoading</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modifiers<span class="token operator">:</span> binding<span class="token punctuation">.</span>modifiers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      el<span class="token punctuation">.</span>instance <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>回过头来看看之前element UI在IE下可能会出现的两个bug</p> <ol><li>element v-loading在IE下可能会溢出到全屏的问题，我的理解是，我觉得主要的核心在于在v-loading作用的元素上添加position:relative没有成功</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>originalPosition <span class="token operator">!==</span> <span class="token string">'absolute'</span> <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>originalPosition <span class="token operator">!==</span> <span class="token string">'fixed'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">addClass</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token string">'el-loading-parent--relative'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><ol start="2"><li>element v-loading在IE下可能会关不掉的问题，我的理解是，当binding.value有值时，它是在Vue.nextTick下次渲染周期才挂载loading的dom，如果设置true,false间隔非常快，还没在下个渲染周期，那么其实loading已经是false了，但它才开始挂载，导致关闭不了</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>modifiers<span class="token punctuation">.</span>fullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>originalPosition <span class="token operator">=</span> <span class="token function">getStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">'position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        el<span class="token punctuation">.</span>originalOverflow <span class="token operator">=</span> <span class="token function">getStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">'overflow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        el<span class="token punctuation">.</span>maskStyle<span class="token punctuation">.</span>zIndex <span class="token operator">=</span> PopupManager<span class="token punctuation">.</span><span class="token function">nextZIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">addClass</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>mask<span class="token punctuation">,</span> <span class="token string">'is-fullscreen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">insertDom</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">removeClass</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>mask<span class="token punctuation">,</span> <span class="token string">'is-fullscreen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><p>后面有机会在 node_modules 下修改源码加上console，然后在IE下调试看看，这个是目前来说最好的方法。</p> <p>参考：</p> <ul><li><a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener noreferrer">vue自定义指令 | Vue.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.yuque.com/guoqzuo/yyxr05/hp742n" target="_blank" rel="noopener noreferrer">vue自定义指令笔记 | 语雀<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="element-v-loading在ie下可能会溢出到全屏的问题"><a href="#element-v-loading在ie下可能会溢出到全屏的问题" class="header-anchor">#</a> element v-loading在IE下可能会溢出到全屏的问题</h3> <p>在IE下，有可能出现v-loading指令在loading时不是作用在添加 v-loading 指令的元素区域里，而是溢出到全屏了。</p> <p>这种情况我查了下dom，了解到v-loading是position: absolute布局，而v-loading position不是relatvie 导致溢出到全屏了。这种情况给使用v-loading指令的元素手动加一个 position: relative就可以了。</p> <h3 id="element-v-loading在ie下可能会关不掉的问题"><a href="#element-v-loading在ie下可能会关不掉的问题" class="header-anchor">#</a> element v-loading在IE下可能会关不掉的问题</h3> <p>对于请求非常快的情况，loading一加载很快就关闭。在IE下，可能出现 v-loading设置的值已经是 false，但loading还是一直显示，关闭不了的情况，解决方法是：在关闭loading前，加一个500ms的延时，就没问题了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="macos下怎么将mp4和m4a文件合并"><a href="#macos下怎么将mp4和m4a文件合并" class="header-anchor">#</a> macOS下怎么将mp4和m4a文件合并</h3> <p>可以使用ffmpeg命令行工具，输入如下命令进行合并，注意这个合并时间非常长，要等很久</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下载ffmpeg解压后会有一个ffmpeg-4.2.3-macos64-static文件夹，然后进入这个目录的bin目录下，执行</span>
./ffmpeg -i /Users/kevin/Desktop/17下.mp4 -i /Users/kevin/Desktop/17下.m4a out2.mp4
</code></pre></div><p>其实合并视频和音频可以使用mac下的imovie或者一些其他的视频剪辑软件，比这个要快很多</p> <h3 id="判断一个字符串出现次数最多的字符-并输出其次数"><a href="#判断一个字符串出现次数最多的字符-并输出其次数" class="header-anchor">#</a> 判断一个字符串出现次数最多的字符，并输出其次数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;ababadectwestsfdadsfb&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getMostChar</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">getMostChar</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>思路：我们先实现获取字符串中每个字符出现的次数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getCharCount</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先把字符串切分为数组</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token operator">++</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的例子中，使用了Array.prototype.reduce，如果不知道reduce执行情况，就需要好好看下<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce" target="_blank" rel="noopener noreferrer">mdn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的文档了，上面的代码其实等价于下面的代码，可以看到reduce使用第二参数时，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getCharCount</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先把字符串切分为数组</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div><p>执行下这个函数</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'每个字符串出现的次数'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token function">getCharCount</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {&quot;a&quot;:4,&quot;b&quot;:3,&quot;d&quot;:3,&quot;e&quot;:2,&quot;c&quot;:1,&quot;t&quot;:2,&quot;w&quot;:1,&quot;s&quot;:3,&quot;f&quot;:2}</span>
</code></pre></div><p>根据上面的例子，我们再来思考怎么获取出现次数最多的字符，<strong>其实在reduce里面每次的result我们可以获取到当前字符、以及其出现的次数。我们可以用一个变量来存储出现次数最多的字符，每次遍历是都与这个变量进行比较就可以了</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;ababadectwestsfdadsfb&quot;</span>
<span class="token keyword">function</span> <span class="token function">getMostChar</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先把字符串切分为数组</span>
  <span class="token keyword">let</span> mostChar <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    char<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> charCountObj <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token operator">++</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">&gt;</span> mostChar<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mostChar<span class="token punctuation">.</span>count <span class="token operator">=</span> result<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
      mostChar<span class="token punctuation">.</span>char <span class="token operator">=</span> item
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    mostChar<span class="token punctuation">,</span> <span class="token comment">// 出现次数最多的字符</span>
    charCountObj<span class="token punctuation">,</span> <span class="token comment">// 字符串中所有字符出现的次数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的例子中mostChar输出了出现次数最多的字符以及其次数，那问题来了，如果字符串是 &quot;aabbcc&quot;，那出现最多次数的字符就不只一个了，可能会是数组。我们需要对上面的例子再进行一些增强，如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主要是修改当前字符和出现次数最多的字符相等的情况</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">&gt;</span> mostChar<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mostChar<span class="token punctuation">.</span>count <span class="token operator">=</span> result<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
  mostChar<span class="token punctuation">.</span>char <span class="token operator">=</span> item
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">===</span> mostChar<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> mostChar<span class="token punctuation">.</span>char <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mostChar<span class="token punctuation">.</span>char <span class="token operator">=</span> <span class="token punctuation">[</span>mostChar<span class="token punctuation">.</span>char<span class="token punctuation">,</span> item<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    mostChar<span class="token punctuation">.</span>char<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上就是完整实现了，完整demo参见：<a href="https://github.com/zuoxiaobai/fedemo/blob/master/src/DebugDemo/%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BA%E7%8E%B0%E6%9C%80%E5%A4%9A%E7%9A%84%E5%AD%97%E7%AC%A6/index.html" target="_blank" rel="noopener noreferrer">判断一个字符串出现最多的字符 | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-06-13-周六"><a href="#_2020-06-13-周六" class="header-anchor">#</a> 2020/06/13 周六</h2> <h3 id="symbol和array-prototype-includes不兼容ie-有babel就可以-他的原理是什么"><a href="#symbol和array-prototype-includes不兼容ie-有babel就可以-他的原理是什么" class="header-anchor">#</a> Symbol和Array.prototype.includes不兼容IE，有babel就可以，他的原理是什么</h3> <p>在mdn上可以查相关API的兼容性,可以看到Symbol和Array.prototype.includes是不支持IE的，但我们在vue-cli的项目中，发现使用了这些api，在IE下也可以运行，这是为什么呢？</p> <p>主要是安装了babel，babel有进行转换，当IE不支持某个方法时，会使用替代的pollyfill，那它是怎么打包进项目的？</p> <h4 id="什么是babel"><a href="#什么是babel" class="header-anchor">#</a> 什么是babel？</h4> <p>为什么会有babel，babel出现的原因是JS的一些很好的新特性在一些低浏览器版本或者IE下无法使用。为了用最新的JS语法特性写的代码在某些不兼容的环境下也可以正常运行，babel应运而生。</p> <blockquote><p>Babel is a JavaScript compiler，Babel is a toolchain that is mainly used to convert ECMAScript 2015+ code into a backwards compatible version of JavaScript in current and older browsers or environments. Here are the main things Babel can do for you:</p></blockquote> <p>babel是一个js编译器，他是一个工具链(toolchain)，它主要用于将 ES6(ES2015)+ 的代码转换为在低版本浏览器或执行环境可以跑起来的代码。他主要做了以下事情：</p> <ol><li>Transform syntax(语法转换)</li> <li>Polyfill features that are missing in your target environment (through @babel/polyfill) (当浏览器会运行环境不支持某些API时，通过使用@babel/polyfill补充上对应的API实现内容(polyfill features))</li> <li>Source coude transformations（codemods） 源码转换</li> <li>And more！（check out these videos for inspiration）（更多，查看这些<a href="https://babeljs.io/videos.html" target="_blank" rel="noopener noreferrer">视频<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>以获取灵感）</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Babel Input: ES2015 arrow function</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Babel Output: ES5 equivalent</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="关于-babel-polyfill与core-js"><a href="#关于-babel-polyfill与core-js" class="header-anchor">#</a> 关于@babel/polyfill与core-js</h4> <p>一般polyfill只会提供es2015+相关的内容，且当某些新特性还没到 Stage 4 proposals(第4阶段的提议)之前，是不支持的</p> <p>As of Babel 7.4.0, this package has been deprecated in favor of directly including core-js/stable (to polyfill ECMAScript features) and regenerator-runtime/runtime (needed to use transpiled generator functions):</p> <p>在 Babel 7.4.0 中，@babel/polyfill这个包被废弃了，现在由 <a href="https://github.com/zloirock/core-js" target="_blank" rel="noopener noreferrer"><code>core-js/stable</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来polyfill features</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;core-js/stable&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;regenerator-runtime/runtime&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>参考 <a href="https://babeljs.io/docs/en/babel-polyfill#tc39-proposals" target="_blank" rel="noopener noreferrer">@babel/polyfill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>我们在core-js的源码中找找 symbol 和includes的实现，一般源码目录在 core-js/internals 目录下，下面是 include polyfill的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// /core-js/internals/array-includes.js</span>
<span class="token keyword">var</span> toIndexedObject <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../internals/to-indexed-object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> toLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../internals/to-length'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> toAbsoluteIndex <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../internals/to-absolute-index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `Array.prototype.{ indexOf, includes }` methods implementation</span>
<span class="token keyword">var</span> <span class="token function-variable function">createMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token constant">IS_INCLUDES</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$<span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> fromIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token constant">O</span> <span class="token operator">=</span> <span class="token function">toIndexedObject</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token function">toLength</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token function">toAbsoluteIndex</span><span class="token punctuation">(</span>fromIndex<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value<span class="token punctuation">;</span>
    <span class="token comment">// Array#includes uses SameValueZero equality algorithm</span>
    <span class="token comment">// eslint-disable-next-line no-self-compare</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">IS_INCLUDES</span> <span class="token operator">&amp;&amp;</span> el <span class="token operator">!=</span> el<span class="token punctuation">)</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>length <span class="token operator">&gt;</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token constant">O</span><span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// eslint-disable-next-line no-self-compare</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// ??????</span>
    <span class="token comment">// Array#indexOf ignores holes, Array#includes - not</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span>length <span class="token operator">&gt;</span> index<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">IS_INCLUDES</span> <span class="token operator">||</span> index <span class="token keyword">in</span> <span class="token constant">O</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">O</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">===</span> el<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">IS_INCLUDES</span> <span class="token operator">||</span> index <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">return</span> <span class="token operator">!</span><span class="token constant">IS_INCLUDES</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// `Array.prototype.includes` method</span>
  <span class="token comment">// https://tc39.github.io/ecma262/#sec-array.prototype.includes</span>
  includes<span class="token operator">:</span> <span class="token function">createMethod</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// `Array.prototype.indexOf` method</span>
  <span class="token comment">// https://tc39.github.io/ecma262/#sec-array.prototype.indexof</span>
  indexOf<span class="token operator">:</span> <span class="token function">createMethod</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>tc39官网介绍：When the includes method is called, the following steps are taken:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// https://tc39.github.io/ecma262/#sec-array.prototype.includes</span>
<span class="token number">1.</span> Let <span class="token constant">O</span> be <span class="token operator">?</span> <span class="token function">ToObject</span><span class="token punctuation">(</span><span class="token keyword">this</span> value<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token number">2.</span> Let len be <span class="token operator">?</span> <span class="token function">LengthOfArrayLike</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token number">3.</span> If len is <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">.</span>
<span class="token number">4.</span> Let n be <span class="token operator">?</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span>fromIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token number">5.</span> Assert<span class="token operator">:</span> If fromIndex is <span class="token keyword">undefined</span><span class="token punctuation">,</span> then n is <span class="token number">0.</span>
<span class="token number">6.</span> If n ≥ <span class="token number">0</span><span class="token punctuation">,</span> then
     Let k be n<span class="token punctuation">.</span>
   Else<span class="token punctuation">,</span>
     Let k be len <span class="token operator">+</span> n<span class="token punctuation">.</span>
     If k <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">set</span> k to <span class="token number">0.</span>
<span class="token number">8.</span> Repeat<span class="token punctuation">,</span> <span class="token keyword">while</span> k <span class="token operator">&lt;</span> len<span class="token punctuation">,</span>
     Let elementK be the result <span class="token keyword">of</span> <span class="token operator">?</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">,</span> <span class="token operator">!</span> <span class="token function">ToString</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
     If <span class="token function">SameValueZero</span><span class="token punctuation">(</span>searchElement<span class="token punctuation">,</span> elementK<span class="token punctuation">)</span> is <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">.</span>
     Set k to k <span class="token operator">+</span> <span class="token number">1.</span>
<span class="token number">9.</span> Return <span class="token boolean">false</span><span class="token punctuation">.</span>
</code></pre></div><p>关于 sameValueZero算法，参见 <a href="https://tc39.es/ecma262/#sec-samevaluezero" target="_blank" rel="noopener noreferrer">samevaluezero tc39<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="symbol-polyfill实现"><a href="#symbol-polyfill实现" class="header-anchor">#</a> symbol polyfill实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// `Symbol.prototype.description` getter</span>
<span class="token comment">// https://tc39.github.io/ecma262/#sec-symbol.prototype.description</span>
<span class="token comment">// /core-js/modules/es.symbol.description.js</span>
<span class="token keyword">var</span> NativeSymbol <span class="token operator">=</span> global<span class="token punctuation">.</span>Symbol<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DESCRIPTORS</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> NativeSymbol <span class="token operator">==</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'description'</span> <span class="token keyword">in</span> <span class="token class-name">NativeSymbol</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token operator">||</span>
  <span class="token comment">// Safari 12 bug</span>
  <span class="token function">NativeSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>description <span class="token operator">!==</span> <span class="token keyword">undefined</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> EmptyStringDescriptionStore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// wrap Symbol constructor for correct work with undefined description</span>
  <span class="token keyword">var</span> <span class="token function-variable function">SymbolWrapper</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> description <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">SymbolWrapper</span>
      <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">NativeSymbol</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>
      <span class="token comment">// in Edge 13, String(Symbol(undefined)) === 'Symbol(undefined)'</span>
      <span class="token operator">:</span> description <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token function">NativeSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">NativeSymbol</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>description <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> EmptyStringDescriptionStore<span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">copyConstructorProperties</span><span class="token punctuation">(</span>SymbolWrapper<span class="token punctuation">,</span> NativeSymbol<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> symbolPrototype <span class="token operator">=</span> <span class="token class-name">SymbolWrapper</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">NativeSymbol</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  symbolPrototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> SymbolWrapper<span class="token punctuation">;</span>

  <span class="token keyword">var</span> symbolToString <span class="token operator">=</span> symbolPrototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>
  <span class="token keyword">var</span> native <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token function">NativeSymbol</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'Symbol(test)'</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> regexp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^Symbol\((.*)\)[^)]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
  <span class="token function">defineProperty</span><span class="token punctuation">(</span>symbolPrototype<span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">description</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> symbol <span class="token operator">=</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> string <span class="token operator">=</span> <span class="token function">symbolToString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">has</span><span class="token punctuation">(</span>EmptyStringDescriptionStore<span class="token punctuation">,</span> symbol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> desc <span class="token operator">=</span> native <span class="token operator">?</span> string<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> string<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regexp<span class="token punctuation">,</span> <span class="token string">'$1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> desc <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="babel是怎么自动打包进vue-cli项目里的"><a href="#babel是怎么自动打包进vue-cli项目里的" class="header-anchor">#</a> babel是怎么自动打包进vue-cli项目里的</h4> <p>在babel github官方仓库里面有一个 <code>babel-loader</code> 项目，主要是Babel loader for webpack，另外vue-cli的package.json里也引入了 <code>@vue/cli-plugin-babel</code>，后面有时间再深入研究</p> <h3 id="用koa-mock接口时router-allowedmethods-这个中间件是用来做什么的"><a href="#用koa-mock接口时router-allowedmethods-这个中间件是用来做什么的" class="header-anchor">#</a> 用koa mock接口时router.allowedMethods()这个中间件是用来做什么的？</h3> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>为什么要加router.allowedMethods()中间件呢？我们写个demo来测试下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// app.use(router.routes()).use(router.allowedMethods())</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'9000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server listen on 9000 port'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>上面的例子中，我们定义一个 /user 接口，他需要使用post请求方法。这里我们先通过get方法来请求这个接口试试</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -v http://127.0.0.1:9000/user
<span class="token comment"># 以下是请求响应的内容，可以看到接口会返回404，因为我们接口现在只能是post请求的</span>
* Connected to <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> port <span class="token number">9000</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">&gt;</span> GET /user HTTP/1.1
<span class="token operator">&gt;</span> Host: <span class="token number">127.0</span>.0.1:9000
<span class="token operator">&gt;</span> User-Agent: curl/7.64.1
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">404</span> Not Found
<span class="token operator">&lt;</span> Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">&lt;</span> Content-Length: <span class="token number">9</span>
<span class="token operator">&lt;</span> Date: Thu, <span class="token number">25</span> Jun <span class="token number">2020</span> 09:13:14 GMT
<span class="token operator">&lt;</span> Connection: keep-alive
<span class="token operator">&lt;</span> 
</code></pre></div><p>我们再调整下上面的demo，使用 router.allowedMethods() 中间件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.use(router.routes())</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>再发一遍get请求</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -v http://127.0.0.1:9000/user
<span class="token comment"># 以下是返回结果</span>
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to <span class="token number">127.0</span>.0.1 <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> port <span class="token number">9000</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">&gt;</span> GET /user HTTP/1.1
<span class="token operator">&gt;</span> Host: <span class="token number">127.0</span>.0.1:9000
<span class="token operator">&gt;</span> User-Agent: curl/7.64.1
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">405</span> Method Not Allowed
<span class="token operator">&lt;</span> Allow: POST
<span class="token operator">&lt;</span> Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">&lt;</span> Content-Length: <span class="token number">18</span>
<span class="token operator">&lt;</span> Date: Thu, <span class="token number">25</span> Jun <span class="token number">2020</span> 09:13:55 GMT
<span class="token operator">&lt;</span> Connection: keep-alive
<span class="token operator">&lt;</span> 
</code></pre></div><p>我们可以看到加router.allowedMethods()中间件和不加这个中间件的区别，当我们定义了post方法接口却发送对应的get请求时，执行结果对比</p> <table><thead><tr><th>类型</th> <th>响应状态码</th> <th>响应头变化</th></tr></thead> <tbody><tr><td>默认情况</td> <td>404 Not Found</td> <td>无</td></tr> <tr><td>router.allowedMethods()</td> <td>405 Method Not Allowed</td> <td>新增响应头 Allow: POST</td></tr></tbody></table> <p>下面我们来看下对应的源码：<a href="https://github.com/koajs/router/blob/master/" target="_blank" rel="noopener noreferrer">koa-router源码 | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>由于它是一个npm包，我们先在package.json里面看看他的入口</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># package.json里面的main就是我们 require对应npm包后，引入的实际文件地址</span>
<span class="token string">&quot;main&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;lib/router.js&quot;</span>,
</code></pre></div><p>也就是源码入口在lib/router.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 源码截取至https://github.com/koajs/router/blob/master/lib/router.js</span>
<span class="token comment">/**
 * Returns separate middleware for responding to `OPTIONS` requests with
 * an `Allow` header containing the allowed methods, as well as responding
 * with `405 Method Not Allowed` and `501 Not Implemented` as appropriate.
 * @param {Object=} options
 * @param {Boolean=} options.throw throw error instead of setting status and header
 * @param {Function=} options.notImplemented throw the returned value in place of the default NotImplemented error
 * @param {Function=} options.methodNotAllowed throw the returned value in place of the default MethodNotAllowed error
 * @returns {Function}
 */</span>
<span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">allowedMethods</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> implemented <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> allowed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>status <span class="token operator">||</span> ctx<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ctx<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> route <span class="token operator">=</span> ctx<span class="token punctuation">.</span>matched<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> route<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> method <span class="token operator">=</span> route<span class="token punctuation">.</span>methods<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            allowed<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> method<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> allowedArr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>allowed<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">~</span>implemented<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>throw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> notImplementedThrowable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>notImplemented <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">notImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// set whatever the user returns from their function</span>
            <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpError<span class="token punctuation">.</span>NotImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">throw</span> notImplementedThrowable<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">501</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> allowedArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>allowedArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> allowedArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowed<span class="token punctuation">[</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>throw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> notAllowedThrowable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>methodNotAllowed <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> 
              <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">methodNotAllowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// set whatever the user returns from their function</span>
              <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpError<span class="token punctuation">.</span>MethodNotAllowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token keyword">throw</span> notAllowedThrowable<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">405</span><span class="token punctuation">;</span>
              ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> allowedArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>怎么弄清楚源码的执行呢？一般我们可以在源码里加入一些console.log，来打印一些关键的信息，注意:</p> <ol><li>一般npm install koa-router --save后，当前目录下的node_modules里面会有对应的源码，可以在里面修改源码</li> <li>修改源码后，需要ctrl+s一下index.js触发nodemon重启服务，这样执行的才是修改过源码后的代码</li></ol> <p>以下是我在调试这个demo时，在源码中加的console信息，如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">allowedMethods</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> implemented <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'koa router log, implemented'</span><span class="token punctuation">,</span> implemented<span class="token punctuation">)</span>
  <span class="token comment">// [ 'HEAD', 'OPTIONS', 'GET', 'PUT', 'PATCH', 'POST', 'DELETE' ]</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> allowed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>status <span class="token operator">||</span> ctx<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ctx.matched'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>matched<span class="token punctuation">)</span>
        <span class="token comment">//  ctx.matched 当前请求匹配到的路由，当发送 /user 请求时，这个数组只有一个元素</span>
        <span class="token comment">// [ Layer {</span>
        <span class="token comment">//   opts:</span>
        <span class="token comment">//    { end: true,</span>
        <span class="token comment">//      name: null,</span>
        <span class="token comment">//      sensitive: false,</span>
        <span class="token comment">//      strict: false,</span>
        <span class="token comment">//      prefix: '',</span>
        <span class="token comment">//      ignoreCaptures: undefined },</span>
        <span class="token comment">//   name: null,</span>
        <span class="token comment">//   methods: [ 'POST' ],</span>
        <span class="token comment">//   paramNames: [],</span>
        <span class="token comment">//   stack: [ [Function] ],</span>
        <span class="token comment">//   path: '/user',</span>
        <span class="token comment">//   regexp: /^\/user[\/#\?]?$/i } ]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ctx<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> route <span class="token operator">=</span> ctx<span class="token punctuation">.</span>matched<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token comment">// 有些接口可能支持多种methods请求，这里遍历当前接口支持的所有方法数组,/user 只支持一个post方法</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> route<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> method <span class="token operator">=</span> route<span class="token punctuation">.</span>methods<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            allowed<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> method<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'allowed'</span><span class="token punctuation">,</span> allowed<span class="token punctuation">)</span> <span class="token comment">// { POST: 'POST' }</span>

        <span class="token keyword">const</span> allowedArr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>allowed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['POST']</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'implemented.indexOf(ctx.method)'</span><span class="token punctuation">,</span> implemented<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>

        <span class="token comment">// if (!~value) 等价于 if (value === -1)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">~</span>implemented<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ctx.method  GET</span>
          <span class="token comment">// 如果当前请求方法不是下面数组中的某一种</span>
          <span class="token comment">// [ 'HEAD', 'OPTIONS', 'GET', 'PUT', 'PATCH', 'POST', 'DELETE' ]</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>throw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> notImplementedThrowable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>notImplemented <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">notImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// set whatever the user returns from their function</span>
            <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpError<span class="token punctuation">.</span>NotImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">throw</span> notImplementedThrowable<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">501</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> allowedArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>allowedArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 当前路由404，但对应的接口可以使用其他的method进行请求</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> allowedArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowed<span class="token punctuation">[</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// allowed: { POST: 'POST' } ctx.method: GET</span>
            <span class="token comment">// 当前请求方法，并不在接口允许的方法(allowed)里面</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>throw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// throw error instead of setting status and header</span>
              <span class="token keyword">let</span> notAllowedThrowable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>methodNotAllowed <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> 
              <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">methodNotAllowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// set whatever the user returns from their function</span>
              <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpError<span class="token punctuation">.</span>MethodNotAllowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token keyword">throw</span> notAllowedThrowable<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token comment">// 默认请求，如果不传 throw方法的情况</span>
              ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">405</span><span class="token punctuation">;</span>
              ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> allowedArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>总结，router.allowedMethods() 的执行逻辑大致如下</p> <ol><li>如果当前接口为404时(!ctx.status的情况貌似没遇到过)，才执行该中间件的逻辑</li> <li>遍历当前请求匹配到的路由信息数组 ctx.matched，将匹配到的路由允许的methods存入 allowed 对象</li> <li>判断当前请求方法ctx.method是否是正常的请求方法，如果不是，抛异常，注意抛异常时，如果调用该中间件时有传入throw参数，则表示自己处理异常，这种情况默认返回501，提示服务异常</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注意这里用到了 !~ 来判断是否 === -1，这里可以使用ES2016新出的Array.prototype.includes来判断</span>
<span class="token comment">// if (!~value) 等价于 if (value === -1)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">~</span>implemented<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//</span>
</code></pre></div><ol start="4"><li>如果当前路由404，但对应的接口可以使用其他的method进行请求，如果是 options(或预检请求)，不返回404，返回200，并设置allow响应头</li> <li>如果当前请求方法不在允许的方法里面，如果传入了throw自己处理异常，否则返回 405 method not allowed，且设置allow响应头</li></ol> <h2 id="_2020-06-12-周五"><a href="#_2020-06-12-周五" class="header-anchor">#</a> 2020/06/12 周五</h2> <h3 id="component用is进行组件切换时会触发哪些钩子函数-加了keep-alive后呢"><a href="#component用is进行组件切换时会触发哪些钩子函数-加了keep-alive后呢" class="header-anchor">#</a> component用is进行组件切换时会触发哪些钩子函数，加了keep-alive后呢？</h3> <p>假设动态组件component使用is控制组件显示，默认显示为A组件，可以切换到B组件。问：</p> <p><strong>首次进入页面以及用is切换组件时，会触发A/B组件的哪些钩子函数，加了keep-alive后呢？</strong></p> <p>先给出结论</p> <ol><li><p>如果不加keep-alive，和正常的进入页面和离开页面触发的钩子函数一致。</p></li> <li><p>如果加了keep-alive，组件首次加载才会触发 created,mounted等钩子函数，切换时就不会触发created,mounted,beforedestroyed等，所以额外加一个activated和deactivated钩子来提示页面已切换，离开当前页面，才会销毁A/B两个组件触发beforeDestroyed和destroyed两个钩子</p></li></ol> <p>这里面涉及到一些钩子函数的触发顺序问题，我们来写详细的demo来验证下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.vue 主页面 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>当前组件{{ curComp }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curComp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compA<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>组件A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curComp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compB<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>组件B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gotoOtherPage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>离开当前页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 这里用来打开或关闭keep-alive --&gt;</span>
      <span class="token comment">&lt;!-- &lt;keep-alive&gt; --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curComp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- &lt;/keep-alive&gt; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">compA</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">compB</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./B&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      curComp<span class="token operator">:</span> <span class="token string">&quot;compA&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">gotoOtherPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/echarts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index beforeCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index beforeMount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index mounted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index beforeUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index activated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deactivated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index deactivated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index beforeDestroy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index destroyed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">errorCaptured</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index errorCaptured&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>组件A.vue和B.vue代码基本一致，下面是A.vue示例，B.vue只是将A改为了B</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- A.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    我是A组件内容
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A beforeCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A beforeMount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A mounted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A beforeUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A activated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deactivated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A deactivated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A beforeDestroy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A destroyed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">errorCaptured</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A errorCaptured&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>keep-alive和非keep-alive钩子函数执行对比图</p> <table><thead><tr><th>类别</th> <th>非keep-alive</th> <th>keep-alive</th></tr></thead> <tbody><tr><td>首次进入</td> <td>index beforeCreate<br>index created<br>index beforeMount<br>index mounted<br>index beforeUpdate<br>A beforeCreate<br>A created<br>A beforeMount<br>A mounted<br>index updated<br></td> <td>index beforeCreate<br>index created<br>index beforeMount<br>index mounted<br>index beforeUpdate<br>A beforeCreate<br>A created<br>A beforeMount<br>A mounted<br>A activated<br>index updated</td></tr> <tr><td>切换到B组件</td> <td>index beforeUpdate<br>A beforeDestroy<br>A destroyed<br>index updated<br>index beforeUpdate<br>B beforeCreate<br>B created<br>B beforeMount<br>B mounted<br>index updated</td> <td>A deactivated<br>index updated<br>index beforeUpdate<br>B beforeCreate<br>B created<br>B beforeMount<br>B mounted<br>B activated<br>index updated</td></tr> <tr><td>再切回到A组件</td> <td>index beforeUpdate<br>A beforeCreate<br>A created<br>A beforeMount<br>B beforeDestroy<br>B destroyed<br>A mounted<br>index updated</td> <td>index beforeUpdate<br>B deactivated<br>A activated<br>index updated</td></tr> <tr><td>再切回B组件</td> <td>index beforeUpdate<br>B beforeCreate<br>B created<br>B beforeMount<br>A beforeDestroy<br>A destroyed<br>B mounted<br>index updated</td> <td>index beforeUpdate<br>A deactivated<br>B activated<br>index updated</td></tr> <tr><td>点击离开当前页面</td> <td>index beforeDestroy<br>B beforeDestroy<br>B destroyed<br>index destroyed</td> <td>index beforeDestroy<br>B deactivated<br>A beforeDestroy<br>A destroyed<br>B beforeDestroy<br>B destroyed<br>index destroyed</td></tr></tbody></table> <p>完整demo地址，参见 <a href="https://github.com/zuoxiaobai/fedemo/tree/master/src/vuecli-demo/src/views/vuehooks/" target="_blank" rel="noopener noreferrer">vue hooks demo | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="component动态组件与使用v-if控制组件显示有什么区别"><a href="#component动态组件与使用v-if控制组件显示有什么区别" class="header-anchor">#</a> component动态组件与使用v-if控制组件显示有什么区别</h3> <p>component动态组件可以理解为它就是v-if控制组件显示的语法糖。我们用一个例子来测试，之前我们写过compoennt用is切换时的钩子函数demo，我们把demo改写下，使用 v-if来替换component，对比页面渲染以及钩子函数的执行情况。改写如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 这里用来打开或关闭keep-alive --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &lt;component :is=&quot;curComp&quot;&gt;&lt;/component&gt; --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>curComp === <span class="token punctuation">'</span>compA<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-b</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-b</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>实验证明，component和v-if的页面显示效果，钩子函数执行情况一模一样，不管是否加keep-alive，完整demo参见 <a href="https://github.com/zuoxiaobai/fedemo/tree/master/src/vuecli-demo/src/views/componentAndIs/" target="_blank" rel="noopener noreferrer">component vs v-if | github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="element-tabs组件切换页面时-显示或隐藏的组件会触发哪些钩子函数"><a href="#element-tabs组件切换页面时-显示或隐藏的组件会触发哪些钩子函数" class="header-anchor">#</a> element tabs组件切换页面时，显示或隐藏的组件会触发哪些钩子函数</h3> <p>这里主要是要弄清楚el-tabs是怎么实现组件切换的，使用el-tab-pane slot和不用这个插槽触发的钩子函数会相同吗？</p> <p>如果不使用el-tab-pane的slot，只使用tab的导航，下面的内容自己控制，就看是使用component还是v-if来控制了，这种情况el-tabs组件不会干扰切换的逻辑。</p> <p>问题来了，如果内容放到了el-tab-pane的slot呢？他有一个lazy属性，用来设置某个tab标签页是否延迟渲染，这个会对钩子函数有什么影响呢？我们改写上面的例子，通过demo来看看</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>当前组件{{ activeName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gotoOtherPage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>离开当前页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 不使用el-tab-pane slot的逻辑，仅用tab控制顶部tab栏 --&gt;</span>
    <span class="token comment">&lt;!-- &lt;el-tabs v-model=&quot;activeName&quot; @tab-click=&quot;handleClick&quot;&gt;
      &lt;el-tab-pane label=&quot;组件A&quot; name=&quot;compA&quot;&gt;&lt;/el-tab-pane&gt;
      &lt;el-tab-pane label=&quot;组件B&quot; name=&quot;compB&quot;&gt;&lt;/el-tab-pane&gt;
    &lt;/el-tabs&gt;
    &lt;div&gt;
      &lt;keep-alive&gt;
        &lt;component :is=&quot;activeName&quot;&gt;&lt;/component&gt;
      &lt;/keep-alive&gt;
    &lt;/div&gt; --&gt;</span>

    <span class="token comment">&lt;!-- 使用el-tab-pane slot --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tabs</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>activeName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@tab-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>组件A<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compA<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:lazy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- &lt;keep-alive&gt; --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- &lt;comp-a v-if=&quot;activeName === 'compA'&quot;&gt;&lt;/comp-a&gt; --&gt;</span>
        <span class="token comment">&lt;!-- &lt;/keep-alive&gt; --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>组件B<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:lazy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- &lt;keep-alive&gt; --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-b</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- &lt;comp-b v-if=&quot;activeName === 'compB'&quot;&gt;&lt;/comp-b&gt; --&gt;</span>
        <span class="token comment">&lt;!-- &lt;/keep-alive&gt; --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tabs</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol><li>如果默认lazy为false，且slot直接写对应的组件
首次进入会触发A/B/index三个组件的新进入页面相关钩子，<strong>再切换到B，不会触发A/B的任何钩子</strong>，仅触发index的updated相关钩子, 再切换到A或来回切换，同上不会触发A/B任何钩子，离开页面，触发A/B/index的destroy相关钩子</li> <li>如果lazy设置为ture，且slot直接写对应的组件
首次进入会触发A/index两个组件的新进入页面相关钩子，<strong>再切换到B，不会触发A的任何钩子</strong>，仅触发index的updated相关钩子以及新进入页面B的钩子, 再切换到A或来回切换，不会触发A/B任何钩子，离开页面，触发A/B/index的destroy相关钩子</li> <li>如果lazy为false，slot里对应的组件用keep-alive包裹
首次进入会触发A/B/index三个组件的新进入页面相关钩子，外加A/B的activated钩子；再切换到B，不会触发A/B的任何钩子，仅触发index的updated相关钩子, 再切换到A或来回切换，同上不会触发A/B任何钩子，离开页面，触发A/B/index的destroy相关钩子以及A/B的deactivated相关钩子</li> <li>如果lazy为true，slot里对应的组件用keep-alive包裹
首次进入会触发A/index两个组件的新进入页面相关钩子，外加A的activated钩子；再切换到B，不会触发A的任何钩子，仅触发index的updated相关钩子以及新进入页面B的钩子外加B的activated钩子, 再切换到A或来回切换，不会触发A/B任何钩子，离开页面，触发A/B/index的destroy相关钩子</li> <li>如果lazy默认为false或者true，给组件加上v-if（或者component)来控制组件显示
和不使用slot，单独在外部用v-if时的钩子保持一致</li> <li>如果lazy默认为false或true，给组件加上v-if（或者component)来控制组件显示，再加上keep-alive
和不使用slot，单独在外部用v-if时的钩子并加上keep-avlie保持一致</li></ol> <p><strong>综上，el-tabs组件el-tab-pane的slot有好多种情况，会比较混乱，对于需要精准控制tabs组件切换逻辑的场景，个人建议不要使用他的slot，除非你能很明确的知道其钩子函数的执行顺序与逻辑，最好还是仅使用其顶部tab，下面的主内容写在外部，不要写在el-tab-pane内部</strong>。其实主要区别是，如果slot里不用v-if控制，首次加载后，A/B来回切换不会触发A/B的任何钩子函数。完整demo参见 <a href="https://github.com/zuoxiaobai/fedemo/tree/master/src/vuecli-demo/src/views/elementTabs/" target="_blank" rel="noopener noreferrer">el-tabs 切换逻辑demo| github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="keep-alive组件切换显示时-avtivated和created同时触发的问题"><a href="#keep-alive组件切换显示时-avtivated和created同时触发的问题" class="header-anchor">#</a> keep-alive组件切换显示时，avtivated和created同时触发的问题</h3> <p>这里分两种情况</p> <h4 id="每次进入页面都需要刷新所有数据"><a href="#每次进入页面都需要刷新所有数据" class="header-anchor">#</a> 每次进入页面都需要刷新所有数据</h4> <p>要么去掉该组件的keep-alive，要么将进入页面请求数据的操作，全部放到activated，在created或mounted就不请求数据了。</p> <h4 id="首次进入页面请求所有数据-再次切换到该页面时刷新部分数据"><a href="#首次进入页面请求所有数据-再次切换到该页面时刷新部分数据" class="header-anchor">#</a> 首次进入页面请求所有数据，再次切换到该页面时刷新部分数据</h4> <p>首次进入created,activated钩子函数都会触发，再次切换到该页面时只会触发activated钩子，且一般先触发created钩子，然后再触发activated钩子</p> <p>所以，在这种情况下，<strong>可以把首次进入才需要请求的数据放到created里执行，把首次进入和再次切回页面都需要请求的数据放到activated里执行</strong>。</p> <p>另外也可以把所有请求操作都放到created，然后在activated里写再次进入页面时刷新部分数据的逻辑。这种情况，会出现有些接口在首次加载请求两次的问题，怎么解决这个问题呢？你可以在created里设置标记值 alreadyCreated 为true，当进入activated钩子时，只有alreadyCreated为false才执行刷新数据操作。true就不执行，并将alreadyCreated设置为false</p> <p>参考：<a href="https://cn.vuejs.org/v2/api/#activated" target="_blank" rel="noopener noreferrer">选项 / 生命周期钩子 activated | Vue.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-06-11-周四"><a href="#_2020-06-11-周四" class="header-anchor">#</a> 2020/06/11 周四</h2> <h3 id="手动触发window-resize事件-fix改变窗口大小后其他tab页echart图表显示异常的问题"><a href="#手动触发window-resize事件-fix改变窗口大小后其他tab页echart图表显示异常的问题" class="header-anchor">#</a> 手动触发window resize事件，fix改变窗口大小后其他tab页echart图表显示异常的问题</h3> <p>在echarts图表组件里，有时候需要图表大小自适应浏览器窗口大小。这种情况echart宽高都会设定为100%，依赖父元素的宽高。然后再监听window的resize事件，当窗口大小改变后，重绘图表。那么问题来了</p> <p>在单个页面里没有问题，但在tab组件切换时，各个tab页是懒加载(keep-alive)的状态，tab切换时，会有页面组件被隐藏，但由于是keep-alive的，所以不会触发beforeDesotry事件，也就是没有销毁组件只是隐藏了。</p> <p>dom被隐藏后，window的resize事件没有被移除。导致在其他页面调整窗口大小，被隐藏的页面也会执行重绘操作，宽高都是百分比的，被隐藏后，宽高会异常，导致图表显示异常</p> <p>除非每次切tab都重绘图表或者不使用keep-alive每次都刷新页面，才不会有问题。最后想了个方法，每次点击tab手动触发window的resize事件进行重绘，下面是手动触发window resize事件的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">tabClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'tab click'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token comment">// 触发window的resize事件</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> resizeEvent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'Event'</span><span class="token punctuation">)</span>
    resizeEvent<span class="token punctuation">.</span><span class="token function">initEvent</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>resizeEvent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为什么不在tab切换后的activated里重绘图表呢？由于有十几个图表，这就需要写十几个手动重绘的函数，在tabclick的事件里写是改动最小的</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/10/29 下午10:59:19</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daily/2020-07.html" class="prev">
        2020年07月技术日常
      </a></span> <span class="next"><a href="/daily/2020-05.html">
        2020年05月技术日常
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.aea08731.js" defer></script><script src="/assets/js/2.3f8a6b0b.js" defer></script><script src="/assets/js/42.154c7e55.js" defer></script><script src="/assets/js/3.018b29e2.js" defer></script>
  </body>
</html>
