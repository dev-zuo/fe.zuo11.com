<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2020年02月技术日常 | 左小白的前端笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="左小白的前端笔记，归纳整理自己在前端工作、学习中的一些心得笔记，有利于前端知识系统化。包括 Vue.js、前端工程化（TypeScript、Node.js、webpack）、Docker、JS/ES6、CSS/CSS3、HTML/HTML5、数据可视化、计算机基础、英语等笔记。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.594b47db.css" as="style"><link rel="preload" href="/assets/js/app.46527dc9.js" as="script"><link rel="preload" href="/assets/js/2.4b3539f1.js" as="script"><link rel="preload" href="/assets/js/36.14151663.js" as="script"><link rel="preload" href="/assets/js/3.e6a4dd76.js" as="script"><link rel="prefetch" href="/assets/js/10.35d8cd15.js"><link rel="prefetch" href="/assets/js/100.e83ab653.js"><link rel="prefetch" href="/assets/js/101.95d44dea.js"><link rel="prefetch" href="/assets/js/102.2f2f2a57.js"><link rel="prefetch" href="/assets/js/103.d0302a16.js"><link rel="prefetch" href="/assets/js/104.8ed98df3.js"><link rel="prefetch" href="/assets/js/105.f630f4d0.js"><link rel="prefetch" href="/assets/js/106.ccff4e18.js"><link rel="prefetch" href="/assets/js/107.98a6402f.js"><link rel="prefetch" href="/assets/js/108.d9a31571.js"><link rel="prefetch" href="/assets/js/109.cd3ec475.js"><link rel="prefetch" href="/assets/js/11.26cf8fbc.js"><link rel="prefetch" href="/assets/js/110.bc3c279a.js"><link rel="prefetch" href="/assets/js/111.1893973e.js"><link rel="prefetch" href="/assets/js/112.922df617.js"><link rel="prefetch" href="/assets/js/113.ef68bfb9.js"><link rel="prefetch" href="/assets/js/114.a9c60c48.js"><link rel="prefetch" href="/assets/js/115.d80bc2ad.js"><link rel="prefetch" href="/assets/js/116.5b821540.js"><link rel="prefetch" href="/assets/js/117.6be7f264.js"><link rel="prefetch" href="/assets/js/118.0a44346e.js"><link rel="prefetch" href="/assets/js/119.6917fa5a.js"><link rel="prefetch" href="/assets/js/12.f288e29d.js"><link rel="prefetch" href="/assets/js/120.bc52589f.js"><link rel="prefetch" href="/assets/js/121.e9908901.js"><link rel="prefetch" href="/assets/js/122.28b8dab2.js"><link rel="prefetch" href="/assets/js/123.02f86128.js"><link rel="prefetch" href="/assets/js/124.ede64f08.js"><link rel="prefetch" href="/assets/js/125.92bfe4ac.js"><link rel="prefetch" href="/assets/js/126.5bde8c26.js"><link rel="prefetch" href="/assets/js/127.61e73300.js"><link rel="prefetch" href="/assets/js/128.8c08ecf5.js"><link rel="prefetch" href="/assets/js/129.7f7fbd5f.js"><link rel="prefetch" href="/assets/js/13.a8b44eb9.js"><link rel="prefetch" href="/assets/js/130.5e40bde2.js"><link rel="prefetch" href="/assets/js/131.5a322aeb.js"><link rel="prefetch" href="/assets/js/132.a6fb1b05.js"><link rel="prefetch" href="/assets/js/133.e53ea4a2.js"><link rel="prefetch" href="/assets/js/134.20b7cd06.js"><link rel="prefetch" href="/assets/js/135.cf018cc3.js"><link rel="prefetch" href="/assets/js/136.f895ab3f.js"><link rel="prefetch" href="/assets/js/137.e8eff4ca.js"><link rel="prefetch" href="/assets/js/138.04825041.js"><link rel="prefetch" href="/assets/js/139.068501ab.js"><link rel="prefetch" href="/assets/js/14.63576ad2.js"><link rel="prefetch" href="/assets/js/140.68f5fa88.js"><link rel="prefetch" href="/assets/js/141.516a2007.js"><link rel="prefetch" href="/assets/js/142.c61087d7.js"><link rel="prefetch" href="/assets/js/143.145902b7.js"><link rel="prefetch" href="/assets/js/144.660ab86e.js"><link rel="prefetch" href="/assets/js/145.13a7d58a.js"><link rel="prefetch" href="/assets/js/146.c9f2d3d7.js"><link rel="prefetch" href="/assets/js/147.b6fefe21.js"><link rel="prefetch" href="/assets/js/148.ef130e5d.js"><link rel="prefetch" href="/assets/js/149.3c7b1581.js"><link rel="prefetch" href="/assets/js/15.6d52c5f9.js"><link rel="prefetch" href="/assets/js/150.573f9e0a.js"><link rel="prefetch" href="/assets/js/151.f351aca7.js"><link rel="prefetch" href="/assets/js/152.4677e214.js"><link rel="prefetch" href="/assets/js/153.8ae4408a.js"><link rel="prefetch" href="/assets/js/154.af82a6fb.js"><link rel="prefetch" href="/assets/js/16.6a143e09.js"><link rel="prefetch" href="/assets/js/17.92df7b99.js"><link rel="prefetch" href="/assets/js/18.50bc4846.js"><link rel="prefetch" href="/assets/js/19.310fceff.js"><link rel="prefetch" href="/assets/js/20.e5894862.js"><link rel="prefetch" href="/assets/js/21.8dd45d89.js"><link rel="prefetch" href="/assets/js/22.f96f7f7f.js"><link rel="prefetch" href="/assets/js/23.9670a582.js"><link rel="prefetch" href="/assets/js/24.9b6f6c0e.js"><link rel="prefetch" href="/assets/js/25.f7468bea.js"><link rel="prefetch" href="/assets/js/26.2fa477e0.js"><link rel="prefetch" href="/assets/js/27.4dc6c393.js"><link rel="prefetch" href="/assets/js/28.4a449035.js"><link rel="prefetch" href="/assets/js/29.0039a6c5.js"><link rel="prefetch" href="/assets/js/30.8385df39.js"><link rel="prefetch" href="/assets/js/31.6ccde381.js"><link rel="prefetch" href="/assets/js/32.e0ed3466.js"><link rel="prefetch" href="/assets/js/33.9f453fac.js"><link rel="prefetch" href="/assets/js/34.8a330d88.js"><link rel="prefetch" href="/assets/js/35.435e5855.js"><link rel="prefetch" href="/assets/js/37.82e1f9ac.js"><link rel="prefetch" href="/assets/js/38.364b23d5.js"><link rel="prefetch" href="/assets/js/39.6a1a3c7c.js"><link rel="prefetch" href="/assets/js/4.d41439b8.js"><link rel="prefetch" href="/assets/js/40.f78c3047.js"><link rel="prefetch" href="/assets/js/41.1a99a0b3.js"><link rel="prefetch" href="/assets/js/42.3ed9f527.js"><link rel="prefetch" href="/assets/js/43.d4e22844.js"><link rel="prefetch" href="/assets/js/44.7abec7b3.js"><link rel="prefetch" href="/assets/js/45.8db46c8a.js"><link rel="prefetch" href="/assets/js/46.8a7c7a2b.js"><link rel="prefetch" href="/assets/js/47.ef2ed3a2.js"><link rel="prefetch" href="/assets/js/48.0012f1c2.js"><link rel="prefetch" href="/assets/js/49.0f70b6c6.js"><link rel="prefetch" href="/assets/js/5.5b94bff7.js"><link rel="prefetch" href="/assets/js/50.9181b3d3.js"><link rel="prefetch" href="/assets/js/51.8288a90c.js"><link rel="prefetch" href="/assets/js/52.e9a6be2c.js"><link rel="prefetch" href="/assets/js/53.45e39d2d.js"><link rel="prefetch" href="/assets/js/54.1a2522ad.js"><link rel="prefetch" href="/assets/js/55.693fd64f.js"><link rel="prefetch" href="/assets/js/56.4906c543.js"><link rel="prefetch" href="/assets/js/57.fb863d5e.js"><link rel="prefetch" href="/assets/js/58.03e95bc5.js"><link rel="prefetch" href="/assets/js/59.a1dfee48.js"><link rel="prefetch" href="/assets/js/6.481b22df.js"><link rel="prefetch" href="/assets/js/60.4e1b36a2.js"><link rel="prefetch" href="/assets/js/61.d120ffeb.js"><link rel="prefetch" href="/assets/js/62.4be78565.js"><link rel="prefetch" href="/assets/js/63.952814e6.js"><link rel="prefetch" href="/assets/js/64.597a069e.js"><link rel="prefetch" href="/assets/js/65.3c7fd61d.js"><link rel="prefetch" href="/assets/js/66.cefe07e3.js"><link rel="prefetch" href="/assets/js/67.706da51f.js"><link rel="prefetch" href="/assets/js/68.59d375fa.js"><link rel="prefetch" href="/assets/js/69.e5a8f871.js"><link rel="prefetch" href="/assets/js/7.cb937ed7.js"><link rel="prefetch" href="/assets/js/70.0054d020.js"><link rel="prefetch" href="/assets/js/71.08d280b0.js"><link rel="prefetch" href="/assets/js/72.2a4a1d18.js"><link rel="prefetch" href="/assets/js/73.9f611ee9.js"><link rel="prefetch" href="/assets/js/74.30f800b1.js"><link rel="prefetch" href="/assets/js/75.4d02f412.js"><link rel="prefetch" href="/assets/js/76.f9f0945f.js"><link rel="prefetch" href="/assets/js/77.8da40f73.js"><link rel="prefetch" href="/assets/js/78.595e6fa6.js"><link rel="prefetch" href="/assets/js/79.94da2805.js"><link rel="prefetch" href="/assets/js/8.9b412011.js"><link rel="prefetch" href="/assets/js/80.b5af450e.js"><link rel="prefetch" href="/assets/js/81.27dd00be.js"><link rel="prefetch" href="/assets/js/82.9b5c191c.js"><link rel="prefetch" href="/assets/js/83.75e64090.js"><link rel="prefetch" href="/assets/js/84.264654f5.js"><link rel="prefetch" href="/assets/js/85.9c6fcee8.js"><link rel="prefetch" href="/assets/js/86.aae01ace.js"><link rel="prefetch" href="/assets/js/87.8d07435b.js"><link rel="prefetch" href="/assets/js/88.2033edab.js"><link rel="prefetch" href="/assets/js/89.d270861d.js"><link rel="prefetch" href="/assets/js/9.6344b9c3.js"><link rel="prefetch" href="/assets/js/90.484c940e.js"><link rel="prefetch" href="/assets/js/91.c6bd7d17.js"><link rel="prefetch" href="/assets/js/92.1385ce40.js"><link rel="prefetch" href="/assets/js/93.47d40d05.js"><link rel="prefetch" href="/assets/js/94.01709d43.js"><link rel="prefetch" href="/assets/js/95.f3613e75.js"><link rel="prefetch" href="/assets/js/96.1e28b733.js"><link rel="prefetch" href="/assets/js/97.68393b7c.js"><link rel="prefetch" href="/assets/js/98.2b2ef528.js"><link rel="prefetch" href="/assets/js/99.072e3728.js">
    <link rel="stylesheet" href="/assets/css/0.styles.594b47db.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">左小白的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link router-link-active">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  首页
</a></li><li class="dropdown-item"><!----> <a href="/nav.html" class="nav-link">
  前端网址导航
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端进阶" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily/" class="nav-link router-link-active">
  技术日常记录
</a></li><li class="dropdown-item"><!----> <a href="/server/docker.html" class="nav-link">
  Docker 基础
</a></li><li class="dropdown-item"><h4>
          Vue.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/base/1.html" class="nav-link">
  Vue.js 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vue-router.html" class="nav-link">
  Vue Router 笔记
</a></li><li class="dropdown-subitem"><a href="/vue/vuex.html" class="nav-link">
  Vuex 笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ts/base-1.html" class="nav-link">
  TypeScript 入门教程笔记
</a></li><li class="dropdown-subitem"><a href="/node/base/1.html" class="nav-link">
  Node.js 笔记
</a></li><li class="dropdown-subitem"><a href="/webpack/base.html" class="nav-link">
  webpack 基础
</a></li></ul></li><li class="dropdown-item"><h4>
          数据可视化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/visual/echarts.html" class="nav-link">
  Echarts 笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS/ES6
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/js/es6/es6-1.html" class="nav-link">
  ES6标准入门(第三版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/ad3/js-ad3-1.html" class="nav-link">
  JavaScript高级程序设计(第四版)笔记
</a></li><li class="dropdown-subitem"><a href="/js/js-dom-art.html" class="nav-link">
  JavaScript DOM编程艺术(第二版)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          CSS/CSS3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/css/less.html" class="nav-link">
  CSS 预处理器 Less.js
</a></li><li class="dropdown-subitem"><a href="/css/flex-grid.html" class="nav-link">
  Flex与Grid布局
</a></li><li class="dropdown-subitem"><a href="/css/html5-css-1.html" class="nav-link">
  HTML5权威指南(CSS部分)笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          HTML/HTML5
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html5/html/1.html" class="nav-link">
  HTML5权威指南(HTML部分)笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/git.html" class="nav-link">
  Git 笔记
</a></li><li class="dropdown-item"><!----> <a href="/base/markdown.html" class="nav-link">
  Markdown 基础语法
</a></li><li class="dropdown-item"><!----> <a href="/base/dbtheory/1.html" class="nav-link">
  数据库系统原理笔记
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuechart.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @guoqzuo/vue-chart
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://zuoblog.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zuo-blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="http://www.zuo11.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zuoxiaobai" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daily/" aria-current="page" class="sidebar-link">技术日常记录</a></li><li><a href="/daily/2020-11.html" class="sidebar-link">2020年11月技术日常</a></li><li><a href="/daily/2020-10.html" class="sidebar-link">2020年10月技术日常</a></li><li><a href="/daily/2020-09.html" class="sidebar-link">2020年09月技术日常</a></li><li><a href="/daily/2020-08.html" class="sidebar-link">2020年08月技术日常</a></li><li><a href="/daily/2020-07.html" class="sidebar-link">2020年07月技术日常</a></li><li><a href="/daily/2020-06.html" class="sidebar-link">2020年06月技术日常</a></li><li><a href="/daily/2020-05.html" class="sidebar-link">2020年05月技术日常</a></li><li><a href="/daily/2020-04.html" class="sidebar-link">2020年04月技术日常</a></li><li><a href="/daily/2020-03.html" class="sidebar-link">2020年03月技术日常</a></li><li><a href="/daily/2020-02.html" aria-current="page" class="active sidebar-link">2020年02月技术日常</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-29-周六" class="sidebar-link">2020/02/29 周六</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#添加到我的小程序引导tips被原生组件遮挡的问题" class="sidebar-link">添加到我的小程序引导tips被原生组件遮挡的问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#border三角形边框问题" class="sidebar-link">border三角形边框问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-27-周四" class="sidebar-link">2020/02/27 周四</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#el-form-item里非elment输入组件时-校验回调函数不触发的问题" class="sidebar-link">el-form-item里非elment输入组件时，校验回调函数不触发的问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#element怎么动态改变校验rules且实时生效" class="sidebar-link">element怎么动态改变校验rules且实时生效</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-26-周三" class="sidebar-link">2020/02/26 周三</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#一条命令安装多个npm包" class="sidebar-link">一条命令安装多个npm包</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#axios文件上传进度及后台接收demo" class="sidebar-link">axios文件上传进度及后台接收demo</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#koa-ctx-body-写在异步里接口会返回404" class="sidebar-link">koa ctx.body 写在异步里接口会返回404</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-24-周一" class="sidebar-link">2020/02/24 周一</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#element-cascader高度过长问题" class="sidebar-link">element cascader高度过长问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#element-required-提示语修改" class="sidebar-link">element required 提示语修改</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#element-表单校验函数没生效" class="sidebar-link">element 表单校验函数没生效</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-20-周四" class="sidebar-link">2020/02/20 周四</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#使用js调用vue单文件组件" class="sidebar-link">使用js调用vue单文件组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-18-周二" class="sidebar-link">2020/02/18 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#error-1396-hy000-operation-drop-user-failed-for-zhangsan-localhost" class="sidebar-link">ERROR 1396 (HY000): Operation DROP USER failed for 'zhangsan'@'localhost'</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-12-周三" class="sidebar-link">2020/02/12 周三</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#为什么书上sql语句一般都是大写" class="sidebar-link">为什么书上SQL语句一般都是大写</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#char与varchar的区别" class="sidebar-link">char与varchar的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-08-周六" class="sidebar-link">2020/02/08 周六</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#nginx-访问不带www的域名-自动切到www" class="sidebar-link">nginx 访问不带www的域名，自动切到www</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-04-周二" class="sidebar-link">2020/02/04 周二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#node-js、js、v8三者之间的关系" class="sidebar-link">Node.js、js、v8三者之间的关系</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#node中4种模块类型" class="sidebar-link">node中4种模块类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#_2020-02-02-周日" class="sidebar-link">2020/02/02 周日</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily/2020-02.html#for-in遍历顺序问题" class="sidebar-link">for...in遍历顺序问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#提取markdown文件的大纲结构数据" class="sidebar-link">提取markdown文件的大纲结构数据</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#node-文件操作路径path问题" class="sidebar-link">node 文件操作路径path问题</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#根据大纲数据生成html" class="sidebar-link">根据大纲数据生成html</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#页面滚动时-自动切换大纲focus" class="sidebar-link">页面滚动时，自动切换大纲focus</a></li><li class="sidebar-sub-header"><a href="/daily/2020-02.html#node复制或删除文件夹" class="sidebar-link">node复制或删除文件夹</a></li></ul></li></ul></li><li><a href="/daily/2020-01.html" class="sidebar-link">2020年01月技术日常</a></li><li><a href="/daily/2019-12.html" class="sidebar-link">2019年12月技术日常</a></li><li><a href="/daily/2019-11.html" class="sidebar-link">2019年11月技术日常</a></li><li><a href="/daily/2019-10.html" class="sidebar-link">2019年10月技术日常</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2020年02月技术日常"><a href="#_2020年02月技术日常" class="header-anchor">#</a> 2020年02月技术日常</h1> <h2 id="_2020-02-29-周六"><a href="#_2020-02-29-周六" class="header-anchor">#</a> 2020/02/29 周六</h2> <h3 id="添加到我的小程序引导tips被原生组件遮挡的问题"><a href="#添加到我的小程序引导tips被原生组件遮挡的问题" class="header-anchor">#</a> 添加到我的小程序引导tips被原生组件遮挡的问题</h3> <p>在小程序里，为了增加用户留存，会做一个引导用户添加到我的小程序的提示面板</p> <p>今天自己实现了下，发现原生组件遮挡了这个提示，貌似暂时没有很好的解决方法</p> <p>所以，当设计小程序UI时，尽量不要在顶部使用原生组件。</p> <p>参考：</p> <ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/component/native-component.html#%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%AF%B9%E5%B1%82%E7%BA%A7" target="_blank" rel="noopener noreferrer">原生组件相对层级 - 小程序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="border三角形边框问题"><a href="#border三角形边框问题" class="header-anchor">#</a> border三角形边框问题</h3> <p>在给小程序添加引导时，里面有个带边框的三角形，如下图</p> <p><img src="/images/daily/border%E8%BE%B9%E6%A1%86.png" alt="border边框.png"></p> <p>一般用css画三角形使用的是border，但三角形边的边框怎么画呢？一般用两个三角形叠加来实现</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add-to-mymptips<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>atm-angle-a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>atm-angle-b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>atm-main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    点击 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/images/three_point.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span> 添加到我的小程序，微信首页下拉即可快速访问小程序
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>来看css样式</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.add-to-mymptips</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 270px<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 主内容区域 */</span>
<span class="token selector">.atm-main</span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ddd<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 10px #ccc<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span><span class="token function">rgb</span><span class="token punctuation">(</span>53<span class="token punctuation">,</span> 53<span class="token punctuation">,</span> 53<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 三个点图片样式 */</span>
<span class="token selector">.atm-main image</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 33px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 三角形+边框 区域 */</span>
<span class="token selector">.atm-angle-a, .atm-angle-b</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span>200px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 10px solid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.atm-angle-a</span> <span class="token punctuation">{</span>
  <span class="token property">top</span><span class="token punctuation">:</span> -20px<span class="token punctuation">;</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> transparent transparent #ccc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.atm-angle-b</span> <span class="token punctuation">{</span>
  <span class="token property">top</span><span class="token punctuation">:</span>-19px<span class="token punctuation">;</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> transparent transparent #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参考：</p> <ul><li><a href="https://www.cnblogs.com/blosaa/p/3823695.html" target="_blank" rel="noopener noreferrer">纯CSS写三角形-border法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_2020-02-27-周四"><a href="#_2020-02-27-周四" class="header-anchor">#</a> 2020/02/27 周四</h2> <h3 id="el-form-item里非elment输入组件时-校验回调函数不触发的问题"><a href="#el-form-item里非elment输入组件时-校验回调函数不触发的问题" class="header-anchor">#</a> el-form-item里非elment输入组件时，校验回调函数不触发的问题</h3> <p>今天写表单校验规则，有个 el-form-item 里使用了富文本编辑器，发现校验规则校验这个值会有异常：</p> <ol><li>当 change 或 blur 时，根本没有触发校验(提示错误)</li> <li>提交表单时，当该字段校验失败会提示错误，但该字段符合要求时，validate的回调一直没触发，导致无法进行校验成功之后的下一步操作</li></ol> <p>将富文本编辑器换成 el-input 正常，换成普通的 input 也会异常，感觉一头雾水。</p> <p>使用 this.$refs.ruleForm.validateField('xxx') 单读校验也不行，这个应该是element表单输入组件特有的</p> <p>于是粗略看了下源码，发现错误信息在form-item(也就是el-form-item)组件里处理，当el-select或el-input值改变时会将事件传递给form-item</p> <p>两个不同的组件，一个组件里怎么捕获到另一个组件的事件呢，在element内部使用了发布订阅设计模式来处理：</p> <ol><li>在form-item里订阅事件</li> <li>当el-input或el-select等elemnt表单输入组件的值改变时，发布事件</li></ol> <p>来看源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在 form-item 里订阅事件</span>
<span class="token comment">// https://github.com/ElemeFE/element/blob/1.x/packages/form/src/form-item.vue</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rules<span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_props<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'el.form.blur'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onFieldBlur<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 订阅了el.form.change事件</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'el.form.change'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onFieldChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 当 el-input 值改变时，发布事件</span>
<span class="token comment">// https://github.com/ElemeFE/element/blob/1.x/packages/input/src/input.vue</span>
<span class="token comment">// el-input</span>
<span class="token function">setCurrentValue</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentValue<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resizeTextarea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>validateEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发布el.form.change事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'ElFormItem'</span><span class="token punctuation">,</span> <span class="token string">'el.form.change'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// el-select</span>
<span class="token comment">// https://github.com/ElemeFE/element/blob/1.x/packages/select/src/select.vue</span>
<span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>multiple<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetInputHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>input <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>query <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentPlaceholder <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentPlaceholder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachedPlaceHolder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSelected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filterable <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>multiple<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>inputLength <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'ElFormItem'</span><span class="token punctuation">,</span> <span class="token string">'el.form.change'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以，如果表单里使用了非element输入组件，比如普通的input，当值改变或输入框失去焦点时，没有发布对应的事件，那么form-item组件就不会触发校验</p> <p>怎么来处理呢？这里暂时采用自定义方法来处理：</p> <ol><li>从rules移除对应的字段 required，至于label前面的红星，直接在el-form-item__label类上加一个before属性来设置</li> <li>对于行内显示错误信息，可以在el-form-item__label的after里显示错误信息，通过一个父类的error-class来控制隐藏显示</li> <li>单独写校验逻辑，如果校验失败加上一个error-class，如果想做的更逼真一点，在错误时给输入组件加一个红色的border</li></ol> <h3 id="element怎么动态改变校验rules且实时生效"><a href="#element怎么动态改变校验rules且实时生效" class="header-anchor">#</a> element怎么动态改变校验rules且实时生效</h3> <p>需要动态改变rules场景，有两个功能点：</p> <ol><li>某个checkbox的值改变，有部分字段需要在必须和可选间切换</li> <li>某个cascader组件值改变时，需要动态切换部分字段（有删有减）</li></ol> <p>需要注意的地方</p> <ol><li>可选和必选切换，只需要改变rules里的require属性，true和false之间切换（我之前直接暴力删rule里的fields，这种方法不能关闭原来必选时触发的错误提示）</li> <li>对于动态修改rules后，必选的小红星以及之前的错误信息还在的问题，需要完全改变rules的值，才能重新触发校验，使前端页面更新</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 强制触发表单校验更新</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rules<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2020-02-26-周三"><a href="#_2020-02-26-周三" class="header-anchor">#</a> 2020/02/26 周三</h2> <h3 id="一条命令安装多个npm包"><a href="#一条命令安装多个npm包" class="header-anchor">#</a> 一条命令安装多个npm包</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装多个包koa、koa-router、koa-static </span>
<span class="token function">npm</span> <span class="token function">install</span> koa koa-router koa-static --save
<span class="token comment"># npm notice created a lockfile as package-lock.json. You should commit this file.</span>
<span class="token comment"># npm WARN upload@1.0.0 No description</span>
<span class="token comment"># npm WARN upload@1.0.0 No repository field.</span>

<span class="token comment"># + koa-router@8.0.8</span>
<span class="token comment"># + koa@2.11.0</span>
<span class="token comment"># + koa-static@5.0.0</span>
<span class="token comment"># added 61 packages from 29 contributors in 22.996s</span>
<span class="token comment"># kevindeMacBook-Air:upload上传进度 kevin$</span>
</code></pre></div><p>如果需要卸载已经写入package.json里的npm包</p> <div class="language-js extra-class"><pre class="language-js"><code>npm uninstall 对应的包 <span class="token operator">--</span>save
</code></pre></div><h3 id="axios文件上传进度及后台接收demo"><a href="#axios文件上传进度及后台接收demo" class="header-anchor">#</a> axios文件上传进度及后台接收demo</h3> <p>axios的config参数里，可以传入onUploadProgress参数来接收upload进度事件，在koa处理时使用 post-bodyparser 可以很好的解析 multipart/form-data 数据</p> <p><img src="/images/daily/node%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%BF%9B%E5%BA%A6.png" alt="node文件上传进度.png"></p> <p>来看源码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 前端HTML --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>progressDiv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/axios/dist/axios.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> progressDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'progressDiv'</span><span class="token punctuation">)</span>

    <span class="token comment">// 当input文件输入框值改变时</span>
    fileInput<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> file <span class="token operator">=</span> fileInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 

    <span class="token comment">// 上传文件到后台</span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> fd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      fd<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
      fd<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'mask'</span><span class="token punctuation">)</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> payload <span class="token operator">=</span> fd
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token comment">// axios 接收进度事件文档</span>
          <span class="token comment">// https://github.com/axios/axios#request-config</span>
          <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// {loaded: 1687552, total: 35353356, ...}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'接收到进度事件'</span><span class="token punctuation">,</span> progressEvent<span class="token punctuation">)</span>
            progressDiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
              &lt;div&gt;上传中，当前进度：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% &lt;/div&gt; 
              &lt;div&gt;文件大小: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>progressEvent<span class="token punctuation">.</span>loaded<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>progressEvent<span class="token punctuation">.</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            </span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cosnoel<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>koa后端接收处理 upload.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> BodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'post-bodyparser'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> req <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request
  <span class="token keyword">const</span> parser <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">BodyParser</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> body <span class="token operator">=</span> <span class="token keyword">await</span> parser<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> body
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token comment">// 打印内容</span>
<span class="token comment">// upload</span>
<span class="token comment">// /upload</span>
<span class="token comment">// { file:</span>
<span class="token comment">//    { value:</span>
<span class="token comment">//       '/var/folders/mw/hbp6ytc9753gcm3zhqbmfkp40000gn/T/RAzvcR/9cd892b3-3243-4469-8cfa-ecbe2190a6ee.mongodb-macos-x86_64-4.2.2.tar',</span>
<span class="token comment">//      name: 'file',</span>
<span class="token comment">//      filename: 'mongodb-macos-x86_64-4.2.2.tar',</span>
<span class="token comment">//      contentType: 'application/x-tar' },</span>
<span class="token comment">//   type: 'mask' }</span>
</code></pre></div><p>完整demo，参见: <a href="https://github.com/zuoxiaobai/fedemo/tree/master/src/DebugDemo/upload%E4%B8%8A%E4%BC%A0%E8%BF%9B%E5%BA%A6" target="_blank" rel="noopener noreferrer">upload文件上传demo - github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="koa-ctx-body-写在异步里接口会返回404"><a href="#koa-ctx-body-写在异步里接口会返回404" class="header-anchor">#</a> koa ctx.body 写在异步里接口会返回404</h3> <p>今天mock上传的接口时，发现总是404，刚开始以为是代理的问题，后来单独写了个demo，发现如果ctx.body放在异步的回调，后端接收到请求了，但还是会返回404</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 最简单的验证方法</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 只要是异步，前端就会返回404</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>怎么解决呢？只要 await 对应的异步就好了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将文件数据接收，放到Promise里然后await，这样前端就不会404了</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUploadData</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 用 promise 封装一层</span>
<span class="token keyword">function</span> <span class="token function">getUploadData</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> chunk <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">0</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      chunk<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      size <span class="token operator">+=</span> data<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2020-02-24-周一"><a href="#_2020-02-24-周一" class="header-anchor">#</a> 2020/02/24 周一</h2> <h3 id="element-cascader高度过长问题"><a href="#element-cascader高度过长问题" class="header-anchor">#</a> element cascader高度过长问题</h3> <p>当cascader里选项比较多时，组件高度会异常，主要是 <code>.el-cascader-menu__wrap</code> 这个样式高度为100%，将cascader里其任意一父元素手动指定高度即可，但el-cascader-menu__wrap设置的效果最好</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.el-cascader-menu__wrap</span> <span class="token punctuation">{</span>
  <span class="token property">max-height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但这样设置后，可能会影响全局，这个是直接挂载在body元素下的，对其他模块会有影响，怎么解决这个影响呢？</p> <p>发现组件提供了一个 popper-class 属性，可以自定义浮层类名</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token comment">// 用 popper-class指定一个class，比如my-container，防止污染全局样式</span>
<span class="token selector">.my-container</span> <span class="token punctuation">{</span>
  <span class="token selector">.el-cascader-menu__wrap</span> <span class="token punctuation">{</span>
    <span class="token property">max-height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>总结：当写类似的组件时，如果需要在body里插入，需要有入口可以指定对应的自定义class，这样当多个页面需要时，不会产生样式干扰</p> <p>参考：</p> <ul><li><a href="https://element.eleme.cn/#/zh-CN/component/cascader#cascader-attributes" target="_blank" rel="noopener noreferrer">cascader 组件popper-class属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/q/1010000021033440" target="_blank" rel="noopener noreferrer">vue element Cascader 高度过长问题？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="element-required-提示语修改"><a href="#element-required-提示语修改" class="header-anchor">#</a> element required 提示语修改</h3> <p>在element组件中，想要label文字前面加红色*，需要当在el-form-item元素加上 required 属性，但使用 rules 添加blur校验规则后，两者会有冲突</p> <p>required 默认的提示是英文，怎么自定义提示呢? 需要将el-form-item元素上的 required属性去掉，放到rules规则里</p> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  name<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 必填项</span>
    <span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'姓名不能为空'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> validator<span class="token operator">:</span> validatorName<span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre></div><p>参考：<a href="https://blog.csdn.net/princek123/article/details/85267544" target="_blank" rel="noopener noreferrer">vue element-ui 使用required进行表单校验时自定义提示语<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="element-表单校验函数没生效"><a href="#element-表单校验函数没生效" class="header-anchor">#</a> element 表单校验函数没生效</h3> <p>根据element官网的dmeo，加入表单校验，发现校验的rules根本没执行。</p> <p>注意：<strong>el-form-item 标签也需要设置 prop 属性，并且名称需要和对应model的名称一致</strong></p> <p>我这次漏写了，所以一直没生效</p> <p>参考：</p> <ul><li><a href="https://element.eleme.cn/#/zh-CN/component/form#zi-ding-yi-xiao-yan-gui-ze" target="_blank" rel="noopener noreferrer">表单 自定义校验规则 - element<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/qq_36070288/article/details/88683747" target="_blank" rel="noopener noreferrer">关于el-form中的rules未生效问题的解决方法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_2020-02-20-周四"><a href="#_2020-02-20-周四" class="header-anchor">#</a> 2020/02/20 周四</h2> <h3 id="使用js调用vue单文件组件"><a href="#使用js调用vue单文件组件" class="header-anchor">#</a> 使用js调用vue单文件组件</h3> <p>在封装组件时，如果是dialog组件，一般封装好后，通过component引入，然后把标签放到html里，通过true或false来隐藏和显示，每次都要写一些重复代码。</p> <p>怎么能够像ElementUI的message函数一样直接调用呢，首先需要搞懂怎么用js来调用vue单文件组件，下面来看方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假设写好了 showInfo.vue 组件，执行clickShow函数直接显示dialog</span>
<span class="token comment">// 组件中 dialog :visible.sync=&quot;dialogTableVisible&quot;初始值设置为true</span>

<span class="token comment">// demo.vue 在需要调用的vue文件中引入该组件</span>
<span class="token keyword">import</span> ShowInfo <span class="token keyword">from</span> <span class="token string">'showInfo.vue'</span>
<span class="token comment">// ...</span>
<span class="token function">clickShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Component <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>ShowInfo<span class="token punctuation">)</span>

  <span class="token comment">// 挂载后返回对应组件的vm</span>
  <span class="token keyword">let</span> showInfoVue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

  <span class="token comment">// 将组件vm的dom，append到当前页面</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>showInfoVue<span class="token punctuation">.</span>$el<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><p>参考:</p> <ul><li><a href="https://cn.vuejs.org/v2/api/#vm-mount" target="_blank" rel="noopener noreferrer">vm.$mount()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/u014445339/article/details/79596201" target="_blank" rel="noopener noreferrer">JS 操作vue单文件组件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_2020-02-18-周二"><a href="#_2020-02-18-周二" class="header-anchor">#</a> 2020/02/18 周二</h2> <h3 id="error-1396-hy000-operation-drop-user-failed-for-zhangsan-localhost"><a href="#error-1396-hy000-operation-drop-user-failed-for-zhangsan-localhost" class="header-anchor">#</a> ERROR 1396 (HY000): Operation DROP USER failed for 'zhangsan'@'localhost'</h3> <p>在看mysql账号相关内容时，发现在root用户下，更新、删除用户均报错。后面发现居然是localhost的字母拼错了，但新建user时居然没报错。下面来复盘整个记录：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 1. 先创建一个账号，用来测试修改用户名</span>
CREATE <span class="token environment constant">USER</span> zhangsan@localost IDENTIFIED BY <span class="token string">'123'</span><span class="token punctuation">;</span>

<span class="token comment"># 2. 在使用 RENAME USER ... TO ... 时，发现更改不了名字，一直报错</span>
<span class="token comment"># mysql&gt; RENAME USER 'zhangsan'@'localhost' TO 'wangwu'@'localhost';</span>
ERROR <span class="token number">1396</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Operation RENAME <span class="token environment constant">USER</span> failed <span class="token keyword">for</span> <span class="token string">'zhangsan'</span>@<span class="token string">'localhost'</span>

<span class="token comment"># 3. 于是我试了下删除，发现还是错误</span>
<span class="token comment"># mysql&gt; DROP USER zhangsan@localhost;</span>
ERROR <span class="token number">1396</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Operation DROP <span class="token environment constant">USER</span> failed <span class="token keyword">for</span> <span class="token string">'zhangsan'</span>@<span class="token string">'localhost'</span>

<span class="token comment"># 4. 于是搜索了下，偶然看到一个测试的命令，仔细看发现host拼写错误，而我之前修改删除时host的localhost都是拼写正确的，所以没匹配到</span>
<span class="token keyword">select</span> user,host from mysql.user where user <span class="token operator">=</span> <span class="token string">'zhangsan'</span><span class="token punctuation">;</span>
+----------+----------+
<span class="token operator">|</span> user     <span class="token operator">|</span> <span class="token function">host</span>     <span class="token operator">|</span>
+----------+----------+
<span class="token operator">|</span> zhangsan <span class="token operator">|</span> localost <span class="token operator">|</span>
+----------+----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 5. 于是我将host改了下，再删除，就成功了。</span>
mysql<span class="token operator">&gt;</span> DROP <span class="token environment constant">USER</span> zhangsan@localost<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre></div><h2 id="_2020-02-12-周三"><a href="#_2020-02-12-周三" class="header-anchor">#</a> 2020/02/12 周三</h2> <h3 id="为什么书上sql语句一般都是大写"><a href="#为什么书上sql语句一般都是大写" class="header-anchor">#</a> 为什么书上SQL语句一般都是大写</h3> <p>一般我比较喜欢小写的sql语句，比如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">select</span> * from tb_user<span class="token punctuation">;</span> <span class="token comment"># 一般习惯用法</span>
SELECT * FROM tb_user<span class="token punctuation">;</span> <span class="token comment"># 教材或书上的写法</span>
</code></pre></div><p>为什么小写更直观，而不使用小写呢？今天在看语法时，有了一个答案，来看一个例子</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># select ... from 内连接语法</span>
<span class="token comment"># 先来看全小写的写法</span>
<span class="token keyword">select</span> some_colums from tb1 inner <span class="token function">join</span> tb2 on some_conditions<span class="token punctuation">;</span>
<span class="token comment"># 教科书上的写法</span>
SELECT some_colums FROM tb1 INNER JOIN tb2 ON some_confitions<span class="token punctuation">;</span>
</code></pre></div><p>你会发现可变动的内容一般是小写（比如：列名，表名，一些条件），而SQL语法相关的单词都是大写，这样更好理解。全小写描述语法时，对于初学者来看分不清哪些是SQL语句中必须的，哪些是可变动的。以后还是要习惯大写，更规范。</p> <h3 id="char与varchar的区别"><a href="#char与varchar的区别" class="header-anchor">#</a> char与varchar的区别</h3> <p>在创建表，指定字段数据类型时，如果是字符串数据类型可以是varchar(50)，也可以是char(50)。这两种有什么区别呢？</p> <ol><li>它们都是用来储存字符数值小于255的字符, mysql5.0之前是varchar支持最大255。</li> <li>varchar(40)存入&quot;Bill Gates&quot;，取出数据时字符串长度为10；char(40)存入&quot;Bill Gates&quot;，取出数据时字符串长度为40, 后面会被加多余的空格。</li> <li>varchar使用可能会更方便、所占用内存空间更小，特别是当数据库比较大时，内存和磁盘空间的节省会非常重要。</li> <li>从系统性能讲，char处理速度更快，有时可以超出varchar处理速度的50%。</li> <li>在设计数据库时应综合考虑各方面因素，来达到一个平衡。</li></ol> <h2 id="_2020-02-08-周六"><a href="#_2020-02-08-周六" class="header-anchor">#</a> 2020/02/08 周六</h2> <h3 id="nginx-访问不带www的域名-自动切到www"><a href="#nginx-访问不带www的域名-自动切到www" class="header-anchor">#</a> nginx 访问不带www的域名，自动切到www</h3> <p>在seo时，搜索引擎可能会将xx.com和www.xx.com一起收录。这里需要进行处理，当使用一级域名直接访问时(xx.com)，自动切到www.xx.com</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 修改nginx配置，加入如下转换</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> <span class="token string">'zuo11.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ http://www.zuo11.com/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如下图</p> <p><img src="/images/daily/nginx_config.png" alt="nginx_config.png"></p> <p>测试是否生效</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 打开浏览器的console，测试是否有转换成功</span>
location.host <span class="token comment"># zuo11.com 或 www.zuo11.com</span>
</code></pre></div><p>参考：</p> <p><a href="https://www.cnblogs.com/yiwd/p/3230371.html" target="_blank" rel="noopener noreferrer">nginx 域名跳转 Nginx跳转自动到带www域名规则配置、nginx多域名向主域名跳转<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="http://nginx.org/en/docs/http/converting_rewrite_rules.html" target="_blank" rel="noopener noreferrer">Converting rewrite rules - nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2020-02-04-周二"><a href="#_2020-02-04-周二" class="header-anchor">#</a> 2020/02/04 周二</h2> <h3 id="node-js、js、v8三者之间的关系"><a href="#node-js、js、v8三者之间的关系" class="header-anchor">#</a> Node.js、js、v8三者之间的关系</h3> <ol><li>Node.js 提供了JS运行时（运行js的环境，类似的概念有JRE提供了运行java的环境）。Node.js通过内部集成Chrome V8引擎来解析执行js</li> <li>浏览器里js无法操作文件、无法开启http服务器、而Node.js里可以，主要是因为Node.js里面扩展加入了很多功能。比如使用libuv，提供了文件系统、网络、子进程、管道、信号处理、轮询、流等功能；使用llhttp提供了HTTP解析功能；使用OpenSSL提供tls、crypto加密相关功能等等。</li></ol> <p>参考之前的笔记：https://www.yuque.com/guoqzuo/rdrqd5/ms0w14#Libraries</p> <h3 id="node中4种模块类型"><a href="#node中4种模块类型" class="header-anchor">#</a> node中4种模块类型</h3> <p>Node.js的模块化使用CommonJS规范，在node中你会发现使用某个模块时，是否需要require，是否需要npm install会有区别。</p> <ul><li>核心模块 <strong>require都不需要直接使用</strong>，比如global、buffer、module、process等</li> <li>内置模块 <strong>需要require才能使用，不需要npm install</strong>，比如：os、fs、path、http、util等</li> <li>第三方模块 <strong>不仅需要require，还需要npm install才能使用</strong>，比如: download-git-repo、ora、commander等</li> <li>本地自己写的模块，自己写的模块一般require就行，但如果里面包含了需要npm install的包，也需要安装</li></ul> <h2 id="_2020-02-02-周日"><a href="#_2020-02-02-周日" class="header-anchor">#</a> 2020/02/02 周日</h2> <h3 id="for-in遍历顺序问题"><a href="#for-in遍历顺序问题" class="header-anchor">#</a> for...in遍历顺序问题</h3> <p>Object.entries()遍历顺序和for...in的遍历顺序一致。for...in <strong>以任意顺序遍历一个对象除Symbol以外的可枚举属性</strong></p> <p>来看一个示例:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">1</span><span class="token operator">:</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
    <span class="token number">7</span><span class="token operator">:</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token operator">:</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token operator">:</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;-3&quot;</span><span class="token operator">:</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span>
    f<span class="token operator">:</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2.2&quot;</span><span class="token operator">:</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">,</span>
    <span class="token number">6</span><span class="token operator">:</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token operator">:</span><span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;j&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
<span class="token comment">// 在chrome、safari、火狐浏览器中结果一致</span>
<span class="token comment">// 0 1 2 4 5 6 7 -3 f 2.2 </span>
</code></pre></div><p>再来个例子，都是字符串的情况</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> category <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'web'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">'微信小程序'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
  <span class="token string">'数据库'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'观点'</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token string">'iOS'</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token string">'UNIX环境高级编程'</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token string">'C语言'</span><span class="token operator">:</span> <span class="token number">6</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调整上面的属性顺序，均按照定时时的顺序来，以属性定义的先后顺序来</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> category<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>再来个例子，属性都可以转换为数字的情况，这样就会按数字属性的大小来排序了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> nums <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
  <span class="token number">4</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调整上面的属性顺序，均按照定时时的顺序来，以属性定义的先后顺序来</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>  <span class="token comment">// 1 3 4</span>
<span class="token punctuation">}</span>
</code></pre></div><p>总结：总之，for...in遍历属性是无序的。确定顺序，还是用数组来</p> <p>参考：</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in" target="_blank" rel="noopener noreferrer">for...in - JavaScript | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/SailingLee/article/details/84598921" target="_blank" rel="noopener noreferrer">for...in遍历的顺序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="提取markdown文件的大纲结构数据"><a href="#提取markdown文件的大纲结构数据" class="header-anchor">#</a> 提取markdown文件的大纲结构数据</h3> <p>知道将md转换为html文件的方法后，需要生成对应的大纲数据。方法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 截取至 zuo-blog 源码</span>
<span class="token comment">// 读取文件内容，通过maked转换为html字符串</span>
<span class="token keyword">const</span> fileStr <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>articlePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">// let htmlStr = marked(fileStr)</span>
<span class="token keyword">let</span> headers <span class="token operator">=</span> marked<span class="token punctuation">.</span><span class="token function">lexer</span><span class="token punctuation">(</span>fileStr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'heading'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> outline <span class="token operator">=</span> <span class="token function">_generateOutline</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span> <span class="token comment">// 根据文件内容生成大纲数据</span>

<span class="token comment">/**
 * @description 将md文件heading列表，转换为层级结构，用于生成大纲
 * @param {*} headers 原数据格式
 * [ { type: 'heading', depth: 1, text: '站点优化 页面打开较慢处理' },
 *  { type: 'heading', depth: 2, text: '代码托管' },
 *  { type: 'heading', depth: 2, text: '速度慢的原因分析' },
 *  { type: 'heading', depth: 3, text: '代码分析' },
 *  { type: 'heading', depth: 2, text: '速度测试' } ]
 * @returns  [ { text: 'xx', children: [ { text:'xxx', children:[...] } ] } ]
 */</span>
<span class="token keyword">function</span> <span class="token function">_generateOutline</span><span class="token punctuation">(</span><span class="token parameter">headers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tree <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 加try catch是为了如果中间出现跨越的层级问题，直接返回错误</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> headers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> item <span class="token operator">=</span> headers<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token comment">// 如果是一级目录，直接挂载到tree下</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>depth <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tree<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> target
        <span class="token comment">// 如果是二级目录，挂载到当前tree最后一个元素的children上</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>depth <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          target <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果是3级+，遍历到最近一个层级的list</span>
          <span class="token keyword">let</span> count <span class="token operator">=</span> item<span class="token punctuation">.</span>depth <span class="token operator">-</span> <span class="token number">2</span>
          target <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          <span class="token keyword">while</span><span class="token punctuation">(</span>count<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            target <span class="token operator">=</span> target<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token operator">!</span>target<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        target<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'目录生成异常，请确保目录层级从H1到H6是正常顺序，对于没有H1或目录中间断层的情况需要修正'</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> tree
<span class="token punctuation">}</span>

<span class="token comment">// 最开始比较low的写法</span>
<span class="token comment">//  let tree = []</span>
<span class="token comment">//   for (let i = 0, len = headers.length; i &lt; len; i++) {</span>
<span class="token comment">//     let item = headers[i]</span>
<span class="token comment">//     if (item.depth === 1) {</span>
<span class="token comment">//       tree.push(item)</span>
<span class="token comment">//     } else if (item.depth === 2) {</span>
<span class="token comment">//       // 找最近的一个1级目录，加入到其list里面</span>
<span class="token comment">//       let level1 = tree[tree.length - 1]</span>
<span class="token comment">//       !level1.list &amp;&amp; (level1.list = [])</span>
<span class="token comment">//       level1.list.push(item)</span>
<span class="token comment">//     } else if (item.depth === 3) {</span>
<span class="token comment">//       // 找最近的一个二级目录</span>
<span class="token comment">//       let level1 =  tree[tree.length - 1]</span>
<span class="token comment">//       let level2 = level1.list[level1.list.length - 1]</span>
<span class="token comment">//       !level2.list &amp;&amp; (level2.list = [])</span>
<span class="token comment">//       level2.list.push(item)</span>
<span class="token comment">//     } else if (item.depth === 4) {</span>
<span class="token comment">//        // 找最近的一个三级目录</span>
<span class="token comment">//        let level1 =  tree[tree.length - 1]</span>
<span class="token comment">//        let level2 = level1.list[level1.list.length - 1]</span>
<span class="token comment">//        let level3 = level2.list[level2.list.length - 1]</span>
<span class="token comment">//        !level3.list &amp;&amp; (level3.list = [])</span>
<span class="token comment">//        level3.list.push(item)</span>
<span class="token comment">//     } else if (item.depth === 5) {</span>
<span class="token comment">//        // 找最近的一个4级目录</span>
<span class="token comment">//        let level1 =  tree[tree.length - 1]</span>
<span class="token comment">//        let level2 = level1.list[level1.list.length - 1]</span>
<span class="token comment">//        let level3 = level2.list[level2.list.length - 1]</span>
<span class="token comment">//        let level4 = level3.list[level3.list.length - 1]</span>
<span class="token comment">//        !level4.list &amp;&amp; (level4.list = [])</span>
<span class="token comment">//        level4.list.push(item)</span>
<span class="token comment">//     } else if (item.depth === 6) {</span>
<span class="token comment">//       // 找最近的一个5级目录</span>
<span class="token comment">//       let level1 =  tree[tree.length - 1]</span>
<span class="token comment">//       let level2 = level1.list[level1.list.length - 1]</span>
<span class="token comment">//       let level3 = level2.list[level2.list.length - 1]</span>
<span class="token comment">//       let level4 = level3.list[level3.list.length - 1]</span>
<span class="token comment">//       let level5 = level4.list[level4.list.length - 1]</span>
<span class="token comment">//       !level5.list &amp;&amp; (level5.list = [])</span>
<span class="token comment">//       level5.list.push(item)</span>
<span class="token comment">//     } else if (item.depth === 7) {</span>
<span class="token comment">//       // 找最近的一个6级目录</span>
<span class="token comment">//       let level1 =  tree[tree.length - 1]</span>
<span class="token comment">//       let level2 = level1.list[level1.list.length - 1]</span>
<span class="token comment">//       let level3 = level2.list[level2.list.length - 1]</span>
<span class="token comment">//       let level4 = level3.list[level3.list.length - 1]</span>
<span class="token comment">//       let level5 = level4.list[level4.list.length - 1]</span>
<span class="token comment">//       let level6 = level5.list[level5.list.length - 1]</span>
<span class="token comment">//       !level6.list &amp;&amp; (level6.list = [])</span>
<span class="token comment">//       level6.list.push(item)</span>
<span class="token comment">//     } </span>
<span class="token comment">//   }</span>
</code></pre></div><h3 id="node-文件操作路径path问题"><a href="#node-文件操作路径path问题" class="header-anchor">#</a> node 文件操作路径path问题</h3> <p>在写 zuoblog init 命令执行的操作时，需要操作当前命令执行时所在的目录，而__dirname是程序文件的路径。这就需要用到 process.cwd()了，可以获取到当前命令执行时所在的目录</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// delPath = path.join(__dirname, delPath) // 这个是当前文件的路径</span>
<span class="token comment">// process.cwd()  当前命令执行时所在的目录</span>
delPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delPath<span class="token punctuation">)</span>
</code></pre></div><h3 id="根据大纲数据生成html"><a href="#根据大纲数据生成html" class="header-anchor">#</a> 根据大纲数据生成html</h3> <p>在md文件显示的右侧，显示大纲html，将大纲JSON数据，生成html。注意：</p> <ol><li><p>ul 的padding-left要修改为0，而不是1em，因为发现语雀、gaylab对应的大纲实现里，focus时都有左侧border，菜单的padding-left根据其depth来生成，padding-left: (depth * 1)em</p></li> <li><p>这里大纲的每一个标题都没有使用a标签，不是走hash，而是直接通过点击js来滚动到对应id的位置。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
  * @description 根据大纲数据(JSON)生成侧边栏html
  * @param {*} outline 
  */</span>
<span class="token function">_getAsideHtml</span><span class="token punctuation">(</span><span class="token parameter">outline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handlerId</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> newId <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
    newId <span class="token operator">=</span> newId<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\(\)\/\,\=\&gt;\.\:\+]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> newId
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> asideHtml <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">let</span> backupOutline <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>outline<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> outline<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    asideHtml <span class="token operator">+=</span> <span class="token string">'&lt;ul&gt;'</span>
    asideHtml <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li&gt;&lt;span class=&quot;ul-span&quot; data-id=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">handlerId</span><span class="token punctuation">(</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; style=&quot;padding-left:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>depth <span class="token operator">+</span> <span class="token string">'em'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;span&gt;&lt;/li&gt;</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      asideHtml <span class="token operator">+=</span> <span class="token function">getChildrenAsideHtml</span><span class="token punctuation">(</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
    asideHtml <span class="token operator">+=</span> <span class="token string">'&lt;/ul&gt;'</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">getChildrenAsideHtml</span><span class="token punctuation">(</span><span class="token parameter">outline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outline <span class="token operator">||</span> outline<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> asideHtml <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> outline<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      asideHtml <span class="token operator">+=</span> <span class="token string">'&lt;ul&gt;'</span>
      asideHtml <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li&gt;&lt;span class=&quot;ul-span&quot; data-id=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">handlerId</span><span class="token punctuation">(</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; style=&quot;padding-left:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>depth <span class="token operator">+</span> <span class="token string">'em'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;span&gt;&lt;/li&gt;</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        asideHtml <span class="token operator">+=</span> <span class="token function">getChildrenAsideHtml</span><span class="token punctuation">(</span>outline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> 
      asideHtml <span class="token operator">+=</span> <span class="token string">'&lt;/ul&gt;'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> asideHtml
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> asideHtml
<span class="token punctuation">}</span>
</code></pre></div><h3 id="页面滚动时-自动切换大纲focus"><a href="#页面滚动时-自动切换大纲focus" class="header-anchor">#</a> 页面滚动时，自动切换大纲focus</h3> <p>直接上代码，里面包含大纲点击事件、滚动页面后自动改变大纲focus，这里的核心问题是: <strong>怎么获取页面滚动到了哪个标题区域？</strong></p> <p><strong>每次一进入页面，将每个标题(h1,h2,..)的id，offsetTop(距离页面顶部距离)按顺序存到数组，监听页面滚动事件，根据document.documentElement.scrollTop的高度，来匹配之前的数组，就可以找到滚动到哪个标题了</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 监听大纲的点击事件</span>
<span class="token keyword">let</span> asideDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'aside'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
asideDiv<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> id <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>id
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token comment">// 移除所有的active</span>
  <span class="token keyword">let</span> nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'ul-span'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">scrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> headersArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果是category，且有hash值，向上滚动 -70</span>
  <span class="token comment">// 通过category.html#web进入页面时, 由于顶部fixed会有遮挡，fix方案</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> pathname<span class="token punctuation">,</span> hash <span class="token punctuation">}</span> <span class="token operator">=</span> location
  pathname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'category.html'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hash <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">scrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">)</span>

  <span class="token comment">// 将每个标题的高度，存到数组里，当滚动时，自动focus右侧大纲</span>
  <span class="token keyword">let</span> nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'ul-span'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(nodes.dataset)</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>id
    headersArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span> id<span class="token punctuation">,</span> offsetTop<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>offsetTop<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// console.log(headersArr)</span>

  window<span class="token punctuation">.</span><span class="token function-variable function">onscroll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">focusAsideSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// debounce(focusAsideSpan)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 效果不好，没有实时滚动的感觉，关闭防抖</span>
<span class="token comment">// function debounce(method, context) {</span>
<span class="token comment">//   clearTimeout(method.tId)</span>
<span class="token comment">//   method.tId = setTimeout(function() {</span>
<span class="token comment">//     method.call(context)</span>
<span class="token comment">//   }, 100)</span>
<span class="token comment">// }</span>

<span class="token keyword">function</span> <span class="token function">focusAsideSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop
  <span class="token keyword">let</span> curNode
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> headersArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>headersArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">-</span> scrollTop <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 移除所有的active</span>
      <span class="token keyword">let</span> nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'ul-span'</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headersArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">===</span> nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
          nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果走到这里，说明滚到底部了</span>
  <span class="token comment">// 移除所有的active</span>
  <span class="token keyword">let</span> nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'ul-span'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  nodes<span class="token punctuation">[</span>nodes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="node复制或删除文件夹"><a href="#node复制或删除文件夹" class="header-anchor">#</a> node复制或删除文件夹</h3> <p>node只提供了复制文件、删除空文件夹的方法，如果需要复制文件夹或删除文件夹，就需要自己写方法了，参考：
https://github.com/zuoxiaobai/zuo-blog/blob/master/vendor/utils/FSExtend.js</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/29/2020, 10:59:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daily/2020-03.html" class="prev">
        2020年03月技术日常
      </a></span> <span class="next"><a href="/daily/2020-01.html">
        2020年01月技术日常
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.46527dc9.js" defer></script><script src="/assets/js/2.4b3539f1.js" defer></script><script src="/assets/js/36.14151663.js" defer></script><script src="/assets/js/3.e6a4dd76.js" defer></script>
  </body>
</html>
