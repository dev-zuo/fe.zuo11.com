(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{381:function(s,t,a){"use strict";a.r(t);var n=a(27),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"数据库安全与保护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库安全与保护"}},[s._v("#")]),s._v(" 数据库安全与保护")]),s._v(" "),a("h2",{attrs:{id:"数据库完整性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库完整性"}},[s._v("#")]),s._v(" 数据库完整性")]),s._v(" "),a("h3",{attrs:{id:"什么是数据库完整性-领会"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是数据库完整性-领会"}},[s._v("#")]),s._v(" 什么是数据库完整性(领会)")]),s._v(" "),a("p",[s._v("数据库完整性是指数据库中数据的"),a("strong",[s._v("正确性")]),s._v("、"),a("strong",[s._v("相容性")]),s._v("、"),a("strong",[s._v("一致性")]),s._v("。")]),s._v(" "),a("p",[s._v("比如：性别一般只有男和女，身份证号是唯一的，年龄在0-150之间")]),s._v(" "),a("h3",{attrs:{id:"完整性约束条件的作用对象-领会"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完整性约束条件的作用对象-领会"}},[s._v("#")]),s._v(" 完整性约束条件的作用对象(领会)")]),s._v(" "),a("ul",[a("li",[s._v("列级约束：包括对列的类型、取值范围、精度等约束")]),s._v(" "),a("li",[s._v("元组约束：指元组中各个字段之间的相互约束")]),s._v(" "),a("li",[s._v("表级约束：指若干元组、关系之间的联系的约束")])]),s._v(" "),a("h3",{attrs:{id:"定义与实现完整性约束-综合应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义与实现完整性约束-综合应用"}},[s._v("#")]),s._v(" 定义与实现完整性约束(综合应用)")]),s._v(" "),a("p",[s._v("完整性约束的三个部分：")]),s._v(" "),a("h4",{attrs:{id:"实体完整性约束"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实体完整性约束"}},[s._v("#")]),s._v(" 实体完整性约束")]),s._v(" "),a("p",[s._v("实体完整性主要是通过"),a("strong",[s._v("主键约束")]),s._v("和"),a("strong",[s._v("候选键约束")]),s._v("实现的。必须有一个主键，主键不能为空。候选码是可以标识一行数据的，比如身份证号、学号，候选码中指定一个就是主键。")]),s._v(" "),a("p",[s._v("主键列必须遵守的规则：")]),s._v(" "),a("ol",[a("li",[s._v("每一个表只能定义一个主键")]),s._v(" "),a("li",[s._v("主键的值必须能够唯一标识表中的每一行数据，且不能为NULL")]),s._v(" "),a("li",[s._v("复合主键不嫩包含不必要的多余列")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("约束方式")]),s._v(" "),a("th",[s._v("语句")]),s._v(" "),a("th",[s._v("关键字")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("主键约束")]),s._v(" "),a("td",[s._v("CREATE TABLE或ALTER TABLE")]),s._v(" "),a("td",[s._v("PRIMARY KEY")])]),s._v(" "),a("tr",[a("td",[s._v("候选键约束")]),s._v(" "),a("td",[s._v("CREATE TABLE或ALTER TABLE")]),s._v(" "),a("td",[s._v("UNIQUE")])])])]),s._v(" "),a("h4",{attrs:{id:"参照完整性约束"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参照完整性约束"}},[s._v("#")]),s._v(" 参照完整性约束")]),s._v(" "),a("p",[s._v("外键的值如果不为NULL，那其值必须是被参照关系里的主键")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nREFERENCES tbl_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index_col_name,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ON DELETE reference_option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ON UPDATE reference_option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# references 参照")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tbl_name 指定外键所参照的表名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index_col_name col_name[(length)][ASC|DESC]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ON xxx 指定参照动作相关的SQL语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reference_option 指定参照完整性约束的实现策略, 包括 RESTRICT | CASCADE | SET NULL | NO ACTION")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restrict 限制策略，cascade 级联策略，set null 置空策略，no action 不采取实施策略")]),s._v("\n")])])]),a("p",[s._v("示例：在数据库mysql_test中创建一个商品订单表orders，该表包含订单号order_id，商品名order_product，商品类型order_product_type，客户id号cust_id，订购时间order_date，价格order_price，数量order_amount。要求商品订单表orders中的所有订购客户信息均已在customers中记录在册。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE TABLE orders "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  order_id INT NOT NULL AUTO_INCREMENT COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'订单号'")]),s._v(",\n  order_product VARCHAR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOT NULL COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'商品名'")]),s._v(",\n  order_product_type VARCHAR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOT NULL COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'商品类型'")]),s._v(",\n  cust_id INT NOT NULL COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客户ID号'")]),s._v(",\n  order_date DATETIME NOT NULL COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'订购时间'")]),s._v(",\n  order_price DOUBLE NOT NULL COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'订购价格'")]),s._v(",\n  order_amount INT NOT NULL COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'订购数量'")]),s._v(",\n  PRIMARY KEY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  FOREIGN KEY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cust_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" REFERENCES customers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cust_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ON DELETE RESTRICT ON UPDATE RESTRICT\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" COMMENT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'商品订单表'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> DESC ORDERS;")]),s._v("\n+--------------------+--------------+------+-----+---------+----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Field              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Type         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Null "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Default "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Extra          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+--------------+------+-----+---------+----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" order_id           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PRI "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" auto_increment "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" order_product      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" varchar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" order_product_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" varchar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_id            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MUL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" order_date         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" datetime     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" order_price        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" double       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" order_amount       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+--------------+------+-----+---------+----------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h4",{attrs:{id:"用户定义完整性约束"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户定义完整性约束"}},[s._v("#")]),s._v(" 用户定义完整性约束")]),s._v(" "),a("p",[s._v("用户自定义完整性约束包含：")]),s._v(" "),a("ul",[a("li",[s._v("非空约束 NOT NULL")]),s._v(" "),a("li",[s._v("CHECK 约束 CHECK(expr)")])]),s._v(" "),a("h3",{attrs:{id:"命名完整性约束-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命名完整性约束-简单应用"}},[s._v("#")]),s._v(" 命名完整性约束(简单应用)")]),s._v(" "),a("p",[s._v("命名完整性约束只能给基于表的完整性约束指定名字，无法给基于列的完整性约束指定名字")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CONSTRAINT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# constraint  [kənˈstreɪnt] 约束")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# symbol 指定的约束名字")]),s._v("\n")])])]),a("h3",{attrs:{id:"更新完整性约束-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新完整性约束-简单应用"}},[s._v("#")]),s._v(" 更新完整性约束(简单应用)")]),s._v(" "),a("p",[s._v("使用ALTER TABLE更新与列或表有关的各种约束")]),s._v(" "),a("ol",[a("li",[s._v("完整性约束不能直接被修改。（需要先删除，再增加）")]),s._v(" "),a("li",[s._v("使用ALTER TABLE，可以独立地删除完整性约束，而不会删除表本身。（DROP TABLE语句删除一个表，则表中所有的完整性约束都自动删除）")])]),s._v(" "),a("h3",{attrs:{id:"练习题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习题"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),a("p",[s._v("1.在mysql中，各种完整性约束可通过CREAT TABLE 或 （  ）TABLE 语句来定义。填空题，答案：ALTER")]),s._v(" "),a("p",[s._v("2.完整性约束条件的作用对象可以是列、元组和（  ）。填空题，答案：表")]),s._v(" "),a("p",[s._v("3.候选键可以在CREATE TABLE 或 ALTER TABLE语句使用关键字 （  ）来定义。填空题，答案：UNIQUE")]),s._v(" "),a("p",[s._v("4.命名完整性约束的方法是在各种完整性约束的定义说明之前加上关键字（  ）和该约束的名字。填空题，答案：CONSTRAINT")]),s._v(" "),a("h2",{attrs:{id:"触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#触发器"}},[s._v("#")]),s._v(" 触发器")]),s._v(" "),a("p",[s._v("什么是触发器？")]),s._v(" "),a("p",[s._v("触发器是用户定义在关系表上的一类由事件驱动的数据对象，也是一种保证数据库完整性的方法。")]),s._v(" "),a("h3",{attrs:{id:"创建触发器-综合应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建触发器-综合应用"}},[s._v("#")]),s._v(" 创建触发器(综合应用)")]),s._v(" "),a("p",[s._v("使用CREATE TRIGGER创建触发器")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nCREATE TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_body\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trigger  [ˈtrɪɡə(r)] v 触发，n 扳机")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trigger_name 指定触发器的名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trigger_time 指定触发器被触发的时刻, 比如 AFTER、BEFORE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trigger_event 指定触发的事件，比如 INSERT、DELETE、UPDATE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tbl_name 指定与触发器相关联的表名，必须是永久性表，不能是临时表或视图")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FOR EACH ROW 指定对于受触发事件影响的每一行都要激活触发器的动作")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trigger_body 指定触发的动作主体")]),s._v("\n")])])]),a("p",[s._v("示例：在数据库 mysql_test 的表 customers 中创建一个触发器 customers_insert_trigger，用于每次向表customers插入一行数据时，将变量str的值设置为 one customer added!")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE TRIGGER mysql_test.customers_insert_trigger AFTER INSERT ON mysql_test.customers FOR EACH ROW SET @str"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'one customer added!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nINSERT mysql_test.customers VALUES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NULL, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'万华'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'F'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'长沙市'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'芙蓉区'")]),s._v(", DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT * FROM customers ORDER BY cust_id DESC LIMIT 1;")]),s._v("\n+---------+-----------+----------+--------------+--------------+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_sex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_address "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_contact "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" create_time         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-----------+----------+--------------+--------------+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 万华      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" F        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 长沙市       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 芙蓉区       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-02-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":36:32 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-----------+----------+--------------+--------------+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select @str;")]),s._v("\n+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" @str                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" one customer added"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n\n")])])]),a("h3",{attrs:{id:"删除触发器-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除触发器-简单应用"}},[s._v("#")]),s._v(" 删除触发器(简单应用)")]),s._v(" "),a("p",[s._v("使用DROP TRIGGER 删除触发器")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nDROP TRIGGER "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IF EXISTS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("schema_name."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("trigger_name\nDROP TRIGGER IF EXISTS mysql_test.customers_insert_trigger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"使用触发器-综合应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用触发器-综合应用"}},[s._v("#")]),s._v(" 使用触发器(综合应用)")]),s._v(" "),a("p",[s._v("触发器的分类：")]),s._v(" "),a("ul",[a("li",[s._v("INSERT 触发器")]),s._v(" "),a("li",[s._v("DELETE 触发器")]),s._v(" "),a("li",[s._v("UPDATE 触发器")])]),s._v(" "),a("h4",{attrs:{id:"insert触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#insert触发器"}},[s._v("#")]),s._v(" INSERT触发器")]),s._v(" "),a("p",[s._v("在INSERT触发器内，可以引用一个名为"),a("strong",[s._v("NEW")]),s._v("(不区分大小写)的虚拟表，来访问被插入的行。")]),s._v(" "),a("p",[s._v("在BEFORE INSERT触发器中，NEW的值"),a("strong",[s._v("可以被更新")]),s._v("。")]),s._v(" "),a("p",[s._v("示例：在数据mysql_test的表customers中重新创建触发器customers_insert_trigger，用于每次向表customers插入一行数据时，将用户变量str的值设置为新插入客户的id号。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE TRIGGER mysql_test.customers_insert_trigger AFTER INSERT ON mysql_test.customers FOR EACH ROW SET @str"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NEW.cust_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> INSERT mysql_test.customers VALUES(NULL, '万华2','F','长沙市','芙蓉区', DEFAULT);")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select @str;")]),s._v("\n+------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" @str "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h4",{attrs:{id:"delete触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#delete触发器"}},[s._v("#")]),s._v(" DELETE触发器")]),s._v(" "),a("p",[s._v("在DELETE触发器代码内，可以引用一个名为 "),a("strong",[s._v("OLD")]),s._v("（不区分大小写）的虚拟表，来访问被删除的行。OLD中的值全部是只读的，不能被更新。")]),s._v(" "),a("h4",{attrs:{id:"update触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update触发器"}},[s._v("#")]),s._v(" UPDATE触发器")]),s._v(" "),a("p",[s._v("在UPDATE触发器代码内，可以引用一个名为 "),a("strong",[s._v("OLD")]),s._v(" 的变量来访问UPDATE语句执行前的值，也可以引用一个名为 "),a("strong",[s._v("NEW")]),s._v(" 的变量来访问更新后的值")]),s._v(" "),a("p",[s._v("示例：在数据库mysql_test的表customers中创建一个触发器customers_update_trigger，用于每次更新表customers，将该表中cust_address列的值设置为cust_contact列的值。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE TRIGGER mysql_test.customers_update_trigger BEFORE UPDATE ON mysql_test.customers FOR EACH ROW SET NEW.cust_address "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" OLD.cust_contact"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nUPDATE mysql_test.customers "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cust_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'曾伟'")]),s._v(",cust_address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'武汉市'")]),s._v(" where cust_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT * FROM customers WHERE cust_id=1000;")]),s._v("\n+---------+-----------+----------+--------------+--------------+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_sex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_address "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_contact "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" create_time         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-----------+----------+--------------+--------------+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 曾伟      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" F        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 芙蓉区       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 芙蓉区       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-02-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":36:32 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-----------+----------+--------------+--------------+---------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h3",{attrs:{id:"练习题-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习题-2"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),a("p",[s._v("1.将触发器从数据库中删除使用的语句是（  ）。 单选题：B")]),s._v(" "),a("ul",[a("li",[s._v("A ALTER TRIGGER")]),s._v(" "),a("li",[s._v("B DROP TRIGGER")]),s._v(" "),a("li",[s._v("C DELTE TRIGGER")]),s._v(" "),a("li",[s._v("D CREATE TRIGGER")])]),s._v(" "),a("p",[s._v("2.写出创建触发器的语法格式。简答题")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW tigger_body\n")])])]),a("p",[s._v("3.在UPDATE触发器代码内，可以引用一个名为（  ）的虚拟表访问更新的值。单选题，答案：A")]),s._v(" "),a("ul",[a("li",[s._v("A NEW")]),s._v(" "),a("li",[s._v("B OLD")]),s._v(" "),a("li",[s._v("C BEFORE")]),s._v(" "),a("li",[s._v("D ALTER")])]),s._v(" "),a("p",[s._v("4.MySQL支持的触发器不包括（  ）。单选题 D")]),s._v(" "),a("ul",[a("li",[s._v("A INSERT 触发器")]),s._v(" "),a("li",[s._v("B DELETE 触发器")]),s._v(" "),a("li",[s._v("C UPDATE 触发器")]),s._v(" "),a("li",[s._v("D CREATE 触发器")])]),s._v(" "),a("h2",{attrs:{id:"安全性与访问控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全性与访问控制"}},[s._v("#")]),s._v(" 安全性与访问控制")]),s._v(" "),a("h3",{attrs:{id:"用户账号管理-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户账号管理-简单应用"}},[s._v("#")]),s._v(" 用户账号管理(简单应用)")]),s._v(" "),a("p",[s._v("查看当前用户，一般存在系统默认的mysql数据库的user表里")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("SELECT user FROM mysql.user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT user FROM mysql.user;")]),s._v("\n+------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" user             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql.infoschema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql.session    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql.sys        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.04")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("root用户，是最高级权限")]),s._v(" "),a("h4",{attrs:{id:"使用create-user创建账户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用create-user创建账户"}},[s._v("#")]),s._v(" 使用CREATE USER创建账户")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nCREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user 指定创建用户账号，格式: 'user_name' @ 'host_name'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IDENTIFIED BY identified 可选项，指定用户账号对应的口令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PASSWORD, 可选项，指定散列口令，加密")]),s._v("\n")])])]),a("p",[s._v("示例：在MySQL服务器中添加两个新的用户，其用户名分别为zhangsan和lisi，他们的主机名均为localhost，用户张三口令为123，用户lisi口令为对明文456使用PASSWORD()函数加密返回的散列值。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" zhangsan@localhost IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select user from mysql.user;")]),s._v("\n+------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" user             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql.infoschema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql.session    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql.sys        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" zhangsan         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -u zhangsan -p'123'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以直接登录成功")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于加密PASSWORD的问题")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# password函数: this function is removed in MySQL8.0.11")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以使用md5('AAA') 或 sha('AAA') 代替")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CREATE USER zhangsan@localhost IDENTIFIED BY PASSWORD 'password函数加密后的字符串'; // 理论上 mysql 5.x的版本是支持的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select password('123');")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1064")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": You have an error "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your SQL syntax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" check the manual that corresponds to your MySQL server version "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the right syntax to use near "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'('")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("')'")]),s._v(" at line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select sha('123');")]),s._v("\n+------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sha"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 40bd001563085fc35165329ea1ff5c5ecbdbbeef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select md5('123');")]),s._v("\n+----------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" md5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 202cb962ac59075b964b07152d234b70 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 非root用户时看不到mysql.user表的信息的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select user from mysql.user;")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1142")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": SELECT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" denied to user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" table "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user'")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> show databases;  # 只能看到一个数据库")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Database           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h4",{attrs:{id:"使用drop-user-删除用户账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用drop-user-删除用户账号"}},[s._v("#")]),s._v(" 使用DROP USER 删除用户账号")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nDROP "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例")]),s._v("\nDROP "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" zhangsan@localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> DROP USER zhangsan@localhost;")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h4",{attrs:{id:"使用rename-user修改用户账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用rename-user修改用户账号"}},[s._v("#")]),s._v(" 使用RENAME USER修改用户账号")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nRENAME "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" old_user TO new_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",old_user TO new_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),a("p",[s._v("例子：将shangsan的用户名改为wangwu")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" zhangsan@localhost IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nRENAME "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wangwu'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uwangwu -p123 可登录成功")]),s._v("\n")])])]),a("h4",{attrs:{id:"使用set-password修改用户密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用set-password修改用户密码"}},[s._v("#")]),s._v(" 使用SET PASSWORD修改用户密码")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nSET PASSWORD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("FOR user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'new_password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'encrypted password'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FOR user 可选项，指定欲修改口令的用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PASSWORD('new_password') 使用函数password()设置新口令new_password")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# encrypted password 已加密的字符串")]),s._v("\n")])])]),a("p",[s._v("例子：将wangwu的密码修改为 pass")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("SET PASSWORD FOR "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wangwu'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pass'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql8.x版本不支持password()函数，就不真实调试了")]),s._v("\n")])])]),a("h4",{attrs:{id:"练习题-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习题-3"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),a("p",[s._v("1.创建用户账号的语句是（  ）。单选题，答案：D")]),s._v(" "),a("ul",[a("li",[s._v("A INSERT USER")]),s._v(" "),a("li",[s._v("B DROP USER")]),s._v(" "),a("li",[s._v("C RENAME USER")]),s._v(" "),a("li",[s._v("D CREATE USER")])]),s._v(" "),a("h3",{attrs:{id:"账号权限管理-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#账号权限管理-简单应用"}},[s._v("#")]),s._v(" 账号权限管理(简单应用)")]),s._v(" "),a("h4",{attrs:{id:"使用grant为用户授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用grant为用户授权"}},[s._v("#")]),s._v(" 使用GRANT为用户授权")]),s._v(" "),a("p",[s._v("grant [ɡrɑːnt] 授予，允许")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nGRANT priv_type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",priv_type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nON "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("object_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" priv_level TO user_specification "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",user_specification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITH GRANT OPTION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# priv_type 用于指定权限名称 SELECT SELECT,UPDATE ALL  CREATE USER等")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# column_list 用于指定权限要授予给表中的哪些具体的列")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# object_type 用于指定权限授予的对象和级别 mysql_test.customers、mysql_test.* 或 *.*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# priv_level 用于指定权限的级别 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TO 指定被授予权限的用户user 比如：'zhangsan'@'localhost'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user_specification => user [IDENTIFIED BY [PASSWORD]'password']")]),s._v("\n")])])]),a("p",[s._v("示例：授予用户wangwu在数据库mysql_test表customers上拥有对列cust_id和列cust_name的SELECT权限.")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("GRANT SELECT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cust_id,cust_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ON mysql_test.customers TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wangwu'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在root下执行上面的命令成功后，exit退出，再使用wangwu的用户登录")]),s._v("\nmysql -uwangwu -p123\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> show databases; ")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Database           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql_test         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("可以看到设置权限后比之前多了一个mysql_test数据库，我们再来看看表，及表结构")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> use mysql_test;")]),s._v("\nReading table information "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" completion of table and "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),s._v(" names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> show tables;")]),s._v("\n+----------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Tables_in_mysql_test "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" customers            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> desc customers;")]),s._v("\n+-----------+----------+------+-----+---------+----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Field     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Type     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Null "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Default "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Extra          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------+----------+------+-----+---------+----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_id   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PRI "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" auto_increment "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" char"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NO   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------+----------+------+-----+---------+----------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select * from customers;")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1142")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": SELECT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" denied to user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wangwu'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" table "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'customers'")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT * from customers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1142")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": SELECT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" denied to user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wangwu'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" table "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'customers'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select cust_id,cust_name from customers;")]),s._v("\n+---------+-----------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cust_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-----------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("901")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 张三      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("902")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 李四      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("904")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 李四      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("909")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 周明      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("999")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 王五      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 曾伟      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 万华2     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-----------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("h4",{attrs:{id:"使用grant-with子句允许权限转移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用grant-with子句允许权限转移"}},[s._v("#")]),s._v(" 使用GRANT...WITH子句允许权限转移")]),s._v(" "),a("p",[s._v("示例：授予当前系统中一个不存在的用户zhou在数据库mysql_test的表customers上拥有SELECT和UPDATE的权限，并允许其可以将自身的这个权限授予给其他用户。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("GRANT SELECT,UPDATE ON mysql_test.customers TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhou'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),s._v(" WITH GRANT OPTION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不试用mysql8.0+，此版本将创建账号和授权分离了。我们分开来写：")]),s._v("\nCREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhou'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGRANT SELECT,UPDATE ON mysql_test.customers TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhou'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" WITH GRANT OPTION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"all所有权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#all所有权限"}},[s._v("#")]),s._v(" ALL所有权限")]),s._v(" "),a("p",[s._v("示例：授予系统中已存在的zhangsan可以在数据库mysql_test中执行所有数据库操作的权限")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" zhangsan@localhost IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nGRANT ALL ON mysql_test.* TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"授予create-user权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#授予create-user权限"}},[s._v("#")]),s._v(" 授予CREATE USER权限")]),s._v(" "),a("p",[s._v("示例：授予系统中已存在的wangwu拥有创建用户的权限")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("GRANT CREATE "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" ON *.* TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wangwu'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"使用revoke撤销用户权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用revoke撤销用户权限"}},[s._v("#")]),s._v(" 使用REVOKE撤销用户权限")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nREVOKE priv_type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",priv_type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nON "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("object_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" priv_level\nFROM user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),a("p",[s._v("示例：回收系统中已存在用户zhou在数据库mysql_test的表customers上的SELECT权限")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("REVOKE SELECT ON mysql_test.customers FROM "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhou'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录zhou这个账号执行也可以")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" REVOKE SELECT ON mysql_test.customers FROM "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhou'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from customers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1142")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": SELECT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" denied to user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhou'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" table "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'customers'")]),s._v("\n")])])]),a("h4",{attrs:{id:"练习题-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习题-4"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),a("p",[s._v("1.新建的MySQL用户必须被授权，可以使用（  ）语句来实现。填空题，答案：GRANT")]),s._v(" "),a("p",[s._v("2.权限的转移可以通过在GRANT语句中使用（  ）子句来实现。填空题，答案：WITH GRANT OPTION或WITH")]),s._v(" "),a("p",[s._v("3.当需要撤销一个用户的权限，而又不希望将该用户从系统中删除时，可以使用 （  ）语句来实现。答案：REVOKE")]),s._v(" "),a("h2",{attrs:{id:"事务与并发控制-领会"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务与并发控制-领会"}},[s._v("#")]),s._v(" 事务与并发控制(领会)")]),s._v(" "),a("h3",{attrs:{id:"事务的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务的概念"}},[s._v("#")]),s._v(" 事务的概念")]),s._v(" "),a("p",[s._v("事务是用户定义的一个"),a("strong",[s._v("数据操作序列")]),s._v("，这些操作可作为一个完整的工作单元，要么全部执行，要么全部不执行，是一个不可分割的工作单位。事务中的操作一般是对数据的更新操作，包括增、删、改。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/db/6_1_%E7%A8%8B%E5%BA%8F%E4%B8%8E%E4%BA%8B%E5%8A%A1.png",alt:"6_1_程序与事务.png"}})]),s._v(" "),a("p",[s._v("事务以 "),a("strong",[s._v("BEGIN TRANSACTION")]),s._v(" 语句开始，以 "),a("strong",[s._v("COMMIT")]),s._v(" (提交)语句或 "),a("strong",[s._v("ROLLBACK")]),s._v(" (回滚)语句结束")]),s._v(" "),a("h3",{attrs:{id:"事务的特征"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务的特征"}},[s._v("#")]),s._v(" 事务的特征")]),s._v(" "),a("p",[s._v("ACID")]),s._v(" "),a("ul",[a("li",[s._v("原子性 atomicity [ˌætəˈmɪsəti]")]),s._v(" "),a("li",[s._v("一致性 consistency [kənˈsɪstənsi]")]),s._v(" "),a("li",[s._v("隔离性 isolation [ˌaɪsəˈleɪʃn]")]),s._v(" "),a("li",[s._v("持续性(永久性) durative ['djuərətiv]")])]),s._v(" "),a("h3",{attrs:{id:"并发操作问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#并发操作问题"}},[s._v("#")]),s._v(" 并发操作问题")]),s._v(" "),a("p",[s._v("假设事务1与事务2并发执行，可能会存在的问题")]),s._v(" "),a("ul",[a("li",[s._v("丢失更新，事务2的提交结果会破坏事务1的提交结果")]),s._v(" "),a("li",[s._v("不可重复读，事务2执行更新操作，使事务1无法再现前一次读取结果")]),s._v(" "),a("li",[s._v('读"脏"数据，事务1修改数据后撤销，使得事务2读取的数据与数据库中不一致')])]),s._v(" "),a("h3",{attrs:{id:"封锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#封锁"}},[s._v("#")]),s._v(" 封锁")]),s._v(" "),a("p",[s._v("一个锁实质上是允许或阻止一个事务对一个数据对象的存取。")]),s._v(" "),a("ol",[a("li",[s._v("排他锁(X锁)，用于写操作")]),s._v(" "),a("li",[s._v("共享锁(S锁)，用于读操作")])]),s._v(" "),a("p",[s._v("我们通常以粒度来描述封锁的数据单元的大小")]),s._v(" "),a("p",[s._v("粒度越细，并发性越大，但软件复杂性何系统开销也就越大。")]),s._v(" "),a("h4",{attrs:{id:"封锁的级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#封锁的级别"}},[s._v("#")]),s._v(" 封锁的级别")]),s._v(" "),a("p",[s._v("封锁的几倍又称为一致性级别或隔离度")]),s._v(" "),a("ul",[a("li",[s._v("0 级封锁：不重写其他非0级封锁事务的未提交的更新数据。（实用价值低）")]),s._v(" "),a("li",[s._v("1 级封锁：不允许重写未提交的更新数据。防止了丢失更新的发生")]),s._v(" "),a("li",[s._v("2 级封锁：既不重写也不读未提交的更新数据（防止读了脏数据）")]),s._v(" "),a("li",[s._v("3 级封锁：不去读未提交的更新数据，不写任何（包括读操作）未提交数据")])]),s._v(" "),a("h4",{attrs:{id:"死锁和活锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#死锁和活锁"}},[s._v("#")]),s._v(" 死锁和活锁")]),s._v(" "),a("p",[s._v("或锁 --- 先来先服务")]),s._v(" "),a("p",[s._v("死锁 --- 预防")]),s._v(" "),a("ol",[a("li",[s._v("一次性死锁")]),s._v(" "),a("li",[s._v("锁请求排序")]),s._v(" "),a("li",[s._v("序列化处理")]),s._v(" "),a("li",[s._v("资源剥夺")])]),s._v(" "),a("h3",{attrs:{id:"练习题-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习题-5"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),a("p",[s._v("1.典型的并发操作不包括（  ）。单选题：D")]),s._v(" "),a("ul",[a("li",[s._v("A 不可重复读")]),s._v(" "),a("li",[s._v("B 丢失更新")]),s._v(" "),a("li",[s._v("C 读脏数据")]),s._v(" "),a("li",[s._v("D 修改异常")])]),s._v(" "),a("p",[s._v("2.事务的特征包括：一致性、隔离性、持续性、（  ）。单选题，答案：原子性 ，记住ACID")]),s._v(" "),a("h2",{attrs:{id:"备份与恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份与恢复"}},[s._v("#")]),s._v(" 备份与恢复")]),s._v(" "),a("h3",{attrs:{id:"数据库备份与恢复的概念-识记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库备份与恢复的概念-识记"}},[s._v("#")]),s._v(" 数据库备份与恢复的概念(识记)")]),s._v(" "),a("p",[a("strong",[s._v("数据备份")]),s._v("是指通过"),a("strong",[s._v("导出数据")]),s._v("或者"),a("strong",[s._v("复制表文件")]),s._v("的方式来制作数据库的副本，")]),s._v(" "),a("p",[a("strong",[s._v("数据库恢复")]),s._v("是当数据库出现故障或遭到破坏时，将"),a("strong",[s._v("备份")]),s._v("的数据加载到系统，从而使数据库从错误状态恢复到备份时的正确状态。")]),s._v(" "),a("p",[s._v("数据库的恢复是以备份为基础的，它是与备份相对应的系统维护和管理操作")]),s._v(" "),a("h3",{attrs:{id:"备份数据的方法-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份数据的方法-简单应用"}},[s._v("#")]),s._v(" 备份数据的方法(简单应用)")]),s._v(" "),a("p",[s._v("使用SELECT INTO OUTFILE备份")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nSELECT * INTO OUTFILE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'file_name'")]),s._v(" export_options "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" INTO DUMPFILE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'file_name'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# export_options")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("FIELDS \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONALLY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ENCLOSED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'char'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ESCAPED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'char'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LINES")]),s._v(" TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FIELDS 和 LINES 决定数据行在备份文件中存储的格式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TERMINATED BY 指定字段值之间的符号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ENCLOSED BY 指定包裹文件中字符值的符号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ESCAPED BY 指定转义字符")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TERMINATED BY 指定一个数据行结束的标志")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DUMPFILE 导出的备份文件里所有数据行都会彼此紧挨着放置")]),s._v("\n\n")])])]),a("h3",{attrs:{id:"恢复数据的方法-简单应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复数据的方法-简单应用"}},[s._v("#")]),s._v(" 恢复数据的方法(简单应用)")]),s._v(" "),a("p",[s._v("使用LOAD DATA INFILE恢复数据")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nLOAD DATA INFILE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'file_name.txt'")]),s._v(" INTO  TABLE tbl_name \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("FIELDS \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONALLY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ENCLOSED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'char'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ESCAPED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'char'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LINES")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("STARTING BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'string'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# STARTING BY 指定一个前缀")]),s._v("\n")])])]),a("p",[s._v("示例：备份数据库mysql_test中表cumstomers的全部数据到 backup/backupfile.txt 文件中，要求字段值如果是字符则用双引号标注，字段值之间用逗号隔开每行以问号为结束标志。然后，将备份后的数据导入到一个和customers表结构相同的空表customers_copy中。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于mysql8.x不能直接支持，需要修改配置，很麻烦就不实际操作了，感觉用mysqldump备份更快")]),s._v("\nSELECT * FROM mysql_test.customers INTO OUTFILE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./backupfile.txt'")]),s._v(" \nFIELDS TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" OPTIONALLY ENCLOSED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LINES")]),s._v(" TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT * FROM mysql_test.customers INTO OUTFILE '/Users/kevin/Desktop/backup/sql.txt'  FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '' LINES TERMINATED BY '?';")]),s._v("\nERROR "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1290")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HY000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": The MySQL server is running with the --secure-file-priv option so it cannot execute this statement\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#恢复")]),s._v("\nLOAD DATA INFILE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/kevin/Desktop/backup/sql.txt'")]),s._v(" INTO TABLE mysql_test.customers_copy \nFIELDS TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" OPTIONALLY ENCLOSED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LINES")]),s._v(" TERMINATED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"练习题-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习题-6"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),a("p",[s._v("1.备份数据使用的语句是 SELECT INTO （  ）。填空题，答案：OUTFILE")]),s._v(" "),a("p",[s._v("2.恢复数据使用的语句是 LOAD DATA （  ）。填空题，答案：INFILE")]),s._v(" "),a("h3",{attrs:{id:"使用mysqldump备份恢复数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用mysqldump备份恢复数据"}},[s._v("#")]),s._v(" 使用mysqldump备份恢复数据")]),s._v(" "),a("p",[s._v("备份时不需要登录mysql控制台，任意打开一个终端即可")]),s._v(" "),a("h4",{attrs:{id:"备份数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份数据库"}},[s._v("#")]),s._v(" 备份数据库")]),s._v(" "),a("p",[s._v("如果只要数据库每个表的结构，不需要数据加-d参数")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份 zhongmingdb 数据库到zhongmingdb.sql文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份所有表结构 + 所有数据")]),s._v("\nmysqldump -uroot -p zhongmingdb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" zhongmingdb.sql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果只备份表结构，不备份数据 加-d参数 ")]),s._v("\nmysqldump -uroot -p -d zhongmingdb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" zhongmingdb.sql\n")])])]),a("h4",{attrs:{id:"备份某个表的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份某个表的数据"}},[s._v("#")]),s._v(" 备份某个表的数据")]),s._v(" "),a("p",[s._v("如果只要结构，不需要数据加-d参数")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份zhongmingdb数据库的sys_menu表到sys_menu.sql文件")]),s._v("\nmysqldump -uroot -p zhongmingdb sys_menu "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sys_menu.sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"备份远程服务器数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份远程服务器数据库"}},[s._v("#")]),s._v(" 备份远程服务器数据库")]),s._v(" "),a("p",[s._v("加-h ip 参数即可")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份 192.168.9.111 服务器 zhongmingdb 数据库表内容")]),s._v("\nmysqldump -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".9.111 -uroot -p zhongmingdb sys_menu "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sys_menu.sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"恢复-备份数据导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复-备份数据导入"}},[s._v("#")]),s._v(" 恢复(备份数据导入)")]),s._v(" "),a("ol",[a("li",[s._v("登录到mysql控制台，use 对应的database")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录")]),s._v("\nmysql -uroot -p\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择数据库(如果没有需要创建)")]),s._v("\nuse xxxdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("使用source命令导入，其实就是批量执行sql文件中的SQL语句")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source  需要导入的数据文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" sys_menu.sql\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);