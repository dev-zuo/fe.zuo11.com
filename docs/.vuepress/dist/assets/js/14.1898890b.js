(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{453:function(s,a,t){"use strict";t.r(a);var n=t(30),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"数据库编程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库编程"}},[s._v("#")]),s._v(" 数据库编程")]),s._v(" "),t("h2",{attrs:{id:"存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[s._v("#")]),s._v(" 存储过程")]),s._v(" "),t("h3",{attrs:{id:"存储过程的基本概念-领会"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程的基本概念-领会"}},[s._v("#")]),s._v(" 存储过程的基本概念(领会)")]),s._v(" "),t("p",[t("strong",[s._v("存储过程")]),s._v("是一组为了完成某项特定功能的"),t("strong",[s._v("SQL语句集")]),s._v("，其实质就是一段存储在数据库中的"),t("strong",[s._v("代码")]),s._v("，它可以由声明式的SQL语句和过程式SQL语句组成。")]),s._v(" "),t("p",[s._v("声明式的SQL语句：CREATE、UPDATE、SELECT等")]),s._v(" "),t("p",[s._v("过程式的SQL语句：CASE IF ELSE 等")]),s._v(" "),t("p",[s._v("特点：")]),s._v(" "),t("ul",[t("li",[s._v("可增强SQL语言的功能和灵活性")]),s._v(" "),t("li",[s._v("良好的封装性")]),s._v(" "),t("li",[s._v("高性能")]),s._v(" "),t("li",[s._v("可减少网络流量")]),s._v(" "),t("li",[s._v("可作为一种安全机制来确保数据库的安全性和数据的完整性")])]),s._v(" "),t("h3",{attrs:{id:"创建存储过程-综合应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建存储过程-综合应用"}},[s._v("#")]),s._v(" 创建存储过程(综合应用)")]),s._v(" "),t("p",[s._v("DELIMITER命令，delimiter [dɪ'lɪmɪtə] 定界符，一般语句遇到 ; 就结束执行SQL语句")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DELIMITER "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $$用户定义的结束符号")]),s._v("\n")])])]),t("p",[s._v('示例：将MySQL结束符修改为两个感叹号 "!!"')]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DELIMITER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> select * from customers_view!!")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 回到分号结束")]),s._v("\nDELIMITER "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"create-procedure-创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-procedure-创建"}},[s._v("#")]),s._v(" CREATE PROCEDURE 创建")]),s._v(" "),t("p",[s._v("procedure  [prəˈsiːdʒə(r)] 程序，步骤")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nCREATE PROCEDURE sp_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("proc_parameter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" routine_body\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认创建存储过程在当前的数据库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sp_name 指定存储过程的名称，默认在当前数据库中创建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proc_parameter 指定存储过程的参数列表 [IN | OUT | INOUT] param_name type 参数名 参数类型")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# routine [ruːˈtiːn] 惯例，例行程序，存储过程的主题部分，也称为存储过程体。")]),s._v("\n")])])]),t("p",[s._v("示例：在mysql_test中创建一个存储过程，用于实现给定表customers中一个客户id号即可修改表customers中该客户的性别为一个指定的性别")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("USE mysql_test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDELIMITER "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\nCREATE PROCEDURE sp_update_sex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IN cid INT,IN csex CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" \nBEGIN\nUPDATE mysql_test.customers SET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cust_sex")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("csex WHERE "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cust_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nEND "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\n")])])]),t("h3",{attrs:{id:"存储过程体-简单应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程体-简单应用"}},[s._v("#")]),s._v(" 存储过程体(简单应用)")]),s._v(" "),t("h4",{attrs:{id:"使用declare声明局部变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用declare声明局部变量"}},[s._v("#")]),s._v(" 使用DECLARE声明局部变量")]),s._v(" "),t("p",[s._v("desclare [dɪˈkleə(r)] 声明")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DECLARE var_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DEFAULT value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.只能在存储过程体的BEGIN ... END语句块声明变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.必须在存储过程的开头处声明")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.作用范围仅限于声明它的BEGIN...END语句块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.不同于用户变量")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例子：声明一个整型局部变量cid")]),s._v("\nDECLARE cid INT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("局部变量与用户变量的区别")]),s._v(" "),t("ol",[t("li",[s._v("用户变量前面有@，局部变量前面没@")]),s._v(" "),t("li",[s._v("可用范围：用户变量在整个SQL里都可以使用，局部变量只能在BEGIN...END语句块中使用")])]),s._v(" "),t("h4",{attrs:{id:"使用set为局部变量赋值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用set为局部变量赋值"}},[s._v("#")]),s._v(" 使用set为局部变量赋值")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("var_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",var_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给局部变量cid赋予一个整数值 910")]),s._v("\nSET cid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("910")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"使用select-into把选定列的值直接存储到局部变量中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用select-into把选定列的值直接存储到局部变量中"}},[s._v("#")]),s._v(" 使用SELECT...INTO把选定列的值直接存储到局部变量中")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT col_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" INTO var_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" table_expr\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# col_name 指定列名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# var_name 指定要赋值的变量名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# table_expr 表示SELECT语句中的FROM子句及后面的语法部分")]),s._v("\n")])])]),t("h4",{attrs:{id:"流程控制语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流程控制语句"}},[s._v("#")]),s._v(" 流程控制语句")]),s._v(" "),t("ol",[t("li",[s._v("条件判断语句 IF...THEN...ELSE语句 CASE语句")]),s._v(" "),t("li",[s._v("循环语句 WHILE、REPEAT、LOOP语句")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("IF 条件 THEN\n  表达式\nELSE\n  表达式\n\nWHILE 条件\n  表达式\nEND WHILE\n\nREPEAT\n  表达式\nEND REPEAT\n\nLOOP\n  表达式\nEND LOOP\n\nITERATE语句 用于表示退出当前循环\n")])])]),t("h4",{attrs:{id:"使用declare-cursor语句创建游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用declare-cursor语句创建游标"}},[s._v("#")]),s._v(" 使用DECLARE CURSOR语句创建游标")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DECLEAR cusor_name CURSOR FOR select_statement\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cursor_name 指定要创建的游标的名称")]),s._v("\n")])])]),t("h4",{attrs:{id:"使用open打开游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用open打开游标"}},[s._v("#")]),s._v(" 使用OPEN打开游标")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("OPEN cusor_name "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定要打开的游标")]),s._v("\n")])])]),t("h4",{attrs:{id:"使用fetch-into语句读取数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用fetch-into语句读取数据"}},[s._v("#")]),s._v(" 使用FETCH...INTO语句读取数据")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("FETCH cursor_name INTO var_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",val_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cursor_name 指定已打开的游标")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# var_name 指定存放数据的变量名")]),s._v("\n")])])]),t("h4",{attrs:{id:"使用close关闭游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用close关闭游标"}},[s._v("#")]),s._v(" 使用CLOSE关闭游标")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("CLOSE cursor_name \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cursor_name 用于要关闭的游标")]),s._v("\n")])])]),t("h3",{attrs:{id:"调用存储过程-综合应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用存储过程-综合应用"}},[s._v("#")]),s._v(" 调用存储过程(综合应用)")]),s._v(" "),t("p",[s._v("使用CALL语句调用存储过程")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("CALL sp_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("parameter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCALL sp_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sp_name 被调用存储过程的名称")]),s._v("\n")])])]),t("p",[s._v("示例：调用数据库mysql_test中的存储过程sp_update_sex，将客户id号为909的客户性别修改为女性 'F'")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之前创建的存储过程 sp_update_sec")]),s._v("\nUSE mysql_test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDELIMITER "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\nCREATE PROCEDURE sp_update_sex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IN cid INT,IN csex CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" \nBEGIN\nUPDATE mysql_test.customers SET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cust_sex")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("csex WHERE "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cust_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nEND "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\nDELIMITER "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用存储过程")]),s._v("\nCALL sp_update_sex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("909")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'F'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"删除存储过程-简单应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除存储过程-简单应用"}},[s._v("#")]),s._v(" 删除存储过程(简单应用)")]),s._v(" "),t("p",[s._v("DROP PROCEDURE")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DROP PROCEDURE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IF EXIST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sp_name\n")])])]),t("h3",{attrs:{id:"练习题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#练习题"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),t("p",[s._v("1.存储过程是一组为了完成某项特定功能的SQL语句集，其实质就是一段存储在数据库中的（  ）。答案：代码")]),s._v(" "),t("p",[s._v("2.创建存储过程使用的语句是（  ）。单选题，A")]),s._v(" "),t("ul",[t("li",[s._v("A CREATE PROCEDURE")]),s._v(" "),t("li",[s._v("B DROP PROCEDURE")]),s._v(" "),t("li",[s._v("C CALL PROCEDURE")]),s._v(" "),t("li",[s._v("D DECLARE PROCEDURE")])]),s._v(" "),t("p",[s._v("3.下面哪个不是循环语句（  ）。单选题，B")]),s._v(" "),t("ul",[t("li",[s._v("A WHILE")]),s._v(" "),t("li",[s._v("B CASE")]),s._v(" "),t("li",[s._v("C REPEAT")]),s._v(" "),t("li",[s._v("D LOOP")])]),s._v(" "),t("p",[s._v("4.DECLARE CURSOR语句的作用是（  ）。单选题 B")]),s._v(" "),t("ul",[t("li",[s._v("A 打开游标")]),s._v(" "),t("li",[s._v("B 声明游标")]),s._v(" "),t("li",[s._v("C 读取数据")]),s._v(" "),t("li",[s._v("D 关闭游标")])]),s._v(" "),t("h2",{attrs:{id:"存储函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储函数"}},[s._v("#")]),s._v(" 存储函数")]),s._v(" "),t("h3",{attrs:{id:"什么是存储函数-领会"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是存储函数-领会"}},[s._v("#")]),s._v(" 什么是存储函数(领会)")]),s._v(" "),t("p",[s._v("存储函数与存储过程一样，是由SQL语句和过程式语句组成的代码片段。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("存储函数")]),s._v(" "),t("th",[s._v("存储过程")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("不能拥有输出参数")]),s._v(" "),t("td",[s._v("可以拥有输出参数")])]),s._v(" "),t("tr",[t("td",[s._v("可以直接调用存储函数，不需要CALL语句")]),s._v(" "),t("td",[s._v("需要CALL语句调用存储过程")])]),s._v(" "),t("tr",[t("td",[s._v("必须包含一条RETURN语句")]),s._v(" "),t("td",[s._v("不允许包含RETURN语句")])])])]),s._v(" "),t("h3",{attrs:{id:"创建存储函数-综合应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建存储函数-综合应用"}},[s._v("#")]),s._v(" 创建存储函数(综合应用)")]),s._v(" "),t("p",[s._v("使用CREATE FUNCTION创建存储函数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("CREATE FUNCTION sp_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("func_parameter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nRETURNS "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" routine_body\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sp_name 指定存储函数的名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RETURNS type 声明存储函数返回值的数据类型；type指定返回值的数据类型")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# routine_body 指定存储函数的主题部分，也称为存储函数体")]),s._v("\n")])])]),t("p",[s._v('示例：在数据库mysql_test中创建一个存储函数，要求该函数能根据给定的客户id号返回客户的性别，如果数据库中没有给定的客户id号，则返回 "没有该客户"')]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deterministic [dɪˌtɜːmɪˈnɪstɪk] 确定性的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DETERMINISTIC ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# USE mysql_test;")]),s._v("\nDELIMITER "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\nCREATE FUNCTION get_sex_by_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cid INT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  RETURNS VARCHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  DETERMINISTIC\nBEGIN\n  DECLARE SEX VARCHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  SELECT cust_sex FROM customers WHERE "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cust_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cid INTO SEX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  IF SEX IS NULL THEN\n    RETURN "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'没有该客户'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ELSE IF "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SEX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'F'")]),s._v(" THEN\n    RETURN "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'女'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ELSE \n    RETURN "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'男'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  END IF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  END IF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nEND "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\nDELIMITER "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"调用存储函数-综合应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用存储函数-综合应用"}},[s._v("#")]),s._v(" 调用存储函数(综合应用)")]),s._v(" "),t("p",[s._v("使用SELECT调用存储函数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SELECT sp_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("func_parameter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nSELECT get_sex_by_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("901")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT get_sex_by_id(909);")]),s._v("\n+--------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" get_sex_by_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("909")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 女                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" warning "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT get_sex_by_id(9100);")]),s._v("\n+---------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" get_sex_by_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 没有该客户          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql> SELECT get_sex_by_id(904) as gender;")]),s._v("\n+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" gender "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 男     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"删除存储函数-简单应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除存储函数-简单应用"}},[s._v("#")]),s._v(" 删除存储函数(简单应用)")]),s._v(" "),t("p",[s._v("使用DROP FUNCTION 删除存储函数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("DROP FUNCTION "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IF EXISTS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" sp_name\n\nDROP FUNCTION IF EXISTS get_sex_by_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"练习题-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#练习题-2"}},[s._v("#")]),s._v(" 练习题")]),s._v(" "),t("p",[s._v("1.创建存储函数会用的语句是（  ）。单选题，答案：C")]),s._v(" "),t("ul",[t("li",[s._v("A CREATE PROCEDURE")]),s._v(" "),t("li",[s._v("B DROP PROCUDURE")]),s._v(" "),t("li",[s._v("C CREATE FUNCTION")]),s._v(" "),t("li",[s._v("D DROP FUNCTION")])]),s._v(" "),t("p",[s._v("2.写出调用存储函数的语法格式。简答题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\nSELECT sp_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("param1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(",param2,"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);